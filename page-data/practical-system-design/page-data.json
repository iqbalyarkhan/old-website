{"componentChunkName":"component---src-templates-post-js","path":"/practical-system-design","result":{"data":{"markdownRemark":{"html":"<ol>\n<li><a href=\"#system-design\">System Design</a></li>\n<li><a href=\"#generating-unique-ids-in-a-distributed-env\">Generating Unique IDs in a distributed Env</a></li>\n<li><a href=\"#back-of-the-envelope-estimation\">Back of the envelope Estimation</a></li>\n<li><a href=\"#storing-images\">Storing Images</a></li>\n<li><a href=\"#allowing-users-to-chat\">Allowing users to chat</a></li>\n<li><a href=\"#design-chat-messaging\">Design Chat Messaging</a></li>\n<li><a href=\"#design-rate-limiting\">Design Rate Limiting</a>\n<ul>\n<li><a href=\"#sharing-data-between-servers\">Sharing data between servers</a></li>\n<li><a href=\"#tcp-vs-udp\">TCP vs UDP</a></li>\n</ul>\n</li>\n<li><a href=\"#design-distributed-message-queue\">Design Distributed Message Queue</a></li>\n<li><a href=\"#design-distributed-cache\">Design Distributed Cache</a>\n<ul>\n<li><a href=\"#lru-cache\">LRU Cache</a></li>\n<li><a href=\"#replication-to-achieve-high-availability\">Replication to Achieve HA</a></li>\n</ul>\n</li>\n<li><a href=\"#notification-service\">Notification Service</a></li>\n<li><a href=\"#useful-architectures\">Useful architectures</a></li>\n</ol>\n<h3 id=\"system-design\" style=\"position:relative;\"><a href=\"#system-design\" aria-label=\"system design permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>System Design</h3>\n<p>Let's look at some example system designs and see the trade-offs between various approaches that can be used to design a solution.</p>\n<h3 id=\"generating-unique-ids-in-a-distributed-env\" style=\"position:relative;\"><a href=\"#generating-unique-ids-in-a-distributed-env\" aria-label=\"generating unique ids in a distributed env permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Generating Unique IDs in a distributed Env</h3>\n<p>Say you're given a distributed system and are asked to come up with a function to generate a globally unique ID for this system. On a single machine, this is simple, you just auto-increment an ID in your DB and you have a unique ID on each call. However, this isn't possible if you have a distributed system with multiple machines and multiple partitions.</p>\n<ul>\n<li><strong>Requirements</strong></li>\n<li>The ID should be unique across EVERY call and EVERY machine.</li>\n<li>It should consist of numerical values only</li>\n<li>It should fit into 64-bit</li>\n<li>Should be able to generate over 10,000 unique IDs/sec</li>\n</ul>\n<p>First thing that comes to mind is to use UUID that can be generated independently without coordination between servers. However, UUIDs are 128 bits long and are non-numeric: Example: 09c93e62-50b4-468d-bf8a-c07e1040bfb2.</p>\n<p>Another thing that can be done is to have a centralized generator. Every time you need to generate a new ID, this centralized generator is called. The issue here is that this is a single point of failure and is not scalable. It definitely won't be able to handle 10,000 unique IDs/sec.</p>\n<p>How about we just use time as the id? Hmm, ok so if I have distributed environment, it is possible that two different nodes are called at the same time to generate the id. Even if they're not, different nodes might have different clocks that might result in collisions.</p>\n<p>But the idea of using time does look promising ie using epoch time. Now to make it unique, we can add in the IP address of the server. So, we might be able to concatenate the IP address of the server with the epoch time and get a unique id right? Well, what if we invoke this function in the same microsecond on the same server? That would cause a collision!  Maybe we can use a counter that gets incremented every time this function is called. So something like: <code class=\"language-cpptext\">epochTime_serverID_counter</code>. Hmm, this would work!</p>\n<p>But wait a second, what if the machine reboots? What if it crashes, has to re-boot and then start generating unique ids again. Since the machine crashed, our counter would reset to 0. Maybe we can store this counter somewhere and have the server read it from there on restart. And every time it is incremented, we can push the counter value to this store! This sounds like a job for Redis! Yup, that would work. So, our unique ID would be: <code class=\"language-cpptext\">epochTime_serverID_counter</code></p>\n<ul>\n<li><strong>Approach</strong></li>\n</ul>\n<p>Ok, so we've deiced to have the unique ID like so: <code class=\"language-cpptext\">epochTime_serverID_counter</code>. Now, we can have up to 64 bits in the id. Epoch time takes 41 bits. How do I know that? Convert an epoch time value to binary and count the number of bits. For example,  epoch time 1288834974657 converted to binary is:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cppcpp\"><code class=\"language-cppcpp\"><span class=\"token number\">0</span>       epoch time                      <span class=\"token number\">40</span>\n<span class=\"token number\">10010110000010100100011010000001111000001</span></code></pre></div>\n<p>We're still left with 23 bits. For the sake of having a more robust id, we can add the datacenter id to the unique ID as well! So our unique ID would be:</p>\n<p><code class=\"language-cpptext\">epochTime_dataCenterID_serverID_counter</code></p>\n<p>Alright, so we've got 41 bits for epoch time. Next up, we can use 5 bits for our dataCenterID. This would result in a total of 32 data centers because <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>5</mn></msup><mo>=</mo><mn>32</mn></mrow><annotation encoding=\"application/x-tex\">2^5 = 32</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">32</span></span></span></span></span>. Our ID now is:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cppcpp\"><code class=\"language-cppcpp\"><span class=\"token number\">0</span>       epoch time                     <span class=\"token number\">40</span>   <span class=\"token number\">44</span> \n<span class=\"token number\">1001011000001010010001101000000111100000100001</span>\n                                        dcID</code></pre></div>\n<p>Next, we add serverId which we can have a bit longer, say 6 bits meaning we can have 64 servers in a datacenter:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cppcpp\"><code class=\"language-cppcpp\"><span class=\"token number\">0</span>       epoch time                     <span class=\"token number\">40</span>   <span class=\"token number\">44</span>    <span class=\"token number\">45</span> \n<span class=\"token number\">1001011000001010010001101000000111100000100001000001</span>\n                                        dcID serverID</code></pre></div>\n<p>and finally the remaining bits can be the counter value meaning <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>1</mn></msup><mn>9</mn></mrow><annotation encoding=\"application/x-tex\">2^19</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span><span class=\"mord\">9</span></span></span></span></span> giving us a total of 524288 per machine:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cppcpp\"><code class=\"language-cppcpp\"><span class=\"token number\">0</span>       epoch time                     <span class=\"token number\">40</span>   <span class=\"token number\">44</span>    <span class=\"token number\">45</span>   counter       <span class=\"token number\">64</span>\n<span class=\"token number\">10010110000010100100011010000001111000001000010000010000000000000000001</span>\n                                        dcID serverID</code></pre></div>\n<h3 id=\"types-of-encoding\" style=\"position:relative;\"><a href=\"#types-of-encoding\" aria-label=\"types of encoding permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Types of Encoding</h3>\n<p>Encodings could be base36 ([a-z ,0-9]) or base62 ([A-Z, a-z, 0-9]). If you use base 36 encoding and have a 4 character string, possible number of strings would be: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>3</mn><msup><mn>6</mn><mn>4</mn></msup></mrow><annotation encoding=\"application/x-tex\">36^4</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord\"><span class=\"mord\">6</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">4</span></span></span></span></span></span></span></span></span></span></span></span>. For 62 base encoding and 7 character string: <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>6</mn><msup><mn>2</mn><mn>7</mn></msup></mrow><annotation encoding=\"application/x-tex\">62^7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\">6</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">7</span></span></span></span></span></span></span></span></span></span></span></span>.</p>\n<h3 id=\"back-of-the-envelope-estimation\" style=\"position:relative;\"><a href=\"#back-of-the-envelope-estimation\" aria-label=\"back of the envelope estimation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Back of the envelope Estimation</h3>\n<p>Below is a table explaining the data volume unit</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.91329479768786%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQUlEQVQoz23TB45CMQwE0H//S9J77x2vniV/AdpIJmFiz4xNaIbDYcxmszidThmHwyFGo1GMx+OMyWQSi8Uiz/D1eh3n8zl2u12odT+fz1usWS6Xsd/v4/V6xfv9jvv9ngTb7TYDgcSKy+US1vV6zbvNZpO4xVBD4Xa7ZYKdEsJShyFx7na7SUBUMdc6ejwemZcO2VVQcTwek5Dzak9RYbohDlNrVwfTUTOdTlPh+XxmUIdRhxsFdXMeDAZ5Jw/GdY1LMNNI/HVImSNtlRvu5K5WqxaTg/DLoV+ugJoXJ8IZhpizTqeTYpwTVmumcv6dIVKJZifK4Sf2OUOu3fneOizFmiElFxw5e0qVbK5IC3Nm5GuGnsevQ2Ta6fV67YNH1u/3c26EOFRL6MuhD4uqxSVSBXa4DupfVA+73qL8Wp7YH3CuS50TXCDZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Power of Two\"\n        title=\"Power of Two\"\n        src=\"/static/fc08d92bfc92d5aecf388f5ebaef136b/1e043/power-of-two.png\"\n        srcset=\"/static/fc08d92bfc92d5aecf388f5ebaef136b/991de/power-of-two.png 173w,\n/static/fc08d92bfc92d5aecf388f5ebaef136b/e4d6b/power-of-two.png 345w,\n/static/fc08d92bfc92d5aecf388f5ebaef136b/1e043/power-of-two.png 690w,\n/static/fc08d92bfc92d5aecf388f5ebaef136b/20982/power-of-two.png 778w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Some common facts:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-cpptext\"><code class=\"language-cpptext\">               • Memory is fast but the disk is slow.\n               • Avoid disk seeks if possible.\n               • Simple compression algorithms are fast.\n               • Compress data before sending it over the internet if possible.\n               • Data centers are usually in different regions, and it takes time to send data between them.\n               </code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 550px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.47976878612717%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAEF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB2AQH/8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQABBQJ//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAEP/aAAgBAQAGPwJ//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAEhUf/aAAgBAQABPyGEwbP/2gAMAwEAAgADAAAAEAAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGRAAAgMBAAAAAAAAAAAAAAAAAAERIUFR/9oACAEBAAE/EE9InQuUcP/Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Power of Ten\"\n        title=\"Power of Ten\"\n        src=\"/static/a68ec88b918976a97c85a9df1a08b912/d7854/powers_of_10.jpg\"\n        srcset=\"/static/a68ec88b918976a97c85a9df1a08b912/9ac50/powers_of_10.jpg 173w,\n/static/a68ec88b918976a97c85a9df1a08b912/8d48c/powers_of_10.jpg 345w,\n/static/a68ec88b918976a97c85a9df1a08b912/d7854/powers_of_10.jpg 550w\"\n        sizes=\"(max-width: 550px) 100vw, 550px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<ul>\n<li>Single Character requires 1 byte</li>\n<li>Integer requires 4 bytes</li>\n<li>Media requires 1 MB</li>\n</ul>\n<p>For variable length strings, we need this calculation to determine the number of bytes needed:</p>\n<div class=\"math math-display\"><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mtext>Total size (in Bytes)</mtext><mo>=</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">(</mo><mtext>Number of bits used to encode a single character</mtext><mo stretchy=\"false\">)</mo><mo>∗</mo><mo stretchy=\"false\">(</mo><mtext>Number of characters</mtext><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mn>8</mn></mrow><annotation encoding=\"application/x-tex\">\\textrm{Total size (in Bytes)} = ((\\textrm{Number of bits used to encode a single character}) * (\\textrm{Number of characters}))/8</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord textrm\">Total size (in Bytes)</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">((</span><span class=\"mord text\"><span class=\"mord textrm\">Number of bits used to encode a single character</span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord textrm\">Number of characters</span></span><span class=\"mclose\">))</span><span class=\"mord\">/8</span></span></span></span></span></div>\n<p>If we are using ASCII encoding, we need 8 bits to encode each character, so Number of bits used to encode a single character = 8\nIf we are using UNICODE encoding, we need 16 bits to encode each character, so Number of bits used to encode a single character = 16.</p>\n<h3 id=\"storing-images\" style=\"position:relative;\"><a href=\"#storing-images\" aria-label=\"storing images permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Storing Images</h3>\n<p>Say, for example, that you're creating an image sharing system (instagram like service) and need to store images for your service. How/where would you store them? You have 2 options: use a DB and store images as blob (binary large object) or use a distributed file system and have a DB store location of images for each user. Let's have a look at the pros and cons for each:</p>\n<p><strong>Why DB</strong></p>\n<ul>\n<li>DB is ACID (Atomicity, Consistency, Isolation, Durability) compliant</li>\n<li>DB provides data integrity between the file and its metadata (Files can be deleted from FS causing database integrity to be compromised.)</li>\n<li>Much easier to perform backups as the entire process is built-in</li>\n<li>Database indexes perform better than file system trees when more number of items are to be stored</li>\n<li>File deletion and updates becomes simpler as opposed to a File System.( In the case of FS, we first delete the mapping from DB and then delete the image from FS as well. There’s this extra overhead to make sure that the file in FS is deleted. In DB this operation is atomic)</li>\n</ul>\n<p><strong>Why DFS</strong></p>\n<ul>\n<li>If your application uploads a large number of high-quality images, your DB backups become huge, which can have a significant impact on the makes replication speed</li>\n<li>FS can be accessed via a CDN without allowing the user’s request to go through your Application and Database layers</li>\n<li>Needless to say, this will be cost-effective as compared to DB</li>\n<li>Easier in cases where files has to be shared with third-party providers</li>\n<li>Storing/retrieving BLOB in DB is a heavy process</li>\n<li>For the application in which the images will be used requires streaming performance, such as real-time video playback</li>\n</ul>\n<p>The case against DB is that for images, we aren't ever going to use ACID properties (those are for financial transactions etc). DFS is cheaper as compared to a DB, it is faster and a DFS can make use of a CDN to render our images for us.</p>\n<h3 id=\"allowing-users-to-chat\" style=\"position:relative;\"><a href=\"#allowing-users-to-chat\" aria-label=\"allowing users to chat permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Allowing users to Chat</h3>\n<p>XMPP, an Extensible Messaging and Presence Protocol, helps to build a real time chat application. XMPP provides an open and decentralized instant messaging services. As the name indicates, it is a highly extendable protocol formerly known as Jabber protocol. To exchange the information, XMPP uses Extensible Markup language (XML) as the base format. XMPP uses the TCP protocol to maintain connections between 2 clients.</p>\n<p>A simple XMPP architecture consists of a server and two clients. Every client acts as the part of a common domain where the servers can also communicate for the purpose of routing between domains.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.965317919075144%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAABI0lEQVQY0x3OP0sCYQCA8ftErg21NThkQy1FQdTQUBANNdUXCCQIkobaAhUTyyGIwIggRQ001KzQ0IK6sD+S3nt37/ue90Stz295jL70KNbbXORr5G6bFCstbOkDPgK4Nz/I3T1Saj7TcQdo/8+g3fkhU6iSLTfIlhqYX/Z/N2IPivGkzWJKMH8oCIUFsSsJDNg2FastyXrDYaXuMHvj0ux5fAqPmVOHuZTNQkwwtSdY2ncQro8RKUoCOxZju4LglkVg2SJy7AIea0+SiarDdNlhsmAzdG5T62rMnmb4wGY0IgiGLUY2LEKbgr7wMervHtGiIpFXHF0rohlJveX97+e+Nak3RfpVc/KiSbYUXenjap90RREvKBI5RfxScpZXaO3zC5kwEKqQh8TjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"XMPP\"\n        title=\"XMPP\"\n        src=\"/static/d527af46a6735b6995513f73acaafa7a/1e043/xmpp.png\"\n        srcset=\"/static/d527af46a6735b6995513f73acaafa7a/991de/xmpp.png 173w,\n/static/d527af46a6735b6995513f73acaafa7a/e4d6b/xmpp.png 345w,\n/static/d527af46a6735b6995513f73acaafa7a/1e043/xmpp.png 690w,\n/static/d527af46a6735b6995513f73acaafa7a/00b70/xmpp.png 733w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://blog.mirrorfly.com/xmpp-use-cases-for-scalable-chat-platform/\">Image Credit</a></p>\n<p>XMPP protocol is a great fit for Real-Time Web applications like Live News, Interactive web page, web games and web chat. It provides inbuilt security with multiple layers. Moreover, here the users need to authenticate both host servers as well as messages to prevent the risk of spoofing. Eventually, it eradicates the fear of spamming. Now, when you use XMPP in a chat service, you need to able to keep track of the user ids and connection ids that are being used by each user. To do so, you can have a <strong>connection service</strong> that maintains this information for you:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 664px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e23888c3ea53e52a0b07e60826e00e85/31493/chat.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.445086705202314%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABA0lEQVQoz5WS147FMAhE8/9fmKcbpUnpvTdWB4mrbLR5WCRiB2ZgjO0cxyFvfp7n16/r+rVa/ol3nkRLrusqXdept22rbvtpmuSN5xgZX5ZFgxikbdvkafu+yzAMWoS8cYmrwnmeJUkS8TxP17quhVie59L3vQJRRpFxHJXEP5gwDCWOY/F9X/GMw4GAGnO6Evt8PtrkflwaULBpGimKQrIsU0wURSpEFfIxowNHpihq0zTV2N3Io5QGVVVJEARa2MbgcH4AuM0QMEDXdaUsS1V2vyDDsmIUIq4FAaMEp5PN5357zz2rXY41osH3UmxGAIwE4e19Wu6vhs79LT0f6n8dhT+/YAq97dI3cQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Chat\"\n        title=\"Chat\"\n        src=\"/static/e23888c3ea53e52a0b07e60826e00e85/31493/chat.png\"\n        srcset=\"/static/e23888c3ea53e52a0b07e60826e00e85/991de/chat.png 173w,\n/static/e23888c3ea53e52a0b07e60826e00e85/e4d6b/chat.png 345w,\n/static/e23888c3ea53e52a0b07e60826e00e85/31493/chat.png 664w\"\n        sizes=\"(max-width: 664px) 100vw, 664px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>XMPP uses XML to exchange data between client and server. Whenever a client connects to an XMPP server using a chat application, they transmit information with each other which is also known as an XML “Stanza”. Stanza is a basic unit of communication in XMPP. In XMPP based communication, there are 3 types of stanzas:</p>\n<ul>\n<li>Message: Used to exchange messages.</li>\n<li>Presence: Used to exchange online and subscription status.</li>\n<li>IQ (Info/Query): Used to control dynamic settings of the communication that is controlled over the server.</li>\n</ul>\n<p>Advantages of XMPP:</p>\n<ul>\n<li><strong>Extensible</strong>: XMPP can be used to send different message types including text, pictures, videos, and audios</li>\n<li><strong>Decentralized architecture</strong>: Which means anyone can set up an XMPP server</li>\n<li><strong>Security</strong>: XMPP allows developers to set up a separate storage server which can have its own encryption and security standards</li>\n<li><strong>Flexibility</strong>: Can connect to non-Jabber programs as well using special gateway services</li>\n</ul>\n<p>Disadvantages of XMPP:</p>\n<ul>\n<li><strong>No default way to assure message delivery</strong>: XMPP doesn’t provide the ability to request message delivered confirmation by default. The developers need to set up message receipts manually.</li>\n<li><strong>Slow speed</strong>: The decentralized architecture of XMPP allows anyone to run his/her own server, however, it does eat up on the speed of the connection.</li>\n</ul>\n<p>We've already talked about websockets and WS can also be used to implement chat based applications. Let's see its advantages and disadvantages:</p>\n<ul>\n<li><strong>Speed</strong>: With a centralized and persistent communication connection, WebSockets are the fastest online communication method.</li>\n<li><strong>Unlimited open sessions</strong>: There can be an unlimited number of user sessions on a single app.</li>\n</ul>\n<p>Disadvantages:</p>\n<ul>\n<li><strong>Low Security</strong>: Although WebSockets utilize WSS(Websockets of SSL), the technology is still new and prone to attacks like XSS and DDOS.</li>\n</ul>\n<h3 id=\"design-chat-messaging\" style=\"position:relative;\"><a href=\"#design-chat-messaging\" aria-label=\"design chat messaging permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Design Chat Messaging</h3>\n<p>Requirements:</p>\n<ul>\n<li>Users should be able to chat in a group</li>\n<li>Sent + Delivered + Read Receipts</li>\n<li>Person online/last seen</li>\n<li>Chat history (permanent vs temporary)</li>\n</ul>\n<p>Ok, let's start with the basic setup of how we want our users to interact. We'll use an API gateway which'll capture requests from client:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 373px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1818904cadfe32d89e5945a6b8d92e94/67a5d/messaging1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 112.71676300578035%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAABx0lEQVQ4y5WViY7CMAxE+/+/iESFKHeh3CCurJ6liYxJQRvJJA3O+Bg7qe73e3o+n+nxeJj4tRfpIa/X60N0rkJRB0rrCHg6ndLhcEjH49FmifQN0FuJFj0g83g8TpvNJnVdZ/Nut7M9DHCuQul2u5mV8/mcLpeL/cnswWWsbdsUx36/N88NEMXlcmmK0+k0NU1j35PJJBuQYHQ+nxuIDDHw9s3D1WplIeH6bDazwxxEEeuExTwajcygABHGdrs1QAxUbJILAPByvV6bh4iGP4zxEiAhMzIpkQS+I+uIDPV6yIHr9WphsUneyBUWI8sRUDn8CBklQoUI8rhYLCwF8lTei8A4FHJmmbxQOiQcULGJEZQhh7mua/sfXYBF2hvLALIhAAjCAAdiuKQG4jBIJICrGnLIIsUn3rdd7PO+kN/q0JeHX5cuiz5Scg5RAh232WSNAqyXbp2fZcMPeSB3g8EgDYdD+6YNSb5Pg8j42SlimRlPOQwgazyVx7AMGV87hTB8mSDUIWCl7vnpYWw9FXLfza1e/srytycgfhOJ32MQVQb875sCIGGr+JkpcK68HHLpHSm9KT4l8SbX7VQMOeazr2tKqfkDZ6YAGFwOyCgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Messaging\"\n        title=\"Messaging\"\n        src=\"/static/1818904cadfe32d89e5945a6b8d92e94/67a5d/messaging1.png\"\n        srcset=\"/static/1818904cadfe32d89e5945a6b8d92e94/991de/messaging1.png 173w,\n/static/1818904cadfe32d89e5945a6b8d92e94/e4d6b/messaging1.png 345w,\n/static/1818904cadfe32d89e5945a6b8d92e94/67a5d/messaging1.png 373w\"\n        sizes=\"(max-width: 373px) 100vw, 373px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Ok, to allow your users to chat, you'd have to keep track of connection information (port etc). This information can be stored in API GW. However, the downside is that our system would not be loosely coupled. We want a separate microservice that handles all sessions for us, leaving the gateway to concentrate on the edge functions. So, the flow would now be that the user connects to our API gateway, and API gateway calls the <strong>sessions</strong> service.</p>\n<p>Our sessions service would reside behind a load balancer and we'll have multiple servers working as sessions service. The service would also need access to a DB where it'll be able to update/retrieve user session information. For that, we'll create a table with userID, connectionInfo etc. The type of data store I'm thinking here is a MySQL DB since we'll be able to quickly access user info by creating an index n userId. So, our architecture will look like so:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8de4c6545a0eb27072193e18161cf29a/6c745/messaging2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.75722543352601%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABQ0lEQVQoz52T62qEMBCFff933B+lRS3rLfdkJvGUma3WUtjCCodMDHP8TE66WitEsfhTiQI2N+NjeEM/vuNz6hGLQ8gPSf2QP+tQHApndPu+gysjkUfOGc47OGeRcgIxIZcMooJaGW1v2LGjtgpm0nUZpb9QQioe3bpusM7ol62xaK2BiBBCUMm6jPJuHEfcbjcYY7AuK4Z+ADOj1QbiglQCumVZYJ2FT1YNlZgZ3ns45zDPs9ZCP00T+r7XeYgB9/tdt+s0pG9D560SeudPw5QS5BHiQ7Imus6PM/hNaI0SGmO13rZNDaXpaHiuC2EphEIZmQJSTNj3poQxxtcMx2HEss6wYdMDOH7jZUI5PSXkiBAeVExC+NdQNv861sv8NNSYMGk4heqaQ8kXH1l7KkampEHvrjdFwn3Vz234X6FYDfcXsTJaJCdFjEgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Messaging2\"\n        title=\"Messaging2\"\n        src=\"/static/8de4c6545a0eb27072193e18161cf29a/1e043/messaging2.png\"\n        srcset=\"/static/8de4c6545a0eb27072193e18161cf29a/991de/messaging2.png 173w,\n/static/8de4c6545a0eb27072193e18161cf29a/e4d6b/messaging2.png 345w,\n/static/8de4c6545a0eb27072193e18161cf29a/1e043/messaging2.png 690w,\n/static/8de4c6545a0eb27072193e18161cf29a/6c745/messaging2.png 893w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now, when userA wants to connect to userB, userA will send a <strong>sendMessage(B)</strong> request to our API GW. API GW will forward that request to sessions service. Sessions service will determine which port userB is connected to (using information from the DB) and will forward request to the appropriate connection and thus sending the message to userB. Now, to actually send message to userB (client) from server, we can use multiple techniques as discussed earlier such as long polling, ajax, websockets or xmpp etc. Now in the <a href=\"#allowing-users-to-chat\">chat</a> section, we compared XMPP and websockets. One advantage of using websocket is that it allows for unlimited open sessions over TCP. Since we're looking for group chat as well, we'll go ahead and use websockets that communicate via TCP.</p>\n<p>One requirement for our chat app is that the sender should be able to see sent + delivered + read receipts. In order for us to be able to show to userA that the message was <strong>sent</strong>, we can send a response back from session service to gateway and back to userA that the message will be sent when possible. In order to store this information, we'll need another DB for our sessions service. This new DB will hold our message statuses. This flow is shown with red arrows in the diagram below:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7abdc1a0abd425dbde2bbff0907f52c3/59000/messaging4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.445086705202314%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABc0lEQVQoz2VS2W7DQAj0//9kEqVu4yN29mTZw1OBHStVH0asgB2Go6u1YkdDZI/IDsQeKQcsZkb/uONn7LG8JvXHE07t2xeS/AvohCznrKQxe1AiOGdhnQVnRqkFzEmtomTkklFa1bjmqI+1SGetxTCOeE0TolsQlhWlFKSUkLyHNwbP5wIyBullcLlc0N/vCPMT0zBiGEZkPgSxR0dEEFKKUdtMRGitKSkZC3IezntkZtRSMA8D1mkCU8L4eOAxDJor6pXQOYdpmmCMhSejn/2BXAratmkBnXNr2EpBDRGZCN9fPb76HizF3oTSWggBotSTPcn8oaqdS9uhalICh4D77Ybr9aq+k1DI5nlWUmmZPlqWyqe6T7SmfomLIC30JhQl67rqHG1YYcwLte2bT5z0/Y+wFrWt1bOgbFoJxbEdc9KlJEaMhCBz4oytSWyP79jQ6oc93kIqN9l9HrZPRg/URQMfzXnEfw/6L0gRENghJItf7TMJpMOK/MsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Messaging4\"\n        title=\"Messaging4\"\n        src=\"/static/7abdc1a0abd425dbde2bbff0907f52c3/1e043/messaging4.png\"\n        srcset=\"/static/7abdc1a0abd425dbde2bbff0907f52c3/991de/messaging4.png 173w,\n/static/7abdc1a0abd425dbde2bbff0907f52c3/e4d6b/messaging4.png 345w,\n/static/7abdc1a0abd425dbde2bbff0907f52c3/1e043/messaging4.png 690w,\n/static/7abdc1a0abd425dbde2bbff0907f52c3/59000/messaging4.png 917w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>When userB opens the app on his/her end, the message gets sent to userB's phone. Upon receipt of the message, userB's phone should respond with a message saying that he/she received the message from userA. At that point, the <strong>delivered</strong> confirmation flows from userB to API GW to sessions service and back to userA. This done via a TCP acknowledgement. userB will send back the info that it received message from userA and sessions service will deliver the delivered receipt by looking up the box where userA's connection resides and will send the confirmation back to userA. This flow is shown via blue arrows in the diagram below:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0ab8c22cfb30c170c9bfa2e57ef766fb/b3ad9/messaging5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.445086705202314%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVQoz2WS6W7jMAyE8/6vuP2xSevGkW+dpK5ZkA6SFmvggyWCGg0pXmqtEFptSBwQ2CGyR8oBh18xjJ+4mwHT+tD4C3I/9uc6kMVFxJhZBakERAoIIcA5C2JC6w2cGa1VpZSMnDNKrcgl61n5i46nAxfvPcbHiOUxYd9mzONDxXMpsLvFsR0w04xt2WCXDV+3T/y9XuGmGYsxuI+jGugdp0MiUjfWBdjosO4H5GutYV93Fd0PCx8SfGIMd4PVGGRmrNOEYRiQUkJv/RQUdWMMrHVwyWF3DnKJOHcxIUsrckEuFVQqfGS0GFGZYcYR19tNc18OpQciGhPBJofVvgUPH1SMuCA9ybmgEKES4fH9jT8fH++S2eIidud51iDlAO/dq2SihN4bWq2vRxFqa4r0Wc6XUtCkZH6WvK6rlnz4DcsyAx36apJc2zlWvylPql4sa3lIFZRA712bKrMXYwRTRowJlEjjkix5Jz/29U1v0HnUOVTLcgNZxUcLF49zwDn8Jof/YyztinBpwz/wLwiyqOKAEQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Messaging5\"\n        title=\"Messaging5\"\n        src=\"/static/0ab8c22cfb30c170c9bfa2e57ef766fb/1e043/messaging5.png\"\n        srcset=\"/static/0ab8c22cfb30c170c9bfa2e57ef766fb/991de/messaging5.png 173w,\n/static/0ab8c22cfb30c170c9bfa2e57ef766fb/e4d6b/messaging5.png 345w,\n/static/0ab8c22cfb30c170c9bfa2e57ef766fb/1e043/messaging5.png 690w,\n/static/0ab8c22cfb30c170c9bfa2e57ef766fb/b3ad9/messaging5.png 909w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The flow above is also relevant for read receipt. UserB would send another message back to our API GW once the app is opened and message is read on userB's phone. This will result in a <strong>read</strong> receipt being sent back to userA.</p>\n<p><strong>Let's tackle our third requirement: last seen/online</strong></p>\n<p>Let's say userB is online and is chatting with others. UserB will send requests to our API GW via websocket connection. Remember, we've already stored userB's connection information in our sessionsDB. We can look at the sessionsDB to see whether connectionInfo related to userB is actually showing an active connection or that the connection has been closed. If it is active, we can show to userA and userC that userB is online. If connection is inactive, we need another method to determine last-seen. For last-seen, as userB exits the app, we can send a message from userB's phone to API GW and to session service saying that userB has terminated the connection. We can store this information in a Redis cache data store with userB's uniqueID and time-stamp. So, any time userA or userC clicks on userB's profile, we can display the last time userB was online: which would be the time-stamp when userB exited the app.</p>\n<p><strong>Group messaging</strong></p>\n<p>Let's focus now on group messaging. Earlier we talked about two users chatting; what if we have multiple users who're part of different groups. In the diagram below, users are grouped as shown and each user can be connected to a different API GW (remember, API gateway is also a service which needs to be highly available and resilient):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8da53acf9ea9b7a3a55b0a0916df31ba/b2cef/messaging6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.19653179190751%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIUlEQVQoz41S2YrDMAz0/39gH/rSJqVHLsuJ4yPnLCMwLCzsbkDIljSjkRxzHgeOb5ZzhvceIQQsy6Kxfd//tII3EmZ0TuDCjBQjpmmCtRbOObxer1/B5bxtm9YPwwBjZ0ErLcQ7pJSwrqsmuq5Tz3sBFk/lRT2nadsWVVXhfr/D7ItgHhusWRBi0gKqjDFqV5KQlCugEja63W6o6xoionHWcCrmzLImhOyRl4QUkxaRgIQk7/teOxNAJcw/Hg9dByfizinger3icrnA9N6jsYJuHHWHBBBM+3w+aJpGiTkilfCjJxEJacw/n09tZOY0QbxFSB7Hfmi39/utykhK8HmeP16b9xKn51RsarYs8K7BlkfdIRPsyt3wXF7xP78O7QtzYWrFzcVnIAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Messaging6\"\n        title=\"Messaging6\"\n        src=\"/static/8da53acf9ea9b7a3a55b0a0916df31ba/1e043/messaging6.png\"\n        srcset=\"/static/8da53acf9ea9b7a3a55b0a0916df31ba/991de/messaging6.png 173w,\n/static/8da53acf9ea9b7a3a55b0a0916df31ba/e4d6b/messaging6.png 345w,\n/static/8da53acf9ea9b7a3a55b0a0916df31ba/1e043/messaging6.png 690w,\n/static/8da53acf9ea9b7a3a55b0a0916df31ba/b2cef/messaging6.png 847w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now, here's the requirement: we want to determine if the user we just received a message from is present in a group and if the user is sending a message to a group or a single individual. If it is a single individual, the API GW call would be <strong>sendMessage(B)</strong> as we discussed earlier. If it is a group message, message received on the API GW would be <strong>sendGroupMessage(userA)</strong>, meaning userA is trying to send a group message to his/her group. Now, we need to determine what group userA is trying to send message to. If we ask session service to determine that for us, we'd be coupling our functionality so instead, let's have a separate service that handles our group information. Let' call this group service. What will now happen is that if sessionService receives a group message request, it'll call groupService to determine all the users in that group. GroupService will return that information, which'll be connectionID (remember webSockets allow us to have multiple chat sessions), where we'll be able to send message to the entire group. Group service needs to have a data-store where it converts groupId to connectionIds since different users can be on different connections:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/96af3d5ac10f12b1d4b8d7675e4e5100/42d54/messaging7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.93063583815029%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABVElEQVQoz22S6W6DQAyEef/ni5RGEQpNaAjXssAesBxTjRtQ0vaHhTCeb3wQhWkCY55nOOdQVRX6vkfbtpie+d/xml+WRZ4hBHlGWVWiaDV028JZi67rBJrnOay1u2CLdV334PswDFKbpimMMYiULtAbBecsxnEUWFmW0FpLMbDuIMIpoimnYQ2nybIMSZJIA5EzCvPYCbBpGoEQzI/GWvTWQiklEArP5zOOxyOKopAaGhHKLmkS+RDgwyhJCrkLgryz+MxyfMSJGDVKiRlrOB5h9rmiy+WCw+Ege4/SMsdDK1jnpIDj3u933IsKX6WSbnmEbW8bcDsMc4Rer1cxjJrmAe85qkdvjMDoVDcaYZrfjkL47XZDHMcC5TvzBNLIe49ocC3m0GMch13ITqcQ/lz49fegmGtisLvT6fRz5WVZMS/Lm/g/0O9vy1PDkQmq61pG/gYl8rZr0adWxwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Messaging7\"\n        title=\"Messaging7\"\n        src=\"/static/96af3d5ac10f12b1d4b8d7675e4e5100/1e043/messaging7.png\"\n        srcset=\"/static/96af3d5ac10f12b1d4b8d7675e4e5100/991de/messaging7.png 173w,\n/static/96af3d5ac10f12b1d4b8d7675e4e5100/e4d6b/messaging7.png 345w,\n/static/96af3d5ac10f12b1d4b8d7675e4e5100/1e043/messaging7.png 690w,\n/static/96af3d5ac10f12b1d4b8d7675e4e5100/42d54/messaging7.png 858w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>There're multiple improvements to consider:</p>\n<ul>\n<li>We can have consistent hashing for db partitioning</li>\n<li>We can have MQs between services to handle failures</li>\n<li>We can have retry mechanisms between services</li>\n</ul>\n<h3 id=\"design-rate-limiting\" style=\"position:relative;\"><a href=\"#design-rate-limiting\" aria-label=\"design rate limiting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Design Rate Limiting</h3>\n<p>The requirement here is simple: we already know what rate limiting is. Now, we need to design it for our service. Before we begin to design rate limiting for a distributed system, let's design one for a single server first!</p>\n<p>On a single machine, all we need to worry about is the fact that there's a rules DB that'll hold the criteria based on which we'll throttle requests. We'll have a background process that routinely polls the DB for these rules and saves them in memory. Disk reads are expensive so we'll look to save these rules in memory using Redis cache. We'll check these cached rules whenever a request comes in and determine whether the request can be allowed through or not. Next, we'll have to keep track of the number of requests made by the client (we can id the client based on their IP address for example) in the past second and check whether the threshold has been reached as set in cache. If threshold is not reached, we can allow our request to go through. If threshold is met or exceeded, we have 3 options: drop the request, send back a 503 (service unavailable) or 429 (too many requests), or add the request to a queue and wait for threshold to recede:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/595a2ca3a5a61950f220baf78b08f02c/2b2c6/ratelimiting1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.884393063583815%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA+UlEQVQoz5VR2W7EIAzkQ3pllxxAOEIg17ZRpf7/N01lq1R0pUrtwwh7bMaXeGk17nHpR5iQGNfB4lkq5ul9ug6MOr+Oi2LUpFQOUz5gpwXKRS5Awp32MCFD+8Rc0xn+05mAfJxYb+8QRFLwR4L2aLVnP+SdhcdpQVxvcHFlLu8n0v6GeXvFcX5wIfKF9jN82pigSg9Nxx3248QvCdOIj5eeORKm/DFklGYGGzlm40qCCXKwkMpyNRKeloOTaMzehO91tMrxXsvI9aoolzihbITxiUE2keqrorwT/O0o9WFEMeoPZVQS7yrBv0DUTlNd2c0bH4A6/Y/gJ97t7P0MK3hpAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RateLimiting1\"\n        title=\"RateLimiting1\"\n        src=\"/static/595a2ca3a5a61950f220baf78b08f02c/1e043/ratelimiting1.png\"\n        srcset=\"/static/595a2ca3a5a61950f220baf78b08f02c/991de/ratelimiting1.png 173w,\n/static/595a2ca3a5a61950f220baf78b08f02c/e4d6b/ratelimiting1.png 345w,\n/static/595a2ca3a5a61950f220baf78b08f02c/1e043/ratelimiting1.png 690w,\n/static/595a2ca3a5a61950f220baf78b08f02c/2b2c6/ratelimiting1.png 869w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Cool, we've got the design working for a single server. Now, let's talk about a simple algorithm to handle rate limiting: bucket algorithm. Here, the idea is simple, we will have a bucket with <strong>tokens</strong> and each request from the client will deplete the tokens present in the bucket. Each second that passes, we'll refill the bucket with one token. Now, say for example we start with one server that has one bucket with 4 tokens (ie 4 requests per second) and receives 5 requests within the first second, first 4 requests will be allowed to go through while the final request will be throttled. That's the algorithm in a nutshell for a single server.</p>\n<p>Now imagine, these requests coming in to our distributed microservice. Say we have 3 hosts handling our requests, where each host is initially allotted 4 tokens. Since our architecture would have load balancers, say our requests are distributed like so:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8178beeb748f5bee94543f57738e7e0e/e0885/ratelimiting2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.53757225433526%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABxklEQVQoz3WQ/0/aUBTF+29vf45LzJK5xJGx7Ac0GseEGawKMksLTNTSUhgItdD29X2WR8sXK3vJycu7595zz3kagJSS1T0cDhkMBoxGI1zXxXEcxuMxnuctOQVVVz0K6r2aVdDIzkp011ECtm3/l9+e1fIO8xBC0Gg0MAyDKIqWfUmSvOrZ6TC/bbtZ168oFotLoVdcTnTtcCP01qk6bcvkolp5I7i9fC24y3a2AikTZCI27lXULG6+Pxd5EyElUyF1p38mSEScJZApl7ld9a/SaUEoSJLNlmARKyupkIR5KECKZS2MBLHYJFiEMVEstmYFmvk0Yx6DmHkoD8bDNLOfECwiTDtYO7H/hniT+drpkxfg+RL5MiRM0lmt3h0zqpcYH75j2rlAvf3ZFN+fMZz4NG5NFr1L5vc1up17es4zwcuMwJ/Stqf09FOeC++Z/D6l3p2gVRs9zg73qXw7oPz1Ez/rjwzcPo7T57HvUToqUyl84PzLHscnFVp/HAaug+f2uTH7lA72+fX9Mz8KHzm7fkBrmRaXtx2OyzWqVwZGy6TdbmNZChbNVpdyrclRucZN01rWFK+gZvVml5NznYp+x51h8g/J7ZRdvvqsPwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RateLimiting2\"\n        title=\"RateLimiting2\"\n        src=\"/static/8178beeb748f5bee94543f57738e7e0e/1e043/ratelimiting2.png\"\n        srcset=\"/static/8178beeb748f5bee94543f57738e7e0e/991de/ratelimiting2.png 173w,\n/static/8178beeb748f5bee94543f57738e7e0e/e4d6b/ratelimiting2.png 345w,\n/static/8178beeb748f5bee94543f57738e7e0e/1e043/ratelimiting2.png 690w,\n/static/8178beeb748f5bee94543f57738e7e0e/e0885/ratelimiting2.png 918w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>We've already consumed our allotted 4 requests for the current 1 second window and should throttle all remaining requests HOWEVER, each of our hosts still has tokens available. How do we make sure we throttle our requests? We need the hosts to talk to each other and determine the TOTAL number of tokens consumed:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/33d32425ebb80eb7e857ee9c0e3ce1be/b94e3/ratelimiting3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.22543352601156%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABsklEQVQoz3WPW2/aQBSE/f8f+9L+gDxWVaWqfavUQikKgfiGMOBLkCgiYbENOLbj61etMS0N9Eij3Z0zc3aOUtc1rxGGIUEQ4Pt+A/mWp+QkttstQgjiOEbWuVfhSp0LZC2XS1ar1UXv1D8v5VrCc6Os+dzGtu0L/toHTcL6P+mq1mgYBv1+/2r6qwlpBFUr5CJl9pKSpcmrDU79irqqoPUraRzhiw2hL5D3Y966ETXC9i0NDX8a0EytqIqMfRgQ7XfUZY4iyTwv2EVpoylqOMT5nxWitKSsjomipOS0aRTnFK1GeouibD5Uijwnek5ZPMZU7nf2yykPTyllkZFlGQ+rHUm0o0gPLNZ7kvSlSbV4Stg5d9S/hiw2KYfnBDlL2YoN603A3UBl8vEN959v0KYrAl/g+wEjzUL9csP463tGpsdGCMIwQBt7jD68xfr0jqHhsn4UbIVAcV0Xz3UZWw6dwZjuwMSaOXieh+e5TGYOP251vvWGmGMLZz7DmU+xpja90YTOrYE5sRutnKWoqoqErmuYuoqpa+iaxj+8cYSmjuh2O/R/9tC1+1avYuh/9b8BtxBCUljCf5AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RateLimiting3\"\n        title=\"RateLimiting3\"\n        src=\"/static/33d32425ebb80eb7e857ee9c0e3ce1be/1e043/ratelimiting3.png\"\n        srcset=\"/static/33d32425ebb80eb7e857ee9c0e3ce1be/991de/ratelimiting3.png 173w,\n/static/33d32425ebb80eb7e857ee9c0e3ce1be/e4d6b/ratelimiting3.png 345w,\n/static/33d32425ebb80eb7e857ee9c0e3ce1be/1e043/ratelimiting3.png 690w,\n/static/33d32425ebb80eb7e857ee9c0e3ce1be/e3189/ratelimiting3.png 1035w,\n/static/33d32425ebb80eb7e857ee9c0e3ce1be/b94e3/ratelimiting3.png 1126w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Host A should see that the other 2 hosts used up 3 tokens in total and reduce that number from its available tokens. Hosts B and C should do the same leaving us with this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c99459762c16637920cfc9ca9f6c0d3f/23725/ratelimiting4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.22543352601156%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABm0lEQVQoz21RDU+jQBTk//+qOw1l4YwCBxQPta3UtAVrWRZQPpa5vNcjoV5fMsnsMDP7Nhj4NuM4YhgG9H3P0Fojz3NkWcZ80slD5ykzjUGHOa5NHMdIkuTqN87M8v8Xzvi0ged5ME2TOWnfF5hz49qNcyPNx/Ed+WF/oZ19l8/lDT9rhVIWKOUJfft1WUwbjnp2m2ZtnDT29KgrhUqVGIcORvvVQCkFKSX00IE6un5gM03Xn4sJXT+Vj+wZNK04QKkKTV1zuQFoqKbD7tiwtazbMx81/8nNvoLWA2NzqFmjzP6jQVG1XE5+VbecMcpS4m1/hJ/sUEiJlzTH8uUAVUoURQH3cYfs/YT8eGJOWqUk4tUBySbjl1GWOqjLSNMU6/UGv/wn3No+fooA4eMK220K+nYfPOPWCfDD8nDnJ9imr3jbpoj+rHDjRLixfTjeE1brV/YbYRiCEC8j+J6LIPCxXEa41D247gOiwIOwTDhigTj6jTAM4LkP7In++Q0hBCbYtg1BmGmTbtsOLGuBxcJkCMuCEPY5M/P+BVsvP1BngCe0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RateLimiting4\"\n        title=\"RateLimiting4\"\n        src=\"/static/c99459762c16637920cfc9ca9f6c0d3f/1e043/ratelimiting4.png\"\n        srcset=\"/static/c99459762c16637920cfc9ca9f6c0d3f/991de/ratelimiting4.png 173w,\n/static/c99459762c16637920cfc9ca9f6c0d3f/e4d6b/ratelimiting4.png 345w,\n/static/c99459762c16637920cfc9ca9f6c0d3f/1e043/ratelimiting4.png 690w,\n/static/c99459762c16637920cfc9ca9f6c0d3f/e3189/ratelimiting4.png 1035w,\n/static/c99459762c16637920cfc9ca9f6c0d3f/23725/ratelimiting4.png 1105w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>How do we share information between hosts?</p>\n<h3 id=\"sharing-data-between-servers\" style=\"position:relative;\"><a href=\"#sharing-data-between-servers\" aria-label=\"sharing data between servers permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sharing data between servers</h3>\n<p>We need to be able to share data/information between servers. Let's look at the different ways we can do this:</p>\n<h3 id=\"message-broadcasting\" style=\"position:relative;\"><a href=\"#message-broadcasting\" aria-label=\"message broadcasting permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Message Broadcasting</h3>\n<ul>\n<li>One approach to keep track of the number of tokens used is for each host to tell every other host everything. ie tell everyone everything aka <strong>full mesh topology</strong>:</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 198px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/857abb0e72fa792e73a0e0a84a0e21ee/18f77/ratelimiting5.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.3757225433526%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAADLElEQVQ4y62U/29TVRjG90dJNESMhP0gJGgCBlCHiFCILAo6UMLIAmMEi2aJwUQhWWZst9GNtdtte7t2tIyJbSlr+r1jX2qKGSN+YdDputv23vvBnq6XAfY3TvLec899zvuc5z3nuaeJl9h0XacpkUjQ09ODy+UiFArh8/mQJIlwOIwsy3g8Hvx+P6lUCq/Xi9PpZHJyErfbjdVqxW6343A4SCaTgrSpUCgwNTVFLpdjfn6eaDQqIp1Oi8RYLCYm5/N54vE4kUiETCZDMBhkenqaqqDx8XEhQBC+9JKrD03TjNB1RIgJmo6qqrXv1XdNFT1VXK8RVL/V8vSnCuuDaitVlFqUFUFWx+tzKmpZYKVKibJaXofX8msKdU0MbmYddAzvpmt0H2cc72N2HeLPwn1jsdkHcc46WuiS9tE5speO4T2kfg8JTKuqN0peI7T+auactJcfA6f43t/GcdtW7t6PGoS/3JVou7qVyxPtIo7btuFN9glM1SovEg5FLtFmewuz2ySIT9i2k8jH0WowgYyHY/3NXHAd4Bv5MEf7m5nIDjcm7A9+yyeWjXR7W2m37+Cz/s1Ec7cNhb7kCKafNvC1fICLHhMHe1/hetrWmPDWjJMzjvfoGt3PudEP6R5rZXFpAaWsU67AzGKS89JHdEkfc17aT+dIC9mFyLN7+Pwpa1qFh4UCRaWIvrbQ0j8KyyslI3FFUSiWSmLu8/lN601pWEd51rAPC6sGYSNDi561kutKFpfyeBN9OKMW5JiF4KzMaqlKVmZlVWW5+JhA5hpyrA9PfAB/epBH//69jtTYw5qBB0Ld4pQ7pRY6Rnbx+UAzqXsxQ8lExsWn1jeFAzqlD2i1vEEgPdT4UK6GuwWZ8OH1L/hq6B3uzE0hYB3G4qOcHHqbHwInuXLjFF8ObhcqGxIO3v5OWMUsm2i37xTGzS7Ejd/q1swYRyybMMsHMXtMHLG8zo3/96FqEB7++TVO298VpR/t28Jvf6SNkiM5H6beVzlt3ykWNPVuYCLreJGwfkp/FRYJzroJzcmij+UnxWVQbyvKMpHcuMCCczLheS/LxUdPL4j/bPMEGwE+vjuz59UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RateLimiting5\"\n        title=\"RateLimiting5\"\n        src=\"/static/857abb0e72fa792e73a0e0a84a0e21ee/18f77/ratelimiting5.png\"\n        srcset=\"/static/857abb0e72fa792e73a0e0a84a0e21ee/991de/ratelimiting5.png 173w,\n/static/857abb0e72fa792e73a0e0a84a0e21ee/18f77/ratelimiting5.png 198w\"\n        sizes=\"(max-width: 198px) 100vw, 198px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>How would each server know what other servers are present in the network? You could use <a href=\"#services-service-discovery\">service discovery mechanisms</a> already discussed earlier! However, this approach is not scalable.</p>\n<ul>\n<li>\n<p>Another good approach is to  use <a href=\"#handling-failures\">gossip protocol</a> that we've already seen earlier.</p>\n</li>\n<li>\n<p>Another approach is to use a distributed, in-memory cache store (Redis) to keep track of the count for each server's used tokens. This will be eventually consistent but is highly scalable:</p>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 325px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b344d249ce9f626768931b179a3c0ad6/ff46a/ratelimiting6.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.38150289017341%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACVElEQVQoz42T7UvTURTH918V9DaCCrJQhCwMw/aiN5EkQipYPkytjJT1wt4klFn5wNIt2FwbKNVmolPWVpO1UOdDOJ3bfs+/feJ3l2YW2Be+nHvPuefLveeca8tms/h8PrxeLx6Ph0AggN/vJxQKCRsMBpEkCQvFYpGjYLMO6bqGqqqCsiyjKIpYW1ZRFUzT/Etwb23ZPQpB/hOHxUyziHGIlt9mmAbD4T76g00MTLWTlbZEkndxkP5Ak2BqMyZ8ZtE88tm2gpynY7yGLk8tzaOVpH4sicDjdw043DU0jZYzHfeUBE1DWFk1WFrN8XZmg2f+FZzjKZ56l5EUHZuqKdx1Xab+1RkaXp8jnfkukpyTzdS9OM+N56d5/8VP0QRN10Ws8+USlY55LnZFqHREqOiY59jNMA9GkqUaLm8liKc/kdyMYpilpI2dZWLpWb6uLZKT80iKiaRoTITWOdk4S1lrhOvOz1x7FKWiY4FTzXNc6l4oCVq3zBYyyGphvxa6obJb2CEn5dF0g4Kio+s6rg9rHK8LU90Txd4bpe5JnKruCCduhbk3nMSm6Sp9vjoc7qt0TtSysbMiBAem7tPqstMyVsNschpDlM8kW9BoHUyI515om+dsyxz23kUejn2z+o9NkvO0vammfeIKjSPlpDYTpRr6G2gbr+b2SBlTMbfwGb+aYiGxmicU32YomCaTU393WTd0nJP13HFV0eW2k8mvi8DQxx7RLIux1Zn9sTEPDPFBmHtzaG0UTWJX3kZS8/uHNV1hV8qQV7J//Ip/DfbB3/ITD3lT9eBCIgAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RateLimiting6\"\n        title=\"RateLimiting6\"\n        src=\"/static/b344d249ce9f626768931b179a3c0ad6/ff46a/ratelimiting6.png\"\n        srcset=\"/static/b344d249ce9f626768931b179a3c0ad6/991de/ratelimiting6.png 173w,\n/static/b344d249ce9f626768931b179a3c0ad6/ff46a/ratelimiting6.png 325w\"\n        sizes=\"(max-width: 325px) 100vw, 325px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>Another approach is to have a single leader in the cluster that'll gather information from all the nodes, calculate the total number of tokens used and return the number back to each node. In this setup, all nodes will only talk to one master node. This can be done using consensus algorithms such as paxos and raft implemented in a coordination service:</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 159px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9251fa7909bc861314a18f929d257159/f69fa/ratelimiting7.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 139.62264150943395%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAcCAYAAABh2p9gAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFJklEQVRIx62U6VOTVxTG+Vf6qZ/6odNtOo67gwVbqzOtUx0drX5grAUUQUUr+yYIylaUArIkQAQLCWsgAUF2CCIo06mGLaxhS0LCkrzJr/O+IYAdO9NpPZObc957zn3uufee53jxnsWrra2N/v5+dDqdpAcGBpDJZLS0tDA8PIxGo0GtVjM0NERXVxcGg0Gyu7u7GRwcpK+vj/b2dnp7e5mfn8erqakJpVJJVlYWBQUFqFQq0jPSUSgUFBcXk5GRIWm5XE5+fr60sbhhTm4OWq1WsouKisjNzWV0dBQvMU2ny/n+juxyubY+nIILlwAivmcP0b9zSHObfjFWXOMR0S9laFtf4VFLDEm1F7lXHyAN0W56WY7nBB6w2ueFJNb4kVLvz736QO7W/oS8/S4bjnV3huLfm5mXBMoPEl9zngjlSaJUpwlSHCa+6gK4xJ8bzOGw80v5CW5Xfkdc9TnCKk4QVnmCANkBZpcntgH1s6+4UXaULO0NsptvU9SRQITylLT7TkC7YCeq8gxJdX7kPA0ntyWcTO1Vgkt8mTMZtgFHZocJURwh+LEPkcpT3HxynKBSb1Lq/N135wF0bBCr/JHLJYcIr/yB6KozhDz24ZriG+ZMEzuPPETIY19uPjlGTms4CTUXuKrwJrn2Ei7n9qWL9xStPEuQwpu0xiByW8MIKfOVAGeWx7YBpxZHCSo+jL9sn3QfgfJD+BV8SUZDMDvLSsw2ocqPi4W7pDh/2X5+lu3lWulRllaMm2WzeZw/pwfo1WvoedNM9+sm+vRajOaprezsgoB11cn00hg9+kZ0I83S6HnTiH7u1XbZiNWwsxbfJWsbAouWNRzCPxPAg+GFy52jGCpqsZpWPUHAim0Dk3XjX7HEXdibyPaxbjYGVawO1WIdrMHxqhrLnAHrhuutDF7PDFKjK0A9UIx6oITq/gKejz57mymCaQpTyi7MSZ9jvvMJ5qTPMEV/iK0uepNqDkkLToHoynMEFO/naulXBMgPcLnkIEHFPsybZ7ZfWVgYwZy6D0tlCGblNax14VgyvbFV3WKLvGKcYCey4hRpmivIO5IoaIvlwdNQgkp83maKsDSG6f5uLCLoA18s2UexJH2KpSoM0zqYLDbM1g0WTCtEVZzletnXEgGiVae5XfE9waVHmN3JFGFRBNyDJXUvZvl5LJmHMd/5GGttBILodzhwOsXXXidWdV5iUWrjZdIarkhMua749m8ZLk9gSvwUc/xHmFP3YL77BaaID7DVhHn6mrs5CHbCfz/JJfluQp8cJ7T8GIElBwiUHWJ22eApbHA6BdYGKlhtycSkTcfakiXZ9tk/3CXldEpDlJZhpdRA8lqjyGuNlJqESpeLQ3BsZ7hTzPb/3q2lshEEJ9MLaxjmbEwZbQzr5xmbtki2OGcwrjFpXMNgXJVsUU/MWZmYszFhtEl6fNaGdW0zw0mjjfzqcYpqR5HXT6DQzlCsNiCrHaWkYZLSxilpvrRxGnn9OLK6cUo105JPjFNopqX1nUMLbsCx6RXyVCPcy2smMaueyORy4jOqCY0vIiVHw60EGdH3KwhPLiOtsI2Y1Eqi7leS9FBNbJqKuPQq8qv0tL2YdwPqJy0ky1+TXPiCmIedRGV1cCdPR0x2J4mPnhP56zPifush+kEHybKXxGZ3EpfdI/lis7uIze6Q1jd0z7kBV2wOGnrnUfcu0ahbplFnoqFvSdLinKbfvDWv7l2UtPjtjllG02+iusOIfsr67lf+PyK+8l/9/IKo/DcY7QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RateLimiting7\"\n        title=\"RateLimiting7\"\n        src=\"/static/9251fa7909bc861314a18f929d257159/f69fa/ratelimiting7.png\"\n        srcset=\"/static/9251fa7909bc861314a18f929d257159/f69fa/ratelimiting7.png 159w\"\n        sizes=\"(max-width: 159px) 100vw, 159px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<ul>\n<li>We can also have a multi-leader setup where we can have multiple leaders coming to the same answer and then broadcasting it to their respective followers:</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 201px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cfe4abc0b2fd0fa618d92de068254e94/2ef63/ratelimiting8.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 87.28323699421965%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAADLElEQVQ4y3WS628UVRiH+5/40S9+NNEEo4mYRsSaVCIgH0wKGC+gMVSIlGqtIFa0kMalbi+wpdfd0hKgu6Satpat6Ac18YZNg7KksdDtdi9z3T2zM/OYOTuz3QKe5J3Jed95n/M78/7qCoUCqVQKRVFYXV1leXmZbDZLJpMhnU6Tz+dZX1+Xee8bXdflfmVlhVwuJ3u9txeu61K3uLhId3c3o6OjRKNR+vp6uTg+TnxqiqmrVxkaGpK1UChEMplk7rs5Bgcv0NMTJhqLEolEiMViJBIJHMehDpBkIQS2bWMDjh8uUBICy7Iol8uyLpP3raAmFXqP2uUU/sVOL2Gv3ZKBLTbVM+pd/kn/QWrtpnwrZrZaqwJd15EHO8o91HADSug51PB2lM4nKf086n/tYJWLfHLpNZrHtnH0YiPvDj/LuevtVZgEVjaOTNqZv1HP1qPG3kSbfAc1tBXzegjLq5VdCoZK68ROuueOcH7hY07Gmzg7e3izwlqgk72D+tVWVE9hZBfKyccwf+hHyP/kopgarRO7aJlspHP6bQ5F6+mdbw1wD1GYvYPy5RMoZ7ag9mwn3/YIpRvhakNRaByOvkhztJ7PEnt5a2gLoZn3A1wtsDIY17YQv05ift+DluxF/NiPce8WJWdDwbe/j3Fh4VMGFzoYWDjBT7dnH/IPK5mqI7x+wwl0gWYIiqK8adp2zVYK8pvrNiV9gigKVLWI6/nOX7ppYZQqFO+p+ZasFeMGwACmGDnCc8c4lXiDL64dpCO+nxtLCf8cB7NURpvpRBvZR2HsANpwE+JPv+5ZL7iy4w/ldvomR8Yb6Jp5j9DsIVouNdI/31ZzzxJq30so53eije1F6XoG/crRqk8fAC6vL3Fscof01+lvDvLBRAMDyQ4sAaawMXUdbWA36tcvoI00oXY9jTF94v+BqbW/aI49z0eXX6H9yh4ODD/FufnjlC0oCpuioUs7KaceRx14FeX4o+jxDx8EBj7MKHf5PP467Zf3SJUtEy8z/dswG/N2Ma61oUV2o43sR+vfQemXqM+rAdYORi8q5PQ18jIy2I694bMAaxUrURbc3/8fKzW3KWTIq+gAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RateLimiting8\"\n        title=\"RateLimiting8\"\n        src=\"/static/cfe4abc0b2fd0fa618d92de068254e94/2ef63/ratelimiting8.png\"\n        srcset=\"/static/cfe4abc0b2fd0fa618d92de068254e94/991de/ratelimiting8.png 173w,\n/static/cfe4abc0b2fd0fa618d92de068254e94/2ef63/ratelimiting8.png 201w\"\n        sizes=\"(max-width: 201px) 100vw, 201px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Out of all the approaches above, we'll use in-memory Redis cache. Here're all the approaches that can be taken to allow server-server communication:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/af08bfc973f6cd6551f95672f3bd6185/7830c/ratelimiting9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.445086705202314%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABvElEQVQoz42Sb2/SUBTG+738WvopNCZu0eyNL9grXOI0JsPMkRBNWBlhoJvY8EcQVhkttgUKLZf29mduhYpLjJ7k5N7zPPc850+uNp1O8TwPdTqOQxRFKAuCANd1U07hQogUj+M4xZXPZjOSJGHXtNa4xlkzT7VX5EPrOCO8pc3rxgGtcYNX9WckifxVSCw4rj+lrfDLAwIxx/Yiio0JzYGPduN0qPXe88Wsc31zngn6oYfeeYvpdjnvFJAbQRGFaTz8ofB3+MGCB8/b3Ltf5dHLPtpns8LJxxzldoFiM58JOv6Yo+oTmmaV/MVjpIw3HfpprPAXF3ssxZyBJdANl0UYoUXxmtU6YB2v0upbk1ISigWKD9dLtqtSO1NxJLf4nR2qxY6+j7AtG9f1sgfqPrq1sO0J1q3FfD7PBO+alAmxTFJOuzJ13lwfond/j6xSkliQnD3E+aaTu9zHXVgbQZkm7vpuIc2ZtBh2SxijOlfD8kYwQcqIgVHAtdt0jBNW4eyvHf4xsuzrUDlE751SMo4yIooFudoevWEFSvtIf/J/gn3To1jucqp/5VNnnCUpX62XaacyCrN/+C/Bn9P77ncoJa6GAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"RateLimiting9\"\n        title=\"RateLimiting9\"\n        src=\"/static/af08bfc973f6cd6551f95672f3bd6185/1e043/ratelimiting9.png\"\n        srcset=\"/static/af08bfc973f6cd6551f95672f3bd6185/991de/ratelimiting9.png 173w,\n/static/af08bfc973f6cd6551f95672f3bd6185/e4d6b/ratelimiting9.png 345w,\n/static/af08bfc973f6cd6551f95672f3bd6185/1e043/ratelimiting9.png 690w,\n/static/af08bfc973f6cd6551f95672f3bd6185/e3189/ratelimiting9.png 1035w,\n/static/af08bfc973f6cd6551f95672f3bd6185/7830c/ratelimiting9.png 1345w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now, in order for the servers to talk to each other, they have to use some sort of communication protocol. We have 2 types of protocols: TCP and UDP</p>\n<h3 id=\"tcp-vs-udp\" style=\"position:relative;\"><a href=\"#tcp-vs-udp\" aria-label=\"tcp vs udp permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TCP vs UDP</h3>\n<p>A service host in a network has to choose how it wants to send its data to other hosts in the network. That choice boils down to sending the data reliably vs unreliably. Reliably, data is sent via TCP:</p>\n<p><strong>TCP</strong></p>\n<p>This is the most widely used protocol to send data between hosts. If there is a network blip and some segments are lost along the way, TCP can recover them ie user experience is not compromised. Here're TCP attributes:</p>\n<ul>\n<li>Slower than UDP</li>\n<li>Guarantees delivery of data</li>\n<li>Guarantees that packets will be delivered in the order they were sent</li>\n</ul>\n<p><strong>UDP</strong></p>\n<p>UDP has no error handling or sequencing that comes with TCP. UDP has one goal which is to send data fast! All the checks done by TCP are time consuming. UDP is chosen for live data transmission such as voice calls, live gaming etc.</p>\n<ul>\n<li>Faster than TCP</li>\n<li>No data delivery guarantee</li>\n<li>No order guarantee</li>\n</ul>\n<p>So which one should we use for our rate limiting solution? If we're more interested in accuracy and are ok with a hit to our performance, we'll go with TCP. If we're ok with inaccurate counts BUT want lightning fast responses, we'll go with UDP.</p>\n<h3 id=\"design-distributed-message-queue\" style=\"position:relative;\"><a href=\"#design-distributed-message-queue\" aria-label=\"design distributed message queue permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Design Distributed Message Queue</h3>\n<p>Let's understand what synchronous and asynchronous communication is before we begin designing distributed message queues:</p>\n<p><strong>Synchronous Communication</strong></p>\n<ul>\n<li>When producer makes a call to a consumer, waits for a response.</li>\n<li>Easier and faster to implement.</li>\n<li>Harder to deal with consumer service failures. Need to think about when and how to properly retry failed requests? How not to overwhelm consumer service with too many requests? How to deal with a slow consumer service host?</li>\n</ul>\n<p><strong>Asynchronous Communication</strong></p>\n<p>Queue : Producer sends data to that component and exactly one consumer gets this data to a short time after.\nIt is distributed, because data is stored across several machines.\nDo not confuse queue with topic. In case of a topic, message goes to all subscribers. In case of a queue, message is received by only one consumer.</p>\n<p>Let's look at our functional and non-functional requirements:</p>\n<p><strong>Functional Requirements</strong></p>\n<ul>\n<li>sendMessage(messageBody)</li>\n<li>receiveMessage()</li>\n</ul>\n<p><strong>Non-Functional Requirements</strong></p>\n<ul>\n<li>Scalable (handle load increases, more queues, messages)</li>\n<li>Highly Available (tolerates hardware / network failures)</li>\n<li>Highly Performant (single digit latency, both send and receive operations are fast)</li>\n<li>Durable (once submitted, data is not lost, so persistent)</li>\n</ul>\n<p>As always, let's start with a single producer and consumer and a single machine. On a single machine, all we'll be doing is receiving a request from a single producer that posts to our queue. Our application sits behind a single LB that knows the address of our single server. Our single server would be connected to one DB that'll be responsible for keeping track of the metadata of our queue. For the sake of record-keeping, we'll save each message received in a separate DB that is accessed via our message service:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4f750388e326118674095cd0265018f3/8802b/distributedqueue1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.79190751445087%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsElEQVQY042Q2wqEMAxE+/9fqthabb31IllOIIv4sKwwpDaZmUzdeZ4C9n2XbdsUx3HIfd/Se/+Cmeu6tNKrtSpKKdJaUw49t66rLMsi8zxrBTlnJdsQgpz5Ukp6B28cRwkh6HkYBpmmSRwOkHFBCGFIDPFvAhiRAmBA9d7rPXyEY4ziLIZtRCUKd782pD5TsSEGzrYwB8jv9wNPY/oks/cnnfWcbcIAgzTfYv8ALvgATabSG/UQQFMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Distributed Queue 1\"\n        title=\"Distributed Queue 1\"\n        src=\"/static/4f750388e326118674095cd0265018f3/1e043/distributedqueue1.png\"\n        srcset=\"/static/4f750388e326118674095cd0265018f3/991de/distributedqueue1.png 173w,\n/static/4f750388e326118674095cd0265018f3/e4d6b/distributedqueue1.png 345w,\n/static/4f750388e326118674095cd0265018f3/1e043/distributedqueue1.png 690w,\n/static/4f750388e326118674095cd0265018f3/e3189/distributedqueue1.png 1035w,\n/static/4f750388e326118674095cd0265018f3/8802b/distributedqueue1.png 1135w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Here, a single producer produces a message and sends it over to our virtual IP address. This virtual IP resolves to our single LB that then forwards the request to produce the message to our API gw. API gw then checks to see whether the user is authorized to publish to the queue and upon successful authorization, allows the message to move on to metadata service first. In our metadata service, we check to see whether the queue being pushed to is already created, if so, we return the name of the queue back to API GW, otherwise, we create this new queue and return this information back to our API gw. Once API gw receives this response back, it will call the message service where it'll hold the message for the queue. For durability, we'll also store this message in  message service's DB.</p>\n<p>To improve this experience and add reliability, availability and higher durability, we'll create a distributed service. We'll start by addressing the first point of failure in our architecture: the load balancer.</p>\n<p>A single load balancer would be overwhelmed if there are too many requests. Therefore, we need multiple load balancers using VIPs and have these load balancers partitioned so that each LB can receive a request and forward it to our API GW:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f56a2e30586ec9e93f3b52e057e3457a/91f10/distributed-queue1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.17919075144509%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAACb0lEQVQoz42RWU8TURiG+wPRC29cElww8UovBCLBhAJ6YaJQ1mggoWAkXJAYhCqlm2AIpbaEGkosBdpO9wLSMkPndGHax8wgQcONX86b7+QsT877HlOjUedfNYAGiqixmy8RPVSJHQnCWZXdvEAp1/m79PMX0svEf1a9IdDqKpUzFVEtGdLq2hW4SRxsIA6DiHyAmhKjUq2RzWTZ2YkQDu+glgRy6ZAJ5yveLfYw7njJ+NILxhy9ZIuSAapWq2jaOdwkOR8jeZ4huZ6g/JxAPZVx2JcYHhphdPQtqWiUkjhg5Esn/Z+eMmBrx7LQhmWhlUwhRlmtkM1lkWX5j2URByGh94aaMRaFEMgnsiFNq1OpCTb3V/FHlgnsrhCIrBDYXUYRxSs5mvQoi7KKHnVDq1OtVFBVlWLxhGKxiHamUamqBsC34+J7xI0v4ja6rBYu0jsfOlCfFfzzaEKhXiujFA5ZstsZHBhieHjEsKyUMphn7tPx/ibPp+/Q+eE2ndO3kI7C1Mpn5PK5S8v6a5T1WUrHeUqnChUhiMcltkPbhELbFH4dc3ScYdozhNXxmilnH5OOPiadb5Bye8anFQoFFEUxnJkSiQSJZIpEMokU2ycej5FKpUin06TTKZKpNNF4lI3QOv6tNQJbXgJGX2MvGiGdSpPJZIw7OssUDAYJbm4SDP5gw+9jdeUr42NjdHWZ6Tb34FxcxOvz0DHUQqulmfbBe7QN3KVtsBnnt8/4fQE8HjderxedZXK5XFzKaWxarVYs/RYslgHm5+aYt83yqPcGD7qaeNh9nRbzNVq6m5j5OIXL6cZms2G323G5XfwG8NUATWc1fc4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Distributed Queue 2\"\n        title=\"Distributed Queue 2\"\n        src=\"/static/f56a2e30586ec9e93f3b52e057e3457a/1e043/distributed-queue1.png\"\n        srcset=\"/static/f56a2e30586ec9e93f3b52e057e3457a/991de/distributed-queue1.png 173w,\n/static/f56a2e30586ec9e93f3b52e057e3457a/e4d6b/distributed-queue1.png 345w,\n/static/f56a2e30586ec9e93f3b52e057e3457a/1e043/distributed-queue1.png 690w,\n/static/f56a2e30586ec9e93f3b52e057e3457a/91f10/distributed-queue1.png 992w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Next, we need our metadata service to be durable: ie our queue metadata needs to be replicated among various nodes. For this, we can either use single leader replication, multi-leader replication or leaderless replication. We'll use leaderless replication so that we have multiple nodes available to receive our metadata and distribute it among all available nodes. Single leader replication is not scalable since it introduces a SPOF: the single leader.</p>\n<p>We also want our data to be partitioned among nodes. Now, if our data is small enough to be stored on a single machine, we'll have every node in our cluster hold this information for us. So, when a request comes in to our metadata service to fetch information for a particular queue, we can send the request to any of the nodes. However, if our queue metadata gets too large, we'll have to partition this data using a hash ring with virtual nodes. To determine where each data queue metadata lives, we can either use client side discovery with each node updating a registry with its information or have each node ping every other node its information (gossip protocol).</p>\n<h3 id=\"design-distributed-cache\" style=\"position:relative;\"><a href=\"#design-distributed-cache\" aria-label=\"design distributed cache permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Design Distributed Cache</h3>\n<p>A cache sits between a service and a DB. Our questions deals with designing a distributed cache so that we can reduce the number of calls to a DB (which are expensive). Therefore, storing data in memory will help to address these issues. When a client request is received, we first check the cache and try to retrieve information from memory. And only if data is unavailable or stale, we make a call to the DB.</p>\n<p>And why do we call it a distributed cache? Because amount of data is too large to be stored in memory of a single machine and we need to split the data and store it across several machines.</p>\n<p>Let's start with the functional and non-functional requirements:</p>\n<p><strong>Functional</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cppcpp\"><code class=\"language-cppcpp\"><span class=\"token comment\">// Stores object with a unique key</span>\n<span class=\"token function\">put</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// Gets object from cache based on</span>\n<span class=\"token comment\">// key provided</span>\n<span class=\"token function\">get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>Nonfunctional</strong></p>\n<ul>\n<li>Scalable</li>\n<li>Highly Available</li>\n<li>Highly Performant</li>\n</ul>\n<p>As always, we'll start with a simple, single server design first and then evolve our solution. If we have a single server, we'll have the following setup:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 38.150289017341045%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAACEklEQVQoz1WKSU8TARiG588YMeISXOoSSAiNhOKhES9GAaFRwODBhaPBk8tBQdGWCngAEtuyBE4mWIEEnekMCGXG6QDpWDWlLI0GiCHpMn1Mq3F5vzx58n55BX4nl8sVnPyRYGF1BnVNRF179w9i4Z/Yjv3a5y/Hf8l3YdmMsb2zg2VZpNNp7gbrqB0+jGv0BA0jJ/+Q7/XDJbS9drKzu4WVtcDKYGUzpNJpspkMWFkEtauN5Jcou6kM37e+cX3UQYO/mPO+duwBncpACPtQhBrfPVyBQzQNlxPbMCGVZiKa5Ia4zi0lyc3QBgPaBsJSzx3WTIPNRJzVryatgWpqB4qo7u/i6FON44+DHOmYx9HfQ91gMVf8FUSiYVKbce5PRdnTIWF7Ms3BZzKN41EE8VopS1PjxBPrmOYyzYNVXOwrwtH3EFv3Eqc8EjaPQVVfJ5de7qexv5wFY47tRJxHkwYHOt9j65ympEuidUxHmPd70GYmiH76TMTQqe8p5dzzvTjd5Tg8lznbXVew011BjXsfF7zHUFSJmBljXjcYkyP4JIORUARZNRC0FRNVN1hcDKOpH3kwdJtGr52W3kquestwuU/T9KKMlt4zuLx22l81Ew4voKoqmrrIsq6yoqsF65qKIEsSciiELMsossKc8gFJEpEVhYk3QXx+P8G3k4UuSiKzyhyKMlvY55FCfwnJMj8B2h7t8enQg4AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Distributed Cache 1\"\n        title=\"Distributed Cache 1\"\n        src=\"/static/9d0d7d665d1477fe47eb86308e4c2751/1e043/distributed-cache1.png\"\n        srcset=\"/static/9d0d7d665d1477fe47eb86308e4c2751/991de/distributed-cache1.png 173w,\n/static/9d0d7d665d1477fe47eb86308e4c2751/e4d6b/distributed-cache1.png 345w,\n/static/9d0d7d665d1477fe47eb86308e4c2751/1e043/distributed-cache1.png 690w,\n/static/9d0d7d665d1477fe47eb86308e4c2751/37523/distributed-cache1.png 720w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://www.youtube.com/watch?v=iuqZvajTOyA&#x26;ab_channel=SystemDesignInterview\">Image Credit</a></p>\n<p>In a single server setup, the client makes a request to our single server that has the cache implemented locally. If the request comes in and it is a cache miss, we'll get the data from our DB, store it in our cache and then return the value to our client. If it is a cache hit, we'll simply return the value from our cache. In essence, this is a read through cache system. Let's dive into various algorithms that can be used to create our own cache.</p>\n<h3 id=\"lru-cache\" style=\"position:relative;\"><a href=\"#lru-cache\" aria-label=\"lru cache permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>LRU Cache</h3>\n<p>We'll be using a doubly linked list to keep track of all the requests that we've received from the client in a linked list in memory. We'll have a tail pointer that points to the end of the list. This pointer will be used to evict items from the cache. Next, we'll have our linked list setup so that every new read would cause us to move the item we've just read to the front of the list (since we're using LRU as our eviction policy). The linked list will allow us to:</p>\n<ul>\n<li>Keep track of least recently used key in <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span></span> time via tail pointer</li>\n<li>Move key to front of list in <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(N)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mclose\">)</span></span></span></span></span> time (we need to iterate through the list to find our key)</li>\n<li>Adding key to list in <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mn>1</mn><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(1)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mclose\">)</span></span></span></span></span> time (using our head pointer)</li>\n<li>Finding key would take <span class=\"math math-inline\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>O</mi><mo stretchy=\"false\">(</mo><mi>N</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">O(N)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mclose\">)</span></span></span></span></span> time.</li>\n</ul>\n<p>We can make an improvement here: we can have a hash table that holds key and value from our linked list. When we add an item to our linked list, we do the same to our hash table. When we remove an item from our linked list, we do the same from our hash table. This would allow us to return items back to the client in constant time and then update our list accordingly. Here's the LRU cache algorithm decision flow for GET and PUT:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.93063583815029%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABUklEQVQoz21Rya6CQBDk/z/Hg/FiXA4u0ZgoKJrAXRQUwqCzUi/dOurzvU463V1VvTAEANC2LXxsmgbOuVftOaUU8jxHURQ4n88wxsAb5cSTBd8D61r8qn1OTULUKMsKQghe6jkpFYRo3gM/zT00j2F4569rrPvqoKV4alsE/gprLax1aG73V5Pn3hqH213CWPvqoUFSadylZCyo6xpSaihtoYzF5XKB0gbtnzsAbSyqqmKdMg5aG9DuWgjG6euCx2WW38SQUBtoY+DxT+fH/4fXzz7KA/pr5HQZxWN2wvV6hcc9V5Ylx+MxY56cavIsOyHPC8aCNE1BniQJoijCer1BvNtx7bk4jhGGIfObTYhou+X8cDggTRPmCN/v9wiWyyXIF4sFBoMBxuMxZrMZ14SvViv0+310Oh10u130ej1Mp1NMJhPM53PWDYdD1oxGI/wAZ7qtHoDoi9AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Distributed Cache 2\"\n        title=\"Distributed Cache 2\"\n        src=\"/static/77d41d62d24b8002ea60152181c14b5b/1e043/distributed-cache2.png\"\n        srcset=\"/static/77d41d62d24b8002ea60152181c14b5b/991de/distributed-cache2.png 173w,\n/static/77d41d62d24b8002ea60152181c14b5b/e4d6b/distributed-cache2.png 345w,\n/static/77d41d62d24b8002ea60152181c14b5b/1e043/distributed-cache2.png 690w,\n/static/77d41d62d24b8002ea60152181c14b5b/e3189/distributed-cache2.png 1035w,\n/static/77d41d62d24b8002ea60152181c14b5b/b1001/distributed-cache2.png 1380w,\n/static/77d41d62d24b8002ea60152181c14b5b/0e904/distributed-cache2.png 1384w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://www.youtube.com/watch?v=iuqZvajTOyA&#x26;ab_channel=SystemDesignInterview\">Image Credit</a></p>\n<p>Next, we can go ahead and discuss the LRU cache algorithm code in detail. Now that we've explained how the algorithm works on a single server, we need to make it distributed. Earlier we said that this is a distributed cache because our cache data is too large to be saved on a single machine. Therefore, we'll have our data sharded among different hosts:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 481px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 103.46820809248554%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsTAAALEwEAmpwYAAAD80lEQVQ4y2WTy28bVRTGvYI9D8EfgFghKEhdQVmyKBIUSlShPgQLKDsEEi0b+ANAVJWAdAMCiSICIS7IEWnehlYlVZrGdtu4jhq/PbYzM/a8MvY8f+heO04iRvp07tzznc/fnHOcYPhoukqtXkVpKZQrJZRmA7e3I3NxHEuIx7AMKrUKzZZCpVqmWq9iWsaIlwjDUL7sdPs0qypas0uzso2qdMGHKBqIRVEEMfhOhFLZRlO6tGoq7bpO6CJzgpMggo32Kr/cvUCycImp+9/KOJn/mlThe+yeNXAXQc3Y4td7F0kWxoe8cX6//w1T+XE0uyU5CeHup+wXHP/tKc5ceYFTyec4lTzEyeSzvPPHYRSzvNsVlopTjE0+zZkrz494p5OHeHvqGe60/pWchLB6Ofclp68c4oPpl3k/9ZLEe6kXZWwYpQOCQuzs9JER72zqCO/+eZhc88ae4NUHP/PhzCt8unCcc7OvcW7udT5ZOMbn6ZNoTkv2R2Bd+ZuPZo9yfuFNyTk3f0zi/MIbFPWNgaAYiuf3MXZ0TLeD4WyjayU63TpO3yYIQuI4IgojfN8fcHpdukYDw25juB2sniFzcihyJaLBShCPvo645xI6FlHgj+52Jy3zfReCYFQncwyHIm52d20EIRAGhK5F6NqjPRRuxSnsO0RBf9CNUS4eOoz3WdvzuOfM7xM4XSKvt3fn7RCH/oHFHwnuXgrb+zFMjPLCVeAYhGFA0HMIvR6iW/9zOPjr6ays3CSXy7G+vk6hUJCi+39dPLZlcvNamsyNNNn1NTLZHJ7n7QkGQSAnFAf+AQGikDAIJFm6E9sgzmE4+BqvRyz4YUg05AlOwvMHffhuy+XodJETs2XGrpZ5a7lNeUdMNSSMIjx/MNHLJZdX/ypxYr7K2EyRseU2G5ZoT4QfhCTcfl8O4OM1g4cvXOPJ8RUev5jmkR83yHQDMRG8IMDte5L3WcbgoYs3eGJ8hce+WuTRH+7xjxpAHNDzfBKGabLj2JR1k1taj0zX57YRsN626Zg2lmngOA6mZeHYFhXd4pbqDngdj9ttG820sEwTy7JI6JrG9rZKt6NjtxQ6d+/QyWWxdRVNVVFVFV3XJSRP17DaTTq5HMbWA+yudoCXUBSFZrOJ0mxSr9Wp3stT2chTbyg0Go0DUERUFGq1GuW7G9S2ijRE7a6GopAolUpIFIuDWK1SrtWkQL1eH4kJEfEuYq1eR2m3ZSzu1g2RyOfz7MdmocDa2hoTExNMTk6SSqVknJubI5lMMjs7y/T0tLxLp9Nsbm4eqE9kMhn2I5vNsrq6KguFyPz8vIxLS0vyvLy8zOLiIjMzM1y/fl3y99f/B+5+4OTbqJXmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Distributed Cache 3_1\"\n        title=\"Distributed Cache 3_1\"\n        src=\"/static/fd232cb4c707d116e90a00b5d8394106/d024a/distributed-cache3_1.png\"\n        srcset=\"/static/fd232cb4c707d116e90a00b5d8394106/991de/distributed-cache3_1.png 173w,\n/static/fd232cb4c707d116e90a00b5d8394106/e4d6b/distributed-cache3_1.png 345w,\n/static/fd232cb4c707d116e90a00b5d8394106/d024a/distributed-cache3_1.png 481w\"\n        sizes=\"(max-width: 481px) 100vw, 481px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://www.youtube.com/watch?v=iuqZvajTOyA&#x26;ab_channel=SystemDesignInterview\">Image Credit</a></p>\n<p><strong>We need to figure out how we'll decide which cache client to call?</strong></p>\n<p>How do we decide the method with which we'll be distributing our data among cache hosts? We can use the following two approaches:</p>\n<ul>\n<li><strong>Key based partitioning</strong></li>\n</ul>\n<p>Here, we'll have the data partitioned based on the keys. We can have dedicated shards that handle keys from say Aa - Ba, Bb - Ca and so on. The issue with this approach is that we can have hotspots if the requests are not uniform, resulting in some shards being queried excessively while others sit idle.</p>\n<ul>\n<li><strong>Hash based partitioning</strong></li>\n</ul>\n<p>Another approach is to use a hash function that uniformly distributes data among shards. This helps get rid of the hotspots issue with key based partitioning. However, now, what would happen if some of our nodes go down? We'd have to re-assign data to nodes and this would cause us to unnecessarily move data around.</p>\n<ul>\n<li><strong>Consistent Hashing</strong></li>\n</ul>\n<p>We'll stick with the hash function but will use a ring to assign our data and servers. We'll also use virtual nodes to evenly distribute load across available nodes. This allows us to re-hash a much smaller number of values if a new host is added or an existing node is removed.</p>\n<p>Ok, so we've chosen the method we'll use to actually place our data on cache hosts but who or what  does the consistent hashing calculation? Answer: a light-weight cache client that resides on the service itself:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.35260115606936%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABq0lEQVQoz31Rz0sbYRDdP8iDh/4lgoitB6GHSi/So7H0rhd79uTRlmrBiqjFxCBGF0lsdqWJBLW435fNJrub3+63uyRPZtQlCnXg7QzzHm/mm9WGwyEonvLLGIz0/6cZDW1UqOIAKr5DEPeh4n5i9u3SxUpect3r9dBqtRie56HZbDJ832dOGwxiFhbtY6QOJpHamcbn3XdYTL9FsXbK3FLRxYdjh2vX8yGEQK1WY6MnUxpAi2l3osTCg8o6ZjbH8f7XG8xvzCK18hNnf6+Z+/rHwacj69HQY8N6vY5Op5OADMMwhNa/OWfh4fUmpn+MYXZrHHPfp/BxeQ36xSVzq2YdX04fnuz5Pm9n2zZny7J4gOM4iKLo4YYUbeVBt/ahi9/QxR5O5DZ81WBuIScwsfsvMaxWq+h2u3yzdrvNoC2DIIBGH0IUxgCdcwShihGpAFd+HxeNHiKleKtKpZI8m34GZdd1oZSCJqUEgQSWuH0G6gkh0bAlPFtCSIlSqYRCoYB8Pg/DMFAul7lHmfQaNV+DaRgoPsI0Tei6jnQ6jWw2i0wmw3Uul0sG3AOZxo2RhpKt6gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Distributed Cache 4\"\n        title=\"Distributed Cache 4\"\n        src=\"/static/36be7ebdd7b03349cabb50ea51e51ad3/1e043/distributed-cache4.png\"\n        srcset=\"/static/36be7ebdd7b03349cabb50ea51e51ad3/991de/distributed-cache4.png 173w,\n/static/36be7ebdd7b03349cabb50ea51e51ad3/e4d6b/distributed-cache4.png 345w,\n/static/36be7ebdd7b03349cabb50ea51e51ad3/1e043/distributed-cache4.png 690w,\n/static/36be7ebdd7b03349cabb50ea51e51ad3/e3189/distributed-cache4.png 1035w,\n/static/36be7ebdd7b03349cabb50ea51e51ad3/d43b4/distributed-cache4.png 1202w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://www.youtube.com/watch?v=iuqZvajTOyA&#x26;ab_channel=SystemDesignInterview\">Image Credit</a></p>\n<p>Each cache client needs to keep track of all the available cache server nodes. To do so, it'll have to be able to know the exact list and addresses of each of the available nodes. To keep track of that, we have a few options that can be used:</p>\n<ul>\n<li><strong>Configuration File Method</strong></li>\n</ul>\n<p>We can use a configuration file with node information and deploy it on every service so that each cache client on each service would know exactly the server IP addresses and ports.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 325px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 144.50867052023122%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAdCAYAAACqhkzFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEyklEQVRIx52U+0+TVxjH+6dQ/MHNJU6Y0EUDyJbs15llxim0UJgt4EayzcvIpoSLIGHoVLyMKZeNbUC5lLZvAbFcHcxxGaAL06CDtiCXIQyYlkv5LOdAkagszDbfPpdzvp/3eU/fvCrWfZaXl2X0er14Fp4wv+jBs+CRuawXPLK3ovnnfCyDytfwLntlr8PZSFpDDMmOSJIdWlKadaS26kht0ck8uUErdcIRQUnPORaXFtag4iuBPtjE7EPiLXvQmQOIqdYQa9OwLy+Ad3O2s/fsdvZdDkBv1hBj0RBr0bDf9Cr190qld8m7JKGrwCXZ/GOsG705iHhlD0ZrKHH2EHQ/7uTAtwEcvBZIRGEgBtsu4myhJCjh6KoCKejMWAUuvgj4G3pzsDQYbLsxVr9NojmCRIvQQRKrtSSY92Kw7iZeCUNbuYOirqynQDYEhhFrDSK1JJ/8Ejf55X9SUD5IgWmQ3B96OFz1HnH2XWgrAyjqOr0JoBImzzD7J4Xca3dIO2sn7UwNZ/J+5sr3D0isiMJofxNtZeAmgWJCi4aMYjM5l3tITLrKpyeKOZll43zBPT4qj3w5YEphFRnnu4g7coWEY1dJyrSSndfP4ZcBfmjV8MU31Zy+MMSpC7+Tdu6OjOnnB0gwaYn7v0CDouHj7z7neK7CsUtVHL9k5vhFK59dKcRofod4JWTzf4rRForRGoLRpsFgC8Zo1UgZRJT1bvmsrjw2m5owlENKCNG1YcQ8I72I9lDibWGbA8aYgzlkD+WT8l3kXAwkMzeQjNyA1RjIV7kBJBcFY7BvMOHKi+EpMLYqSE5xOj+IIZ0f7RFqOiP8uHVQTdMHau4d8MOeso3ounCiKp4BLr8AGLMKPFUQxAODmqYoNY5IP9pj/KmNVHNX74cl/TX0deHoXgRc/7a5u27CU2LCQ/4069S06NT8qlfToFPTH6XeALgylJzQV6zccjD6mjDS84Nwxflz2yig/ji0W+gxbGHYoMaWsu054KJvwvn5eTyeJ+CF2+5bRJveQK+Ek54XxFiMWk7Zq1uR07AFZ7QfuZnbibW/hbZsB1d/SZPAJ57HCJZqbm6O2blZPI/ncY0/wGgKY3/Z6yQU7eBs5lZysrZyLntFX2dtJTX7FSJKAtGZdvJ+8SsofcV452FmdgbBUk1NTSH0aOoRczP/0NJv56QSRZISydFaHUdrtRxZp2O1Wr5UtCRZD1DYls3ko0mmp6fxcVTj4+P4NDY+xvTkDBPjfzEyMsLoBnr4cITR0VH+npxlYmKC9QzV8PAwQm63W8rlcuIeduPr/5dcbueaz9dTDQ4OMjQ0hMvlwul04nK6GHI+rX3y9dZL9td5BUt1//59Ojo6uH79Ojdv3qSxsRGLxUJ9fb2U6Le2ttLS0sKNGzeoq6ujtrZW5mJN9B0OB01NTQwMDKDq7++XoIaGBgkTBrvdTnV19ZpJgIVJRNEXEnt9674B+vr6UIkfcUXRFCaxWQBFbjKZqKiokLWiKNTU1FBZWUlVVZXMfbXwmM1murq6UInb7e7uprOzk97eXmw2G2VlZfICYlNpaanMhUnAy8vL5Z6SkhIJFp6enh4pwVC1t7fT1ta2JnH74lyEmpubpXy5iOKsxJn61tZ7hf4F4ecTWQ2/axsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Distributed Cache 5\"\n        title=\"Distributed Cache 5\"\n        src=\"/static/406cf4c0477cdc49e841e7d7fd7d0ed8/ff46a/distributed-cache5.png\"\n        srcset=\"/static/406cf4c0477cdc49e841e7d7fd7d0ed8/991de/distributed-cache5.png 173w,\n/static/406cf4c0477cdc49e841e7d7fd7d0ed8/ff46a/distributed-cache5.png 325w\"\n        sizes=\"(max-width: 325px) 100vw, 325px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://www.youtube.com/watch?v=iuqZvajTOyA&#x26;ab_channel=SystemDesignInterview\">Image Credit</a></p>\n<p>This is a simple approach but not very scalable. Imagine the amount of times you'd have to re-deploy services just because a node was removed or added!</p>\n<ul>\n<li><strong>Config file placed in shared location</strong></li>\n</ul>\n<p>In the previous approach, our issue with it was the fact that we'd have to redeploy multiple times just to update our host list. What if we have this config file in a shared location and just have services read from this shared location:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 343px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 117.34104046242774%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEVklEQVQ4y3WRb0wTdxjH7+X2ai4zWWJU0MW9WBYVl7i5d/unMVmWTQWja1GBKCoguAhCcSi6TLOJQnQqbpLNJcuUAi3qooAouPJHEXVuAUI7pKWl7aDQUmzvrvdZ7gpqKz7JN3l+33u+n99zd8JEyE+FZQ9FDSkUX9XxdaOOfQ06Sq7rKWxIprKzBFEOI8qi1qvevqs69k3PNem1rMpQWcIDZxtfGpeQcXk5nx5byKpvElh1KIE1Z94k48py9MZlOMasmtQ+/cpyPj+5iE9K57PyYAJrTi3SsipDZQkPnBbSze+yo34ley8WYjDux1B9gPyLe8is/4gM0/vYfVbsvn4yTCvIrP+QAmM+hur92mz+hb1aNt38HvedFhXYzmbzEnYbt3PqnI3jZ+5SUXmf0+etZNekkmZ6B4fPpinNtIyc2k2cOPePNlNe2c3ZX+zkGTM1hsqaAi5mt3Enh8stZO09RZ6him9PtLKrNk2DTAO3mJZp3qHyZvKKq8gpquRwRRtf1WSxybT4KXCLeSl51TmUftfJ1twfyDP8RumxdnKM6aSbn26o9rtqMij5vpXsgp/JKqjiUNldci9ms6V+aRR4b8iCru4ttl/QU3z8NkVlrRQevYWh4hbbqteRWrf4yTdUe9UzVLRiKLNQePQmxcc7tazKUFmCb9JLafMmdl76mNxaPXk1aeTWpJNbq2PHpQ840rKDx2JQk9qrnvos98mcXsseaN6MyhIAQuJjhv12PMFHDI1bcQWseIIDmheWwkyX2k/PufxWhsb6tX7YP6gx1BIUJUJMxR2jpUwp1lLkOEuJRDdUFIWIEkFBISyKSLJM9KIIQUnGMynhCYpMSrLmqc9ESSIUFrWMllWiFwpP6VFDlGREObrmjz1+Vje62NDqZoNlhNXX3ZzvG596/QhhUYrJzgiUJJmJxyJEJLJv+3n5ZBfzy5uZd7Cal07fJ79LBcr4J8Pa5c8B1UO8xIiivVrWnQBCWRuvHr3OrCNXEY51UNAdiG4oRz9RfFaY6RdEpi7s9oY43D1CocVJ0Z1Rjtwb5eFIKGYmvmbcUBMvLhX2opwQDoeJlyiKhIITjHucjHtcjLgcjA4PMeZ14vc6CU0GtZmZssLExATPKuD3E5QU3F2NdGS+TdPWJFoyk7ixLYlrGUnc3bkU70MLQVEmEPATnxd8Ph/PanTkP8Ymw9j/NNOx8XXq183lj5SozGvncCd1Ds6uJsaCIW02Pi+43W5i5HLhHQtgu1lLu34utSmJmFMSubYxEWNyAu2bExnoaMDr8+MedhGfFxwOB8/KPvgIp3eUnqZq2lLn0ahbiDF5Aab1C2jSL6RNP5e+lnqGPCPYBweJzws2m40YWfsZcLp5cOVXWta+Qsv62dR99hqXv5jNreRZNOjf4O/2GwzYHdisVuLzQm9vLzHq6aGv38pfbc10nC2h86dSus4doKuqlPYzxdy+/Dt91n+1ueeyvb38D2hw6isUgyOFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Distributed Cache 6\"\n        title=\"Distributed Cache 6\"\n        src=\"/static/9ea182748789a55ee12071a0271cc611/41431/distributed-cache6.png\"\n        srcset=\"/static/9ea182748789a55ee12071a0271cc611/991de/distributed-cache6.png 173w,\n/static/9ea182748789a55ee12071a0271cc611/41431/distributed-cache6.png 343w\"\n        sizes=\"(max-width: 343px) 100vw, 343px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://www.youtube.com/watch?v=iuqZvajTOyA&#x26;ab_channel=SystemDesignInterview\">Image Credit</a></p>\n<p>Again, the issue with this approach is what if this update takes time and our service reads an old file. This would result in a cache miss. Another issue is that we'd have to manually update the file.</p>\n<ul>\n<li><strong>Service Discovery</strong></li>\n</ul>\n<p>We can use a configuration service such as Zookeeper that'll keep an eye on the available cache servers. To do so, periodic heartbeats are sent to each of the cache servers to determine their health status. Next, when our service is about to perform consistent hashing calculation, it'll get this information from Zookeeper before sending data over to cache servers:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 478px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.45664739884393%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC3klEQVQ4y52T308TWRTHRzfwf7gPm+i70ScTk33ZFx/EJzUEfyabrGyCxl+JrqvWRYoosvtgCMoiBQERFaMI8QfGVFxBSgRbpFhspVMithaYodO5dz6bmanVir54kk/uyblzvjk/7ih8ZpZlOdiWenafsQYvI5dqCDXVErpcS9hXR+jyeV41VmPEJpzvpJT5PGlZKN8S/HC3hSdHdtG9fzu9h3Zyc18Ztw/soOfwboKeX8mEBnNZ8nMJlI8in5DYkkagn9nWGl43nyXqO8fLBi+hi14mm2qY66jFeBt2BOpfpdlwPciGG0Ha3iy6gtISS6HQTOni+BYYwu2krD9OsecORX/1snfoQ2HLX5pdrRCSrCmc6jOGmfdFbjQ7B1IU/zNE0YVR9gfmUd5rM7S/+Jvm52dofl6Db/gsvsAZoil36EbWzM9VSIlpCgch3dhoWuCLZml5K5iYFyh9E+2UXP2RkvqV/OL9iZL6VWzsWEFzwOskZEU2vzCn3VyFRlbYUbpjOhX9ESoeRriXMFD6wlco7VxDZXsL3tYuvG1d7Oj8mX+HK90dWqJg+1JamKZ0nohtpQ9Vlp24g+LppcKeYd9kC2Wd66mse8yhYx1Unx9kV/smmgKeXJui4BU4VdpzFe6GtvmT/HBugOV1Q+wdnkfpCTdR2rGOP6r9/H7wGsdOD7K9dSONI8ddQUt8dWGG6cYfzQpOBzWqxjM8S5ooT6N9lF5dzZ7GI5Q3VFF+6SRb2tbSHWzIVZN1/oYvcQSl4IGq4flvGs/TGAPvMiiaphFOjDKm+nmZ8DOW8DOuBpibT7OoL2Lf67pegKbrLGgaMqOzpTfCsqNdKH/eotyfQEkmkyykNbR0Js9CWieVSmHffYvZ90kycyk290xSfOouRVUP+O1RDCUejzMdn16CHVdV1TmXoKpMx+MkZ1Tqh6NsvRVk6+1xfCNRlEgkwvcwNWWfU8SjUyRib5iJuf7/Cp0caha7H4EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Distributed Cache 7\"\n        title=\"Distributed Cache 7\"\n        src=\"/static/5349fc404fc5d690991dd30f4507842a/50978/distributed-cache7.png\"\n        srcset=\"/static/5349fc404fc5d690991dd30f4507842a/991de/distributed-cache7.png 173w,\n/static/5349fc404fc5d690991dd30f4507842a/e4d6b/distributed-cache7.png 345w,\n/static/5349fc404fc5d690991dd30f4507842a/50978/distributed-cache7.png 478w\"\n        sizes=\"(max-width: 478px) 100vw, 478px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://www.youtube.com/watch?v=iuqZvajTOyA&#x26;ab_channel=SystemDesignInterview\">Image Credit</a></p>\n<p>The drawbacks here are the operational costs of using a configuration service BUT this is the most efficient method.</p>\n<p>Now, every time a host needs to put or get from cache, it'll have the host address for that particular shard and will make its call to the appropriate host. These calls from service to cache host will be made using either TCP or UDP connections. If needed, we can dive deep into the pros and cons of using TCP vs UDP.</p>\n<p>Here're all the methods we've discussed for cache server discovery:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.86705202312138%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACQElEQVQoz62QS08TARSFZ+3vMHHt0oUL3Whk78YVRkNi6iOSGKOYqDtNURRjVCRAECJQJHZQgfBojAtaqqWdUuljOn3xKJR2Oi2lTGfmMy1N+QOe5OTenOSee+4VLMvCMI0W6yhWdKLZIvKORiJXIpkrkdorkdgts6UekMztoxsmWBaWaWJZzR4Q+E8wG8EshIpe4ltkgM+BbsRwP+VDjZpRYyY8ikN6SyTnRwwN8DX0Ea2qUo9hWCa1agUtk6CYVtjf2WwZC3LeT4fjEnffP+H6RBvRPR/7Rp6bg7dof/6AfqmLjt77XH1jI15cbQ1au1nW+5+x8voxWecAcbXCeKyAEFd93JnqoKt3mdsOG5G8B5Maw79G6JsZJ5Kf5ZPLQd/CMIXqFnrtkERRIlfZaPxN1/W6PT+SGhdFuW4YonPyPE8/XKBz4hzr+eMUJcOix19go2K0tMX4JNfetWOff8SheYBpHenz6RKXZxMIa1oI+8tTSG0nsNtP4iv6mjfV2K6Y3HPvElbrKY5MF+UpbnT38OL7K3SrhGk2F6U1rswlENL5FCMLD5keszG0+IBkTqGsamgHOtueGfy202TmhihVa2iqSnZvk1AmQGI7hlbUKKhFzEqZsWCGM6N+hKAUJBgIE/gba1TJLxGLRlBSG6wtfGHOdha/OIiS3iQWjaLEFTLJDEklhSzLDSpxGSki8zMYRXC5XIiik2nRiTjtZMm1hNvtbtDj/Y03EGLlj6+lud3LLDd5rLnxejysej38A59Uu93HqTlrAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Distributed Cache 8\"\n        title=\"Distributed Cache 8\"\n        src=\"/static/2aac6325e0d06157516c9527ac6e158f/1e043/distributed-cache8.png\"\n        srcset=\"/static/2aac6325e0d06157516c9527ac6e158f/991de/distributed-cache8.png 173w,\n/static/2aac6325e0d06157516c9527ac6e158f/e4d6b/distributed-cache8.png 345w,\n/static/2aac6325e0d06157516c9527ac6e158f/1e043/distributed-cache8.png 690w,\n/static/2aac6325e0d06157516c9527ac6e158f/e3189/distributed-cache8.png 1035w,\n/static/2aac6325e0d06157516c9527ac6e158f/7e11a/distributed-cache8.png 1235w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://www.youtube.com/watch?v=iuqZvajTOyA&#x26;ab_channel=SystemDesignInterview\">Image Credit</a></p>\n<p>So far, we've handled our scalability and performance requirements. We've got an LRU cache algorithm that is performant and our lookups are fast. However, we've done nothing to make our system highly available: if a shard goes down, we don't have any backups to serve from meaning all cached data in that shard is lost.</p>\n<h3 id=\"replication-to-achieve-high-availability\" style=\"position:relative;\"><a href=\"#replication-to-achieve-high-availability\" aria-label=\"replication to achieve high availability permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Replication to Achieve High Availability</h3>\n<p>Types of replication models:</p>\n<ul>\n<li><strong>Probabilistic Protocols</strong></li>\n</ul>\n<p>These protocols include gossip, epidemic broadcast tress, bimodal multicast. <strong>These protocols are eventually consistent.</strong></p>\n<ul>\n<li><strong>Consensus Protocols</strong></li>\n</ul>\n<p>These protocols include 2 or 3 phase commit, paxos, raft and chain replication. <strong>These protocols tend to favor strong consistency.</strong></p>\n<p>To keep things simple, we'll use one of the three methods we already know: single leader, multi leader or leaderless replication.</p>\n<p>Single leader replication would imply that one of our cache servers would act as a leader and we'd have followers in different regions. All cache updates will be sent from this leader to its followers. If the leader fails, a failover process will kick in that'll promote one of the followers to a leader. All <code class=\"language-cpptext\">put</code> calls will go to the leader while <code class=\"language-cpptext\">get</code> calls can be handled by either the leader or the replica:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.369942196531795%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABgklEQVQY032Nz0vbABiGc93/ogw9+AfITrt4EQTBi6d5EwZeNhDmQcUdROlFKf6A2W1a8GDLdJGkxUbbdGpqqy5oXZKhFZqkyVpH0eQZVhFPe+Hh++B73/cT+I/CMHziXndhyG3wsNvNkOiJi+Y0H7yPGaHe9FktRljIThDNj7JZXm5dgzAgfLTdFwZB8PwVuesGwpTCh4Mq3PgY1m8ajQZC0czTH3tJ30Inb2ZGGPs0S63m4vs+tm1TqVRwHJe/9T98/HHFZP4Sz6lSqdpIhoN+7VL3PdxaDc/zEDIFiYHFLgaXXzH8Ps7YuMT5zxIX+jF6qUBJ20c/KXJZ1umI7tI2l+H8TMcwDEplg7OLX1imiWVZmKaJICpJemc76Jlup2eim6HIIJp2iKZprXlU0FBzWXJ7Clu7KslMjtMDlS+Swot3Md7GdzjeV5HTaVRVRZAkidXECp83logl5lnfjJGSU8iy/IxUCyUtk2mR4us3kdczcSbXtkhvf2cjkUQURf4BHpWXrNW9j6MAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Distributed Cache 9\"\n        title=\"Distributed Cache 9\"\n        src=\"/static/e4b966349938fb531e5815f9638be373/1e043/distributed-cache9.png\"\n        srcset=\"/static/e4b966349938fb531e5815f9638be373/991de/distributed-cache9.png 173w,\n/static/e4b966349938fb531e5815f9638be373/e4d6b/distributed-cache9.png 345w,\n/static/e4b966349938fb531e5815f9638be373/1e043/distributed-cache9.png 690w,\n/static/e4b966349938fb531e5815f9638be373/f2d92/distributed-cache9.png 1027w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://www.youtube.com/watch?v=iuqZvajTOyA&#x26;ab_channel=SystemDesignInterview\">Image Credit</a></p>\n<p>We'll perform our data replication asynchronously for better performance. We don't want to wait for all replicas to return acks before returning back to the client.</p>\n<p>Here's our entire system summarized:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.445086705202314%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABpElEQVQoz4WRTS8DQRjH9+x7OPMBfAJ3cSBpHEQkDhIu3IiXaKQ04tATNxKRIgQpqtp4jag2XqptrKKpsOqlusvOM3/Z2W3tqsSTTJ5nZp75zX/+I8EeHOCci5JZeTiWR9ehIuq5myL6oy9QmblX6rWHRJygMx2fvACGYrmRkdns2rpD/VJK1D0HOdTMXOCNmbcT54YG2LHSUKAdfUEXxtcm4Q+Hy0BjkKXgKq+hO5JFTFFR0H/WRR/Rz+AcUvN8DRr91Wj1DMPtiziApWeHchqqphII59SyHX89Vyjcy6whJPsRSm7iNHPmABpHGBE0xnFbJOEds5QI8KuCwv46Pg43UNhdhZY8hVRxBXearTNybIs5mWtfmQSuRzpw5e5EaqAN+eVp08P+oAtjq17M7wSdCg04Ee4/GKZT7yJzm0LSigKqZxL4ki/AnrKGh7XCwzaPG6O+fSGxBNStn448qJC8cZH/9XBHXkQgPYvA5QqO5ROHQiMGowp6jx4hP6vwnSuYiCsgy5vKX6ZKDzl3AhvWb9C0cSvqlu0s6hbS0G3A3wq/ASIn5D3F9WqeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Distributed Cache 10\"\n        title=\"Distributed Cache 10\"\n        src=\"/static/b49d5ebddafed9d0a2eebeeaac3ba2f7/1e043/distributed-cache10.png\"\n        srcset=\"/static/b49d5ebddafed9d0a2eebeeaac3ba2f7/991de/distributed-cache10.png 173w,\n/static/b49d5ebddafed9d0a2eebeeaac3ba2f7/e4d6b/distributed-cache10.png 345w,\n/static/b49d5ebddafed9d0a2eebeeaac3ba2f7/1e043/distributed-cache10.png 690w,\n/static/b49d5ebddafed9d0a2eebeeaac3ba2f7/e3189/distributed-cache10.png 1035w,\n/static/b49d5ebddafed9d0a2eebeeaac3ba2f7/b1001/distributed-cache10.png 1380w,\n/static/b49d5ebddafed9d0a2eebeeaac3ba2f7/5c684/distributed-cache10.png 1829w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://www.youtube.com/watch?v=iuqZvajTOyA&#x26;ab_channel=SystemDesignInterview\">Image Credit</a></p>\n<h3 id=\"notification-service\" style=\"position:relative;\"><a href=\"#notification-service\" aria-label=\"notification service permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Notification Service</h3>\n<p>Design a notification service where a publisher needs to send notifications to subscribers:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.69364161849711%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAACaklEQVQoz5WR30tTYRjH9xcFBWIEhdFdSRSEdaMXRRmUSHkjCqV2kUHgj3IimolpSIJiCeo2xc2pmMvl2u+JbFNZtulcNnfec3bOJ3Y2aVI3PfA5zzl8v8/3fXmOgf8sTdN0cnUksrRPRGga3qBxMMSKP4mh2FRsLu4nQENV89p2PE3lSxd32j1ca3HSP7ONQR/U1NxkAbUwyL8Dc3peIRDe5fJTJ1db1jlbt0rv9FbhhoBaQOM4+89tOTYVKquqpFIpJKEwYo3RNRnl9acIvughhpxPXuxGvKtADN1CnntRGFP155xvlHbzQ3qs9XRYavHurCAdyWhaloys0Tq6Sf1AiLq+AHbPfj5QjNcgjBcQ3WVkBivICJmjo7Se2W1u4EbLKaqen6eyrYSx5V7kjEpWkdjcSeo7vPfKw/VnTvpmtgqBYw+Q2s4gOkvJDN4kI5R8YBbe2J5wu6eE6q6L3B84x6RjgPRPSQ+MxA640uSkvPkrpY8/05f7KfpONu0oi10oi0ayQcuJpW3srmP2DmPxfsDifU/81w5CkpEkSdcnlnfpN23rbMbSGGQhEBrIgEK+y7KMLCsIIdCyhY0q+TOyioqQZVIHSbZi+zS89VNjdFPd6cKy9h1DPB7HNDPNkn2B+blZbNZ5bDYbJpMJs9mMZdaC44uDvf094okfJBIJEok9DlNJltaCVDQvUNW6RHmjFeO4B0M4HCYYDBIKhfD7/fp7IBDA5/Pp/ViLRqNEIhGdcDjCznYUhyvEpUdTlNVOcfruJzpGVjG43W68Xu9f5AKLv3O+YjweN+uubwx9XKZ31K5jXXLyGwj7Syuim75DAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Notification Service 1\"\n        title=\"Notification Service 1\"\n        src=\"/static/85cb2379956f687e1254fdb42ae1c599/1e043/notification-service1.png\"\n        srcset=\"/static/85cb2379956f687e1254fdb42ae1c599/991de/notification-service1.png 173w,\n/static/85cb2379956f687e1254fdb42ae1c599/e4d6b/notification-service1.png 345w,\n/static/85cb2379956f687e1254fdb42ae1c599/1e043/notification-service1.png 690w,\n/static/85cb2379956f687e1254fdb42ae1c599/96e92/notification-service1.png 779w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span> <a href=\"https://www.youtube.com/watch?v=iuqZvajTOyA&#x26;ab_channel=SystemDesignInterview\">Image Credit</a></p>\n<p>Functional Requirements:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cppcpp\"><code class=\"language-cppcpp\"><span class=\"token function\">createTopic</span><span class=\"token punctuation\">(</span>topicName<span class=\"token punctuation\">)</span>\n<span class=\"token function\">publish</span><span class=\"token punctuation\">(</span>topicName<span class=\"token punctuation\">,</span> message<span class=\"token punctuation\">)</span>\n<span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>topicName<span class=\"token punctuation\">,</span> endpoint<span class=\"token punctuation\">)</span></code></pre></div>\n<p>Non functional requirements:</p>\n<ul>\n<li>\n<p>Scalable</p>\n</li>\n<li>\n<p>HA</p>\n</li>\n<li>\n<p>Highly performant</p>\n</li>\n<li>\n<p>Durable</p>\n</li>\n</ul>\n<h3 id=\"useful-architectures\" style=\"position:relative;\"><a href=\"#useful-architectures\" aria-label=\"useful architectures permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Useful architectures</h3>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/whitepapers/latest/best-practices-wordpress/reference-architecture.html\">WordPress on AWS</a></li>\n<li><a href=\"https://netflixtechblog.com/active-active-for-multi-regional-resiliency-c47719f6685b\">Netflix active-active</a></li>\n</ul>","timeToRead":30,"excerpt":"System Design Generating Unique IDs in a distributed Env Back of the envelope Estimation Storing Images Allowing users to chat Design Chat…","frontmatter":{"title":"Practical System Design","date":"2021-04-15T00:00:00.000Z","categories":["System Design"],"extract":"Practical system design","thumbnail":"/post-images/distributed-systems.png","tags":["Data system design"]},"fields":{"slug":"/practical-system-design","date":"April 15, 2021"}}},"pageContext":{"slug":"/practical-system-design","nexttitle":"DP Discussion Updated","nextslug":"/dp-discussion-updated","prevtitle":"ReactJS Notes","prevslug":"/react-js-notes"}},"staticQueryHashes":["3969716136"]}