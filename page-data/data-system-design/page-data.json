{"componentChunkName":"component---src-templates-post-js","path":"/data-system-design","result":{"data":{"markdownRemark":{"html":"<ol start=\"0\">\n<li>\n<p><a href=\"#microservice-architecture\">Microservice Architecture</a></p>\n<ul>\n<li><a href=\"#service\">Service</a></li>\n<li><a href=\"#challenges\">Challenges</a></li>\n<li><a href=\"#ipc\">IPC</a></li>\n<li><a href=\"#message-formats\">Message Formats</a></li>\n<li>\n<p><a href=\"#communication-using-rpi\">Communication Using RPI</a></p>\n<ul>\n<li><a href=\"#rest-pros-vs-cons\">REST: Pros vs Cons</a></li>\n<li><a href=\"#grpc\">gRPC</a></li>\n</ul>\n</li>\n<li><a href=\"#services-service-discovery\">Services: Service discovery</a></li>\n<li>\n<p><a href=\"#messaging\">Messaging</a></p>\n<ul>\n<li><a href=\"#brokerless-messaging\">Brokerless Messaging</a></li>\n<li><a href=\"#broker-based-messaging\">Broker Based Messaging</a></li>\n</ul>\n</li>\n<li><a href=\"#sagas\">Sagas</a></li>\n<li>\n<p><a href=\"#queries\">Queries</a></p>\n<ul>\n<li><a href=\"#api-composition-pattern\">API Composition Pattern</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#api-gateway\">API Gateway</a></p>\n<ul>\n<li><a href=\"#edge-functions\">Edge Functions</a></li>\n<li><a href=\"#secure-services\">Secure Services</a></li>\n<li><a href=\"#rate-limiter\">Rate Limiter</a></li>\n</ul>\n</li>\n<li><a href=\"#summary\">Summary</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#introduction\">Intro</a></p>\n<ul>\n<li><a href=\"#dns\">DNS</a></li>\n<li>\n<p><a href=\"#types-of-data\">Types of data</a></p>\n<ul>\n<li><a href=\"#types-of-data---relational-model\">Types of data - Relational Model</a></li>\n<li><a href=\"#types-of-data---document-model\">Types of data - Document Model</a></li>\n<li><a href=\"#types-of-data---relation-vs-document-model\">Types of data - Relation vs Document Model</a></li>\n<li><a href=\"#types-of-data---graph-model\">Types of data - Graph model</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#types-of-databases\">Types of Databases</a></p>\n<ul>\n<li><a href=\"#relational-database\">Relational Database</a></li>\n<li><a href=\"#when-to-pick-rdbs\">When to pick RDBs</a></li>\n<li><a href=\"#nosql-dbs\">NoSQL Database</a></li>\n<li><a href=\"#nosql-vs-rdbs\">NoSQL vs RDBs</a></li>\n<li><a href=\"#redis\">Redis</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#data-encoding\">Data Encoding</a></p>\n<ul>\n<li><a href=\"#data-encoding---json-xml-and-avro\">Data Encoding - JSON, XML and AVRO</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#data-flow\">DataFlow</a></p>\n<ul>\n<li><a href=\"#data-flow---rest\">Data Flow - REST</a></li>\n<li><a href=\"#data-flow---message-queues\">Data Flow - Message Queues</a></li>\n</ul>\n</li>\n<li><a href=\"#communication-between-services\">Communication Between Services</a></li>\n</ul>\n</li>\n<li><a href=\"#distributed\">Distributed</a></li>\n<li><a href=\"#scalability\">Scalability</a></li>\n<li><a href=\"#reliability\">Reliability</a></li>\n<li>\n<p><a href=\"#cap-theorem\">CAP Theorem</a></p>\n<ul>\n<li><a href=\"#vector-clock\">Vector Clock</a></li>\n<li><a href=\"#handling-failures\">Handling Failures</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#load-balancers\">Load Balancers</a></p>\n<ul>\n<li><a href=\"#why-load-balance\">Why load balance</a></li>\n<li><a href=\"#load-balancers-deep-dive\">Load Balancers Deep Dive</a></li>\n<li><a href=\"#balancing-algorithms\">Balancing algorithms</a></li>\n<li><a href=\"#redundant-load-balancers\">Redundant Load Balancers</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#replication\">Replication</a></p>\n<ul>\n<li><a href=\"#replication-deep-dive\">Replication Deep Dive</a></li>\n<li>\n<p><a href=\"#multi-leader-replication\">Multileader replication</a></p>\n<ul>\n<li><a href=\"#multi-leader-pros\">MultiLeader: Pros</a></li>\n<li><a href=\"#multi-leader-cons\">MultiLeader: Cons</a></li>\n</ul>\n</li>\n<li><a href=\"#leaderless-replication\">Leaderless replication</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#partitioning\">Partitioning</a></p>\n<ul>\n<li><a href=\"#partitioning-consistent-hashing\">Partitioning: Consistent Hashing</a></li>\n<li><a href=\"#partitioning-service-discovery\">Partitioning: Service Discovery</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#indexes\">Indexes</a></p>\n<ul>\n<li><a href=\"#indexing-example\">Indexing Example</a></li>\n<li><a href=\"#index-write-performance\">Index: Write Performance</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#caching\">Caching</a></p>\n<ul>\n<li><a href=\"#cache-types\">Cache Types</a></li>\n</ul>\n</li>\n<li><a href=\"#content-delivery-network-cdn\">CDN</a></li>\n<li><a href=\"#web-tier-and-statelessness\">Web Tier and Statelessness</a></li>\n<li>\n<p><a href=\"#data-centers\">Data Centers</a></p>\n<ul>\n<li><a href=\"#data-centers-geo-routing\">Data Centers: Geo-Routing</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#decoupling\">Decoupling</a></p>\n<ul>\n<li><a href=\"#decoupling-message-queues\">Decoupling: Message queues</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#system-design\">System Design</a></p>\n<ul>\n<li><a href=\"#generating-unique-ids-in-a-distributed-env\">Generating Unique IDs in a distributed Env</a></li>\n<li><a href=\"#back-of-the-envelope-estimation\">Back of the envelope Estimation</a></li>\n<li><a href=\"#storing-images\">Storing Images</a></li>\n<li><a href=\"#allowing-users-to-chat\">Allowing users to chat</a></li>\n</ul>\n</li>\n<li><a href=\"#useful-architectures\">Useful architectures</a></li>\n</ol>\n<h3 id=\"microservice-architecture\"><a href=\"#microservice-architecture\" aria-label=\"microservice architecture permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Microservice Architecture</h3>\n<p>Before we begin designing distributed architectures, let's first understand what the microservice architecture is:\nAs modern systems grow in size, it is recommended to break monolithic systems down into microservices. The idea is to have modularity in our application where each part of the application does one job and does it well. Each modular part is called a service. A key characteristic of microservice architecture is that services are responsible for performing one function. Each service is independent of other services, meaning services are <strong>loosely coupled</strong>: a service can run in isolation from other services. </p>\n<p>According to the book, The Art of Scalability, a microservice is also scalable. It can be scaled using the scalability cube:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.30859835100118%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABtElEQVQoz4WT65KbMAyF9/0fbctu/mR3mg0QaCAQEjAGYwO5nErKkJB2O9WMRrYHfXN04eV6vYKdbTpPdzbXdzBWobP13W3foGlLDEN/z5vsZTrMH293wHQljnWA2mzurrsNvfnYFR+wTv8NnCvSWiPLM9R1jUMZo6hW4sd6jZIgpfblXjUBVBuS+vbfQPbz+QznHGqtKDkgNZFAHgojAn6hsbFAHZX+bckMCsMQn58fUEphPA2UEKJ1sShhMEPYWa3ubkDrnoEcBTiOI9b+GsvlEsfjUZpd6lAA3wFv7wH6wTwN867QWovXH6/wPA95nguwYiAp5NJZLYPZ9+VPiaVeo1IFsizHfLACvFwu2O/3SNMUp9MJfe8EOEFY4eQH9SXlNqaQapIkkb4/DWVu1joY05KCDVRDa2JiGUZNsXUJwWg4usDQj2jbFkEQYLFYIIqih8L5pHl1kjTBLksJbtB1rURDcbdL8GsbY7vd0mopWS/vzcP7+xt8378B//xL2LquQ1VVUkpRFNKOvu9F0YHK5K3gb7k9DC1L/muGx1DmMO7n9MYD8mn6q9WKmp/hf8Y5vwF1XJmt5gTuEAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Cube\"\n        title=\"Cube\"\n        src=\"/static/0af72b08a5ebd774d36952b935b5d509/1dda8/cube.png\"\n        srcset=\"/static/0af72b08a5ebd774d36952b935b5d509/27f03/cube.png 173w,\n/static/0af72b08a5ebd774d36952b935b5d509/376d0/cube.png 345w,\n/static/0af72b08a5ebd774d36952b935b5d509/1dda8/cube.png 690w,\n/static/0af72b08a5ebd774d36952b935b5d509/e7347/cube.png 849w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<p>X-axis scaling is a common way to scale a monolithic application. Figure above shows how X-axis scaling works. You run multiple instances of the application behind a load balancer. The load balancer distributes requests among the N identical instances of the application. This is a great way of improving the capacity and availability of an application.</p>\n<p>Z-axis scaling also runs multiple instances of the monolith application, but unlike X-axis scaling, each instance is responsible for only a subset of the data.</p>\n<p>X- and Z-axis scaling improve the application’s capacity and availability. But neither approach solves the problem of increasing development and application complexity. To solve those, you need to apply Y-axis scaling, or functional decomposition. A service is a mini application that implements narrowly focused functionality, such as order management, customer management, and so on</p>\n<p>Applying the rules of scalability cube, this is what a microservice could look like:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.91358024691358%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACiElEQVQ4y3WT6W7aQBSFef/ffYAKVWpDlVWKQpWUNk2TJlDCYkjArDbGBoyxTTDGbF/HdkjTVj3SSHeu7py7nUlst1vCE8I0TRqNBrIs02w2MQyDP7GJ48ZjFEWh1+tRqz2iG3rkD3kSOyNEpVLh5OSYb98uyXzJUCgUIn9JvkRS63TteXRvt1rspT6Q/pQmmUxSrVbjdJsNiZAsNLabLUEQvNSyXq/jrMKfr39nv5Bn7/aBtj4iWPjI9RaqoqJ2OwTL4HeFjm1zcHiAXm/TK9WZOAPqyj2rVUy4S/IwmvK1KNNtKCwWS2Q1j2YbmMGW47srOoO47cTc85AkCce0sA0L09I4zR5xVswyeZqy8BdcF0+4qReoDF2CTZzoupzm/c0lqbsHMsUSnh+PI+EJwmKpyFQQOrqJZfc5uk6xn71CGw7wvTm1rsTH3E/eXtxRFRWKOUT7KfYtTu/KdGrK8wxFy/ZkwuHRIbrcQa+2GI57dIxyFDB7ehLtLSK7aU3JyT1G2pCZSNJQCmiTAf2pz3k5R88cxhXOZjNUVcUTj58cJ3I6nk9ZbdMfGPhzn0wuRaaa495w8dYrNqstt5U0H64zHOQe+SyVccR4IkLXdTk6PkZv1anlbwjEzDJSnjfpQ2qawmoRYLomp1KNd19ylKRG3LLAbVvntCyTurpE31Vo25NIb45lMRUnxGjqIOkqcyGHUD6ua9Ee20KLQ4bagGeNsFxvmPoB9/IjY9eOCXei3uHv+0Y8Os++56z0g+9dE/t5puECRPQ/b19+yusv+Bqr5ZKZkMRZtUny4hap3OB/iAj/JrOsMZqmRYsajUYv/sl8gTZ28NwZodTCGEP84b7ej2zf96O4Xw0zx+fGMl8AAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Intro Design\"\n        title=\"Intro Design\"\n        src=\"/static/06431334ca01569fe956df09b0197594/1dda8/intro-design.png\"\n        srcset=\"/static/06431334ca01569fe956df09b0197594/27f03/intro-design.png 173w,\n/static/06431334ca01569fe956df09b0197594/376d0/intro-design.png 345w,\n/static/06431334ca01569fe956df09b0197594/1dda8/intro-design.png 690w,\n/static/06431334ca01569fe956df09b0197594/c82e2/intro-design.png 810w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<h3 id=\"service\"><a href=\"#service\" aria-label=\"service permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Service</h3>\n<p>A service is a standalone, independently deployable software component that implements some useful functionality. A service’s API encapsulates its internal implementation. Unlike in a monolith, a developer can’t write code that bypasses its API. As a result, the microservice architecture enforces the application’s modularity. Each service in a microservice architecture has its own architecture and, potentially, technology stack.</p>\n<h3 id=\"challenges\"><a href=\"#challenges\" aria-label=\"challenges permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Challenges</h3>\n<p>Let's discuss some major challenges when working with distributed microservices:</p>\n<p><strong>Network latency</strong> is an ever-present concern in a distributed system. You might discover that a particular decomposition into services results in a large number of round-trips between two services. Sometimes, you can reduce the latency to an acceptable amount by implementing a batch API for fetching multiple objects in a single round trip. But in other situations, the solution is to combine services, replacing expensive IPC with language-level method or function calls.</p>\n<p>Another problem is how to implement inter-service communication in a way that doesn’t reduce <strong>availability</strong>. Meaning, if one service is dependent on another service and that other service is down, this would have a cascading affect whereby the unavailability of one service makes the whole system grind to a halt. A solution could be to have asynchronous calls between services.</p>\n<p>Another challenge is maintaining <strong>data consistency</strong> across services. Some system operations need to update data in multiple services. For example, when a restaurant accepts an order, updates must occur in both the Kitchen Service and the Delivery Service. The traditional solution is to use a two-phase, commit-based, distributed transaction management mechanism which doesn't work for distributed systems. We'd have to use a very different approach to transaction management, a saga. A saga is a sequence of local transactions that are coordinated using messaging. Sagas are more complex than traditional ACID transactions but they work well in many situations. One limitation of sagas is that they are eventually consistent. If you need to update some data atomically, then it must reside within a single service, which can be an obstacle to decomposition.</p>\n<h3 id=\"ipc\"><a href=\"#ipc\" aria-label=\"ipc permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IPC</h3>\n<p>Now that our services are defined as loosely coupled components, what if we need 2 services to talk to each other? Enter <strong>interprocess communication or IPC</strong> mechanisms. Services must often collaborate in order to handle a request. Because service instances are typically processes running on multiple machines, they must interact using IPC.</p>\n<p>Before we begin describing the types of IPC technologies, let's see the various interaction styles that are available that allow IPC. We can have:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.363762102351313%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAABB0lEQVQY01WNTUsCURSG50f2A0qtZatWUZm1inb5BRFEJFKLJkENrJTog5TIhfsWaTOOjTNZzswdRXm6c1d14OEc3vMcjra4lWZ5J08smSEuiSXTxLczJFI5VnbzbGSKrB8UpJNjSbqRF/VEKivzUzazRVb3jlhY26fe6qAdnlc5Kd1w2WgpdEmh3OBYr6m8WGlw9dimfP9K6e6Fi9tn9HqTykOb62ZHUZXzWe2Jt56FNh65hP6YvzUVPs6nxZdjYw/6RM4k8GA2VXsh/W/XYeQO8X5G/241z/fxgwAhQsJwgghD7OEQwzQxDJP3bhfbtlGeHxAIgWUNVN7rfSjH7MunnsdsPucXjwMMfQCO6oMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"IPC\"\n        title=\"IPC\"\n        src=\"/static/a767b19d6f6caa93afb9220e1f277181/1dda8/ipc.png\"\n        srcset=\"/static/a767b19d6f6caa93afb9220e1f277181/27f03/ipc.png 173w,\n/static/a767b19d6f6caa93afb9220e1f277181/376d0/ipc.png 345w,\n/static/a767b19d6f6caa93afb9220e1f277181/1dda8/ipc.png 690w,\n/static/a767b19d6f6caa93afb9220e1f277181/81bf6/ipc.png 723w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<p>As summed above, these are the types of one-to-one requests that we can have:</p>\n<ul>\n<li>Request/response: A service client makes a request to a service and waits for a response. The client expects the response to arrive in a timely fashion. It might event block while waiting. This is an interaction style that generally results in services being tightly coupled.</li>\n<li>Asynchronous request/response: A service client sends a request to a service, which replies asynchronously. The client doesn’t block while waiting, because the service might not send the response for a long time.</li>\n<li>One-way notifications: A service client sends a request to a service, but no reply is expected or sent.</li>\n</ul>\n<p>The following are the different types of one-to-many requests:</p>\n<ul>\n<li>Publish/subscribe: A client publishes a notification message, which is consumed by zero or more interested services.</li>\n<li>Publish/async responses: A client publishes a request message and then waits for a certain amount of time for responses from interested services.</li>\n</ul>\n<p>Synchronous communication with other services as part of request handling reduces application availability. As a result, you should design your services to use asynchronous messaging whenever possible. REST is an extremely popular IPC mechanism. The problem with REST, though, is that it’s a synchronous protocol: an HTTP client must wait for the service to send a response. Whenever services communicate using a synchronous protocol, the availability of the application is reduced. To see why, consider this scenario:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.824611032531823%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABC0lEQVQY04VRy07DMBDM//8ISIgLQhy4IA5ceFQVCpUgRIi20KYudvyK7SbOsHHpoUWIlUZrWePZGW+Gg+r7fg//VWhbrI3DVxMgbIMsxoiu6xJi/C2QhInT9zF1rTWklOBCwNJ5KRTO8xIntznuZytkzjUIwaNpLPWAwZT3PoHkUCmDhznD3bTClCu0xDXWwhKCc6iExFUxw8VjgXzJkW02AdoomqxIxCUiYyzB05BixXE6fsExOXiiB+hadOR0V8Z5vLIaJdd4X4utw53Q1tV+MXI4qUQS+6wVHPGkUqjrGob6gkucjZ9xdDPCiJJkQ8TDBfy5ELqzP3GHvxwiM6lxXX7gcvKGfMHxDZ+MzTDm0tfFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Problem With REST\"\n        title=\"Problem With REST\"\n        src=\"/static/3454dc791a7545b24cfc2c4da855b4a8/1dda8/problem-with-rest.png\"\n        srcset=\"/static/3454dc791a7545b24cfc2c4da855b4a8/27f03/problem-with-rest.png 173w,\n/static/3454dc791a7545b24cfc2c4da855b4a8/376d0/problem-with-rest.png 345w,\n/static/3454dc791a7545b24cfc2c4da855b4a8/1dda8/problem-with-rest.png 690w,\n/static/3454dc791a7545b24cfc2c4da855b4a8/037d4/problem-with-rest.png 707w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<p>If either one of the consumer service or the restaurant service is slow/unavailable, we'll be impacting the response time to our client.  All services must be available in order for the order to be processed. The best way to handle issues here is to use an asynch request/asynch reponse style of interaction to create orders:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.97026022304833%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABOUlEQVQY03WQS2vCQBSF/f/brrp0WRBKl3VRlFIqlkoFrTVGjRoT4yvvxIxOvk4SKqXQC8PAmTvnVUNNnuf8N8VbcWRxVwAH18dy9gRhVO382q39kMVxjGVZRIHH2ZuReSuklH/pOSvI0dro7RvcjV7wo292PI1mvC9sakIIhMgIfJ+VaXLcrZm91pn3HsgyQaiEJlsXfefhKUcFdkn25OECcQqRF8lovaXxNuBZNyvCIPCVw+ga/RhDJCpPJ/Xh/kOj0fvCdr0S2806LLt1LGNIEcLxAiaHkOn2WBGmaUIUhaSnjCRyOZstknUH13UxVQ1D00Hf+6XDQtNZjfl8a3Lc26XAYGlz1+nT1pZVh1LmV3fnLEXrNTG1LnGSsDAMFS29dngSEqP/iPFyizUflAJT1WFrvCg7/AbNDsZBdEeY9AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Asynch-Requests\"\n        title=\"Asynch-Requests\"\n        src=\"/static/c41682315c4558569d79b4bd21e6a997/1dda8/asynch-requests.png\"\n        srcset=\"/static/c41682315c4558569d79b4bd21e6a997/27f03/asynch-requests.png 173w,\n/static/c41682315c4558569d79b4bd21e6a997/376d0/asynch-requests.png 345w,\n/static/c41682315c4558569d79b4bd21e6a997/1dda8/asynch-requests.png 690w,\n/static/c41682315c4558569d79b4bd21e6a997/a0800/asynch-requests.png 807w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<p>The client and the services communicate asynchronously by sending messages via messaging channels. No participant in this interaction is ever blocked waiting for a response.\nSuch an architecture would be extremely resilient, because the message broker buffers messages until they can be consumed. The problem, however, is that services often have an external API that uses a synchronous protocol such as REST, so it must respond to requests immediately.\nIf a service has a synchronous API, one way to improve availability is to replicate data. Let’s see how that works:</p>\n<p>One way to minimize synchronous requests during request processing is to replicate data. A service maintains a replica of the data that it needs when processing requests.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.07823960880196%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAAB/klEQVQoz42SWW/aUBCF/f9/Qh8jVWqfolZK0hSSkNQkEHAMOBgctrAFzGYbAzZe+HoNzdI+9Uijmfty7pwzR9rtdrwXH7DDDyLcTUgQxsRxhLfdigrYBoF4x8ynC8bDCZOXGeOBieu4SPyLPXG8H6e9CvrNEbOXJmEYcdvsc6wadOc2m9Way2+/uD7NcnN+S+o4Qyn7iJT85DgOS8emN7PIPY/RX6ZstyFbp48/KrJxTDzPR+2bpOpdhtYS13YEgU7L6FDVdBpaC73wdCDceB6B72GMpny5ryI3egRC3kdEUUTTnFPuj5ktV0RhyNWJzMnXFOnja75/PkMr6H9L3gQhI+GDtd4QCT9n7TtG95+YdCt4fsCF3uIoq9IW3jkLi+xZgUdFp6xUULMaJbmK9HqQZNMEyaa8ejg1aRhVlkubUByiu1hSm9jM3fVewVO5jaE1qVUMauoTnXoPyZrZyD9zZFN5MqcyhWuV8q2Olquj3dV5NgZ78jgSlxayd6JWKxff9w8lvI3j93hI8/GCQlYhlymQuyyi5B8oyioP+RL3cpGK8DSJzEcMhgPy+TyKouy7aZp/ArJDWov1W7UOLb1Ds9qhIXxqVNs09YOcYXdEJAht28ayLVzXPcyWtU9H0gNhxxsh/4lkm3Q6zVXmivPzH6QvDrNaUkVGwzfC35p95kyf4TYPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Replicate-Data\"\n        title=\"Replicate-Data\"\n        src=\"/static/bc19fe881b30eee870bfa16e07f3ee0a/1dda8/replicate-data.png\"\n        srcset=\"/static/bc19fe881b30eee870bfa16e07f3ee0a/27f03/replicate-data.png 173w,\n/static/bc19fe881b30eee870bfa16e07f3ee0a/376d0/replicate-data.png 345w,\n/static/bc19fe881b30eee870bfa16e07f3ee0a/1dda8/replicate-data.png 690w,\n/static/bc19fe881b30eee870bfa16e07f3ee0a/3fbe0/replicate-data.png 818w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<h3 id=\"messaging\"><a href=\"#messaging\" aria-label=\"messaging permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Messaging</h3>\n<p>When using messaging, services communicate by asynchronously exchanging messages. A messaging-based application typically uses a message broker, which acts as an intermediary between the services, although another option is to use a brokerless architecture, where the services communicate directly with each other. A service client makes a request to a service by sending it a message. If the service instance is expected to reply, it will do so by sending a separate message back to the client. Because the communication is asynchronous, the client doesn’t block waiting for a reply. Messages are exchanged over channels.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.40728831725616%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABt0lEQVQoz32SzW/TQBDF879z54QQCKQCt7YcekEVagUtUkGt1DZtSNLEcWI7dlwnaztObMef+bHrkBtipFnNjua92Xmzre12i7IkiZnNHKqqBJlL0pRUel3XqBrlKk73+apqMLY9Jcs2DYeqaakgiBO684hHd8VArFhLgGkYmKZJnufsrapqppJgMh7jLgR9ibmfBvTmS6J0R9oqyoJhkDBy72ThISMxQffXqt9fmi0idPCEQbpZNZm6Lhn5MXowJozOGfsamryr6VpulDDwPW4HRxx+f0fPOpUdA8IkpSpLsjzlpvOFs6sDbG/QEIpVzKMXMJt+IrRe4Dkf6IqAxTqhtZRPffKXdCZf+dn+SHt0w9APWMVrbMthHUfYYRsrukZExk5v2aTjLjDtH2yCN3L8M3pSqjjLlIZbrGUsNXxm6On8dgXHl+85uXjF88zDlovSup/R71+jT+6wnRnH5y85ujjgl2bRdcd0Fj5OFO80VEdeFIh4g0gLwjTDcPuYXg/tSUcbDen0T/l2+ZZ5oDeL0Z0HLG/Y1Iokx49TSrn1hnD/bf5lClwUGZZ/ixFcyZFN/meK6w9+HlYrBFZ36gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Message-Channels\"\n        title=\"Message-Channels\"\n        src=\"/static/a281b8393427aaf7ff8da846f54642a8/1dda8/message-channels.png\"\n        srcset=\"/static/a281b8393427aaf7ff8da846f54642a8/27f03/message-channels.png 173w,\n/static/a281b8393427aaf7ff8da846f54642a8/376d0/message-channels.png 345w,\n/static/a281b8393427aaf7ff8da846f54642a8/1dda8/message-channels.png 690w,\n/static/a281b8393427aaf7ff8da846f54642a8/dbb86/message-channels.png 933w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<p>There are two kinds of channels: point-to-point and pub-sub:</p>\n<ul>\n<li>A point-to-point channel delivers a message to exactly one of the consumers that is reading from the channel. Services use point-to-point channels for the one- to-one interaction styles described earlier. For example, a command message is often sent over a point-to-point channel.</li>\n<li>A publish-subscribe channel delivers each message to all of the attached consumers. Services use publish-subscribe channels for the one-to-many interaction styles described earlier. For example, an event message is usually sent over a publish-subscribe channel.</li>\n</ul>\n<p>A messaging-based application typically uses a message broker, an infrastructure service through which the service communicates. But a broker-based architecture isn’t the only messaging architecture. You can also use a brokerless based messaging architecture, in which the services communicate with one another directly. The two approaches, shown below, have different trade-offs, but usually a broker-based architecture is a better approach.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.21325648414985%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABrUlEQVQoz3VTaXOjMAzl//+uTrf7pd1p2klncvQgBBswNvedV8lAw6aJZsAysuT39IQDsrZtUZYlmqa2K+/ZTqfTzbWua1RVZR/O6fvOxhx+ZVmGo+dBSAEhhN0vC8z+vC+oiOf7CKREGIbwyY9Ngn4Y4MyHgrzEVmeIaF0WuESXlhWejwFeZYyiGZmoosK/Y4i1jEaENQWeDgJ3mw+s/BDNRPkaOj/J8Gfv4uH9AE+nHMUmULjbfuLJk4RwzMCn0lgJhXe6paH+tF2Pom5+Iazpsl2ksQ1jKG3sNxFF2ESGapgz5aZpoJPE+iZN8UpIX4hWkOa4ZX3fI89zC2i2n4Ks7EBNZYuzAn+J0v3uy6Jhy4sCXTcqyWtKl7qui/1+D0nicNyK8t9NU2FW+StOsFMJMhKBjceDzy3PK6UgaSqM0XZ0GJDTUXBH/XgLiF6s0RL1sWcDhqnAr/GZ/IF8Zcw5xpRVTvQ+PKvaltS6TFqKslSb0bC6jwcJNza2jxxyWLU3CqxEhPjKDN76W8pp1HiE1lL9tMOZ+1Yz1Yuka3ZGf8JBJ1gHGmF6/rO+AZpDo0La3igCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Broker\"\n        title=\"Broker\"\n        src=\"/static/c8a69d85c43c5aaca6911b77937c4f12/1dda8/broker.png\"\n        srcset=\"/static/c8a69d85c43c5aaca6911b77937c4f12/27f03/broker.png 173w,\n/static/c8a69d85c43c5aaca6911b77937c4f12/376d0/broker.png 345w,\n/static/c8a69d85c43c5aaca6911b77937c4f12/1dda8/broker.png 690w,\n/static/c8a69d85c43c5aaca6911b77937c4f12/080fe/broker.png 694w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<h3 id=\"brokerless-messaging\"><a href=\"#brokerless-messaging\" aria-label=\"brokerless messaging permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Brokerless Messaging</h3>\n<p>In a brokerless architecture, services can exchange messages directly. <a href=\"http://%20zeromq.org\">ZeroMQ</a> is a popular brokerless messaging technology.\nBrokerless architecture has some benefits:</p>\n<ul>\n<li>Allows lighter network traffic and better latency, because messages go directly from the sender to the receiver, instead of having to go from the sender to the message broker and from there to the receiver</li>\n<li>Eliminates the possibility of the message broker being a performance bottle- neck or a single point of failure</li>\n<li>Features less operational complexity, because there is no message broker to set up and maintain</li>\n</ul>\n<p>As appealing as these benefits may seem, brokerless messaging has significant drawbacks:</p>\n<ul>\n<li>Services need to know about each other’s locations and must therefore use one of the discovery mechanisms describer earlier in section 3.2.4.</li>\n<li>It offers reduced availability, because both the sender and receiver of a message must be available while the message is being exchanged.</li>\n<li>Implementing mechanisms, such as guaranteed delivery, is more challenging.</li>\n</ul>\n<h3 id=\"broker-based-messaging\"><a href=\"#broker-based-messaging\" aria-label=\"broker based messaging permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Broker Based Messaging</h3>\n<p>A message broker is an intermediary through which all messages flow. A sender writes the message to the message broker, and the message broker delivers it to the receiver. An important benefit of using a message broker is that the sender doesn’t need to know the network location of the consumer. Another benefit is that a message broker buffers messages until the consumer is able to process them.\nThere are many message brokers to chose from. Examples of popular open source message brokers include <a href=\"http://activemq.apache.org\">ActiveMQ</a>, <a href=\"https://www.rabbitmq.com\">RabbitMQ</a>, <a href=\"http://kafka.apache.org\">Apache Kafka</a> etc.</p>\n<p><strong>There are many advantages to using broker-based messaging:</strong></p>\n<ul>\n<li>Loose coupling: A client makes a request by simply sending a message to the appropriate channel. The client is completely unaware of the service instances. It doesn’t need to use a discovery mechanism to determine the location of a service instance.</li>\n<li>Message buffering: The message broker buffers messages until they can be processed. With a synchronous request/response protocol such as HTTP, both the client and service must be available for the duration of the exchange. With messaging, though, messages will queue up until they can be processed by the consumer. This means, for example, that an online store can accept orders from customers even when the order-fulfillment system is slow or unavailable. The messages will simply queue up until they can be processed.</li>\n<li>Flexible communication: Messaging supports all the interaction styles described earlier.</li>\n<li>Explicit interprocess communication: RPC-based mechanism attempts to make invoking a remote service look the same as calling a local service. But due to the laws of physics and the possibility of partial failure, they’re in fact quite different.</li>\n</ul>\n<p><strong>There are some downsides to using messaging:</strong></p>\n<ul>\n<li>Potential performance bottleneck: There is a risk that the message broker could be a performance bottleneck. Fortunately, many modern message brokers are designed to be highly scalable.</li>\n<li>Potential single point of failure: It’s essential that the message broker is highly available—otherwise, system reliability will be impacted. Fortunately, most modern brokers have been designed to be highly available.</li>\n<li>Additional operational complexity: The messaging system is yet another system component that must be installed, configured, and operated.</li>\n</ul>\n<p>A challenge you must tackle when using messaging is dealing with duplicate messages. A message broker should ideally deliver each message only once, but guaranteeing exactly-once messaging is usually too costly. Instead, most message brokers promise to deliver a message at least once. Best way to handle duplicate messages is to write idempotent message handlers. Another method is to track messages and discard duplicates (more costly than idempotency). </p>\n<h3 id=\"message-formats\"><a href=\"#message-formats\" aria-label=\"message formats permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Message formats</h3>\n<p>The choice of message format can impact the efficiency of IPC, the usability of the API, and its evolvability. If you’re using a messaging system or protocols such as HTTP, you get to pick your message format. Some IPC mechanisms—such as gRPC, which you’ll learn about shortly—might dictate the message format. There are two main categories of message formats: text and binary. Text based are JSON and XML. Binary are AVRO, Thrift and Protocol Buffers. </p>\n<h3 id=\"communication-using-rpi\"><a href=\"#communication-using-rpi\" aria-label=\"communication using rpi permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Communication Using RPI</h3>\n<p>When using a remote procedure invocation-based IPC mechanism, a client sends a request to a service, and the service processes the request and sends back a response. Some clients may block waiting for a response, and others might have a reactive, non-blocking architecture. There're 2 main types of RPI methods: REST and gRPC. REST is quite well understood, so let's just understand the benefits/drawbacks of REST and then we'll see how gRPC works:</p>\n<h3 id=\"rest-pros-vs-cons\"><a href=\"#rest-pros-vs-cons\" aria-label=\"rest pros vs cons permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>REST: Pros vs Cons</h3>\n<p><strong>There are numerous benefits to using REST:</strong></p>\n<ul>\n<li>It’s simple and familiar.</li>\n<li>You can test an HTTP API from within a browser using, for example, the Postman plugin, or from the command line using curl (assuming JSON or some other text format is used).</li>\n<li>It directly supports request/response style communication.</li>\n<li>HTTP is, of course, firewall friendly.</li>\n<li>It doesn’t require an intermediate broker, which simplifies the system’s architecture.</li>\n</ul>\n<p><strong>There are some drawbacks to using REST:</strong></p>\n<ul>\n<li>It only supports the request/response style of communication.</li>\n<li>Reduced availability. Because the client and service communicate directly without an intermediary to buffer messages, they must both be running for the duration of the exchange.</li>\n<li>Clients must know the locations (URLs) of the service instances(s). This is a nontrivial problem in a modern application. Clients must use what is known as a service discovery mechanism to locate service instances.</li>\n<li>Fetching multiple resources in a single request is challenging.</li>\n<li>It’s sometimes difficult to map multiple update operations to HTTP verbs.</li>\n</ul>\n<h3 id=\"grpc\"><a href=\"#grpc\" aria-label=\"grpc permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>gRPC</h3>\n<p>As mentioned in the preceding section, one challenge with using REST is that because HTTP only provides a limited number of verbs, it’s not always straightforward to design a REST API that supports multiple update operations. An IPC technology that avoids this issue is <a href=\"www.grpc.io\">gRPC</a>, a framework for writing <a href=\"https://en.wikipedia.org/wiki/Remote_procedure_call%20for%20more\">cross-language clients and servers</a>.</p>\n<p>With the gRPC framework, you create a .proto file and define your service in that file. Finally, methods in the file can be invoked after you've provided your implementations for the methods and calls can then be made over the network.</p>\n<p>gRPC uses Protocol Buffers as the message format. Protocol Buffers is, as mentioned earlier, an efficient, compact, binary format. It’s a tagged format. Each field of a Protocol Buffers message is numbered and has a type code. A message recipient can extract the fields that it needs and skip over the fields that it doesn’t recognize. As a result, gRPC enables APIs to evolve while remaining backward-compatible.</p>\n<p>gRPC has several benefits:</p>\n<ul>\n<li>It’s straightforward to design an API that has a rich set of update operations.</li>\n<li>It has an efficient, compact IPC mechanism, especially when exchanging large messages.</li>\n<li>Bidirectional streaming enables both RPI and messaging styles of communication.</li>\n<li>It enables interoperability between clients and services written in a wide range of languages.</li>\n</ul>\n<p>gRPC also has several drawbacks:</p>\n<ul>\n<li>It takes more work for JavaScript clients to consume gRPC-based API than REST/JSON-based APIs.</li>\n<li>Older firewalls might not support HTTP/2.</li>\n</ul>\n<h3 id=\"services-service-discovery\"><a href=\"#services-service-discovery\" aria-label=\"services service discovery permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Services: Service Discovery</h3>\n<p>Service instances have dynamically assigned network locations. Moreover, the set of service instances changes dynamically because of auto-scaling, failures, and upgrades. Consequently, your client code must use a service discovery. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 561px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.8270944741533%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAAB20lEQVQ4y4VT32vbQAzO//8++lwY7KkPLVnD3MJWWGAsLYNSlrTQOHE8N7N9/u34bCf5Jh09z40dKhC6H9KnT3fSAK+y3+8bK6VEURTYbDbY7Xade5a6rpFlmfLT/nmeY9AG1M6TyQTD4RDnF+eI4/jNvfZhsPH4O0ajEQzDgHFlwDTNfkAGsSwLvu+jrwLNmlk5jgPXdeF5rjprAA8DdVlVVXXYsexozSzbZ7zuZdheV2Wp3kgnsO0VbGsJe2XRnURJ98xYxwza2Q+VhcGCIEAYRciJkRdEuDNt3JI+rkVTQYvhHseEHSICWq9fkKQpclKHAD/9uMfJ6AZfpguUXUAo2sxEK5fAltuAy2xlQFZIPP8VeHYDWH7YZbjdbqnfcgIolKZp8gaILe+5J0tOIksF9vTiYeEFRKYHsK4rLJcLzGZTei+hADRrIQR9hI0wDJFSO9nE6uP4Fz58/orLhzkqStjDcEPUSwKRimGSJE0p+gdZthQcpRl+Ox4eSJ/WfrfkZtTk/xFiELZ8xgFauRJJdiUi9X5OEPf98nFhYJ4CnhrP9xBHBCJCnN1NcfrtJ65ny+4vv9eHqrlfg7hkEae4mc1xff+IifnnfYbHJqY9imz57Xmt20z7/wMB6YnDFVYm1AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Service Discovery\"\n        title=\"Service Discovery\"\n        src=\"/static/300068da50a9d6e89cf672168aa3433f/daba0/service-discovery.png\"\n        srcset=\"/static/300068da50a9d6e89cf672168aa3433f/27f03/service-discovery.png 173w,\n/static/300068da50a9d6e89cf672168aa3433f/376d0/service-discovery.png 345w,\n/static/300068da50a9d6e89cf672168aa3433f/daba0/service-discovery.png 561w\"\n        sizes=\"(max-width: 561px) 100vw, 561px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<p>An application must use a dynamic service discovery mechanism. Service discovery is conceptually quite simple: its key component is a service registry, which is a database of the network locations of an application’s service instances. The service discovery mechanism updates the service registry when service instances start and stop. When a client invokes a service, the service discovery mechanism queries the service registry to obtain a list of available service instances and routes the request to one of them. Let's see how the service registry works:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 70.60367454068242%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACNElEQVQ4y3WTWW/aUBCF+f8/ow/tc6U+JOqSVlFCy+oEB4wNttm8Arbxgg2Y05kLThGiI42udJfvnDv3Tg3nOB6PuI5q7nqsIssyrJdLpHGMw36PsixR4023sgLcSgYVeY6Uxr4xhaSO4UYEPexRu1TcbrcwTZPSEGOSJLgVh8MBOe0Noghf2m18+PENTV1HSfPCYVHk8HwPcRITNENO6kVRIAwD5LTGjlhMOKP5NE3FmXUQ4PFVwvduEz19fLpyScCUQH25B991hSteYKGYarNYLGDbtkgW2u12iMiZ6zoINxs0NAN3jQ40xxd1FFfWrTnums9oKLIA7mmBD3KyK3bE8xWQaxcTzF+t8Pn3Ez7++oq60seRHTLQmM/wKLXRUd6Eer7NBaS66nX9NgTjGmYk8DI2UJf70G1XrAlgSup83Q3BGOIsfapnImDsStSMRi9Yw/VcAWThFdXwvivh088HdMzJ6VEYWB5LQefacfLBkDYzhNOxqV7rNRaecxLKTkIhQR+kDu7bfyCNtH+vfBkpuaoPZTwrPbQMFT1nhr5vYbC08WpNENMvECZI+DLKs6Ha5QfmCNMELVOFPBxAHqmYejZ6moI3bYjudAwvjkRnqJp6+rMTE5ZlvYNr120WbVO8mCPY9FBzSo9qay3m8B0HytyEuwnfm4CvLUb6k5Wpm0BJV+GRqmtb8BwbLmVIPTuYGdRiwc3u+T8wS9GcjqA6cwwpFXsmcuRZaPGVzw5v9T7HX5LPLQX6h9bCAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Client Side Discovery\"\n        title=\"Client Side Discovery\"\n        src=\"/static/ef8b222179e81e1b933d7885bdc46bf2/1dda8/client-side-discovery.png\"\n        srcset=\"/static/ef8b222179e81e1b933d7885bdc46bf2/27f03/client-side-discovery.png 173w,\n/static/ef8b222179e81e1b933d7885bdc46bf2/376d0/client-side-discovery.png 345w,\n/static/ef8b222179e81e1b933d7885bdc46bf2/1dda8/client-side-discovery.png 690w,\n/static/ef8b222179e81e1b933d7885bdc46bf2/2850b/client-side-discovery.png 762w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<p>This approach to service discovery is a combination of two patterns. The first pattern is the <strong>self registration</strong> pattern. A service instance invokes the service registry’s registration API to register its network location. It may also supply a health check URL: The health check URL is an API endpoint that the service registry invokes periodically to verify that the service instance is healthy and available to handle requests. A service registry may require a service instance to periodically invoke a “heartbeat” API in order to prevent its registration from expiring.\nThe second pattern is the <strong>client-side discovery</strong> pattern. When a service client wants to invoke a service, it queries the service registry to obtain a list of the service’s instances. To improve performance, a client might cache the service instances. The service client then uses a load-balancing algorithm, such as a round-robin or random, to select a service instance. It then makes a request to a select service instance.</p>\n<h3 id=\"sagas\"><a href=\"#sagas\" aria-label=\"sagas permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sagas</h3>\n<p>Sagas are mechanisms to maintain data consistency in a microservice architecture without having to use distributed transactions. You define a saga for each system command that needs to update data in multiple services. A saga is a sequence of local transactions. Each local transaction updates data within a single service using the familiar ACID transaction frameworks and libraries mentioned earlier. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.69496021220159%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAB9ElEQVQoz02RCW+bYAyG8/9/zrZWm9SpapJCyH0fkEKBQDjCmTQ90uSZSaVtn2QZ+/v84NeuXS4XqpPuDzhhjJ8WhPuPa+ztUjZxcvVV7It3JfbTnPTwQpjl17iyICs4fZ6pVbAs2aGsTL5NLH5OVzSWGgPL5nZmcTMxuF14dO2Qu7nJ97HBr6VDxw2pL61r/EPs98qhPL5Sqzr8eH/H8AL6a5uVbTLX75lsfLT4SCs8oD7PGEl+sDuiRQda8Rs9P2cY5rSiF9qS0/yM8uVI7SzAy+cnqyhDcSJ6Xori7Zm6AQN9zdAw6Q1vGJlzWn7JwyanYer0zAV9gTyKKdsS1d//A55PHyx3JXW/QA1Kmm7MzI/peAldMVV+MBQ/Mp7oLJ/QrT5Tc0B3W9AMDjy6Hooxpvjb4enEMi5oeCKhAnoHptsERb6VqqiSt4kYBhldyXUcm7ZpMDEdUWEx0/vMjHuyw//AnQBFkurFNBcaU28r8D2tbY4iwJEAx2uLnmEzX9WZGKp0ncpyIroiuy21X5LPZ84yw4Xjoc0Nxvqc0eKOobORzqquM5lbRs8J0Z4DmpaPKnPsbFLaMoYHr6Auyhru7ktyteUK6CcZhh9ihQnrqMRNcgxZVGV6mGLHKaao0OP8ukArSniO5S5Kv95J3evbO38AjieQ/278tPUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Saga\"\n        title=\"Saga\"\n        src=\"/static/35902f02ca39cdab9d9366ea2065d06c/1dda8/saga.png\"\n        srcset=\"/static/35902f02ca39cdab9d9366ea2065d06c/27f03/saga.png 173w,\n/static/35902f02ca39cdab9d9366ea2065d06c/376d0/saga.png 345w,\n/static/35902f02ca39cdab9d9366ea2065d06c/1dda8/saga.png 690w,\n/static/35902f02ca39cdab9d9366ea2065d06c/dbdb8/saga.png 754w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<p>One challenge with sagas is that they are ACD (Atomicity, Consistency, Durability). They lack the isolation feature of traditional ACID transactions. As a result, an application must use what are known as countermeasures, design techniques that prevent or reduce the impact of concurrency anomalies caused by the lack of isolation.</p>\n<h3 id=\"queries\"><a href=\"#queries\" aria-label=\"queries permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Queries</h3>\n<p>Now that you've created a distributed service architecture, you want to gather data residing in different services' DBs to say, for example, create a master view for monitoring. How would you go about doing so? There are two different patterns for implementing query operations in a microservice architecture:</p>\n<ul>\n<li><strong>The API composition pattern</strong>: This is the simplest approach and should be used whenever possible. It works by making clients of the services that own the data responsible for invoking the services and combining the results.</li>\n<li><strong>The Command query responsibility segregation (CQRS) pattern</strong>: This is more powerful than the API composition pattern, but it’s also more complex. It maintains one or more view databases whose sole purpose is to support queries.</li>\n</ul>\n<h3 id=\"api-composition-pattern\"><a href=\"#api-composition-pattern\" aria-label=\"api composition pattern permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>API Composition Pattern</h3>\n<p>One way to implement query operations, that retrieve data owned by multiple services is to use the API composition pattern. This pattern implements a query operation by invoking the services that own the data and combining the results. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.67835550181378%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACFUlEQVQoz31TaW/aQBT0//8RiZJKVY8vCS5QcYQ2VRKgTYECxopCMMbFpsZmzWF8Mn1ejhoi9UnPa8/Ozs6+txY8zwNjDLPZDGEYwnVdnvvwAw/ueom1t+IZhgHHN5sNz9MQLi8vIIoZiJ9EZDLXKJfLkGWZyDEtjtAfV1GXP+Ku9R7fadQt+UjwVFSQJAn9/jMURYGmjQ6EOI4RBCE6/QpqvXfoqFm01Sv8NruvHKZFBfwnkhLMmAnbMWAzA/OVCTa3uPN9nAoLmqZB13Xohg7DMA7u1us1OfRT4v9EfN/j82lne2HBNE0kaUwmmFoW5os5J8cpckCNcBznyE1Emy5XK2qYy7mbV0cmwiY5ojUFs2341P1kERIBSmZbcAh3SeSAI40vtw6Th+/7eNIn+PEyQEsd4Zc2hr1cEj/GcGrh52CIBmVzqGHizLnQ2GZoKCrNKWiqGrQZQ0yGuEOPanXbU5B7kPC5KiFbl6FajBuv9TWI9x0UajJEmpeNKcfb2h9c3xFe3+INdUKCwU4wCnBf7yF/XkD+LI/SVRWqafOFj50X5C+KyJ7lUPzwDbK6bZyk6Mi9KSF3Tvy3X9F8UqlqKYcP3QFKlRbKN02U7roY7Rw+PmsoJniF8NsOlcbcCpLDAmE3Cf6ljRZtEEc7h8n1sBcLWFS3JKf0vqJOR1QTtvu2d+OCfss4CulOro5wJ2lWFOEvHW6FoY+91XAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"API Composition Pattern\"\n        title=\"API Composition Pattern\"\n        src=\"/static/e63313fa71293b9b79eb49bc91972083/1dda8/api-composition-pattern.png\"\n        srcset=\"/static/e63313fa71293b9b79eb49bc91972083/27f03/api-composition-pattern.png 173w,\n/static/e63313fa71293b9b79eb49bc91972083/376d0/api-composition-pattern.png 345w,\n/static/e63313fa71293b9b79eb49bc91972083/1dda8/api-composition-pattern.png 690w,\n/static/e63313fa71293b9b79eb49bc91972083/c87be/api-composition-pattern.png 827w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<p>Figure above shows three provider services. The API composer implements the query by retrieving data from the provider services and combining the results. </p>\n<h3 id=\"api-gateway\"><a href=\"#api-gateway\" aria-label=\"api gateway permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>API Gateway</h3>\n<p>Now that you've created your service, you'd usually have clients connecting to your services. These clients could be connecting via mobile applications, via JS running in the browser, or other applications. Now, since our services are broken down into multiple microservices, each service would have its own API. Plus, different clients typically require different data. A desktop browser-based UI usually displays far more information than a mobile application. Also, different clients access the services over different kinds of networks. Four kinds of clients consume the services’ APIs:</p>\n<ul>\n<li>Web applications</li>\n<li>JavaScript applications running in the browser</li>\n<li>Mobile applications, one for consumers and the other for couriers</li>\n<li>Applications written by third-party developers</li>\n</ul>\n<p>The diagram below shows the initial state of our design:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 580px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.79310344827586%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAADsUlEQVQ4y21UaW/bRhTUn+6HokCB9oPboheK1C6MJHB65E7buDGSuHBkN42ty4rjS7dEHRQl8T7EUySnb5eynTRZYLHgkjucmTf7cmma4v8jSRJc7LP17S/4M3+XIqEljrNJR8C2c0EQQBAEdDod9Ho9DIdDmKYJto8lqFo7Q+2PBxi+3EW8iC7BXfsUnrmF0NmGpT2ndz5yvu+j1WoSWBe6phGYAdu2EYbh5UG18C/EG6uYPH6IiP0IGau5mYerfgd1/D18Yx2LyMkAT85q6PVHfPYHI0iSBMdx4HsegjiBUSnCevAb9O0tBLSXpgn9MCVWeQj1FdTerECT1pHELnJh4EEenkOXmjAnTTi6SHJD6LqO6uEhGl1iXi5Avb0B5ekmB+RegjF8BVdbg2/ehCXfJIZzYmiKMErf4PjJ5xBerMA43uDWscJ4rouIHrTyAYx7P0N7/uRSMhtMYuhP4dgirTLSJEZurg1gDCuQxn0oMxFKe48OzfkBJpkxYZIvAEOyiIMtFqQkgueF0DQT5AwnkfOMEYTKpyjkP0Zp7yNMTn5CsiCPoggnx28wURSY1dJ7gKxww0Efk/EIE0mEYxmI6EzOt2X0itdwtPstTl9+jVntETeI/S2hUsasysV96HdvvSOZvRMUHfvtIQrtAcrdETzyPhf4BnzrKRD8jdjdgqGWeGAzj7LMaVQU7c4tyFQU33O5xykB1sYzbNd62KkLyNN0/YABylSpVVQPPsG0/wWM2e9EPaWcxWg2G1BNC+bhlWRW5ZjY25aJqWnjqDvAUUdAXZzCY4BhoFBkCLDwGUbtr2DIm4gWKZke8aDPSaJa2od6J4sNY8gAHQJsqTYeVs5x+58y8h0JbsAZalDE65T2deiTNczGf/F7+fbQK4X3GDq2halhoSHJaE9VtCfKBUMH6nQHhrIDbfYMqny0bAIJ6vUaFMMgwCJnmHno8eYQRyFaiol7+6+xsb2H3c4Yc4/dZW+G0LoOR1mjdRX6bJPkgktWFRkOxYQFW7/7brAT+misW6j2RFQ7A5yLM/hMchSqmA1/xOEB3ZTGl9Cm5GF01b645PKV5DDIchhTAvq6jd2GgBenLVRFharMGcqw5Wswpz/wzqFIj3jquewkXnpIN+X+L9CoOVwBhuiqJp4dN/D4oIqCMMkkR5EPXSnC1Aq0vqIcni3bIDXSZXW0Au3/egPa1p+XN4XFivVMdqPYZF0rIpty+OBIs/AuZZvNOrS9HeiUx4uw4wOdno3/APfhfenCrUkjAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Gateway-1\"\n        title=\"Gateway-1\"\n        src=\"/static/7eb3d50d34506625f138d05feb9310c6/2c164/gateway1.png\"\n        srcset=\"/static/7eb3d50d34506625f138d05feb9310c6/27f03/gateway1.png 173w,\n/static/7eb3d50d34506625f138d05feb9310c6/376d0/gateway1.png 345w,\n/static/7eb3d50d34506625f138d05feb9310c6/2c164/gateway1.png 580w\"\n        sizes=\"(max-width: 580px) 100vw, 580px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<p>We can't have clients directly calling our services. As we discussed earlier ideas relating to circuit-breaker, clients making multiple calls to services etc, we need an additional coordination layer between our backend services and clients. This coordination layer can be represented by a service called the <strong>API Gateway Service</strong>. An API gateway is a service that’s the entry point into the application from the outside world. It’s responsible for request routing, API composition, and other functions, such as authentication. Clients to make a single request to an API gateway, a service that serves as the single entry point for API requests into an application from outside the firewall. API gateway encapsulates the application’s internal architecture and provides an API to its clients. It may also have other responsibilities, such as authentication, monitoring and rate limiting. Here's what our structure would look like with the API gateway added:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.75204359673025%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAAC00lEQVQ4y21UaU/bQBTMH6eqenypVFW9xIeKFgoNoH5A9IACKZSC1IpSEggEJYGEmCQ+EjvrK749fbtOQpFYaWV59TyemTdvc7Ztw7Is8GcQBEiSBHzFYYiB3IVjGOI9TdPJhngCgW/QVuF7Gn0Xi7pcuXyMdvsamqbCdV0BytdQ6aL25jXaG1+R4mYJQFphmMAzV+Czabj6DKLQzADrjWsovQFktQ/GGOIoygCJHVueh7n7HXGSMePsx9v3SYGaR6U4BVV6jiQeAV4dr0E+L2DQOYMfhGhdNdGUJLjdDrT8LPrbmwjjWEiK4whJyi1JEcUpXLYOj72HrecRRVYG2D5chnS0CuuyIA4YG4DZDly5g97iLAY/tgRD3CE7ikKYFiP5weQsVz2ew9nxInoX6+LA0HUYpomAPO0vzhFgQQA6HgNzVIRR5jFvoqYq0BQZjm2R5FhYkSvt3Efp52Pol2tZoWXSx56QnDHMAA8bn/Ct/AIqa4k6zxvivC3jqNlGWerCCzKWOVtdwLC/hEHvQBQGgY+A/sS7rOXfwdghD6MER63PKFRfQTNbE7nFlozduoS9Wgv20BPe5qrle2hWH8HUC+BWyeRdV1XhkZQMcAtDz0fh7zwWth9ANhpIKAiOY+O0o2H7pIrfF9REPxD5zNVPH0KqPQHr8XgIywUD0RTqsk4MOeB+5SO+FJ9BMZqihEuudHsolCo4aLQxHAMa6gqBrULvFQWQTPnrKErG8EPGkHv452oF65Wn5GFzFOwARUnBWrGCPZLt0E8FoN59CVOdJsm7lDPQGA0Rcg8J+P8uN9USTqQCTLc/AWz2Tfw6r+O0TRbRqIqm1E6m0CIPWX/zluQbQGKY3s6hCDZNVBpnU0V5yd6FZGUGVm8OhraflY6GnAPqSyOGApCPXzIJsBjF8TiOLw0e7Djm6Hw+R4Wj24Y3RVl4S6O3MWF468a5Y/Hzf5pqYAUzhDQRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Gateway-2\"\n        title=\"Gateway-2\"\n        src=\"/static/82e31a2bcc8d9d108f8e1d14d7c33d16/1dda8/gateway2.png\"\n        srcset=\"/static/82e31a2bcc8d9d108f8e1d14d7c33d16/27f03/gateway2.png 173w,\n/static/82e31a2bcc8d9d108f8e1d14d7c33d16/376d0/gateway2.png 345w,\n/static/82e31a2bcc8d9d108f8e1d14d7c33d16/1dda8/gateway2.png 690w,\n/static/82e31a2bcc8d9d108f8e1d14d7c33d16/e804f/gateway2.png 734w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<p>The API gateway is responsible for request routing, API composition, and protocol translation. All API requests from external clients first go to the API gateway, which routes some requests to the appropriate service. </p>\n<h3 id=\"edge-functions\"><a href=\"#edge-functions\" aria-label=\"edge functions permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Edge Functions</h3>\n<p>Although an API gateway’s primary responsibilities are API routing and composition, it may also implement what are known as edge functions. An edge function is, as the name suggests, a request-processing function implemented at the edge of an application. Examples of edge functions that an application might implement include the following:</p>\n<ul>\n<li>Authentication—Verifying the identity of the client making the request.</li>\n<li>Authorization—Verifying that the client is authorized to perform that particular operation.</li>\n<li>Rate limiting —Limiting how many requests per second from either a specific client and/or from all clients.</li>\n<li>Caching—Cache responses to reduce the number of requests made to the services.</li>\n<li>Metrics collection—Collect metrics on API usage for billing analytics purposes.</li>\n<li>Request logging—Log requests.</li>\n</ul>\n<p>It’s often convenient to implement these edge functions, especially authorization, in the API gateway itself. There’s one less network hop, which improves latency. There are also fewer moving parts, which reduces complexity. Usually, to increase availability, we have the API gateway behind a load balancer.</p>\n<p><strong>BENEFITS OF AN API GATEWAY</strong>\nA major benefit of using an API gateway is that it encapsulates internal structure of the application. Rather than having to invoke specific services, clients talk to the gateway. The API gateway provides each client with a client-specific API, which reduces the number of round-trips between the client and application. It also simplifies the client code.</p>\n<p><strong>DRAWBACKS OF AN API GATEWAY</strong>\nThe API gateway pattern also has some drawbacks. It is yet another highly available component that must be developed, deployed, and managed. There’s also a risk that the API gateway becomes a development bottleneck. Developers must update the API gateway in order to expose their services’s API. It’s important that the process for updating the API gateway be as lightweight as possible. Otherwise, developers will be forced to wait in line in order to update the gateway. Despite these drawbacks, though, for most real-world applications, it makes sense to use an API gateway. If necessary, you can use the Backends for frontends pattern to enable the teams to develop and deploy their APIs independently.</p>\n<h3 id=\"secure-services\"><a href=\"#secure-services\" aria-label=\"secure services permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Secure Services</h3>\n<p>An application developer is primarily responsible for implementing four different\naspects of security:</p>\n<ul>\n<li>Authentication: Verifying the identity of the application or human (a.k.a. the principal) that’s attempting to access the application. For example, an application typically verifies a principal’s credentials, such as a user ID and password or an application’s API key and secret.</li>\n<li>Authorization: Verifying that the principal is allowed to perform the requested operation on the specified data. Applications often use a combination of role-based security and access control lists (ACLs). Role-based security assigns each user one or more roles that grant them permission to invoke particular operations. ACLs grant users or roles permission to perform an operation on a particular business object, or aggregate.</li>\n<li>Auditing: Tracking the operations that a principal performs in order to detect security issues, help customer support, and enforce compliance.</li>\n<li>Secure interprocess communication: Ideally, all communication in and out of services should be over Transport Layer Security (TLS). Interservice communication may even need to use authentication.</li>\n</ul>\n<p>There are a couple of different ways to handle authentication. One option is for the individual services to authenticate the user. The problem with this approach is that it permits unauthenticated requests to enter the internal network. It relies on every development team correctly implementing security in all of their services. As a result, there’s a significant risk of an application containing security vulnerabilities.</p>\n<p>A better approach is for the API gateway to authenticate a request before forwarding it to the services. Centralizing API authentication in the API gateway has the advantage that there’s only one place to get right. As a result, there’s a much smaller chance of a security vulnerability. Another benefit is that only the API gateway has to deal with the various different authentication mechanisms. It hides this complexity from the services. Two types of clients are possible when authenticating: API Client and Login-based client:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.44239631336406%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACDklEQVQoz3WTaY7iMBCF+/43GfUtgB8IesIAGpoAJgtZcBI7ISH78sY2SzcjdUmlQFz57Hr1/DYMA2REUQRyJFgul5jPZ3AcB4+omxI8oUjSEG1XIwpFLTnAtm3xJEjTVNVJ1pv80bYtqqpSL8n2gPloBlu3sF/pOKwI9vslpptfmG/fEecWDMPCeDzCdDrFZrNBmmWvwKZpcLkkSBKOiIZIwhixSEYZ2JnB9y1cqwCXawCPEvVx3/fouu7ZhYTJXhVQLtyyVYuWbaEoC/RDL3JAxH00banWZh9j0DNVQJkCdQPfpXt7aPh4ppcUi4kGsj6gLEp0ba/06/pKfazrK6w/1tgs/sIhNsJLhqlFsQsTBX2esKlrsWOHLM3gGg6oQ1GLd504RcBcGOYepmnApyYyAYl5glwMgwQx3jUdI+KqWgUsigJBQFVKiGEYsA4mnOMJ1KbwPVtMmCGOOVjs4Xs0bQeDZ4iuN0kUsCyFLThTWVUlwjDEcXvE8ZPA+DTgnAzRbKM0jrj7NYS7TF+DuQNVa6JtWdAJCy1//0HgB+AhR54XCLknvJiLOrEZd140f4DV/4eGL7v0gzgdgb7ewtyZ6NsBaS6sE+1wOm/BEu8F+H8oIGNMWcX1XFBKn4ue78HzPJzpWXjRE36tf2z3BSivz2QyhqZp6hpJf0ldFwtN3QjLstTgbr77+XQy/gHIeZPIWokZTwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Authentication\"\n        title=\"Authentication\"\n        src=\"/static/626446b926864e9df3576f40176cf58b/1dda8/authentication.png\"\n        srcset=\"/static/626446b926864e9df3576f40176cf58b/27f03/authentication.png 173w,\n/static/626446b926864e9df3576f40176cf58b/376d0/authentication.png 345w,\n/static/626446b926864e9df3576f40176cf58b/1dda8/authentication.png 690w,\n/static/626446b926864e9df3576f40176cf58b/983e0/authentication.png 868w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://microservices.io/book\">Image Credit</a></p>\n<p>The sequence of events for API clients is as follows:</p>\n<ol>\n<li>A client makes a request containing credentials.</li>\n<li>The API gateway authenticates the credentials, creates a security token, and passes that to the service or services.</li>\n</ol>\n<p>The sequence of events for login-based clients is as follows:</p>\n<ol>\n<li>A client makes a login request containing credentials.</li>\n<li>The API gateway returns a security token.</li>\n<li>The client includes the security token in requests that invoke operations.</li>\n<li>The API gateway validates the security token and forwards it to the service or services.</li>\n</ol>\n<p>Authenticating a client’s credentials is important but insufficient. An application must also implement an authorization mechanism that verifies that the client is allowed to perform the requested operation. You can use an off-the-shelf service or framework that implements a standard called OAuth 2.0.</p>\n<p>The key concepts in OAuth 2.0 are the following:</p>\n<ul>\n<li>Authorization Server: Provides an API for authenticating users and obtaining an access token and a refresh token. Spring OAuth is a great example of a framework for building an OAuth 2.0 authorization server.</li>\n<li>Access Token: A token that grants access to a Resource Server. The format of the access token is implementation dependent. But some implementations, such as Spring OAuth, use JWTs.</li>\n<li>Refresh Token: A long-lived yet revocable token that a Client uses to obtain a new AccessToken.</li>\n<li>Resource Server: A service that uses an access token to authorize access. In a microservice architecture, the services are resource servers.</li>\n<li>Client: A client that wants to access a Resource Server. In a microservice architecture, API Gateway is the OAuth 2.0 client.</li>\n</ul>\n<h3 id=\"rate-limiter\"><a href=\"#rate-limiter\" aria-label=\"rate limiter permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Rate Limiter</h3>\n<p>One of the most important edge functions provided by an API gateway is the rate limiter. API limiting, which is also known as rate limiting, is an essential component of Internet security, as DoS attacks can tank a server with unlimited API requests. Rate limiting also helps make your API scalable. If your API blows up in popularity, there can be unexpected spikes in traffic, causing severe lag time. </p>\n<p>API owners typically measure processing limits in Transactions Per Second (TPS). Some systems may have physical limitations on data transference. Both are part of the Backend Rate Limiting. To prevent an API from being overwhelmed, API owners often enforce a limit on the number of requests, or the quantity of data clients can consume. This is called Application Rate Limiting. If a user sends too many requests, API rate limiting can throttle client connections instead of disconnecting them immediately. Throttling lets clients still use your services while still protecting your API.</p>\n<p>Some APIs feature soft limits, which allow users to exceed the limits for a short period. Others have a more hardline approach, immediately returning an HTTP 429 error and timing out, forcing the user to send a brand new query. There are various algorithms for rate limiting, each with its benefits and drawbacks. Let’s review each of them so you can pick the best one for your needs.</p>\n<p><strong>Sliding Window</strong>\nWe track a counter for each fixed window. Next, we account for a weighted value of the previous window’s request rate based on the current timestamp to smooth out bursts of traffic. For example, if the current window is 25% through, we weigh the previous window’s count by 75%. The relatively small number of data points needed to track per key allows us to scale and distribute across large clusters.Sliding window approach is recommended because it gives the flexibility to scale rate limiting with good performance. The rate windows are an intuitive way to present rate limit data to API consumers. It also avoids the starvation problem of the leaky bucket and the bursting problems of fixed window implementations.</p>\n<p>Let's have a look at a detailed design for a rate limiter:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.12295973884659%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+UlEQVQ4y5VTTW/UMBDdf8sZfgFHDr1y4cIRcUJCSJUQiF6LQNoDQlBUdVk23STOd5z4M3mMnWblsqlKI81mNvY8v/dmvBrHEQ+NYRh8uJzxHn9ShqIXsPR/FW64L+a9lPhweac00rKFNBZDCPi/zByQsRbaGLjHDhasyf3bPaslFnezHn3R01ef8ej5GYS0iIod3pw/A2vjCdD9LPoTxHxQrxR6KfD603e8eLem7xZc9NglW1oTE2AnBAwVaJIR+mMpF3aEvPnWCQem/XJRX6NuEhgzyZxKJkKr33GKKI5xtYuQtx0VSrS9xL6scbXZYLePsUlL7PMMSZXQ2oD365c4v3jrwRzLWYFnyKlLLEnBCEBoc5DMpcI2ukac5T6vOR1Gcl1DsramcWl8Y8KmTk2hDabrMN7ycpikSDnp8UxoRIg5Vwb5xS+k67WvCZsZAPLFmTO8hShyqLbFbJYblrOTE5w+eXw46AhQcz4xczVBWGJujfa5oOYJx9jl9OZCLAO6xFLrVVlCZAySzBeMQTcNTFMTuwaWvOOU98RUE1CVpqjq2nf5yMPZN6s1NDFyoYixnQ0nBZbmryLpvWNMXW2q0odWchnwcENCyf9cSUMHGlJSlQ2+bTMf+4L73ceAd1y1W1fwpiDLK3z48gMfv/7EZcQOPs6AfwFTb49YcFLriAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Rate-Limiter\"\n        title=\"Rate-Limiter\"\n        src=\"/static/9b1e7d4f0f6c1f2f5685cc544e5cb335/1dda8/rate-limiter.png\"\n        srcset=\"/static/9b1e7d4f0f6c1f2f5685cc544e5cb335/27f03/rate-limiter.png 173w,\n/static/9b1e7d4f0f6c1f2f5685cc544e5cb335/376d0/rate-limiter.png 345w,\n/static/9b1e7d4f0f6c1f2f5685cc544e5cb335/1dda8/rate-limiter.png 690w,\n/static/9b1e7d4f0f6c1f2f5685cc544e5cb335/558d2/rate-limiter.png 919w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Once a client makes a request to our API gateway, we first check and see whether the user is on the rate-limited list! To do so, we route the request to the rate limiter middleware. The middleware hits the cache that has the rules stored for determining when to limit API calls. Based on the rules, the middleware sets the constraints. On a high level, we need a counter to keep track of how many requests are sent from the same user, IP address etc. If the counter is > limit, request is denied. Where shall we store the counters? Using the database is not a good idea due to slowness of disk access. In-memory cache is chosen because it is fast and supports time-based expiration strategy. For instance, Redis is a popular option to implement rate limiting. It is an in-memory store that offers two commands: INCR and EXPIRE.</p>\n<p>• INCR: It increases the stored counter by 1.</p>\n<p>• EXPIRE: It sets a timeout for the counter. If the timeout expires, the counter is automatically deleted.</p>\n<p>Rate limiter middleware loads rules from the cache. It fetches counters and last request timestamp from Redis cache. Based on the response, if the rate limiter decides that request is not rate limited, it is forwarded to API servers. If request is rate limited, rate limiter returns 429 too many requests error to the client. In the meantime, the request is either dropped or forwarded to the queue depending on how you want to handle blocked requests.</p>\n<p>Building a rate limiter that works in a single server environment is not difficult. However, scaling the system to support multiple servers and concurrent threads is a different story. There are two challenges: <strong>Race condition</strong> and <strong>Synchronization issue</strong>. </p>\n<p>Race condition occurs when two clients read the value from Redis cache and try to update the value concurrently. A possible solution is to use locks however locks are not scalable and will slow down our system. A simple solution is to use a lua script that, when executing, prevents concurrent updates. We can also use Redis' built-in sorted sets.</p>\n<p>Synchronization issues arise when we have multiple rate limiter servers and consecutive user requests hit different servers. For the first request, user's counter is updated in server 1 but for the second request, since the request is routed to server 2,  the counter is updated there. Even though the number of requests from the user are 2, our systems show that we've only received 1 request. To handle this, we need to synchronize our Redis instances. We can try and use sticky sessions that routes user requests to the same server BUT it is not scalable. A better approach is to use centralized Redis data stores. This is done via eventual consistency model:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.076154806491886%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABhElEQVQoz1VSu27DMAz0D2Xqj/YDCnTs0rFTl/5Bh2RKWxdx4jiJ/JRlyVJs63pyGiAhQFA2KfLuqEhZhzg74lA16IYJde/QujNuLe8MamNR6p55+//Xw3uPaZouPo6zRxWLsixDttuhKgoc0h2+0wMabVE0CknZIjsJ7JINa7YQtUTR9XAcGhqFxrcWtfaMgCevasSbBHGS4PcgMHK6Ow+QRCbJotUGyvQzA0VvlEHZdmjYXDNXrFbIl0tEA6coN8CQrhn9fLbDyMEXSgGBJpqOzUOuZ7yi8tOIjqXvr294Wizw/PCAyPFywUlVQDBfHGHHeyqaNUFfxWjCMNrAWLd6lkZLiY/HR3y+vCAqKfj6J8aGVDtjIPIciSjRE01HukGv7fGEdL+nZzg1EjV1L6WCoRTwl8FqIMuwFGkvG83FCV/rNTa/MdbbPbQdqJNGWqlZuzIXkFWFhuewSPzLcd3y/E2PNDU5EoUg9Nw4pNxseB63JgLS/szoUHIhwa6NvL9/Pn8bkWQil8lMswAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Synchronization\"\n        title=\"Synchronization\"\n        src=\"/static/00b967a595985cb75d974c31354ae211/1dda8/rate-limiter2.png\"\n        srcset=\"/static/00b967a595985cb75d974c31354ae211/27f03/rate-limiter2.png 173w,\n/static/00b967a595985cb75d974c31354ae211/376d0/rate-limiter2.png 345w,\n/static/00b967a595985cb75d974c31354ae211/1dda8/rate-limiter2.png 690w,\n/static/00b967a595985cb75d974c31354ae211/299c1/rate-limiter2.png 801w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p><a href=\"https://blog.cloudflare.com/counting-things-a-lot-of-different-things/\">Interesting read on rate limiting by Cloudflare</a></p>\n<h3 id=\"summary\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h3>\n<p>We talked about the best practices when designing microservices and the trade-offs between different approaches. We can use the ideas discussed in the section above to setup a system from scratch using the microservice approach. The section below deals with coming up with a system from scratch. The idea is to use the concepts above to come up with a system architecture on the fly.</p>\n<h3 id=\"introduction\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h3>\n<p>If you were to setup your website today, from scratch, how would you go about doing it? You'd probably have a single server to serve your website. In this single server setup, everything is running on one server: your web application, maybe a database, your cache etc. You'll have something like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 672px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.61309523809524%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABX0lEQVQoz42STWuDQBCG85v7h1rw3ktOvZQeSm5pwUMg0lLUBInGxnxo/J76DJ2kKQSiDju78+6zM+OO+r6Xrutks9nIarWS4/EoeZ5LURRqrDPHiPE0TSN1XUvbtjpfr9dSlqX6IxPsdjsVRVEkvu9rEOB8Pj+JD4eDgpfLpQRBoNrZbCaO48hkMjkDAdkmz/NUxBoA13UlyzKNke12u1VgGIay3+9lsVjIeDxW3UWGnAwUCEKyo8QkSRRiMdrDAWmaSlVVCmHNnpE5ZGRZsdmMNeBstp7ZY/1nxBTIJrKgsZaNin9fvjiONcbIgQYymI0K5FQrk5FS6rqSnmSGSqxs0zD/D7oA4tBDOxEf0Ec8lbfwSf22vYzThqtAJibA2q7RwPPnvTxM79QHeIoPFd0EtCbrO5T7/vUir96jZtj358b/TeBqyfxB+8t6hYpc0mS4c99cn/xUJoaW+TXgD+ToVJWF40J3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Basic-Simple-Setup-Flow\"\n        title=\"Basic-Simple-Setup-Flow\"\n        src=\"/static/e47782298824bde7e74b3f6de694bb90/581a4/basic-setup.png\"\n        srcset=\"/static/e47782298824bde7e74b3f6de694bb90/27f03/basic-setup.png 173w,\n/static/e47782298824bde7e74b3f6de694bb90/376d0/basic-setup.png 345w,\n/static/e47782298824bde7e74b3f6de694bb90/581a4/basic-setup.png 672w\"\n        sizes=\"(max-width: 672px) 100vw, 672px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>A user would hit your website by either going to his/her browser or the mobile app, and enter the URL to your website. Next, this request will be routed to a domain name server that translates the address to an IP address and returns back to you. Let's talk a little more about the DNS:</p>\n<h3 id=\"dns\"><a href=\"#dns\" aria-label=\"dns permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DNS</h3>\n<p> Anything connected to the internet - laptops, phones etc has an IP address. A DNS's job is to convert the IP address to something more recognizable (from 64.202.189.170 to yourwebsite.com). So, when you type yourwebsite.com into your browser, your browser sends a query over the internet to find the website for yourwebsite.com. The query, in simplified terms, would be \"What is the IP address of yourwebsite.com\". The request is first sent to the <strong>recursive resolver (RR)</strong> (usually operated by your ISP). RR knows which other DNS servers might know the answer to your question. </p>\n<p>The first server RR talks to is called the <strong>Root Server</strong>. These servers are running all over the world and each one knows DNS information about top level domains. These root servers are placed strategically around the world to handle user traffic appropriately. The root server then returns the IP address to the recursive resolver. Since the internet supports IPv4 and IPv6, the recursive resolver returns both ip addresses. Finally, now that the recursive resolver has the answer for \"What is the IP address of yourwebsite.com\", it can go ahead and visit the IP address and the server at that address responds to your request.  </p>\n<p>Now, say as your website grows, you want to show a personalized page for each visitor. To store each visitor's information, you need a data-store: ie database. This is what our flow would look like with a database:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 627px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.459330143540676%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABqklEQVQoz11Sy07CUBD13/wLf8S9P+AnmLhhi2sJK1kYQ0yMCxoCAm2BtrwK9N1y7Dn1KjLJ9E7vnTkz59x7hdqiKIJt29jv94rjOEaaptjtdnLGh8MBZVkqTpJETttsNpjP54pPpxOu+CFAnudaB4OBimmj0QjT6VQxAYIgUOPJZKJ9xu12G61WC2EYKu8XkMaCfr8P13X1PxwOYVkWqqoS4Gq1guM4mM1mquEe83u9ngYSoOmeZRmKohAlOhMMNe5zJbChzPjSRJm6MIH6HY9HacIiNuAeNeQ+ZSCwMQJeugA5uud58H1flI1+NE65XC51RmdjFpniJq79J/69lHPbbrco84YOhTa3eU6LRmalJq7Bq1LNBXg+rnTMSnjhBO/Oc02xkYNTjsdj3S49rKVIkhiHOEX3w8HUD3EqC0nyDzBNm2k+Fh3cv9woLormORln05hTVznsdYzruw6e3mzlZlneUP6bMNXBl/+JrvVYU4FAHNfRu+Ok5r2S5jqMcPvQw6u1aADzC0A9j3pK3wuwdH3dsHlSzKFuzOE/PapvfxssEO42asTzb0BwTDoM2WVgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Flow-with-DB\"\n        title=\"Flow-with-DB\"\n        src=\"/static/71501212bd1751140b86262522b51fbc/56f38/setup-with-db.png\"\n        srcset=\"/static/71501212bd1751140b86262522b51fbc/27f03/setup-with-db.png 173w,\n/static/71501212bd1751140b86262522b51fbc/376d0/setup-with-db.png 345w,\n/static/71501212bd1751140b86262522b51fbc/56f38/setup-with-db.png 627w\"\n        sizes=\"(max-width: 627px) 100vw, 627px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Now, your website server would hit the database, get the user information/preferences and return the page rendered with that information.</p>\n<p>A few questions you should ask:</p>\n<h3 id=\"types-of-data\"><a href=\"#types-of-data\" aria-label=\"types of data permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Types of Data</h3>\n<p><strong>(1) What type of database should I use?</strong></p>\n<p>In order to answer this question, you need to understand the data model that you'll use to represent your data! The data model will determine how you THINK about the problem. You can use JSON or XML documents, tables in a relational database or a graph model. The representation that you choose for your data would determine how your data is queried, searched, manipulated and processed in various ways. Let's look at some common data models:</p>\n<h3 id=\"types-of-data---relational-model\"><a href=\"#types-of-data---relational-model\" aria-label=\"types of data   relational model permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Types of data - Relational Model</h3>\n<p>This is by far the best known model: the SQL model. Here, data is organized into relations (tables in SQL) where each relation is an unordered collection of tuples (rows in SQL). Common use cases for the SQL model constitute transaction processing such as entering sales or banking transactions, airline reservations etc and batch processing: customer invoicing, payroll, reporting  etc. </p>\n<p>In the relational model, the data is laid out in the open: a table is simply a collection of rows and that's it! There are no nested structures or complicated access paths to follow if you want to look at the data. You can read any or all rows in a table, selecting those that match a condition. In relational DBs, the <strong>query optimizer</strong> automatically decides which parts of the query to execute in which order, and which indexes to use. Those choices, when compared to document model, are effectively the access path BUT they're made automatically by the optimizer and not the app developer. </p>\n<p>The key insight of the relational model is this: you only need to build a query optimizer once and all applications that use the DB can benefit from it.  </p>\n<p>Sometimes, there's an awkward transitional layer required between the objects in application code (POJOs for example) and the database model of tables, rows and columns. In order to remedy this, object-relational mapping frameworks can be used such as Hibernate, Spring DAO etc. </p>\n<h3 id=\"types-of-data---document-model\"><a href=\"#types-of-data---document-model\" aria-label=\"types of data   document model permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Types of data - Document Model</h3>\n<p>In this category, the pre-dominant force is the family of NoSQL DBs. These came into existence to solve for:</p>\n<ul>\n<li>A need for greater scalability than relational databases: ie handling very large datasets and very high throughput</li>\n<li>Specialized query operations that are not well supported by relational model</li>\n</ul>\n<p>In the document model, records are saved as a single document. For example, a resume that can be represented using JSON. Databases such as MongoDB, RethinkDB, CouchDB and Espresso support document model. Document model reverted back to the hierarchical model by storing nested records within the parent record rather than in a separate table:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-cppjs\"><code class=\"language-cppjs\"><span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"year\"</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">2013</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"title\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">\"Turn It Down, Or Else!\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"info\"</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"directors\"</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span> <span class=\"token string\">\"Alice Smith\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Bob Jones\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"release_date\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">\"2013-01-18T00:00:00Z\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"rating\"</span> <span class=\"token punctuation\">:</span> <span class=\"token number\">6.2</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"genres\"</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"Comedy\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Drama\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"image_url\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">\"http://ia.media-imdb.com/images/N/O9ERWAU7FS797AJ7LU8HN09AMUP908RLlo5JF90EWR7LJKQ7@@._V1_SX400_.jpg\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"plot\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string\">\"A rock band plays their music at high volumes, annoying the neighbors.\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"actors\"</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"David Matthewman\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"Jonathan G. Neff\"</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token string\">\"year\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2015</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"The Big New Movie\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token string\">\"info\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"plot\"</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Nothing happens at all.\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"rating\"</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span></code></pre></div>\n<h3 id=\"types-of-data---relation-vs-document-model\"><a href=\"#types-of-data---relation-vs-document-model\" aria-label=\"types of data   relation vs document model permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Types of data - Relation vs Document Model</h3>\n<p>There are many differences to consider when deciding whether to use relational DBs or document DBs. Let's create a quick table to compare and contrast the two:</p>\n<table>\n<thead>\n<tr>\n<th></th>\n<th>Relation Model</th>\n<th>Document Model</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><strong>Schema Flexibility</strong></td>\n<td>If you want to add a new field to your existing schema, you'd have to update the tables. There needs to be a middle layer to translate your code objects to data in DB.</td>\n<td>Schema changes are easier in the document model where all you need to do is add a field to the schema and expect the clients to handle that new field. Plus, your application code would have the same data objects that the DB uses.</td>\n</tr>\n<tr>\n<td><strong>Performance</strong></td>\n<td>In order to get all the data that you need, you'd have to customize your query.</td>\n<td>In document model, the performance is better due to locality. If your application needs to access the entire document (to render on a web page for example), then reading entire data in one go would be better than having to join across tables to get all relevant information</td>\n</tr>\n<tr>\n<td><strong>Relations in data</strong></td>\n<td>There's better support for joins, many-to-one and many-to-many relationships</td>\n<td>For joins and multiple relations, you'd have to have references that can get complicated pretty fast!</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"types-of-data---graph-model\"><a href=\"#types-of-data---graph-model\" aria-label=\"types of data   graph model permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Types of data - Graph model</h3>\n<p>We've seen that many-to-many relationships can cause relational and document models to break. If your data consists of numerous many to many relations, then the graph model would be best suited. As with our vanilla graph data structure, a graph model comprises of vertices and edges. Well known graph algorithms can then operate on these structures.</p>\n<h3 id=\"types-of-databases\"><a href=\"#types-of-databases\" aria-label=\"types of databases permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Types of Databases</h3>\n<p>Now that we've talked about the types of data that our application can expect to collect, let's talk about the types of databases that can be used to store our data.</p>\n<h3 id=\"relational-database\"><a href=\"#relational-database\" aria-label=\"relational database permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Relational Database</h3>\n<p>This is the most common &#x26; widely used type of database in the industry. A relational database saves data containing relationships. One to One, One to Many, Many to Many, Many to One etc. It has a relational data model. SQL is the primary data query language used to interact with relational databases. MySQL is the most popular example of a relational database. What are relationships? Let’s say you as a customer buy five different books from an online book store. When you created an account on the book store you would have been assigned a customer id say C1. Now that C1[You] is linked to five different books B1, B2, B3, B4, B5. This is a one to many relationship. In the simplest of forms, one table will contain the details of all the customers &#x26; another table will contain all the products in the inventory. One row in the customer table will correspond to multiple rows in the product inventory table. On pulling the user object with id C1 from the database we can easily find what books C1 purchased via the relationship model.</p>\n<p>Besides, the relationships, relational databases also ensure saving data in a normalized fashion. In very simple terms, normalized data means a unique entity occurs in only one place/table, in its simplest and atomic form and is not spread throughout the database. This helps in maintaining the consistency of the data. In future, if we want to update the data, we just update at that one place and every fetch operation gets the updated data. Had the data been spread throughout the database in different tables. We would have to update the new value of an entity everywhere. This is troublesome and things can get inconsistent.</p>\n<p>Besides normalization &#x26; consistency, relational databases also ensure ACID transactions.\nACID – Atomicity, Consistency, Isolation, Durability.\nAn acid transaction means if a transaction in a system occurs, say a financial transaction, either it will be executed with perfection without affecting any other processes or transactions; the system will have a new state after the transaction which is durable &#x26; consistent. Or if anything amiss happens during the transaction, say a minor system failure, the entire operation is rolled back. When a transaction happens, there is an initial state of the system State A &#x26; then there is a final state of the system State B after the transaction. Both the states are consistent and durable. A relational database ensures that either the system is in State A or State B at all times. There is no middle state. If anything fails, the system goes back to State A. If the transaction is executed smoothly the system transitions from State A to State B.</p>\n<h3 id=\"when-to-pick-rdbs\"><a href=\"#when-to-pick-rdbs\" aria-label=\"when to pick rdbs permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>When to pick RDBs</h3>\n<p>If you are writing a software which has anything to do with money or numbers, that makes transactions, ACID, data consistency super important to you. Relational DBs shine when it comes to transactions &#x26; data consistency. They comply with the ACID rule, have been around for ages &#x26; are battle-tested.</p>\n<p>If your data has a lot of relationships like which friends of yours live in a particular city? Which of your friends already ate at the restaurant you plan to visit today? etc. There is nothing better than a relational database for storing this kind of data. Relational databases are built to store relationships.  </p>\n<h3 id=\"nosql-dbs\"><a href=\"#nosql-dbs\" aria-label=\"nosql dbs permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NoSQL DBs</h3>\n<p>Not only SQL DBs, or NoSQL DBs, are like JSON-based databases built for Web 2.0. Some of the popular NoSQL databases used in the industry are MongoDB, Redis, Neo4J, Cassandra.\nThey are built for high frequency read &#x26; writes, typically required in social applications like Twitter, LIVE real-time sports apps, online massive multi-player games etc.Now, one obvious question that would pop-up in our minds is: Why the need for NoSQL databases when relational databases were doing fine, were battle-tested, well adopted by the industry &#x26; had no major persistence issues?</p>\n<p>Well, one big limitation with SQL based relational databases is Scalability. Scaling relational databases is something which is not trivial. They have to be Sharded or Replicated to make them run smoothly on a cluster. In short, this requires careful thought and human intervention. On the contrary, NoSQL databases have the ability to add new server nodes on the fly &#x26; continue the work, without any human intervention.</p>\n<p>NoSQL databases are designed to run intelligently on clusters. And when I say intelligently, I mean with minimal human intervention. Today, the server nodes even have self-healing capabilities. That’s pretty smooth. The infrastructure is intelligent enough to self-recover from faults. Though all this innovation does not mean old school relational databases aren’t good enough &#x26; we don’t need them anymore. Relational databases still work like a charm &#x26; are still in demand. They have a specific use-case. Also, NoSQL databases had to sacrifice Strong consistency, ACID Transactions &#x26; much more to scale horizontally over a cluster &#x26; across the data centres.\nThe data with NoSQL databases is more Eventually Consistent as opposed to being Strongly Consistent.</p>\n<h3 id=\"nosql-vs-rdbs\"><a href=\"#nosql-vs-rdbs\" aria-label=\"nosql vs rdbs permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NoSQL vs RDBs</h3>\n<p><strong>Why RDBs</strong>\nHere are a few reasons to choose a SQL database: We need to ensure ACID compliance. ACID compliance reduces anomalies and protects the integrity of your database by prescribing exactly how transactions interact with the database. Generally, NoSQL databases sacrifice ACID compliance for scalability and processing speed, but for many e-commerce and financial applications, an ACID-compliant database remains the preferred option.\nYour data is structured and unchanging. If your business is not experiencing massive growth that would require more servers and if you’re only working with data that is consistent, then there may be no reason to use a system designed to support a variety of data types and high traffic volume.</p>\n<p><strong>Why NoSQL</strong>\nHere are a few reasons to use NoSQL database: When all the other components of our application are fast and seamless, NoSQL databases prevent data from being the bottleneck. Big data is contributing to a large success for NoSQL databases, mainly because it handles data differently than the traditional relational databases. A few popular examples of NoSQL databases are MongoDB, CouchDB, Cassandra, and HBase.\nStoring large volumes of data that often have little to no structure. A NoSQL database sets no limits on the types of data we can store together and allows us to add new types as the need changes. With document-based databases, you can store data in one place without having to define what “types” of data those are in advance. Making the most of cloud computing and storage. Cloud-based storage is an excellent cost-saving solution but requires data to be easily spread across multiple servers to scale up. Using commodity (affordable, smaller) hardware on-site or in the cloud saves you the hassle of additional software and NoSQL databases like Cassandra are designed to be scaled across multiple data centers out of the box, without a lot of headaches. Rapid development. NoSQL is extremely useful for rapid development as it doesn’t need to be prepped ahead of time. If you’re working on quick iterations of your system which require making frequent updates to the data structure without a lot of downtime between versions, a relational database will slow you down.</p>\n<h3 id=\"redis\"><a href=\"#redis\" aria-label=\"redis permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Redis</h3>\n<p>Let's talk about another type of DB called Redis. Redis is an open source, <strong>in-memory data structure store</strong>, used as a database, cache, and message broker. Redis provides data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes, and streams. A great example of Redis is its use in the rate limiter example earlier. Redis has built-in replication, Lua scripting, LRU eviction, transactions, and different levels of on-disk persistence, and provides high availability via Redis Sentinel and automatic partitioning with Redis Cluster. You can run atomic operations on these types, like appending to a string; incrementing the value in a hash; pushing an element to a list; computing set intersection, union and difference; or getting the member with highest ranking in a sorted set. To achieve top performance, Redis works with an in-memory dataset. Depending on your use case, you can persist your data either by periodically dumping the dataset to disk or by appending each command to a disk-based log. You can also disable persistence if you just need a feature-rich, networked, in-memory cache. Redis also supports asynchronous replication, with very fast non-blocking first synchronization, auto-reconnection with partial resynchronization on net split.</p>\n<p>Of the NoSQL databases Redis’ various data structures take it closest to the native data structures programmers most commonly use inside applications and algorithms. This ease of use makes it ideal for rapid development and fast applications, as core data structures are easily shared between processes and services. </p>\n<h3 id=\"data-encoding---json-xml-and-avro\"><a href=\"#data-encoding---json-xml-and-avro\" aria-label=\"data encoding   json xml and avro permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data Encoding - JSON, XML and AVRO</h3>\n<p>We can use JSON, XML and CSV as encoding options. These are widely known and are language agnostic. However, using these formats, it is hard to distinguish between a string and an integer. You're also limited by the precision of your floating point integers. In addition, JSON and XML, although popular, are not the most memory/space efficient encoding methods.</p>\n<p>Apache AVRO, is a another option that can be used. AVRO is a binary encoding format that uses a schema (in .avsc files) to specify the structure of the data being encoded. The resulting encoded data is in binary format and is compact as compared to JSON and XML. In addition, AVRO allows forward and backward compatibility semantics. To parse avro data, you go through the fields in the order that they appear in the schema and use the schema to tell you the datatype of each field. This means binary data can be decoded correctly if the code is reading the data using the exact same schema as the code that wrote the data.</p>\n<h3 id=\"data-flow\"><a href=\"#data-flow\" aria-label=\"data flow permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data Flow</h3>\n<p>So far we've discussed how data is stored, retrieved and encoded but have avoided how it is transferred. For example, how would a service, running on a server receive our data and how would it respond back to our request? The most common arrangement for communication over a network is to have two roles: clients and servers. The servers expose an API over the network and the client connect to the servers to make requests to that API. The API exposed by the service is also known as service. Let's look at a few basic modes of data flow:</p>\n<h3 id=\"data-flow---rest\"><a href=\"#data-flow---rest\" aria-label=\"data flow   rest permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data Flow - REST</h3>\n<p>When HTTP is used as the underlying protocol for talking to a service running on a server, it is called a web-service. One approach to speak with a web-service is to use  REST. REST is not a protocol but a design philosophy that models its principles after HTTP. It uses verbs to interact with the web-service by utilizing GET to retrieve information and POST to update it on a web-service. With REST APIs you can expect the response from a running service instantaneously. </p>\n<h3 id=\"data-flow---message-queues\"><a href=\"#data-flow---message-queues\" aria-label=\"data flow   message queues permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data Flow - Message Queues</h3>\n<p>So far, we've looked at the REST philosophy of interacting with web-services which is a synchronous request-response model. We can also pass data to services using asynchronous message passing systems that deliver messages to another process with low latency via an intermediary called the <strong>message broker or message queue</strong>. The message queue stores the message temporarily and acts as a buffer between the sender and the web-service. There are several advantages if MQs are used: </p>\n<ul>\n<li>They can act as a buffer if the recipient is unavailable or overloaded thus improving system reliability</li>\n<li>It can automatically redeliver messages to a process that crashed, thus improving system durability</li>\n<li>It allows one sender to send messages to multiple recipients</li>\n<li>It <strong>decouples</strong> the sender from the recipient: the sender will send the message out into the abyss and won't care what services consume those messages</li>\n</ul>\n<p>The general flow of data to MQs is as follows: One process sends a message to a queue or a topic, and the broker ensures that the message is delivered to one or more consumers of or subscribers to the that queue or topic.  </p>\n<h3 id=\"communication-between-services\"><a href=\"#communication-between-services\" aria-label=\"communication between services permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Communication Between Services</h3>\n<p>In addition to REST and gRPC that we discussed earlier, long-polling, webSockets, and server-sent events are popular communication protocols between a client like a web browser and a web server in addition to HTTP pull and push mechanisms. Let's look at these protocols in detail:</p>\n<h3 id=\"ajax-polling\"><a href=\"#ajax-polling\" aria-label=\"ajax polling permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Ajax Polling</h3>\n<p>Polling is a standard technique used by the vast majority of AJAX applications. The basic idea is that the client repeatedly polls (or requests) a server for data. The client makes a request and waits for the server to respond with data. If no data is available, an empty response is returned.</p>\n<ul>\n<li>The client opens a connection and requests data from the server using regular HTTP.</li>\n<li>The requested webpage sends requests to the server at regular intervals (e.g., 0.5 seconds).</li>\n<li>The server calculates the response and sends it back, just like regular HTTP traffic.</li>\n<li>The client repeats the above three steps periodically to get updates from the server.</li>\n</ul>\n<p>The problem with Polling is that the client has to keep asking the server for any new data. As a result, a lot of responses are empty, creating HTTP overhead. </p>\n<h3 id=\"http-long-polling\"><a href=\"#http-long-polling\" aria-label=\"http long polling permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>HTTP Long-Polling</h3>\n<p>This is a variation of the traditional polling technique that allows the server to push information to a client whenever the data is available. With Long-Polling, the client requests information from the server exactly as in normal polling, but with the expectation that the server may not respond immediately. That’s why this technique is sometimes referred to as a “Hanging GET”.</p>\n<p>If the server does not have any data available for the client, instead of sending an empty response, the server holds the request and waits until some data becomes available.\nOnce the data becomes available, a full response is sent to the client. The client then immediately re-request information from the server so that the server will almost always have an available waiting request that it can use to deliver data in response to an event.</p>\n<h3 id=\"web-sockets\"><a href=\"#web-sockets\" aria-label=\"web sockets permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Web Sockets</h3>\n<p>WebSocket provides <a href=\"https://en.wikipedia.org/wiki/Duplex_(telecommunications)#Full_duplex\">Full duplex</a> communication channels over a single TCP connection. It provides a persistent connection between a client and a server that both parties can use to start sending data at any time. The client establishes a WebSocket connection through a process known as the WebSocket handshake. If the process succeeds, then the server and client can exchange data in both directions at any time. The WebSocket protocol enables communication between a client and a server with lower overheads, facilitating real-time data transfer from and to the server. This is made possible by providing a standardized way for the server to send content to the browser without being asked by the client and allowing for messages to be passed back and forth while keeping the connection open. In this way, a two-way (bi-directional) ongoing conversation can take place between a client and a server.</p>\n<h3 id=\"server-sent-events\"><a href=\"#server-sent-events\" aria-label=\"server sent events permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Server Sent Events</h3>\n<p>Under SSEs the client establishes a persistent and long-term connection with the server. The server uses this connection to send data to a client. If the client wants to send data to the server, it would require the use of another technology/protocol to do so.</p>\n<ul>\n<li>Client requests data from a server using regular HTTP.</li>\n<li>The requested webpage opens a connection to the server.</li>\n<li>The server sends the data to the client whenever there’s new information available.</li>\n</ul>\n<p>SSEs are best when we need real-time traffic from the server to the client or if the server is generating data in a loop and will be sending multiple events to the client.</p>\n<h3 id=\"xmpp\"><a href=\"#xmpp\" aria-label=\"xmpp permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>XMPP</h3>\n<p>XMPP stands for Extensible Messaging and Presence Protocol. This is a protocol that works as a P2P connection. XMPP is mainly used for chat based applications. See <a href=\"#allowing-users-to-chat\">chat</a> for more details on how XMPP works.</p>\n<h3 id=\"distributed\"><a href=\"#distributed\" aria-label=\"distributed permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Distributed</h3>\n<p>So far, we've looked at a simple single server architecture. We've talked about how our data can be encoded and transmitted to services. In summary this is what we have as of now:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 672px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.61309523809524%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABX0lEQVQoz42STWuDQBCG85v7h1rw3ktOvZQeSm5pwUMg0lLUBInGxnxo/J76DJ2kKQSiDju78+6zM+OO+r6Xrutks9nIarWS4/EoeZ5LURRqrDPHiPE0TSN1XUvbtjpfr9dSlqX6IxPsdjsVRVEkvu9rEOB8Pj+JD4eDgpfLpQRBoNrZbCaO48hkMjkDAdkmz/NUxBoA13UlyzKNke12u1VgGIay3+9lsVjIeDxW3UWGnAwUCEKyo8QkSRRiMdrDAWmaSlVVCmHNnpE5ZGRZsdmMNeBstp7ZY/1nxBTIJrKgsZaNin9fvjiONcbIgQYymI0K5FQrk5FS6rqSnmSGSqxs0zD/D7oA4tBDOxEf0Ec8lbfwSf22vYzThqtAJibA2q7RwPPnvTxM79QHeIoPFd0EtCbrO5T7/vUir96jZtj358b/TeBqyfxB+8t6hYpc0mS4c99cn/xUJoaW+TXgD+ToVJWF40J3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Basic-Simple-Setup-Flow\"\n        title=\"Basic-Simple-Setup-Flow\"\n        src=\"/static/e47782298824bde7e74b3f6de694bb90/581a4/basic-setup.png\"\n        srcset=\"/static/e47782298824bde7e74b3f6de694bb90/27f03/basic-setup.png 173w,\n/static/e47782298824bde7e74b3f6de694bb90/376d0/basic-setup.png 345w,\n/static/e47782298824bde7e74b3f6de694bb90/581a4/basic-setup.png 672w\"\n        sizes=\"(max-width: 672px) 100vw, 672px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>We've talked about data that's stored on a single machine but ask this question:</p>\n<p><strong>What if there are a lot of users connecting to your site at the same time?</strong>\nBy asking this question, you're looking to make your website <strong>scalable, available and reliable</strong>. (With this type of architecture, your data storage and retrieval would occur between multiple databases):</p>\n<h3 id=\"scalability\"><a href=\"#scalability\" aria-label=\"scalability permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Scalability</h3>\n<p>A scalable system is one that is <strong>able to deal with its growth</strong>. Growth can be defined as increased volume of data or increased traffic volume. Scalability is used to describe how the system copes with increased load. </p>\n<p>It doesn't make sense to just say system X is scalable. What does that mean? Scalability needs to be considered by asking questions like <strong>if the system's load increases how are we going to handle that growth?</strong> For example, a system could suddenly go from 100 to million users or a client uploads TBs of data through our system: is our system able to handle these sudden spikes? </p>\n<h3 id=\"reliability\"><a href=\"#reliability\" aria-label=\"reliability permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reliability</h3>\n<p>A reliable system is one that <strong>continues to work correctly(ie correct function and performance levels) in the face of adversity(hardware or software failures).</strong></p>\n<p>Reliable systems are fault tolerant: this fault can be a human error (incorrect input) or hardware/software errors. Even under faulty circumstances, our system continues to be reliable. Reliable systems are <strong>resilient</strong> and <strong>fault tolerant</strong>.</p>\n<p>There are several types of faults:</p>\n<ul>\n<li>Hardware faults: Hard disk crash, RAM becomes faulty, electric outage etc. To prevent hardware faults, we add redundancy to our applications: setup disks in RAID (redundant array of independent disks) configuration, have dual power supplies, backup power for data centers etc.  </li>\n<li>Software faults: Leap year errors, bad input errors etc. Happen in unusual set of circumstances. </li>\n<li>Human errors</li>\n</ul>\n<p>In the example where you have a single server, your server might grind to a halt if a number of users hit your website at the same time. You have 2 options:</p>\n<ul>\n<li>Scale vertically: Add more compute power to a single machine</li>\n<li>Scale horizontally: Add more servers to your backend</li>\n</ul>\n<h3 id=\"cap-theorem\"><a href=\"#cap-theorem\" aria-label=\"cap theorem permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CAP Theorem</h3>\n<p>With distributed systems, we can store information on multiple nodes where each node is then partitioned for scalability and reliability. In such scenarios, we need to talk about CAP theorem. CAP theorem states that it is impossible for a distributed software system to simultaneously provide more than two out of three of the following guarantees (CAP): Consistency, Availability, and Partition tolerance. When we design a distributed system, trading off among CAP is almost the first thing we want to consider. CAP theorem says while designing a distributed system, we can pick only two of the following three options:</p>\n<p>Consistency: All nodes see the same data at the same time. Consistency is achieved by updating several nodes before allowing further reads.</p>\n<p>Availability: Every request gets a response on success/failure. Availability is achieved by replicating the data across different servers.</p>\n<p>Partition tolerance: The system continues to work despite message loss or partial failure. A partition-tolerant system can sustain any amount of network failure that doesn’t result in a failure of the entire network. Data is sufficiently replicated across combinations of nodes and networks to keep the system up through intermittent outages.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 502px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.05577689243027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAADDUlEQVQ4y22Ua08bRxSG/Y8r9VuqtqlaRSq0oWkb0XxIE4hS0qotiXIh2KYuAYNtDMaLzeLrLrv4hgk2vnvt3X06axtnnTLS0YzO7nnmvHPmjAcxbNvmerjXbt9N/ptiPdeOcdBoJWaLjmHR7FsYQ3vkG/8DlmFgdbvj2Ylxbeisx0AXrDWATB2kKsTPIVYyydVsjHYXs1zEOtOhVBjbe/GTANuT3RyG50PaNvUe+KQKL0J5VoMpXoZzhM+GSEqTspxnqJ1STcQ53QujRkKooR2q0iF2pz3NdCp5YNoclob4jgRwN83qtizAWSJKi1JGp3SicKXovE8ecfSPf2TxDR/yZoCBfoptmi7JTnZ9WN3J8HQ9yvOdNH9tJvlbzLJa53hnH/8LL/mYTCN9giRAxwKUCGywv75G7TgBkyynwEqHkdQV3wFP1iL85o2yEpCRs3WqqSzVTIZySqWV01BCu0TevCL8+iWprXf0lRxWvTZSOgVW2zbvMk2C2QZboiqbmTZBWaGYectV4iF65GeaJ8sMVa8oTI6+qmKc5jHPNExNxWxcuYHQG9jEyo5ZHJQhLSraLP1Jt7CMHpoj9PwWl/EFzNyPGNklTD3FUNcZCJhjtqj2FHgNLTZMdjWLw2ILNblENDBH5N8FCvFFOieLnO/fxf/0U7b++IR2akVANQZCrjmRO6qy+9qIa0uhCflCEj25yLZ3ns03d7jIL0PlCWb+AdLbL0is36afvi8ylDCvmq6L/1GnIDrEGcNakF7hEYPKM8zzFZToDyS359Bj97Acv/aryO4BVjs3ibWmKj3ufhx9cOZGGLv8CC6f0VIeEnz1JYHVzwitfUVHfwy137Eqj7F72jRuRvKHXh4DMXQB+oV89B56/Cfk4LywOVK731GQ7qPuL9BQlkRQd6aXpxne9KoML3zE/J9zsHGH8PrXBF/fZs/7zSjbyNotepexGVXX5+i54T2afBpgXPjRDr5H2ZsnG/6WorRALnKXdnXPde6zT9v/M5yBimFWoBsXrSUgvWPngGdgH7+J/wGgyefDahysrgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CAP-Theorem\"\n        title=\"CAP-Theorem\"\n        src=\"/static/6ea22601b22745cb19b3c20211679853/79247/cap-theorem.png\"\n        srcset=\"/static/6ea22601b22745cb19b3c20211679853/27f03/cap-theorem.png 173w,\n/static/6ea22601b22745cb19b3c20211679853/376d0/cap-theorem.png 345w,\n/static/6ea22601b22745cb19b3c20211679853/79247/cap-theorem.png 502w\"\n        sizes=\"(max-width: 502px) 100vw, 502px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.educative.io/module/lesson/grokking-system-design-interview/3w8r0BNQLwn\">Image Credit</a></p>\n<p>In an ideal world, our data either resides on a single node and we don't worry about any of the compromises listed above or data written to one node is instantaneously written to other nodes present in the system. In a distributed system, partitions cannot be avoided, and when a partition occurs, we must choose between consistency and availability. Say for example we have this setup with 3 nodes:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 681px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.94566813509545%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAAB+ElEQVQ4y5WSTUsbQRjH8136AWpPQrWXeuonEPWu0EtSxEIriBRKjXhRKO2ht/YgAWMlqEg00h5KxKKRGARf2iSa2Lw0uyabZGfd2X9nZnfMJmaVPvDAzDPz/J5XH5hYltVVKVP2ikj8BFNfdvBpIwndMISN0u4+PgmklN5S+en5+xh6A4t4NrWCotrgLjA9/rcB3ZG4A5eComFwdhMP/ct48iqCZLp8A2yr5i4gdWCK1mTAGqY//8Dj8RBGZtfx648i7Fw6fboCJaxJDJyXrsSZEIKD1BFqWl3cc+Uq6jppg3YFSqNpUmQZ7No0+aOwGYSIYfAzt/NgbpgnkDtdsAy0ZisD8dl15lJt6MhXaq0sO4FyCEVVw99q41Y57iyo669Sa7YNyScduais2ZfuqB3ldK4JbwcvnRjX9m5yoCWWF6zJbAisVHeZ9ymcfmZFP22OyHBr/zdGgqsIfIzhwpksnEBeIhPZTti+/g8xZAqqDZwL76NvYgkDkyvY2EuzlSEoX2moVOueWmLvxCB4F9pF/8swnr7+iu+pSxv4NrSHB2MhPHqxjGjiXDRYretsksRTFU3nXcObxZ/CtycQxjcJjMRPMTSzhrGFKM7yiqskb7Wcnq3unGI4uIbR+SiOcxUbyF6ROkyy5dX/ayhyENlMGqViQZz/AVzpbeqcIj8uAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3-Nodes\"\n        title=\"3-Nodes\"\n        src=\"/static/390bddd5baa9f99772953655cc0cc606/388a9/three-nodes.png\"\n        srcset=\"/static/390bddd5baa9f99772953655cc0cc606/27f03/three-nodes.png 173w,\n/static/390bddd5baa9f99772953655cc0cc606/376d0/three-nodes.png 345w,\n/static/390bddd5baa9f99772953655cc0cc606/388a9/three-nodes.png 681w\"\n        sizes=\"(max-width: 681px) 100vw, 681px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Our data is going to be replicated across the 3 nodes. Assuming that these nodes are deployed in different geographical locations, these 3 nodes would have to be in constant communication with each other to stay in-sync. Therefore, we'd have to:</p>\n<ul>\n<li><strong>replicate</strong> the data: any updates to one node need to be propagated to the other 2 nodes,</li>\n<li><strong>partition</strong> the data: as our data grows in size, we'll break it among partitions for faster retrieval</li>\n</ul>\n<h3 id=\"replication-deep-dive\"><a href=\"#replication-deep-dive\" aria-label=\"replication deep dive permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Replication Deep Dive</h3>\n<p>As we said earlier, replicating data allows us to create available, scalable systems. Replicating data that is not changing (static) is easy, real difficulty lies in replicating data that is changing often. There are 3 main ways to replicate data: <strong>single leader replication</strong> (one we discussed briefly above), <strong>multi-leader replication</strong> and <strong>leaderless replication</strong>. Single leader replication can be done where we're sure our setup would require just a single data center (which is never the case!). Therefore, it's better to use multi-leader or leaderless replication for availability. Let's have a look at the 2 in detail:</p>\n<h3 id=\"multi-leader-replication\"><a href=\"#multi-leader-replication\" aria-label=\"multi leader replication permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Multi-leader Replication</h3>\n<p>If you have a setup with multiple data-centers located in geographically separated locations, you'd have to use multi-leader replication. That is because each user would be connected to the data center closest to him/her and the leader from that data center would then asynchronously replicate that information to other leaders and data centers.   </p>\n<h3 id=\"multi-leader-pros\"><a href=\"#multi-leader-pros\" aria-label=\"multi leader pros permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Multi-leader: Pros</h3>\n<p>As compared to single leader replication, there're advantages that a multi-leader setup enjoys:</p>\n<ul>\n<li><strong>Performance</strong></li>\n</ul>\n<p>In single leader, every write must go to the single leader. No matter how far you're located from that leader, every write will go the leader via the internet. In multi-leader, every write can be processed at the local data center and then replicated to other data centers. This results in a better perceived performance.</p>\n<ul>\n<li><strong>Tolerance</strong></li>\n</ul>\n<p>If single leader goes down, new writes/updates need to be halted and a new leader has to be elected before accepting new writes/updates. With multi-leader, if a leader goes down, other centers can continue to operate and the down leader can catch up once it is back.  </p>\n<h3 id=\"multi-leader-cons\"><a href=\"#multi-leader-cons\" aria-label=\"multi leader cons permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Multi-Leader: Cons</h3>\n<p>In single leader, since all writes go to one leader, there's always just a single source of truth. If 2 clients try to write at the same time, one client would have to wait until the other is done. With multi-leader, that is not the case: there can be write conflicts. To resolve for write conflicts, there're a few different techniques: last write wins, merger of writes, ask user to resolve conflicts etc. </p>\n<p><strong>If your setup requires low latency high availability for geographically dispersed users, multi-leader configuration is the way to go.</strong> </p>\n<h3 id=\"leaderless-replication\"><a href=\"#leaderless-replication\" aria-label=\"leaderless replication permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Leaderless replication</h3>\n<p>Another method to replicate data across servers is to get rid of leaders entirely: every node is a leader. The client sends its writes to multiple nodes and waits for a specific number of acknowledgements before a write can be considered a success. In leaderless replication, if one of the nodes goes down, we can still have other nodes accept writes from the user. Let's say for our quorum, we've decided that if 2 out of 3 replicas acknowledge the write, the write is successful. The client simply ignores the fact that one of the replicas missed the write. </p>\n<p>When the unavailable node comes back online, and clients start reading from it, any writes that happened while the node was down will be missing from the previously dead node. Thus, if you read from that node, you may get stale data. To solve that problem, when the client reads from a leaderless DB setup, the request isn't just routed to a single node but <strong>requests are sent to multiple nodes in parallel</strong>. The client may get different responses from different nodes. To remedy this, we have 2 approaches: <strong>Read repair</strong> and <strong>anti-entropy</strong>. </p>\n<ul>\n<li><strong>Read Repair</strong>\nIn this mechanism, when a client makes a read request from several nodes, the system should be able to detect any stale responses. The system sees that replica 3 for example, has stale value and writes newer value back to that replica. This approach works well for values that are frequently read.</li>\n<li><strong>Anti-Entropy process</strong>\nIn some datastores, we can have background processes that constantly scan for stale data between replicas and copies missing data from one replica to another.  </li>\n</ul>\n<p>Another way to prevent stale data from being returned is to perform periodic scans of all nodes and update any nodes that have fallen behind. This is called <strong>anti-entropy process</strong>.</p>\n<p>Since data is replicated at multiple nodes, it must be synchronized across replicas. Quorum consensus can guarantee consistency for both read and write operations. Let us establish a few definitions first.</p>\n<ul>\n<li>N = The number of replicas</li>\n<li>W = A write quorum of size W. For a write operation to be considered as successful, write operation must be acknowledged from W replicas.</li>\n<li>R = A read quorum of size R. For a read operation to be considered as successful, read operation must wait for responses from at least R replicas.</li>\n</ul>\n<p>How to configure N, W, and R to fit our use cases? Here are some of the possible setups:</p>\n<ul>\n<li>If R = 1 and W = N, the system is optimized for a fast read.</li>\n<li>If W = 1 and R = N, the system is optimized for fast write.</li>\n<li>If W + R > N, strong consistency is guaranteed (Usually N = 3, W = R = 2).</li>\n<li>If W + R &#x3C;= N, strong consistency is not guaranteed.</li>\n</ul>\n<p>Depending on the requirement, we can tune the values of W, R, N to achieve the desired level of consistency. Read and writes that obey the rules we've defined are called quorum reads and writes. You can think of <em>r</em> and <em>w</em> as the minimum number of votes required for read or write to be valid. </p>\n<p>Databases with appropriately configured quorums can tolerate the failure of individual nodes without need for failover. They can also tolerate individual nodes going slow (due to overload), because requests don't have to wait for all n nodes to respond. <strong>These characteristics make DBs with leaderless replication appealing for use cases that require high availability and low latency, and that can tolerate occasional stale reads.</strong>  </p>\n<p>Replication gives high availability but causes inconsistencies among replicas. Versioning and vector locks are used to solve inconsistency problems. Versioning means treating each data modification as a new immutable version of data. Before we talk about versioning, let us use an example to explain how inconsistency happens: Inconsistency occurs when the same data is updated on two different nodes by two different clients. In order to reach a stable state, conflict resolution is required.</p>\n<p>To resolve this issue, we need a versioning system that can detect conflicts and reconcile conflicts. A vector clock is a common technique to solve this problem. Let us examine how vector clocks work.</p>\n<h3 id=\"vector-clock\"><a href=\"#vector-clock\" aria-label=\"vector clock permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Vector Clock</h3>\n<p>A vector clock is a [server, version] pair associated with a data item. It can be used to check if one version precedes, succeeds, or in conflict with others.\nAssume a vector clock is represented by D([S1, v1], [S2, v2], ..., [Sn, vn]), where D is a data item, v1 is a version counter, and s1 is a server number, etc. If data item D is written to server Si, the system must perform one of the following tasks:</p>\n<p>• Increment vi if [Si, vi] exists.</p>\n<p>• Otherwise, create a new entry [Si, 1].</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 105.26315789473684%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAACHklEQVQ4y6VUibKbMAzk/z+w00n6Ho8bcwUw97WVnDo1gbzJtJrRWNj42NVK1rZt+M7neUE3TDgzXl/Xdfe/pQNeeHZawDjNyEqJcRjQdT15p3yg72VZDnt3B5o36e95WeEGMXzPQxRFcF0Xvu+ruO979VJz7+mBjxdiI7gjxE3+G2QzZuvaFp+2jS/XR9M0ap5hatd73nqhimlsibdStv/3wh2HNHphjCgMIYRAEASKvyRJVGLe4tCEPa8borRAS5AZdl3XkFIqn+f5HPKZZHh+HCkhSYpAZDS3vIRscmm94oZtGHr8vH7gajsqQXpNr59xaXHAL2E+tPP3SllsSTKyH2mcULW9SpJeN/81oVssTiY6JNLZHceBiGMEUYyskuoQ1mPdDQQ9JVHfBe6R0L0/Yi/L8pEcy3yuTgSXW3KrD/Nl0+Em99CftWiZG9gmKrWs0ro7XtYQ/Bsd/EqLliY4TVOC+4VftgvbcZFnGaZp2h2WFwVc+ufH1YbnB2oP82hm+6HDgcjlTNakNZEXRPa+m9xb2YSyqtQ6dxzmnxNy6DYmZDbOqOz+VoFuZQuJ/Nb0+M5O+yFzV9RUGf2gDto2ago074RCtS8hYtXCuBRZGRxzKeZ5fiw9PbJlVYNpvsNOSUI9XcAl2BI1XIYMm2PtTMHhhRwzdyxY1uDVT5RPxJ952duQlTTo9svlgoQgfXzaCMLoAZObgsnts/8GBL1rIhkQo0wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Vector-clocks\"\n        title=\"Vector-clocks\"\n        src=\"/static/1f0ca0b664855ec9708f1c4ef1451d5b/1dda8/vector-clock.png\"\n        srcset=\"/static/1f0ca0b664855ec9708f1c4ef1451d5b/27f03/vector-clock.png 173w,\n/static/1f0ca0b664855ec9708f1c4ef1451d5b/376d0/vector-clock.png 345w,\n/static/1f0ca0b664855ec9708f1c4ef1451d5b/1dda8/vector-clock.png 690w,\n/static/1f0ca0b664855ec9708f1c4ef1451d5b/ef7d2/vector-clock.png 722w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<ol>\n<li>A client writes a data item D1 to the system, and the write is handled by server Sx, which now has the vector clock D1[(Sx, 1)].</li>\n<li>Another client reads the latest D1, updates it to D2, and writes it back. D2 descends from D1 so it overwrites D1. Assume the write is handled by the same server Sx, which now has vector clock D2([Sx, 2]).</li>\n<li>Another client reads the latest D2, updates it to D3, and writes it back. Assume the write is handled by server Sy, which now has vector clock D3([Sx, 2], [Sy, 1])).</li>\n<li>Another client reads the latest D2, updates it to D4, and writes it back. Assume the write is handled by server Sz, which now has D4([Sx, 2], [Sz, 1])).</li>\n<li>When another client reads D3 and D4, it discovers a conflict, which is caused by data item D2 being modified by both Sy and Sz. The conflict is resolved by the client and updated data is sent to the server. Assume the write is handled by Sx, which now has D5([Sx, 3], [Sy, 1], [Sz, 1]). </li>\n</ol>\n<h3 id=\"partitioning\"><a href=\"#partitioning\" aria-label=\"partitioning permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Partitioning</h3>\n<p>Replication of your data across multiple servers goes hand in hand with partitioning of data. Data partitioning is a technique to break up a big database (DB) into many smaller parts. It is the process of splitting up a DB/table across multiple machines to improve the manageability, performance, availability, and load balancing of an application. There are multiple different ways to partition data across nodes:</p>\n<ul>\n<li>Key based partitioning</li>\n<li>Hash based partitioning</li>\n</ul>\n<p>The techniques listed above are quite self-explanatory. The issue with these approaches is that if you have to re-balance your partitions in the case of node additions and/or removals, almost all keys need to be re-assigned. This requires us to re-map partitions which is in-efficient. To deal with this, we have <strong>consistent hashing</strong>: </p>\n<h3 id=\"partitioning-consistent-hashing\"><a href=\"#partitioning-consistent-hashing\" aria-label=\"partitioning consistent hashing permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Partitioning: Consistent hashing</h3>\n<p>Consistent hashing was designed to avoid the problem of having to change the server assignment of every object when a server is added or removed. Let's examine how consistent hashing works: quoted from Wikipedia: \"Consistent hashing is a special kind of hashing such that when a hash table is re-sized and consistent hashing is used, only k/n keys need to be remapped on average, where k is the number of keys, and n is the number of slots. In contrast, in most traditional hash tables, a change in the number of array slots causes nearly all keys to be remapped.\"</p>\n<p>Now we understand the definition of consistent hashing, let us find out how it works. Assume SHA-1 is used as the hash function f, and the output range of the hash function is: x0, x1, x2, x3, ..., xn. In cryptography, SHA-1’s hash space goes from 0 to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>1</mn></msup><mn>60</mn><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^160 - 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span><span class=\"mord\">6</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>. That means x0 corresponds to 0, xn corresponds to <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>1</mn></msup><mn>60</mn><mtext>–</mtext><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^160 – 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span><span class=\"mord\">6</span><span class=\"mord\">0</span><span class=\"mord\">–</span><span class=\"mord\">1</span></span></span></span>, and all the other hash values in the middle fall between 0 and <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>1</mn></msup><mn>60</mn><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^160 - 1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.897438em;vertical-align:-0.08333em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span><span class=\"mord\">6</span><span class=\"mord\">0</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span></span></span></span>. Thus, our hash space would look like:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 15.068493150684931%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAASklEQVQI162MOwoAQQhDvf8hbezEz6AHyGIhDGyzxQrBZwyhqsJf090gEcE5B5n50vj3b+/1bp4yZga5O8wMEYHhL9rs7OUpVVU8s9TmoQ3d7Z8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Hash-Space\"\n        title=\"Hash-Space\"\n        src=\"/static/077b781e847fe043cc16368c578537f0/1dda8/hash-space.png\"\n        srcset=\"/static/077b781e847fe043cc16368c578537f0/27f03/hash-space.png 173w,\n/static/077b781e847fe043cc16368c578537f0/376d0/hash-space.png 345w,\n/static/077b781e847fe043cc16368c578537f0/1dda8/hash-space.png 690w,\n/static/077b781e847fe043cc16368c578537f0/16235/hash-space.png 803w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>By collecting both ends, we get a hash ring as shown:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 364px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 101.92307692307692%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAABrUlEQVQ4y6WUaY7CMAyFuf9NOEH/cwMk2rIVKEvLUqBAyw4ePUuOnNCZSoylKs32JbZf3Hi/3wRDi+/1enH7eDxotVrR/X63xtHPsozn9bhwGhqISQ2cTCa02+3MPOxyudBgMKDr9cr9WqBuYZvNhoqiMIDlclkJqwVqa7fb1Gw2qdVq0fl8/lhf6zIMG0ejEbsXxzF5nkedToeiKKLpdMohgT2fz7+BsCRJqNvt0n6/5yTA0jTlFv31ek1BEJj46hAZoMBwOm4mhnncQidM1odhyBnX+xs6g5iEi7Lgtw8HiOGmyLxwLJfhpsTGzbgG6vAcDgeO6wcwz3Maj8dWoN0suuIXaK/XM7E2QMQOUO1uFUxDBYiEIVEMlEEkoizLr4AQP5RhAREHEe2/gOLyYrGwJFAH1DGcz+dGkwZ4Op1oOBx+lRSow+hQP5t+v8+FwJVN1b9oESUOCbVkI0DAIFQx94W4woagfd83fUuHcuXtdsvQ2+1mwO6zE0GjWOjq81Ec5KTj8cjvdDab8UZZg3kEHw8A4ZFDK4uDmzn8Q6yo2tiM1yClTDJaVbF/APZ4GXWI0CSzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Hash-Ring\"\n        title=\"Hash-Ring\"\n        src=\"/static/68377df4168b081632c389d0f4b92d17/3128d/hash-ring.png\"\n        srcset=\"/static/68377df4168b081632c389d0f4b92d17/27f03/hash-ring.png 173w,\n/static/68377df4168b081632c389d0f4b92d17/376d0/hash-ring.png 345w,\n/static/68377df4168b081632c389d0f4b92d17/3128d/hash-ring.png 364w\"\n        sizes=\"(max-width: 364px) 100vw, 364px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Using the same hash function f, we map servers based on their IP addresses or name onto the ring:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.27544910179641%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABq0lEQVQoz31TyU7DMBD1P3NB4sKBC1cu/AUnxA3EJsoigQoUkFoEFFDTNHua1U4engkOoUWMNLIzHj/PezMRdV2jqir8XpVeK5BRLM9zlGXJ33Q+m81gWRayLGtzzF2xDNYAKb0Evg9fexiGCIIAnucxSCkLSCnbB7omKJEumMrI0skjZq8PyArZxuhcylI/EuDu+glKKo4ppZiBYSEuDu/R279lipxQ1bDfh5Bp0AB90zGVk00+poiiiPdxHGM0GqHf78O2bYibo3tcH9y2F8IwQJqX39ooLGvc5DmOw7E0TTEejzEcDjkmtq9esXXxgoq00O5qnQjoL227Gs/ncyRJwjGiWhQF0xerxwOsHA0aQNQsPB10QYx3qVNzSHujr3Hh9DLYp2mroccV6n1V/1shUSX9lsZmvBnhbSPSgab9vuejVGWbuAhmAOlhotqNM2B8eYaod6IpN4l5kcP99PQgkgA/yV2waRjD0/P516PC2luHtbvGlE2VznkA59kjOCxaGM+xc/eCQipu4hJgFU2hwgk3patRkiZwXZf/EJo5agDRpO96AaS7/wInf6J6Bj03lQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Server-Map\"\n        title=\"Server-Map\"\n        src=\"/static/ca76cea131bab6adc569b68c45195c96/1dda8/server-map.png\"\n        srcset=\"/static/ca76cea131bab6adc569b68c45195c96/27f03/server-map.png 173w,\n/static/ca76cea131bab6adc569b68c45195c96/376d0/server-map.png 345w,\n/static/ca76cea131bab6adc569b68c45195c96/1dda8/server-map.png 690w,\n/static/ca76cea131bab6adc569b68c45195c96/ebfaf/server-map.png 835w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Now that we've placed our servers onto the ring, it's time for us to start placing data partitions on the said ring:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.8075117370892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABq0lEQVQoz21T20rDQBDND/ofvvoz+gkiCvrkoyIK2kKQYgk0tqlII2lzb3PfTY47k6YkpQNDstnhzJlzJhr20TQNZ13XaOissqoqjMZjWJaF3W6HKIogpeB6rtvXd0lnLcszxNtoACa3DoKVie0uRa7ui6Jg8LzI4boeHNsbgPZDW37/4eNlirKoDpfe7wzJ5qfjfpiAQsoai9mPapTzmZr5vo/NZsPftJk+x/PNG4q04II0TZgZM5ByMBJl18TzWpYkhWmamEwmLIn2uvRw+W4hKVtt/CCAqIitAjihEYMqsnEcoyxLZrher7FarRSZFNrVp4Wz+xG8rGw7JgmEEAPB+4Z1LLMsYwACtG2bQVnDYFFh+ZJAljWEclDXdTbgGHDAUAWNR4CUhmHw2Azo3qWwLtQ6RORwg8V8wW4er0b7pJR8N1brFCh56C4MQ5aAATPDRPj4BJkXezdrBOsQEOAG8sgY1lmZRiB997t3LdSvYd+eQ2ahMqF10P+M4RoBA/aLKUIF9vC1hGRzTiy22LqonLlaETEYj3bKcRxMp9ODmzRi+7fIQW3//R/jeVB0zjyJYgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Keys\"\n        title=\"Keys\"\n        src=\"/static/d1803e6c2f1e320007679b45325a41e2/1dda8/keys.png\"\n        srcset=\"/static/d1803e6c2f1e320007679b45325a41e2/27f03/keys.png 173w,\n/static/d1803e6c2f1e320007679b45325a41e2/376d0/keys.png 345w,\n/static/d1803e6c2f1e320007679b45325a41e2/1dda8/keys.png 690w,\n/static/d1803e6c2f1e320007679b45325a41e2/d884c/keys.png 852w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>To determine which server a key is stored on, we go clockwise from the key position on the ring until a server is found. Figure below explains this process. Going clockwise, key0 is stored on server 0; key1 is stored on server 1; key2 is stored on server 2 and key3 is stored on server 3.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 682px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.410557184750736%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAAB30lEQVQoz21TyXLTQBDVx/INXDjxAfwBX8ARLoQDBU4BlYOrbJwql4mWOIkWa7OWGWm0PqZHjEox6VJrtp7u97p7jHEcIT9M46TDMCglEULAdV2EYYg0TZVWVaXOlne0GvRr2xb90M+byvifs/1+j91uh7qukec5iqLAKTyh77tnwbUaXdchSRJ5QUyImhbug4Pg9hvKspyRkpCtEDXWN1sUOVN7y3MSgxUVPn/4gfuDq3BFUYRIIiiip5mWjq7RFxlDHCdqTuwIUBAEioFRcYHrqw28Y4RaVGozl7R09KWzZW6zLEPTNEpN08R6vYbneTACJvDq0wZXToyh5kjPGTjnCu2lo9nhOOWXgtOaEPq+D8YYjLASeP31Ft8fE+XEtCxF45Lq5brve+WA8no8HhVKVeU+GxC/5+CbqSjbzRa2bas5XRqHFxBK8SQiQkVrsj8cDsreaKMed298ZNdTbzVCJjlNXszhKEe6ROLYFizJRgdWwQnhwFNkX96hdm6gO7AIS5Qmh25ITVdX+beXwHryZLWz2dHc2B2L4X58C27/nB2e/Qx/ViYqWXUh+1PTbGW+OCvxy3yE450k4v6/3Bq6IZcoOvkKzuwM3/OxWq1Ujqii9OyoEFqG8Xkn0PgX1mGcCo1QefUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Assign\"\n        title=\"Assign\"\n        src=\"/static/f31e394af5838aa2e5fc30faae1b7b3e/4abbd/assign.png\"\n        srcset=\"/static/f31e394af5838aa2e5fc30faae1b7b3e/27f03/assign.png 173w,\n/static/f31e394af5838aa2e5fc30faae1b7b3e/376d0/assign.png 345w,\n/static/f31e394af5838aa2e5fc30faae1b7b3e/4abbd/assign.png 682w\"\n        sizes=\"(max-width: 682px) 100vw, 682px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Adding or removing a server would only affect the keys that it were assigned (in case of removing) or those directly behind the new server (in case of adding).</p>\n<p>One issue with the approach above is that the distribution might not be uniform (ie some servers getting more keys than others thus resulting in skewed partitioning). Enter, <strong>virtual nodes</strong>. We can have more than one <strong>representative</strong> for nodes on the ring to evenly space out keys among servers. We can keep track of what ring positions map to which physical servers. For example, in the following figure we can represent an eight node cluster using only four physical nodes by assigning two tokens to every node:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 680px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAAB5UlEQVQoz3VTy27TQBTN3yIEP8CKBaoErBAgdUUXBCTSBeIh5KpBqKtIlCZFmAbqODgPx/H7ET+w69iH3GtSTJNe6XpG1zNnzjl3plGWJeqhBSlmfor/owStK8pq3BbreoM+cRwjz3MuPPg4xM7hkOfLZY4k9jc2B0EA0zRh2zbm8zmKorgEbYRhiFarhW6vx8UzLYA4q0D64nscvLmNKDSQLoGxEyJNUziOA1mWoaoqJEnCYrFAlmUVw+wiQ6fTwWQ83mCia310j1+uqCYYmjGefpIxVWcYjUbQNA1ExnVdZmpZ1j/JNSPYJ0pc8Up3bbxoC7yRZJLkKIrg+z4De55XAd559hhn48oz8qL8a/zal/OpgrvPd9HuHWPvw1sYKyBrlWtAAiLJxJQBbz7awdfhz2sBvysybj15iM7pEfq9V8yOUtd1BiQ/iSWNDFjUpdUkX70eYWDgy+fXq80ed5mSGkQ3JEkSZsmAy/wC0g8BjjXYaArJ+iaKfNBcNyAIbUynKhRFwWQyYbmGYXBTaC0DRpGNd/s3IJ7uc2HkJvjlJDw/Oemi2Wzy6cRGlgfcAEpiSJLpH0kmlpdd9r0Z0t8RF+4fDnBPkHhOd4u8ue51bHstDXpW9ZDNCOdGuHVxvWnbkuIPdLOOFA+fkVYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Virtual-Nodes\"\n        title=\"Virtual-Nodes\"\n        src=\"/static/0dc410fcfdf2af3953c9efb109a3c44a/6af40/virtual-nodes.png\"\n        srcset=\"/static/0dc410fcfdf2af3953c9efb109a3c44a/27f03/virtual-nodes.png 173w,\n/static/0dc410fcfdf2af3953c9efb109a3c44a/376d0/virtual-nodes.png 345w,\n/static/0dc410fcfdf2af3953c9efb109a3c44a/6af40/virtual-nodes.png 680w\"\n        sizes=\"(max-width: 680px) 100vw, 680px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://cassandra.apache.org/doc/latest/architecture/dynamo.html#dataset-partitioning-consistent-hashing\">Image Credit</a>/</p>\n<h3 id=\"partitioning-service-discovery\"><a href=\"#partitioning-service-discovery\" aria-label=\"partitioning service discovery permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Partitioning: Service Discovery</h3>\n<p>Now as you can imagine, the data is partitioned on different nodes and is usually moved between nodes as data is added or deleted, we need to be able to know at all times, the location of each piece of data. This process is called <strong>service discovery</strong>. To solve this problem, there're 3 approaches:</p>\n<p>(1) Send request to all nodes and the node that has the data will respond\n(2) Send request to the one node that has information about all nodes and have it forward your request to the correct node\n(3) Have client maintain this information on its end.</p>\n<p>Many systems rely on a separate coordination service such as Zookeeper to keep track of cluster metadata. Each node registers itself in Zookeeper and Zookeeper maintains the mapping of partitions to nodes. So, whenever any mapping information is updated, Zookeeper informs the routing tier that can then update its records:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.51336898395722%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAABcSAAAXEgFnn9JSAAABTUlEQVQoz1WSWY6DMBBEuf99coPJz+Qry0iJIrGYxRgwJGxmUcI8sCbStCzA3VXl7jLOsix1XT8ej/f7vfxFVVXFFq/Xi23XdTJJjDG6KPq+J58pNU2TAy2V8vl8WlrTNGiFIoyiyPd9cCTLsrxer9CEH3RtGwSB67rjODqUz6fzz+WCBLiv/X6324Emjy4tkGzbNk3TeZ611uMwUMqzbIJMypgBdFVWdH48Hg/fB8qcrFIlhJjmGRXPdQdjbPNSyiSOVzI0hCkrpT6Ty0Te73exBRJFoW+3m6HtQDA/Sc/zhmFwkLH2lFrX2+TwIas0ZSVxYh2FADrLFE9GoIV1ZqyyJ2MVlljb4BR5jqXMwhZMGIa96TOVQaZHjlzJzMCLJ1nct2S0Ph3ZK4ijGACKgFfD8ny9qlCIagvrIR+lxocSwubiulZfmnb5H/wCv2/x+LIOrUOMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Zookeeper\"\n        title=\"Zookeeper\"\n        src=\"/static/6392fa910da02d696843c97728c91667/1dda8/zookeeper.png\"\n        srcset=\"/static/6392fa910da02d696843c97728c91667/27f03/zookeeper.png 173w,\n/static/6392fa910da02d696843c97728c91667/376d0/zookeeper.png 345w,\n/static/6392fa910da02d696843c97728c91667/1dda8/zookeeper.png 690w,\n/static/6392fa910da02d696843c97728c91667/3a850/zookeeper.png 748w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Cassandra and Riak use a different approach called the <strong>gossip protocol</strong> to disseminate any changes in cluster state. Requests can be sent to any node and that node forwards them to the appropriate node for the requested partition. This comes at a cost of added complexity but removes dependency on external coordination services like Zookeeper. </p>\n<h3 id=\"handling-failures\"><a href=\"#handling-failures\" aria-label=\"handling failures permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Handling Failures</h3>\n<p>As with any large system at scale, failures are not only inevitable but common. Handling failure scenarios is very important. In this section, we first introduce techniques to detect failures. Then, we go over common failure resolution strategies.</p>\n<p>In a distributed system, it is insufficient to believe that a server is down because another server says so. Usually, it requires at least two independent sources of information to mark a server down. One solution is to use an all-to-all broadcast where each node \"pings\" every other node in the system to determine which node is down. This can be inefficient if there're a lot of nodes in the system.</p>\n<p>A better solution is to use decentralized failure detection methods like <strong>gossip protocol</strong>. Gossip protocol works as follows:</p>\n<p>• Each node maintains a node membership list, which contains member IDs and heartbeat counters.</p>\n<p>• Each node periodically increments its heartbeat counter.</p>\n<p>• Each node periodically sends heartbeats to a set of random nodes, which in turn propagate to another set of nodes.</p>\n<p>• Once nodes receive heartbeats, membership list is updated to the latest info.</p>\n<p>• If the heartbeat has not increased for more than predefined periods that act as timeouts, the member is considered as offline.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.226519337016576%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAABNklEQVQoz11SCY6DMAzk/z9cbbfQ7QGUK4QrhGN27G4khCWTA3s8HifCwfZ9xzzPcM7pum3b8aeeg0+MKctS3bYtrLVY1xWRJMphGAb1JElwvV4RxzGMMQo+TRNmv2BeFjjGN7y3XYesKPHKC1R1De+9EorGcUSapqh5KXtZY4L2fa9At9tNgQPbgTGeoGITi2w7YPoB2bvQmCgwkAqh1YIFFrKRAvnrCUtAsZEdNFX1UYDJwnqavcqR5bl2qIAd6csq7ThhTIYCKIUePxc0RaEg1fuN/P74l3RTCUb3YRuIRfI5atjTcyYKOymUZhkMRReTljpKIVqFITmy9BxG8nsn4IhoP01P/Hgn+3BW3VhICvtlpX47atsjpX4yKB1KSDj6GegM2rYGX98XlLXB85Xq0wnP7g+Zmm0UyTE+bAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Gossip-Protocol\"\n        title=\"Gossip-Protocol\"\n        src=\"/static/69f09f69eb0994b066216fd122a2a2fa/1dda8/gossip-protocol.png\"\n        srcset=\"/static/69f09f69eb0994b066216fd122a2a2fa/27f03/gossip-protocol.png 173w,\n/static/69f09f69eb0994b066216fd122a2a2fa/376d0/gossip-protocol.png 345w,\n/static/69f09f69eb0994b066216fd122a2a2fa/1dda8/gossip-protocol.png 690w,\n/static/69f09f69eb0994b066216fd122a2a2fa/51beb/gossip-protocol.png 905w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>After failures have been detected through the gossip protocol, the system needs to deploy certain mechanisms to ensure availability. In the strict quorum approach, read and write operations could be blocked as illustrated in the quorum consensus section. A technique called “sloppy quorum” is used to improve availability. Instead of enforcing the quorum requirement, the system chooses the first W healthy servers for writes and first R healthy servers for reads on the hash ring. Offline servers are ignored.\nIf a server is unavailable due to network or server failures, another server will process requests temporarily. When the down server is up, changes will be pushed back to achieve data consistency. This process is called <strong>hinted handoff</strong>. Since s2 is unavailable in diagram above, reads and writes will be handled by s3 temporarily. When s2 comes back online, s3 will hand the data back to s2.</p>\n<p>Hinted handoff is used to handle temporary failures. What if a replica is permanently unavailable? To handle such a situation, we implement an anti-entropy protocol to keep replicas in sync. Anti-entropy involves comparing each piece of data on replicas and updating each replica to the newest version.</p>\n<p>Refer to Cassandra's <a href=\"https://cassandra.apache.org/doc/latest/architecture/dynamo.html\">architecture</a> for a better understanding. </p>\n<h3 id=\"load-balancers\"><a href=\"#load-balancers\" aria-label=\"load balancers permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Load Balancers</h3>\n<p>Now that our backend is setup with a horizontally scaled system, we can go ahead and improve our system's availability, reliability and scalability. To test our system so far, consider this: say you suddenly start receiving a lot of traffic and have a collection of servers in your backend, how do you direct traffic to each of the servers? You want to utilize the servers to a point where the work-load is evenly distributed among all available servers. Enter <strong>load balancers</strong>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 659px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 78.7556904400607%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAACgElEQVQ4y5WUy27TUBCG81a8Cy/Bmg2vUNYsWEZCdAFCggVSKZUqtVKVblIpJCX3i534dnx8PT72z8wkDhECiR5pZI895/fMN3PcaZoGdV2Ltcvavd+Q5VWFbZwgygskVQ1tLOLSkFV0vzdVGGjygQYdFrTWitB8PsdqtZL7Rj7QQNHmleMiUjGCKEIUx7C0J8kyPI7H0GmKqm4Q5CVYq9NmFgQBut0u3p+fY7zcQFNApDM4cSrvNQn1ej0MBgPxIxK/vbmRfeKfCrIVRYGLiwt8v7pCmuUwlSWr4GeFBCZaY7VcwtmsURkj/nw2I0GfCmkQFQfBliGvkkR0Vu5LpuccqKlkLodZpVRaRo9DYsY8U7tHwmIcIwzLskSSJMiIydYPsHR2KPIcCbFpszfEmK2kzDTFbryQWGrkVFV1eGe5iZyhUgrD4VCYpCQyGo0wmUzguq40qxWV5hGCMAwQkYWBJ/FS4SFOBGOC7TiOwA3DEEvi5Pu++KeC9jBGTOKyv6ZRKn6joXUU1AR3vV6L6G63w3Q6lStnXFFGR0G75zxxYzx7+QVnn/pQvovpbI7FYgFGx6tjiAtv5tI5Q76yz1zbhnGm3PGmtvBVinfXP3E3clFXRtjzhHDMscv/Wm12nKnvefQhBXe7k3cqCuG4O5nPluVxDln9T2vF2i4XJLqgKdhyd2m8UhqX6dZDSGLlaZdPz/LfzSKj85ubHN37V3j0escKPj6c4Wb2QRqVmwPD/xEsaIhzk+L19XP0ncuj4Nu7F/g6eiP3TxDkPw5ZkeH2x2e44ewAGLgff8No2aPhhiB5giANdJph7YbwVIKEJkNRZx1PkUWI6egZ+WM1+AVG6s+yWzfDKwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Load Balancers\"\n        title=\"Load Balancers\"\n        src=\"/static/d8d640ba0c5d4fa9dae0d92221356457/b8d47/load-balancers.png\"\n        srcset=\"/static/d8d640ba0c5d4fa9dae0d92221356457/27f03/load-balancers.png 173w,\n/static/d8d640ba0c5d4fa9dae0d92221356457/376d0/load-balancers.png 345w,\n/static/d8d640ba0c5d4fa9dae0d92221356457/b8d47/load-balancers.png 659w\"\n        sizes=\"(max-width: 659px) 100vw, 659px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>A user connects to the <strong>public IP</strong> of your load balancer (public IP means one that is available over the internet) and we move the web servers to private IP addresses (NOT reachable over the internet). Now, all traffic is directed to the load-balancer. The load balancer will be aware of the status of each of the web servers and if either goes down, traffic can be routed to the correct server. With the addition of a load balancer, we've solved the problem of servers going down.</p>\n<p>To utilize full scalability and redundancy, we can try to balance the load at each layer of the system. We can add LBs in three places:</p>\n<ul>\n<li>Between the user and the web server</li>\n<li>Between web servers and an internal platform layer, like application servers or cache servers</li>\n<li>Between internal platform layer and database.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.695257315842582%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAAA5UlEQVQY022QS0+DUBCF+f87XbnVpcaN8bFjYSCRpgmRhoChhqsFird4Wx6lQKWfio2PxLM4M5kz+TIZjV/q97XIVsz8kLZuvrNttyX0ZgSOoFhW++lu8K7rUEoNvZatG9y0oN40iPtb1KvkYeyin1ySioTg2cd5HBOFCedHN5wdXuPbU4oqx7I9ZKaIowjDML6A/kvOhRuTFyULVydfStw7B/34EzhnmvhMohHpbDEATw+u8Ozg44A1o4lArUqECDFNk77v0fhHVV6SxZKubX/e8dYj44z5k6SuNn/2pZRYljUA3wE1fSkP4/Kh1QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"load-balancers-2\"\n        title=\"load-balancers-2\"\n        src=\"/static/2af2e5bcb6f32c9d96e4a6c1f2edade1/1dda8/load-balancers-2.png\"\n        srcset=\"/static/2af2e5bcb6f32c9d96e4a6c1f2edade1/27f03/load-balancers-2.png 173w,\n/static/2af2e5bcb6f32c9d96e4a6c1f2edade1/376d0/load-balancers-2.png 345w,\n/static/2af2e5bcb6f32c9d96e4a6c1f2edade1/1dda8/load-balancers-2.png 690w,\n/static/2af2e5bcb6f32c9d96e4a6c1f2edade1/c9886/load-balancers-2.png 991w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.educative.io/module/lesson/grokking-system-design-interview/3w8r0BNQLwn\">Image Credit</a></p>\n<h3 id=\"why-load-balance\"><a href=\"#why-load-balance\" aria-label=\"why load balance permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Why load balance</h3>\n<p>Users experience faster, uninterrupted service. Users won’t have to wait for a single struggling server to finish its previous tasks. Instead, their requests are immediately passed on to a more readily available resource.\nService providers experience less downtime and higher throughput. Even a full server failure won’t affect the end user experience as the load balancer will simply route around it to a healthy server.\nLoad balancing makes it easier for system administrators to handle incoming requests while decreasing wait time for users.\nSmart load balancers provide benefits like predictive analytics that determine traffic bottlenecks before they happen. As a result, the smart load balancer gives an organization actionable insights. These are key to automation and can help drive business decisions.\nSystem administrators experience fewer failed or stressed components. Instead of a single device performing a lot of work, load balancing has several devices perform a little bit of work.</p>\n<h3 id=\"load-balancers-deep-dive\"><a href=\"#load-balancers-deep-dive\" aria-label=\"load balancers deep dive permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Load Balancers Deep Dive</h3>\n<p>Now, you might be wondering, what are the different ways I can choose to route which traffic goes to which server? Well, in an OSI model, there are 7 layers: the most abstract layer is the application layer (ie application logic) and the most concrete layer is the physical layer:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 337px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e384a67482fca7a6e2ed7ad5b70176f6/e772b/osi-layers.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 115.13353115727003%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAXABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHt1mpqDMFwf//EABkQAAIDAQAAAAAAAAAAAAAAAAABAhAxQf/aAAgBAQABBQLRJMRyOqsIn//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQMBAT8BH//EABQRAQAAAAAAAAAAAAAAAAAAACD/2gAIAQIBAT8BH//EABkQAAMBAQEAAAAAAAAAAAAAAAABEBEhsf/aAAgBAQAGPwLWd9jjMjP/xAAeEAACAgICAwAAAAAAAAAAAAABEQAhMVEQYXGxwf/aAAgBAQABPyGmAlWYII27wiWEKKnuPBn5/I0ydmBWuXBbM//aAAwDAQACAAMAAAAQ8A88/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAwEBPxAf/8QAFBEBAAAAAAAAAAAAAAAAAAAAIP/aAAgBAgEBPxAf/8QAHhAAAgICAgMAAAAAAAAAAAAAAREAMSFRQfBxwdH/2gAIAQEAAT8QAvILOsGBUIyQBMN3FkDcOh9lh6ONtgd5hvtpEXsXIXJj1vFCFgSA8PwB6n//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"OSI Layers\"\n        title=\"OSI Layers\"\n        src=\"/static/e384a67482fca7a6e2ed7ad5b70176f6/e772b/osi-layers.jpg\"\n        srcset=\"/static/e384a67482fca7a6e2ed7ad5b70176f6/6bc31/osi-layers.jpg 173w,\n/static/e384a67482fca7a6e2ed7ad5b70176f6/e772b/osi-layers.jpg 337w\"\n        sizes=\"(max-width: 337px) 100vw, 337px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Load balancing can be done at:</p>\n<ul>\n<li><strong>Layer 4 (L4)</strong>:\nHere, load balancers work at the transport level. That means they can make routing decisions based on the TCP or UDP ports that packets use along with their source and destination IP addresses. L4 load balancers perform Network Address Translation but do not inspect the actual contents of each packet.</li>\n<li><strong>Layer 7 (L7)</strong>:\nHere, load balancers act at the application level, the highest in the OSI model. They can evaluate a wider range of data than L4 counterparts, including HTTP headers and SSL session IDs, when deciding how to distribute requests across the server farm.</li>\n</ul>\n<h3 id=\"balancing-algorithms\"><a href=\"#balancing-algorithms\" aria-label=\"balancing algorithms permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Balancing algorithms</h3>\n<p>There are a few algorithms that can be used by a balancer to determine which server gets the request from a pool of possible servers. Here're a few common algorithms:</p>\n<ul>\n<li><strong>Least Connection Method</strong>\nThis method directs traffic to the server with the fewest active connections. This approach is quite useful when there are a large number of persistent client connections which are unevenly distributed between the servers.</li>\n<li><strong>Least Response Time Method</strong>\nThis algorithm directs traffic to the server with the fewest active connections and the lowest average response time.</li>\n<li><strong>Least Bandwidth Method</strong>\nThis method selects the server that is currently serving the least amount of traffic measured in megabits per second (Mbps).</li>\n<li><strong>Round Robin Method</strong>\nThis method cycles through a list of servers and sends each new request to the next server. When it reaches the end of the list, it starts over at the beginning. It is most useful when the servers are of equal specification and there are not many persistent connections.</li>\n<li><strong>Weighted Round Robin Method</strong>\nThe weighted round-robin scheduling is designed to better handle servers with different processing capacities. Each server is assigned a weight (an integer value that indicates the processing capacity). Servers with higher weights receive new connections before those with less weights and servers with higher weights get more connections than those with less weights.</li>\n<li><strong>IP Hash</strong>\nUnder this method, a hash of the IP address of the client is calculated to redirect requests to a server.</li>\n</ul>\n<h3 id=\"redundant-load-balancers\"><a href=\"#redundant-load-balancers\" aria-label=\"redundant load balancers permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Redundant Load Balancers</h3>\n<p>The load balancer can be a single point of failure; to overcome this, a second load balancer can be connected to the first to form a cluster. Each LB monitors the health of the other and, since both of them are equally capable of serving traffic and failure detection, in the event the main load balancer fails, the second load balancer takes over.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.65408805031446%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABi0lEQVQoz22STW+bQBCG84vyr3rvz8il9x56yylKq17bS62oVQ5RasVym0JE4tgQwGBgMebTLE+XdeqPpK80zM7s7rvvMHPEHrqu4yX+5VrZkZcVsnt9No4jsmyp10f9Z71eI6XUh/aN3veX65wuX5CHMyhipIp7pGmK73vcGnd482hD2F8UQtC2rU7IvZelJpbIVciP4S9Ov1zyc3xLp0h7BEFAXddEsSDNip1Cz/O2mz3K1VLHO5ScfLrk+O0HTgcjFVc66zhPuO4TD48zomSv5PF4jGEYhGHIH8PkbFTx7ntJlNUs00SX+/nK4s37r1z8VmVXgkSkiszVlQWLBLHMd4TT6ZT7+wfmvs/1cMSV3XIxkbhxgYgXiLmNp5RYd6byDoUIKIoC27ZJkoTHmXOocDKZ6M2mafgvZMnw5oaz84+Ypqlj/auUACES/GBxqPDlmMhn02upmlWnWJbFt8EAZzaFJts2pW/ogcJXo/JMurU+bgqk6ux6FWnfNRuFVVXp0XH9kCTdKPwLsEeudz5VL1kAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Redundant-LB\"\n        title=\"Redundant-LB\"\n        src=\"/static/dbc18946d6418aad37dcceb47ec56484/1dda8/redundant-lb.png\"\n        srcset=\"/static/dbc18946d6418aad37dcceb47ec56484/27f03/redundant-lb.png 173w,\n/static/dbc18946d6418aad37dcceb47ec56484/376d0/redundant-lb.png 345w,\n/static/dbc18946d6418aad37dcceb47ec56484/1dda8/redundant-lb.png 690w,\n/static/dbc18946d6418aad37dcceb47ec56484/bf3e8/redundant-lb.png 795w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.educative.io/module/lesson/grokking-system-design-interview/3w8r0BNQLwn\">Image Credit</a></p>\n<p>Following links have some good discussion about load balancers:\n<a href=\"https://avinetworks.com/what-is-load-balancing/\">What is load balancing</a>\n<a href=\"https://lethain.com/introduction-to-architecting-systems-for-scale/\">Introduction to architecting systems</a>\n<a href=\"https://en.wikipedia.org/wiki/Load_balancing_(computing)\">Load balancing</a></p>\n<p>With the help of load-balancers, we've managed to break our web-service so that user requests for the home page are forwarded to only those nodes that are healthy and are not under heavy load. To do so, we'll be using one of the load balancing algorithms described above. Having said that, this is what our architecture looks like as of now:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 83.47338935574228%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAACwUlEQVQ4y3VU227TQBD1b/LIV1QCPgEJ3nlAKEIF+kApfYNSkArlkgAqBNGStEkcx4njxPF9vV7nMLO+kBYYaZy1Z+fMnLOzMdbrNWqvbfNbXhQIsxwRuyw9zKT2RBWIpUIgJMWl3m/wo6AktiRJked5A0pPDTAaW1gFAVIGEQJSKe2WbcPzfRS0lwFjKWHUYOPxGDs7Ozg8fE1JEoKCgjYt47KIpPezs1MMBwPdAHu324U9meh8wd3TfkNRJbZer4dWq4W95/tY+BFCAvKjBE4Q6XgUhvjc6eDbyQkxSZBlGTrtNvr9PtYEzh1rwE39+hcD+ERh0wLalFL1lDvO82bNnlAsIpmYjaZcd8h0JFV0vACyosc0uRBXDkWm9eGkNFdYUOd+miGhdVxRjSiftTQcx4FlWZqGadkYmSamUxLb8/6cfuVMzZ07GFsTmKS5t1xWB1iUcQacTqeYkLCsyWKx0OA2nZ7ruqgnoHZVlIlJmkKp/JI0Zc2qQwZg0MFwCJM6nM/nWFJ1BrkKynZn9wu235xCSUGaB1itVhA0TmwacDQaacAhAfL48Jq7rcE2hz7JFK7ffYlbrfckyxKz2UyzCmkKNCD+Y5tgfHCcEMcRAvrtWS76Y0e/p0Sfu1tXOcYljVTpm9/K70rT8mk+bcelTIVMpDAnM4RBrGN1ceNftK6aZFAKD+YkjTenUaJBLtawaT1wTOQ8XjRCTYd8Z/m6PTj4gWfHv6iiB5c05INhjbxKn4dHW+ic7zeFPvV38ejtTU7XA89YzV2ORY5rt19g6/4R4tCvKPr6cPw41nu2322hfb7XALbPn+Lx8Q29/gswJWHv7bfx5NVXuM5MzyGPD3tEMf6j+Pj9ABfWT9Tq9EZdfDg5QEyXQpDODSBz55OKVi4if4mrcrJmUUozF6YIE1Hdab7HGYJI6BhfUcb5Df4GFTBaJFy4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"load-balancer-single-db\"\n        title=\"load-balancer-single-db\"\n        src=\"/static/d5c20f28908b218f1177e8ca5003e4bb/1dda8/load-balancer-single-db.png\"\n        srcset=\"/static/d5c20f28908b218f1177e8ca5003e4bb/27f03/load-balancer-single-db.png 173w,\n/static/d5c20f28908b218f1177e8ca5003e4bb/376d0/load-balancer-single-db.png 345w,\n/static/d5c20f28908b218f1177e8ca5003e4bb/1dda8/load-balancer-single-db.png 690w,\n/static/d5c20f28908b218f1177e8ca5003e4bb/3298e/load-balancer-single-db.png 714w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Now the web tier looks good but what about the data tier? The current design has one database, so it does not support failover and redundancy. Meaning, what if our DB is hit with a time consuming query or what if the database node is down? Database replication is a common technique to address those problems. Let us take a look.</p>\n<h3 id=\"replication\"><a href=\"#replication\" aria-label=\"replication permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Replication</h3>\n<p>In replication, as stated earlier, the idea is to <strong>replicate</strong> the same information across multiple databases.</p>\n<p>Advantages of replicating our databases:</p>\n<ul>\n<li>Improved performance</li>\n<li>Reliability: If one node goes down, we have the data on several other nodes</li>\n<li>Availability: By having replicas close to your clients, you can render content fast</li>\n</ul>\n<p>The entire system is shown below:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 643px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 103.42146189735615%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAADJElEQVQ4y41Vy44bRRSdL2TNVyDlD9iyQIIFC8QCISFWrJCSsEBAomGBmFGiMInHmXjsdrfdj+qH+91d1e3DueXMaDydiSjpqq+r6p665758st/vIavseiR1g8oMKClFb6xUZrQiek5pePaxdQIC6nEPL0kRRhGKqkZWFBj4zsgLoVJQPBNdEyzrNPdieNstVus11q6LONvhn7NzXFxcEJCrFa/4uqzlYoH55Qy66/hrj6v5HMvrxa0HTlLg4trFq7cL/Hu1xMpXWAYJHj95ir9OTw+APQHTtkPda3hhBNcPEKUZiqbFehtgwz3RG22QtD0KMgiCAHGsMI6jfUi+Iic3MdT8dBRNPWk0mmFELRRbjfb9fkfbfhiPYib2AiRfEeuhvBgzVkkcI6VEScZLh+CH1CPGVs7l2zEUYjgMw61Xd0EtYF3XSNPUyi7LUDcNnCjHWpUIkh3yfIeEZyKdjS2OwI4AbyjfX1/+8hqffPEHPJUjSxR830cYhjDGTGhOAG9eExEqkt0X1wpPzh0mo4PRHVomTby7T/FBwMPBIeBlrdHr3upZ2Qj+7br7+F3bI0ARTc96VrOXbfHGX1i9Y0b9PMaZc4aW560xD2Z3Alj1B4+eLX/E0/k3760AL7/E9+ePMDDrNeswz3MrEpqPetgYbQFerv7ES+e3W0+CxMHz2c/QfWcLW9oziqbJmQD2fLGi0cL18c6N2DU9el5y/AiXyy12VcUQDP+Psm0fOeDFXLLKYaHyGn5acHAAFSdRZw4Je6igJx4aUnZdDxWLWpFWGKfYKgqnSk9vHU6Vhg1wv6jHDxf2Hi2N3pGuykukeWFBhsEgZnfEeYXlJuB+OSmdiYeGSq013ngxroKMFAcOir0tE4mrDA2SxNxPMdukjOtA+sexnPSyE1f49KtTPHsdWG8bDtEV6c/mb7EJQlvwXz+e4dEP5xZESkz6/0Odc8Jqghum+Ozb5/j9xTWnskbJxBRVg7ysqbcYSf27X1/h85/+FsJsxwZrTmul1BRQ5pvHpl+5a3iBz3o0nIPGloj8fwj1kp6stxuO/Q1UUdq9hyj/B1uHU58foicdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Entire System\"\n        title=\"Entire System\"\n        src=\"/static/adb3c3e6a671253016e8be82ce18f337/6ab6c/entire-system.png\"\n        srcset=\"/static/adb3c3e6a671253016e8be82ce18f337/27f03/entire-system.png 173w,\n/static/adb3c3e6a671253016e8be82ce18f337/376d0/entire-system.png 345w,\n/static/adb3c3e6a671253016e8be82ce18f337/6ab6c/entire-system.png 643w\"\n        sizes=\"(max-width: 643px) 100vw, 643px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Finally, the flow for this design shown would be:</p>\n<ul>\n<li>A user gets the IP address of the load balancer from DNS.</li>\n<li>A user connects the load balancer with this IP address.</li>\n<li>The HTTP request is routed to either Server 1 or Server 2.</li>\n<li>A web server reads user data from a follower database.</li>\n<li>A web server routes any data-modifying operations to the master database. This includes write, update, and delete operations.</li>\n</ul>\n<p>Before we move forward, let's recap what we've seen so far:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 643px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 103.42146189735615%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAAAsSAAALEgHS3X78AAADJElEQVQ4y41Vy44bRRSdL2TNVyDlD9iyQIIFC8QCISFWrJCSsEBAomGBmFGiMInHmXjsdrfdj+qH+91d1e3DueXMaDydiSjpqq+r6p665758st/vIavseiR1g8oMKClFb6xUZrQiek5pePaxdQIC6nEPL0kRRhGKqkZWFBj4zsgLoVJQPBNdEyzrNPdieNstVus11q6LONvhn7NzXFxcEJCrFa/4uqzlYoH55Qy66/hrj6v5HMvrxa0HTlLg4trFq7cL/Hu1xMpXWAYJHj95ir9OTw+APQHTtkPda3hhBNcPEKUZiqbFehtgwz3RG22QtD0KMgiCAHGsMI6jfUi+Iic3MdT8dBRNPWk0mmFELRRbjfb9fkfbfhiPYib2AiRfEeuhvBgzVkkcI6VEScZLh+CH1CPGVs7l2zEUYjgMw61Xd0EtYF3XSNPUyi7LUDcNnCjHWpUIkh3yfIeEZyKdjS2OwI4AbyjfX1/+8hqffPEHPJUjSxR830cYhjDGTGhOAG9eExEqkt0X1wpPzh0mo4PRHVomTby7T/FBwMPBIeBlrdHr3upZ2Qj+7br7+F3bI0ARTc96VrOXbfHGX1i9Y0b9PMaZc4aW560xD2Z3Alj1B4+eLX/E0/k3760AL7/E9+ePMDDrNeswz3MrEpqPetgYbQFerv7ES+e3W0+CxMHz2c/QfWcLW9oziqbJmQD2fLGi0cL18c6N2DU9el5y/AiXyy12VcUQDP+Psm0fOeDFXLLKYaHyGn5acHAAFSdRZw4Je6igJx4aUnZdDxWLWpFWGKfYKgqnSk9vHU6Vhg1wv6jHDxf2Hi2N3pGuykukeWFBhsEgZnfEeYXlJuB+OSmdiYeGSq013ngxroKMFAcOir0tE4mrDA2SxNxPMdukjOtA+sexnPSyE1f49KtTPHsdWG8bDtEV6c/mb7EJQlvwXz+e4dEP5xZESkz6/0Odc8Jqghum+Ozb5/j9xTWnskbJxBRVg7ysqbcYSf27X1/h85/+FsJsxwZrTmul1BRQ5pvHpl+5a3iBz3o0nIPGloj8fwj1kp6stxuO/Q1UUdq9hyj/B1uHU58foicdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Entire System\"\n        title=\"Entire System\"\n        src=\"/static/adb3c3e6a671253016e8be82ce18f337/6ab6c/entire-system.png\"\n        srcset=\"/static/adb3c3e6a671253016e8be82ce18f337/27f03/entire-system.png 173w,\n/static/adb3c3e6a671253016e8be82ce18f337/376d0/entire-system.png 345w,\n/static/adb3c3e6a671253016e8be82ce18f337/6ab6c/entire-system.png 643w\"\n        sizes=\"(max-width: 643px) 100vw, 643px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Diagram above shows that the user gets the IP address of the load balancer from DNS. User connects to the load balancer with this IP address. The HTTP request is routed to either Server 1 or Server 2. A web server reads user data from a follower database. A web server routes any data-modifying operations to the leader database. This includes write, update, and delete operations.</p>\n<h3 id=\"indexes\"><a href=\"#indexes\" aria-label=\"indexes permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Indexes</h3>\n<p>Indexes are well known when it comes to databases. Sooner or later there comes a time when database performance is no longer satisfactory. One of the very first things you should turn to when that happens is database indexing.</p>\n<p>The goal of creating an index on a particular table in a database is to make it faster to search through the table and find the row or rows that we want. Indexes can be created using one or more columns of a database table, providing the basis for both rapid random lookups and efficient access of ordered records.</p>\n<h3 id=\"indexing-example\"><a href=\"#indexing-example\" aria-label=\"indexing example permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Indexing: Example</h3>\n<p>A library catalog is a register that contains the list of books found in a library. The catalog is organized like a database table generally with four columns: book title, writer, subject, and date of publication. There are usually two such catalogs: one sorted by the book title and one sorted by the writer name. That way, you can either think of a writer you want to read and then look through their books or look up a specific book title you know you want to read in case you don’t know the writer’s name. These catalogs are like indexes for the database of books. They provide a sorted list of data that is easily searchable by relevant information.</p>\n<p>Simply saying, an index is a data structure that can be perceived as a table of contents that points us to the location where actual data lives. So when we create an index on a column of a table, we store that column and a pointer to the whole row in the index. Let’s assume a table containing a list of books, the following diagram shows how an index on the ‘Title’ column looks like:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.61964735516373%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABj0lEQVQoz42RS2+bUBCF+c2VuohaVU03VaWu8iv6H6wmpYpjt35RwBgwYPwA2+DaGK4fJDZfb6wqi6460ujO6J4zM0dHqSrgOf+Jqqpe3vOJ/w5lMrHxgy7iEJEVAbmYUj4W/J3H6fSIMWgSryzy44RsF7Irl2wPEzZC4vcRheSuhceh3KAYwRdu9feo/Q/UjNc8uB8lufWycSsSGs4NX8231PQrVPuapnvDrfmOO+sNjeFn7gefJPcV49V3lCDU0CwVw37ADVskmUM080jTFfN4znQWMvBaOH4Py2kTJbbsfzJwO8TJkDi1cYMe4azP7riWkqcWjpSsmXWGYYc0GzEKbKIoZrPZsExibL/NcNSTxA6ThSlxXcnpEEa67A08eZQ37pLvlijjqYbpqLS1Gv60yeK3wWLuUxTiMtDzbXT7Xiqo0zVUwrhHr/+N9q87rGFDqvqBPqhf1O2OKcrhsKYQC4RYIvYJQm4pjwXnc3Vx+EmakhUL1lt5cT6X5qWX+jm3Epvvl5f/rJhTPgn+AJG0/7S+9XXVAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"index-example\"\n        title=\"index-example\"\n        src=\"/static/4dce7121f77c47a7945fbf267625a299/1dda8/index-example.png\"\n        srcset=\"/static/4dce7121f77c47a7945fbf267625a299/27f03/index-example.png 173w,\n/static/4dce7121f77c47a7945fbf267625a299/376d0/index-example.png 345w,\n/static/4dce7121f77c47a7945fbf267625a299/1dda8/index-example.png 690w,\n/static/4dce7121f77c47a7945fbf267625a299/d7d56/index-example.png 794w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.educative.io/module/lesson/grokking-system-design-interview/3w8r0BNQLwn\">Image Credit</a></p>\n<p>Just like a traditional relational data store, we can also apply this concept to larger datasets. The trick with indexes is that we must carefully consider how users will access the data. In the case of data sets that are many terabytes in size, but have very small payloads (e.g., 1 KB), indexes are a necessity for optimizing data access. Finding a small payload in such a large dataset can be a real challenge, since we can’t possibly iterate over that much data in any reasonable time. Furthermore, it is very likely that such a large data set is spread over several physical devices—this means we need some way to find the correct physical location of the desired data. Indexes are the best way to do this.</p>\n<h3 id=\"index-write-performance\"><a href=\"#index-write-performance\" aria-label=\"index write performance permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Index: Write Performance</h3>\n<p>An index can dramatically speed up data retrieval but may itself be large due to the additional keys, which slow down data insertion &#x26; update.</p>\n<p>When adding rows or making updates to existing rows for a table with an active index, we not only have to write the data but also have to update the index. This will decrease the write performance. This performance degradation applies to all insert, update, and delete operations for the table. For this reason, adding unnecessary indexes on tables should be avoided and indexes that are no longer used should be removed. To reiterate, adding indexes is about improving the performance of search queries. If the goal of the database is to provide a data store that is often written to and rarely read from, in that case, decreasing the performance of the more common operation, which is writing, is probably not worth the increase in performance we get from reading.</p>\n<p><a href=\"https://en.wikipedia.org/wiki/Database_index\">Detailed read here</a></p>\n<h3 id=\"caching\"><a href=\"#caching\" aria-label=\"caching permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Caching</h3>\n<p>So far, we've improved the availability and reliability of our system. We can now concentrate on speeding up our architecture by improving latency by improving response and load times for our web-page. Now, as you can imagine, querying the database for the same information over and over again can be quite expensive. For example, let's say we perform a join on a few tables to render on each user's page the most frequently visited part of the site for a particular day. Getting this information for each and every site visitor is expensive. Since this information does not change frequently, we can look up this information once and then <strong>cache</strong> it for future use. This will improve the performance of our application. </p>\n<p>The <strong>cache tier</strong> is temporary data store layer that lies between the server and the database. If the information we want is present in the cache tier, we'll grab it from there, otherwise we'll query the DB, store this information in cache and return. Retrieving data from the cache tier is faster than querying the database for the same information. In addition, using the cache tier will also reduce database workloads. We can use Memcache, Redis etc based on the data we're caching. Interacting with cache servers is simple because most cache servers provide APIs for common programming languages.</p>\n<p>Here's a possible cache tier setup:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 624px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.262820512820513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAxElEQVQI122OPU7DQBhEfTBuwi1oOQQFNV0ugBBQg4QoEkTjJEKKiJO1La/t/bG/ZZ2keaxCy0hPmmaeJrtf3mCDobWafb2jaksq/UdRFdRakW8VDwuFTCf+i5EDs5cNQzyS3c2v0M6hjUE1TRK2SaYpE3XXE6fA4+Kbi+tn8qIj/ER6N2IHofcjEoR813F5+4b2E9nn6h3vB0YRjLU473HOY60jxun8YBiFr82Ww/HEXqXH+ZLVen3uknZl3fD0+pEcgV91xdxMN/K/owAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Cache Tier\"\n        title=\"Cache Tier\"\n        src=\"/static/02f1d64457feaf633353aab801e7dca3/24590/cache-tier.png\"\n        srcset=\"/static/02f1d64457feaf633353aab801e7dca3/27f03/cache-tier.png 173w,\n/static/02f1d64457feaf633353aab801e7dca3/376d0/cache-tier.png 345w,\n/static/02f1d64457feaf633353aab801e7dca3/24590/cache-tier.png 624w\"\n        sizes=\"(max-width: 624px) 100vw, 624px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Not all types of data can be stored in cache! Let's look at a few pitfalls when using caches:</p>\n<ul>\n<li><strong>Type of data</strong>\nSince cache data is read once and then stored in cache tier, it is not advisable to cache data that changes frequently. The ideal candidate for cached data is one that is read frequently but updated infrequently. It is a good idea to set an expiration policy where the cache is <strong>invalidated</strong> and the data in cache is refreshed by performing another read of the DB. </li>\n<li><strong>Inconsistency</strong>\nEven if you set an expiration policy, your cache data might be out of date therefore it is important to keep cache and data store in sync using TTL.</li>\n<li><strong>Eviction Policy</strong>\nOnce the cache is full, we'll have to start removing content from the cache. To do so, we can use something called LRU (least recently used) cache eviction policy where the least recently used data is removed from cache.</li>\n</ul>\n<h3 id=\"cache-types\"><a href=\"#cache-types\" aria-label=\"cache types permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Cache: Types</h3>\n<p>There are several strategies where the choice to pick the correct strategy depends on your <strong>data access patterns</strong>. For example: do you have more writes than reads? (ie time based logs), do you have write once and read multiple times? (ie think user profiles on Facebook), do you have a combination? (update and search data). Depending on your use-case, your caching strategy would evolve. Let's look at the various types of caches available.</p>\n<ul>\n<li><strong>Side Cache</strong></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.34207077326344%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACcklEQVQoz2NgYGDQAGJDIFYGYh0gNgViViBmCIqIYoCB4/93sMDYSzzfMOADzFADWBn4GUGYjcGOhTH0RCxDgvBWJpCCebLf82fz/r4/R+LHxCP/d4HFFtl8YCALLAm/rz6T48/fOQz//y9j+v9/gd5nd5D4HNGfTFg1MOmzQj3IwMAyV1CcYRaHJMNMJlG1xXqKZhsNdCrmNagtEP55dSXQsNlc/94vtHqvDna1/HdGrAb+XSjJ9GueIPP/2exMAiUMTC4bnDkq92ZI1OzOkGBYZM/6/z8D097cPbatstfrm40PO4D0NDLeBhumXf4EbIZW+WNGrfInLEDMjGK45Nf/bPMO14tt3dPLDuIDQ4njbnCE6WFOBolKQQbhJn4GYZD4iSgpxjdzFjH8X57LUN56FNWlf1YYBPxfLO/zbLVF9uP1Dq7Ici/nzJZ6NmMSO6FwVi1/ZqZd8XgG0IWtDP8X8vz/PxcU4gz//82T2H9l1X/OVzO6xF5On6b7ICND/bq1tfwtHx+Fa+7uitfd3BRv2Nmp3ouNlXy9bDnfmYkLhf7/YWAxrbxfCDTsJdDQSwz/5nD9/j+d4fd/YDT+mSt94OncQ+qvZkzUfjl9qtiDzEyx+4mJcvdTUqTvp6aC8d2oKPlHhYUSr+YvELw2Zb7I/+0hXJZV95I0y5+sARo4j+HffKHf/2ez/f6/kP3/3wVSm8hJWmrlT921K56s1Kp4Mp1hfbWB2/JSXf9lJbpBe1qMtUEKtlelMb6aMZnhYV4ew/2kJMb7aWmMD9LTGYFBwHg3OprxUXExw5v58xmmpKWAI8RclY/PwNpL19DKQxEA213y1G8yMX0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Side cache\"\n        title=\"Side cache\"\n        src=\"/static/c6a2425e60d48e817d76a0be14bf785d/1dda8/cache-aside.png\"\n        srcset=\"/static/c6a2425e60d48e817d76a0be14bf785d/27f03/cache-aside.png 173w,\n/static/c6a2425e60d48e817d76a0be14bf785d/376d0/cache-aside.png 345w,\n/static/c6a2425e60d48e817d76a0be14bf785d/1dda8/cache-aside.png 690w,\n/static/c6a2425e60d48e817d76a0be14bf785d/76400/cache-aside.png 763w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://codeahoy.com/2017/08/11/caching-strategies-and-how-to-choose-the-right-one/\">Image Credit</a></p>\n<p>This is the simplest of them all: the application, before calling the DB, checks the cache to see if there's a cache hit: if so, application returns the data. In case of a cache miss, the DB is queried, cache is updated and data is then returned to the application. If the cache goes down, application can continue to query the DB.</p>\n<ul>\n<li><strong>Read Through Cache</strong></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.323722149410223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABlUlEQVQY02NgYGAwBWI1IFYAYg0gNmZgZBBjAAFxBoaJ4RcZJjP8ZwRxJwHp1X73GP5PYmD4HxXMsDargwEDbGt1411QbM73eV0o14IaRw4GBla2/wzbMNVtu8wG5/z/D2eG3/rPoF3+WE2r4om1VvkTUYb/C8Tu/J/LdfvfHK73/xdJ14AU6U5iYGeoZ2BhSAdiIJgr+bNtNs/vx3MkfzaB+DMY+IEubgS7WqXwgSjQsJtAQ/9qlT9eyPBvDsf/f9OBdi5i+P9lkewyhhcf+X1WGWt7LvfSVL3DLNcTe8h3EdP//3OAShaw/P+/P/p47Ie2JLN7ZQ32H8vzHWbXr7LUKH8yXbv80VygoXUM/5fyAVUy/v+/hvH/n0VS88E+2ubH8n/lf2YQe1XEc+nZ3H8eLAUqmcPz7/a2xCuK/yf6cl8p7RD6XxPKHVt/QVKr8sUKrcrnB4G4geFWv3LD1S659mvdsn3Ppmu4gAzp8GYAe8eC4QQkMqyuaHYoXWiqtlhnjBG4XH6MeqE9Vroxc131gjvUAGNEouFdEErHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Read through Cache\"\n        title=\"Read through Cache\"\n        src=\"/static/6f6b76685ece0e223e0e8bc719473b2b/1dda8/read-through.png\"\n        srcset=\"/static/6f6b76685ece0e223e0e8bc719473b2b/27f03/read-through.png 173w,\n/static/6f6b76685ece0e223e0e8bc719473b2b/376d0/read-through.png 345w,\n/static/6f6b76685ece0e223e0e8bc719473b2b/1dda8/read-through.png 690w,\n/static/6f6b76685ece0e223e0e8bc719473b2b/76400/read-through.png 763w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://codeahoy.com/2017/08/11/caching-strategies-and-how-to-choose-the-right-one/\">Image Credit</a></p>\n<p>As the name suggests, read through cache is placed between the application and the database. This means that the application ONLY interacts with the cache and NOT the DB. Any cache misses are populated and cache hits are returned. For example:</p>\n<p> (1) Given a key-value pair, the application first tries to read the data from DB. If the cache is populated with the data (cache hit), the value is returned. If not, on to step 2.</p>\n<p> (2) Transparent to the application, if there was a cache miss, cache fetches the key-value pair from DB.</p>\n<p> (3) To make the data available for any subsequent reads, the key-value pair is then populated in the cache.</p>\n<p> (4) The key-value pair then returns the value back to the application.</p>\n<p> If cache goes down, access to DB will also be lost. Disadvantage here is that on the first request, since the cache is empty, you'll have to query the DB so the first request will always be slow. Read through cache is a good use case for <strong>read heavy</strong> work loads.  </p>\n<ul>\n<li><strong>Write Through Cache</strong></li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.323722149410223%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABi0lEQVQY02NgYGDQBWJVIJYBYi0gNgFicQYoWOr3hmESw39GEHsykJ7mcYWBgYmBwUZFjkHfI5sBA9xaEMK9qsqK9858P+5VNY7sQCE2mFyWbR8jjL1lxxk2BizA0CGMUav8sZpWxRNrIC3K8G+B2N3/c7lu/5vD9e7/Etk6sEtiOdkcTV1YYJrmSf5qm83z5/F8yb/NIL6JsDuzqUM82ALN9v9CQMNuapc//qtV/mQhw785HP//TWf4/38xw//PM4TnMjA0iDhZaGpYGtlqMFgzsNeab/Sbz/r//yygkhnsP//XWK7z5TFgkDE3dtAx1pBU1A+o19cuvTcb6Lo5WuWP6hj+L+X7/38+4///a5n+/5kvPgfsvTQG1nSLRmYQu8v9gMJMnl8PlwCVzOT9eXuq7wVpkHiY22KwvG7KRkmtyucrgfggEDcw3OpXbrjaJdd+rVu279kMLVeQov8LGMBh9x8IwUFgdV2zQ+lCU535ZmMQf5XYf3jY6qTvYtQL67XSjZnrqhfSoQYAgeGPOo7MPhQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Write through Cache\"\n        title=\"Write through Cache\"\n        src=\"/static/e9becdf51ce8828e9cd89bb5a6aae481/1dda8/write-through.png\"\n        srcset=\"/static/e9becdf51ce8828e9cd89bb5a6aae481/27f03/write-through.png 173w,\n/static/e9becdf51ce8828e9cd89bb5a6aae481/376d0/write-through.png 345w,\n/static/e9becdf51ce8828e9cd89bb5a6aae481/1dda8/write-through.png 690w,\n/static/e9becdf51ce8828e9cd89bb5a6aae481/76400/write-through.png 763w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://codeahoy.com/2017/08/11/caching-strategies-and-how-to-choose-the-right-one/\">Image Credit</a></p>\n<p>Similar to read-through cache, write-through cache also sits in line with the DB and the cache is updated as data is written to DB. Here're the data flow for a write through cache:</p>\n<p> (1) For a given key-value pair, the application writes to the DB.</p>\n<p> (2) Cache intercepts the write and then writes the key-value pair to DB.</p>\n<p> (3) Upon a successful write, the cache is hydrated with the new value so that any subsequent reads for the same key-value pair result in a cache hit. If the write is unsuccessful, the exception is returned to the application.</p>\n<p> (4) The acknowledgement of a successful write is then returned to the application.</p>\n<p> Write through and read-through caches can be deployed together to simplify the use of caches. Because a write-through cache automatically caches the update, there's a slight amount of latency for writes. However, the advantage here is that data that is written is also immediately available for reads! Think about it: you have a DB that stores title and summary of new books that you publish. Say you've published a new book and on the landing page of your website you have a huge banner advertising this new book. Before you push the banner to your site, you update your DB with the book title and summary. As soon as you write to the DB, your cache is updated (since it is a write through cache). Now when millions of users flock to your website, they request this new book and its summary which is returned from the cache and NOT the DB. </p>\n<p> Therefore, <strong>write-through cache is advantageous for read heavy workloads</strong>. </p>\n<ul>\n<li><strong>Write Around Cache</strong></li>\n</ul>\n<p> <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 30.219146482122262%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAA/0lEQVQY03VQPUsDQRC9wr9la+kv0TKFpBUtBMVWERtRsZVY2KiVQgS7FAcGRE0uMbe3H7d7e7s7s84KXmFweDDMzHszj8niUiAm/BaA4JTkUlQRPCJQDyhhomTx38DQCGeYM9zrMsEIp5m3smP8FfuA4znmRfwSgU7Bj4dpG6cuTQPQZbh7zvunD5+LOtO6ZowppYSklaEQ2DsvN04mZ482tpVWrJHq4mo8uH4DI2o+I/Hm3uXK2vbgKc+MMSTmnJclo8FH5dYPR6s7L/u3RXIevLF+62CyezwnDxA8feF+OOof3by+z7Klb6HQ7UJZ63zXNGAtuo7gWxtcY3T9DRbvT0Fshbo+AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Write Around Cache\"\n        title=\"Write Around Cache\"\n        src=\"/static/b9b36f9b0fde5521fff302d20eb713fd/1dda8/write-around.png\"\n        srcset=\"/static/b9b36f9b0fde5521fff302d20eb713fd/27f03/write-around.png 173w,\n/static/b9b36f9b0fde5521fff302d20eb713fd/376d0/write-around.png 345w,\n/static/b9b36f9b0fde5521fff302d20eb713fd/1dda8/write-around.png 690w,\n/static/b9b36f9b0fde5521fff302d20eb713fd/0b7a7/write-around.png 867w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://aws.amazon.com/blogs/database/amazon-dynamodb-accelerator-dax-a-read-throughwrite-through-cache-for-dynamodb/\">Image Credit</a></p>\n<p>Some workloads in the IoT or ad tech space have a considerable amount of data that is written once and read never. In these scenarios, it often doesn’t make sense to use a write-through cache. If the cache is populated with data that is never read, it usually means that the utilization and cache/hit miss ratio is low, reducing the utility of the cache. To work around this issue (pun intended), you can employ a write-around pattern in which writes go directly to DynamoDB. Only the data that is read—and thus has a higher potential to be read again—is cached.</p>\n<ul>\n<li><strong>Write Back Cache</strong></li>\n</ul>\n<p> <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.14898177920686%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAsUlEQVQI12WMsQrCMBiE+wA+mZubD+Ciiy/g6Ka7U3EQFCfBoWNBEAQFq1BFhRZLaVNtq8QKJumf/AZXj7tvueMM/JOU6kLULkDyVKhASc1yGbESQEKpB84paPTney8xKKVxHBNCsizTVLJ8c2yPbrWeZy4oy30E6mxps+Wej5S/AoRibK0q1e7Edg0A4D8JIRjj+vgjZGd2rQ8O0/UdUWmHOZj2Iy10CTpRkg6tjR8mXy3Pn38bJg+wAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Write Back Cache\"\n        title=\"Write Back Cache\"\n        src=\"/static/5dcd7d3e754504c7c99feafbffd5efb2/1dda8/write-back.png\"\n        srcset=\"/static/5dcd7d3e754504c7c99feafbffd5efb2/27f03/write-back.png 173w,\n/static/5dcd7d3e754504c7c99feafbffd5efb2/376d0/write-back.png 345w,\n/static/5dcd7d3e754504c7c99feafbffd5efb2/1dda8/write-back.png 690w,\n/static/5dcd7d3e754504c7c99feafbffd5efb2/dbb86/write-back.png 933w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://aws.amazon.com/blogs/database/amazon-dynamodb-accelerator-dax-a-read-throughwrite-through-cache-for-dynamodb/\">Image Credit</a></p>\n<p>Whereas both read-through and write-through caches address read-heavy workloads, a write-back (or write-behind) cache is designed to address write-heavy workloads. In this scenario, items are written to the cache and then asynchronously written to the underlying data store. The process is as follows:</p>\n<p>(1) The item is written to the cache.</p>\n<p>(2) The item is acknowledged by the cache, and success is returned to the application.</p>\n<p>(3) As a background process, items are de-staged and written to DynamoDB.</p>\n<p>(4) The cache acknowledges the write.</p>\n<h3 id=\"content-delivery-network-cdn\"><a href=\"#content-delivery-network-cdn\" aria-label=\"content delivery network cdn permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Content delivery network (CDN)</h3>\n<p>While we're on the topic of getting content to users fast, it is apt to talk about content delivery networks or CDNs. A CDN is a network of geographically dispersed servers that is used to deliver <strong>static</strong> content. CDN caches static content such as images, CSS, JS and HTML pages that are then delivered to customers close to the server in the CDN. CDNs help improve site load times. Examples of CDNs are Amazon CloudFront, Akamai ImageManager, Fastly IO, PageCDN etc.</p>\n<p>Here's how a CDN might work:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.83333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsSAAALEgHS3X78AAABPElEQVQY03WRuU7DQBRF/XH8Fj+AxD9QIoo0dDRIFPSBhC2bEyexPePdTmwnHh/eJIgGUVzdkWbu8t44WmvexmM+Zi6urxlNl6wCTb6rKfcNadvRmY6qqkjTFK0jojhGiS5UijhOCCPF0+wWVbo4XXd+TG+o65pERHNvw9LbcjMvufYMd/6Br7gkzzKUGESJGCcJSZ6zk9C1Drl8uGAUPOIYYzgej9JCuDMU1Z60KAmTnGe1Z7DMuN/WTFRGJK02fkCgtEBR7vai6amaisHwCjd+xbEju4sF85UnzXzGn1PepwuirODYNpSSTrNDRqDvezidzrAlbKGmaVh5S4qiwAnDkJfhkMlihbv28UOFjiIOhwNGDE5C4ZNY1mNX9Ms/hhY2qzc9Ttu2stj4PLbgnG0vjYjMH+F/sB9n+RvVGseSNV4edQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"CDN\"\n        title=\"CDN\"\n        src=\"/static/d8163bbdd9b6c15043b69744f1ac88a3/3f01f/cdn.png\"\n        srcset=\"/static/d8163bbdd9b6c15043b69744f1ac88a3/27f03/cdn.png 173w,\n/static/d8163bbdd9b6c15043b69744f1ac88a3/376d0/cdn.png 345w,\n/static/d8163bbdd9b6c15043b69744f1ac88a3/3f01f/cdn.png 600w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<ul>\n<li>User 1 requests an image that is not found in the CDN. The image is requested from <strong>origin</strong> (or the main server)</li>\n<li>The image is then stored in the CDN</li>\n<li>The image is then returned to the user</li>\n<li>User 2 requests the same image from the same geographical location. The image is found in the CDN and the image is returned to user 2 faster.</li>\n</ul>\n<p>CDN content comes with a <strong>TTL</strong> or time to live that describes how long the image can be cached. </p>\n<p><strong>CDN Drawbacks</strong></p>\n<ul>\n<li><strong>Cost</strong>\nCDNs are run by third-party providers, and you are charged for data transfers in and out of the CDN. Caching infrequently used assets provides no significant benefits so you should consider moving them out of the CDN.</li>\n<li>Setting an appropriate cache expiry: For time-sensitive content, setting a cache expiry time is important. The cache expiry time should neither be too long nor too short. If it is too long, the content might no longer be fresh. If it is too short, it can cause repeated requests to the origin servers thus making the CDN useless.</li>\n<li>If all your users are located within the same geographical region, say Europe, you don't need a CDN in US for your customers.</li>\n<li><strong>CDN fallback</strong>\nYou should consider how your website/application copes with CDN failure. If there is a temporary CDN outage, clients should be able to detect the problem and request resources from the origin.</li>\n</ul>\n<p>Here's the complete diagram with CDN and cache added:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.06346967559945%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAAC00lEQVQ4y41Uy04UURDlF41/4dbojq0bf8GFURYkKgmiCxNZSGKIE9HoMAxMRmaAefX0+30ffftYt5pG0InQSc2t6Vt9bp2qU3etrmu0j/XZyK9qazW0aczQO7tWpr4R2/iN0S/W2k2lFG9qYzDxAkR5iVQqZEojkxpBlvOakMmqukSwSKYx1PyKAfv9Pra3t+H6AXICSIoCeZpgdHoKJSWkFDg87EIryQcGhSBfIS4lNmYKO66GIwwndAW4tbWFueMiLiQUHeV5Ln52u4ijCGVZotfrIYljpu2mOUoh4CQFPkxivD2L4MprgC1t+1g6sVDIidoyLVBQxn5WcDbWT6gMQv+hbMocMomYdt0CGqJREZAFDcMQk9kMF7M5Fp6PqCixDEL+by1OUo6z8VVlYHtkczOXCV0BttYEVvYlBGX5+EUH+8dzarlEnue8dz3+ejIrATnA8JmIqdPrm9/w8fsYSehhvliwGv6Ot/Z/QJYFKEMDTZmVQjcKsTW73L8zoKZgoQ3czMHJYkBdBaahg7E/RKk1lD1sRRIrAWtbNy154/N4E5s/1tnvznfx/OAh+3GWwfd90qa8G6DUimoInMy/oDN+x0Hnfh97g1c8dilpMiY9trXkTt9G2WpxtvQxOD8j6iSjpYvj8YgklPKktLptpWPt1qakNF42m6nnYRF5cBMPE39C/gIe+ULJdiSY2UrAVk9JXsAJEwatOGvD4H6a0mjGWCYuAU+wS/P96OUBpn7eNKqubwLaDgZZiZ2vIzhxRteXQansqGlSpcHxNEBnuKQ6N7T3+yPcf/Ieo0X0LyBnRx8N5zHuPf2E3nkARUAXMwdHgyGkKLCx9wsPnnUgKs3xJU1OnoR0Iwme4/omIGVoKkR0IbzZO8J04VJtmjFs78rD8RKvaS8i6pPpFAmt7fcra2ipCfq4yGJEJA2hGiG3Zu/FlG6WKM2YXjv312f5N387uewNFPTeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Complete with CDN and Cache\"\n        title=\"Complete with CDN and Cache\"\n        src=\"/static/326c713d0affd2b939768448ba5586a8/1dda8/complete-with-cdn-and-cache.png\"\n        srcset=\"/static/326c713d0affd2b939768448ba5586a8/27f03/complete-with-cdn-and-cache.png 173w,\n/static/326c713d0affd2b939768448ba5586a8/376d0/complete-with-cdn-and-cache.png 345w,\n/static/326c713d0affd2b939768448ba5586a8/1dda8/complete-with-cdn-and-cache.png 690w,\n/static/326c713d0affd2b939768448ba5586a8/1d6db/complete-with-cdn-and-cache.png 709w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>In the diagram above we have plenty of improvements over our single server setup:</p>\n<ul>\n<li>Static assets are directly fetched from CDNs that are located close to the end user</li>\n<li>A load balancer is able to scale up/down our backend based on demand and is able to route our requests appropriately</li>\n<li>Database load is lightened by caching data</li>\n<li>Data stored in the database is replicated across followers so that reads are faster</li>\n</ul>\n<h3 id=\"web-tier-and-statelessness\"><a href=\"#web-tier-and-statelessness\" aria-label=\"web tier and statelessness permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Web Tier and Statelessness</h3>\n<p>To understand statelessness we must first understand what stateful means. In a stateful architecture, a user's data is \"remembered\" between sessions. For example, say a user connects to server A, updates his/her profile, and then disconnects. The next time user A re-connects, he/she needs to be re-directed to server A since that is where user's latest information is. Example:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.53588516746411%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACAklEQVQoz21TTYvUQBScf+lP8Ow/8b4XwbPgRQ/CigiCLCwzO4Lgyi4sSczHdNKdpPPZScp6rRnJroFHp7tS9eq919mBj9YaQRBgmiYsy+JjnmeBUNc10ixD0zR+L+crVhQFwjDc8HYCyOFhv4dz7gkpVwrH441P+hgTE4fDwfM2gm3XoaSTlfDP4YK+H5CpfHO+Clq6NtWW5wWzk0JR/U+QDguN3NQbdyuWpBl0ZZ8K5uxFUf4hPXZhyhJKl/gLbpJpY86Cgkns7OhgWFZSNmjGCe3ozqSG72U/Ii4t5Ds7uHOy1k0wnfAsORPqYcQsghXF0sygMBY9p6UpMJEwyjs/ynXl8brtPCbnbpphKK5ZVZwUqNoWlgkkKR0u+HL3DsfoCiMrUW3vBYeJzgfgR3rEx9s33r1qBy8oYYYFD8Ud3n9/RXc9SiaoRVDKf339Apc/L3wrKoJOBN3IGQPX4VtcfH3uMSlTxCSZI3ifX+Hl52fs3YSJe+9woK1v0Sfcn244KgqyBWvJli4ifYtDeOnvWu1LXrEZeR1hH3zAQBM98YYJd0ma4hSfcEoYaQLDXomguIx4ndIogWKf4ihEkhd0shBbkGiDX0FETCMKA87AUHDGLuPYY/4FEhmbXLCHiyfNUE2HrKqQmJJrjcy2PplMWXc9lG2Q8lrlXFXTshUzfgPSZJwI19ysDQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Stateful\"\n        title=\"Stateful\"\n        src=\"/static/25cca893f174729314fa4790311f032e/1dda8/stateful.png\"\n        srcset=\"/static/25cca893f174729314fa4790311f032e/27f03/stateful.png 173w,\n/static/25cca893f174729314fa4790311f032e/376d0/stateful.png 345w,\n/static/25cca893f174729314fa4790311f032e/1dda8/stateful.png 690w,\n/static/25cca893f174729314fa4790311f032e/44348/stateful.png 836w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Now if user A's login information is stored on server A, then to authenticate user A, all his/her requests need to be routed to server A. The issue here is that the same client must be routed to the same original server. This leaves us at a disadvantage that prevents us from scaling down or up since the server needs to stay up in-case user A logs back in! This also makes it difficult for us to handle server failures. </p>\n<p>A better approach would be to have <strong>non-sticky</strong> sessions where no user information is stored on ANY server. Instead, user information is kept in shared storage in the <strong>data tier</strong> that allows us to fetch user information whenever he/she logs in. This is called <strong>stateless</strong> architecture:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.33177570093459%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAAB9UlEQVQ4y5WUTY7TMBTHezfEghNwAhasWHCE2XIANkiz4BAjMUJCLKAdzWKKGNKCRjSVmzhJ48n3l+M/tlunSYZqOpYSO37PP//f83MmQgj0m/ke9/+zj22qTdQrSRI4joMoivRk27baWfWq5XkOQgiyLBvYzUMphed5qOt6BwyCAPP5XE5SvYBzrhcZYBiGmE6n8H2/Ax7sAouFBcuyDkDeNCAbF/dxOgjNAKuqwl97jbIsO6BpXI7tDUXI2C7kfi7SoobPYhCHopGbqN1VU6G6AevBhE4PDUKwtEDD2842MUqMI5dGVzraUnFR1TtgmmBFnE7VlkW4W2+Q5IUKpYtG9Z1CAzVqVShxViCIUmQlh8dK1FI0vY/1vDnffj4fAMfgVnDkFbCgt5jZF7gh35DINLaiHaw5qrAP3D2AnxJ8vH6L89kbfJi+xtK/gkqZaPlw82PAA5TrkCzvCmeXz/D++yvZP8fl8nwfanOawm6soDJR29TH9d0FfthfcLP6BDdeoVEKRftEoOzVwaRFBY8yWfQMjKUaVsvCPzmHY5VcjvO6gu36qOR3zZvj/o8pNDeirkrYxN3foId+jwPFsLbKqsEfspWF3uhCHtfeSSHrHO6v1Oy3jxdnnzFb7n4O6qqNfZ8E/GkzvHz3Fb/WbP83Og78BxYKKcHXEJZBAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Stateless\"\n        title=\"Stateless\"\n        src=\"/static/29ff6f7b6691f216093da54a83b4dd87/1dda8/stateless.png\"\n        srcset=\"/static/29ff6f7b6691f216093da54a83b4dd87/27f03/stateless.png 173w,\n/static/29ff6f7b6691f216093da54a83b4dd87/376d0/stateless.png 345w,\n/static/29ff6f7b6691f216093da54a83b4dd87/1dda8/stateless.png 690w,\n/static/29ff6f7b6691f216093da54a83b4dd87/0d271/stateless.png 856w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>As you can see above, our users can be re-directed to ANY server which will then fetch state data from a shared data store. As a result, state data is kept out of web tier which makes our <strong>web tier stateless</strong>. </p>\n<p>Now, our overall picture with a stateless web tier looks like so:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 95.41511771995043%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAADLklEQVQ4y3VUW08TQRTu//MP+AN8Qx+Mf8FnTYzxgQBqjI/GRKPBeMELBFrUaE1FKAW20NLL7G12Z6+z+3nObFsK6Elmd+fMmW+/c61hTsqyRJTlkEmKSBeIco2Q9nFRmsXfidZsaGz5ffF+LcsydLtdZFlqlCPPh+f7CFQEFcdGJxwXNi2+LtMMUxiCxnGkEeTFTFdrt9tYXlrCj2aLGBQIkgw6z7C3uwvLsoxRp9MB27H4dO5HKZI4xXcR4e5RjmcD0tFdAyilRKPRgG07YJ0iV1EWOO71MRqNjFvCtiHGY3YKktxOKRSa7GJd4s/AxpEbVgzZ5fkYaIqPHYRwwwgjqci93MTtxKYwRAkc0vP+nJA3KPRZDPlRFBXdJEkghMDpYAjXddG3JQ4GDlzPw3A0huN6M9tymhjDG7Pv2kx5IWMsK+/auHZ/nX4UI44ipGl6yfYc8JShKYNJDAqirycsNnb6ePpxj9gSS8eBL/0JH+B/RGoTHCPF3GEQ59O7iLO5WptjdZHdGUNUm4Qy93uwCTsaoutYaJ1uQWUx6kfvqZxC7AzrEOEA+YXozLOcAeqSF/Bo+zra4zp2x1/w5NstAvRwb/0qglRgpXEDbbEJbpaxoCRRGJRS/2bI7sZ5ju3OKsbyBH3nAN8O3iJKA2y0nyGIPNQ7r0h/SHUIhCpERIniTrsMOElKQoCCak5RF6g4wVB42LN62PlzSKUTEKMAklryrNFwKUG1f2WK95nOoXhI0PJCH6ejgalDFSTI06pTyjngojjnMkwMWRhEEjsunYCGQ07vnCdNmsBVHoS0iakLJak2A+5p7v3ifNnEuhpTPy0be6fVVOH9WusEPepTbWwKc35kk9tpSKwdWhKxShES+P6hgKShYQAVxY4Z3Vz5iqXVXxj2j9E66OPqnQ283NrHcdeC1RtiYbGO542uYdITAa7cXkXTqgjw2eO1/SmgpiwXWCawz81qZAlX4uGbJtonwlQBZ/PBix/41KwAhR9j4f4HtIg1y+Lrn9ikzjKAPJkjuuB7DmTgm3oMqb58z0YQhmafkhfSd+hHriHAIy6hmPKb8xD6LjQN6b+BA62Ezgtc2AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Overall Stateless\"\n        title=\"Overall Stateless\"\n        src=\"/static/2f1047f1f06cdb62f273283f639467b5/1dda8/overall-stateless.png\"\n        srcset=\"/static/2f1047f1f06cdb62f273283f639467b5/27f03/overall-stateless.png 173w,\n/static/2f1047f1f06cdb62f273283f639467b5/376d0/overall-stateless.png 345w,\n/static/2f1047f1f06cdb62f273283f639467b5/1dda8/overall-stateless.png 690w,\n/static/2f1047f1f06cdb62f273283f639467b5/a0800/overall-stateless.png 807w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>After the state data is moved out of web servers, auto-scaling of the web tier is easily achieved by adding or removing servers based on traffic load. We no longer have to keep servers around unnecessarily since web tier servers contain no state information and can be added/removed based on traffic. </p>\n<h3 id=\"data-centers\"><a href=\"#data-centers\" aria-label=\"data centers permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data Centers</h3>\n<p>Now let's say this is where we are in our journey to build the ultimate fault tolerant website:</p>\n<ul>\n<li>We have CDN setup to deliver static content to our user FAST</li>\n<li>Our web tier lies behind a load balancer that uses one of the algos listed earlier to route requests</li>\n<li>Our web tier is configured to auto-scale</li>\n<li>Our state data is in the data tier</li>\n<li>Our data tier is replicated </li>\n<li>We have cache setup for better response times</li>\n</ul>\n<p>But what if our servers (both in web and data tier) located in the USA east region and there's a power outage that takes down our server farm? Our website would be down as well! How would we go about making sure that our website is immune to such accidents and is still able to load for users that are farther away from us geographically?</p>\n<p>Enter: <strong>multiple data centers</strong></p>\n<p>We'd have multiple data centers with the same setup(architecture) BUT located in geographically separated regions. For example, we could have one data center in Virginia USA and another in Oregon USA. Thinking globally, we can have another in Shanghai and another in London. </p>\n<p>Now, with the introduction of multiple data centers, how do we route our customers' requests? For example, if a user is in Europe, would the request be routed to Oregon data center or London? Obviously London! We'll do that via <strong>geo-routing</strong></p>\n<h3 id=\"data-centers-geo-routing\"><a href=\"#data-centers-geo-routing\" aria-label=\"data centers geo routing permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Data Centers: Geo routing</h3>\n<p>Geolocation routing lets you choose the resources that serve your traffic based on the geographic location of your users, meaning the location that DNS queries originate from. For example, you might want all queries from Europe to be routed to a load balancer in the London region. It allows domain names to be resolved to IP addresses based on the location of a user:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.91796322489392%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAADpUlEQVQ4y21UTW/jVBTtX2PJGo3EGglY8AtYwGZGfGxAgAbEYjZFCM0gRqAixEdVtQxDm06mTZvGTuLYjr+f7cSfiRPHdg732U2mHeZFL/Z7fj6+95xz7856vcbNwdfRPMN8VSCnR1lR1veb65KurxobnB3+F8cxjo+PEYQh8moNNg0QhhEc10VRVYiTFJphgL8SLZYoyhIVTTEtcZaUSIpqC1oDGnT4u91dSLKCNF+Bx+C5DBedDvLlEhPfw1W3W78UE+CM5jxb4E+2wAMlhTRroq42gBw5SZJmE02aOc1wlmFVVnSdI80y5BTVjNLeplkUSOPoRcoc8GUO0zSFbtvQbAcsCDHLlzBdr56259MHyluc3bxfbzjkG5tZEWdF0UThRRk+/P4ZdBZgMU+RUZQvn69ns9lwuAn1lmL0W+ULKE6Iew/PcDmyYFkGfN/fnniVwltR+LKkxaoswF1hu1Nolo1smW9fiohHi9IO4jl41qua5+IW2NY2jkcqCgIMx8VzuYUL9RKuH9S2WXIPktI9UYBuOuiqAlrS39AdBybxHJDlbtKww6XWLROyNEZbOsJnh3fw7dP3oOgKLNPCfLFAREL1+yJ0w8bu6fv4aP91POnvwXWmYGSpav0i9RqQUYS+F+B89C8end7Dz+dfQDEV2BQBB0xmMzCKyGYufnn+NZ25i9bwAI7tw534/wd0iBvLtiglG72rES47EhTFgHkdYZrNCZyEIdChpKNzNoAsG3AcG95kUhsaN1PmgDZ5zyAhRFlGbyjC0CyMhmNSNoLnh1BGGlFgYzTW0B0IkCQVOn2Uef42urpSSorXJR485mCgaHAZI7JVqIYCs1Z6iWkYg5kmxL6CvqjCHOsQhwIGooKxYiGJs60bdrhpRMPB3gmlYVhQLQf75xJ6ilIrmVLNJosMv7WHOBZUOD5DSxjjrzapTj1AGtuIpgmJyqiS4sY2V5qDO58eXFeFg7e+OsK795/gWX9cA86WGe4+bOMNOnNOHP74j4jXPvgdPxz2oLIm5b2WhnfuP204NEjlg5Muvnx8CpWU7QxUvP35Pj5+dEomXmGSziBKMr55fIKjixEZnOHBr228+ckf6FEwfAx0Dz8dXlLp0UImkJ4oQlYk4s4iD+roCj10JQVZntfd5mooQRoRLZqGMXE7kAbo9ESY/qQpxKrk7adJOaUOzTsLm4bwgwAuNViXGuw0ilHyZkG15tOaBRE9vz7D72mP22pTvnz+B1uoiWdxeZnxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Geo DNS\"\n        title=\"Geo DNS\"\n        src=\"/static/45860a658018c819ca58dfa9a6463762/1dda8/geo-dns.png\"\n        srcset=\"/static/45860a658018c819ca58dfa9a6463762/27f03/geo-dns.png 173w,\n/static/45860a658018c819ca58dfa9a6463762/376d0/geo-dns.png 345w,\n/static/45860a658018c819ca58dfa9a6463762/1dda8/geo-dns.png 690w,\n/static/45860a658018c819ca58dfa9a6463762/037d4/geo-dns.png 707w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Now, if the data center closest to the customer is down (due to a natural disaster), requests can then be routed to the second closest data center. In order to make geo routing possible, there're a few things that need to be figured out:</p>\n<ul>\n<li>Traffic redirection: Effective tools are needed to direct traffic to the correct data center. GeoDNS can be used to direct traffic to the nearest data center depending on where a user is located.</li>\n<li>Data synchronization: Users from different regions could use different local databases or caches. In failover cases, traffic might be routed to a data center where data is unavailable. A common strategy is to replicate data across multiple data centers.</li>\n<li>Test and deployment: With multi-data center setup, it is important to test your website/application at different locations. Automated deployment tools are vital to keep services consistent through all the data centers. </li>\n</ul>\n<h3 id=\"decoupling\"><a href=\"#decoupling\" aria-label=\"decoupling permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Decoupling</h3>\n<p>Let's have another look at the system we've designed so far:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 93.91796322489392%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAADpUlEQVQ4y21UTW/jVBTtX2PJGo3EGglY8AtYwGZGfGxAgAbEYjZFCM0gRqAixEdVtQxDm06mTZvGTuLYjr+f7cSfiRPHdg732U2mHeZFL/Z7fj6+95xz7856vcbNwdfRPMN8VSCnR1lR1veb65KurxobnB3+F8cxjo+PEYQh8moNNg0QhhEc10VRVYiTFJphgL8SLZYoyhIVTTEtcZaUSIpqC1oDGnT4u91dSLKCNF+Bx+C5DBedDvLlEhPfw1W3W78UE+CM5jxb4E+2wAMlhTRroq42gBw5SZJmE02aOc1wlmFVVnSdI80y5BTVjNLeplkUSOPoRcoc8GUO0zSFbtvQbAcsCDHLlzBdr56259MHyluc3bxfbzjkG5tZEWdF0UThRRk+/P4ZdBZgMU+RUZQvn69ns9lwuAn1lmL0W+ULKE6Iew/PcDmyYFkGfN/fnniVwltR+LKkxaoswF1hu1Nolo1smW9fiohHi9IO4jl41qua5+IW2NY2jkcqCgIMx8VzuYUL9RKuH9S2WXIPktI9UYBuOuiqAlrS39AdBybxHJDlbtKww6XWLROyNEZbOsJnh3fw7dP3oOgKLNPCfLFAREL1+yJ0w8bu6fv4aP91POnvwXWmYGSpav0i9RqQUYS+F+B89C8end7Dz+dfQDEV2BQBB0xmMzCKyGYufnn+NZ25i9bwAI7tw534/wd0iBvLtiglG72rES47EhTFgHkdYZrNCZyEIdChpKNzNoAsG3AcG95kUhsaN1PmgDZ5zyAhRFlGbyjC0CyMhmNSNoLnh1BGGlFgYzTW0B0IkCQVOn2Uef42urpSSorXJR485mCgaHAZI7JVqIYCs1Z6iWkYg5kmxL6CvqjCHOsQhwIGooKxYiGJs60bdrhpRMPB3gmlYVhQLQf75xJ6ilIrmVLNJosMv7WHOBZUOD5DSxjjrzapTj1AGtuIpgmJyqiS4sY2V5qDO58eXFeFg7e+OsK795/gWX9cA86WGe4+bOMNOnNOHP74j4jXPvgdPxz2oLIm5b2WhnfuP204NEjlg5Muvnx8CpWU7QxUvP35Pj5+dEomXmGSziBKMr55fIKjixEZnOHBr228+ckf6FEwfAx0Dz8dXlLp0UImkJ4oQlYk4s4iD+roCj10JQVZntfd5mooQRoRLZqGMXE7kAbo9ESY/qQpxKrk7adJOaUOzTsLm4bwgwAuNViXGuw0ilHyZkG15tOaBRE9vz7D72mP22pTvnz+B1uoiWdxeZnxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Overall\"\n        title=\"Overall\"\n        src=\"/static/45860a658018c819ca58dfa9a6463762/1dda8/geo-dns.png\"\n        srcset=\"/static/45860a658018c819ca58dfa9a6463762/27f03/geo-dns.png 173w,\n/static/45860a658018c819ca58dfa9a6463762/376d0/geo-dns.png 345w,\n/static/45860a658018c819ca58dfa9a6463762/1dda8/geo-dns.png 690w,\n/static/45860a658018c819ca58dfa9a6463762/037d4/geo-dns.png 707w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>In the system above, we've got our servers receiving requests from the client. Let's assume, our client requests are simple: delivering your dynamic website. The architecture as shown would work perfectly. Now imagine if your website offers another service: processing images and returning the classification of objects found in the image: </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.1875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAACHUlEQVQoz1WP+0tTARTH75/TL2FRgT9ERFAEQpkIEytRqIxI0RQqLZvCaKmbSJq4dLp8DGdaPgh1rnyk+WprRs6FztBYljJyN3fv7h6frg96fA+H7znfc+B8j7Do8zDyzs7wtIPRmdd4VxZxuqeZaH+G4+kTHN021jd9fPNN4l914l/zsLb8AUlcZc07xtSojanxPj7ODqL8+oqQUZSCJieBGsNlMh8eJ6s8mXNZhzDlnqJZn0Ze3lEetWjwtB5gwpLEZI+OoeaLWNuuMvbiGHMdiYy/tfGm+x7jz7MRimovcLMkkc/9ZhqbkrlVf5rsuwexFGnw9T6muvQwWmMqfdpMuorTsVdlUGM8S25JFgP6PLzGEgZsFppaK9AariHcN2q4UnCEEasem/k6xdWp3MhPoLYgCWe3AWvZecoqkym7dAZd4QlM1SexVKZTWJ6OLieNitsp1LXc4WVHM3qzFsE1N8aIvYvJ4S6+eN+zsjTPlKOHGWMpbpOBDccrZj8NUm/Kx9T/gMZ+HSbVTedQA+a2YqqshTTYjZg76+h1tCOwj83AT/6FvCUS9K/vNXE1t4KEQipFImzwY1dC3Cayo0kxvuNHVkOQZQlJkoioi6HQNsFgEFEUCUcUlFgUWZZ3U1IUwmEJJazWorS3p14Iq/2OFpGiKit/He4gEAjgcjpZWFggHov955h4/E+57FvC5XIx73YTjcb2n9ib/wZ7nABvP4yVvQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Image classification\"\n        title=\"Image classification\"\n        src=\"/static/a56a07bbfb940de6c1492366c8cc9d2d/70d1f/image-classification.png\"\n        srcset=\"/static/a56a07bbfb940de6c1492366c8cc9d2d/27f03/image-classification.png 173w,\n/static/a56a07bbfb940de6c1492366c8cc9d2d/376d0/image-classification.png 345w,\n/static/a56a07bbfb940de6c1492366c8cc9d2d/70d1f/image-classification.png 640w\"\n        sizes=\"(max-width: 640px) 100vw, 640px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.kdnuggets.com/2018/09/object-detection-image-classification-yolo.html\">Image Credit</a></p>\n<p>Now the classification process is more time consuming than simply returning an HTML webpage. Your servers that receive request from your client must wait for the processing servers to finish classification and THEN return back to the client. Your client servers are dependent on processing servers. This makes our system tightly coupled. We want to decouple our system so that we can scale up or down our processing servers. This classification process cannot be performed by any of the services we've seen so far:</p>\n<ul>\n<li>CDN: this is only for static content</li>\n<li>Load balancer: Routes your traffic</li>\n<li>Cache: Prevents multiple hits to the database</li>\n</ul>\n<p> We need something else! Enter: <strong>message queues</strong></p>\n<h3 id=\"decoupling-message-queues\"><a href=\"#decoupling-message-queues\" aria-label=\"decoupling message queues permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Decoupling: Message Queues</h3>\n<p>A message queue is a durable component, stored in memory, that supports asynchronous communication. It serves as a buffer and distributes asynchronous requests. The basic architecture of a message queue is simple. Input services, called producers/publishers, create messages, and publish them to a message queue. Other services or servers, called consumers/subscribers, connect to the queue, and perform actions defined by the messages. We'll add these queues to the datacenter.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.1830985915493%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAA70lEQVQI1x3PT0vCcADG8Z26BdEL6aVEly5BvYeOdSqKiqC6dAi6KJFCTXYIvVhEYZA5y5gOc3OjxbTf3OjvQtT2be25fE4PPI9UbnZZOa6wLT+wmlHJlQyi0YDRcID/2adi9KjZAfeWn+i9hzjuK8IPSBV1ltNl1rIqS6lbSnUXaUfRGJvNMrWYZ2JeZnr9HOF5vHQE13qXw+ITR1dt0pdmomYLbMch8AUzGxdMLuTiboHxuVO25EcktSXYPKmyf6YlK5Ubk//8RhFv332az4JG20W3OphuQO8j5Cv8YRg/yN9Z7Co1Dgp19mKrhuAPHU7FYffI9wUAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"MQ\"\n        title=\"MQ\"\n        src=\"/static/a5618acc88ba077ddae0db18c3b8924f/1dda8/message-queue.png\"\n        srcset=\"/static/a5618acc88ba077ddae0db18c3b8924f/27f03/message-queue.png 173w,\n/static/a5618acc88ba077ddae0db18c3b8924f/376d0/message-queue.png 345w,\n/static/a5618acc88ba077ddae0db18c3b8924f/1dda8/message-queue.png 690w,\n/static/a5618acc88ba077ddae0db18c3b8924f/8551f/message-queue.png 710w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Decoupling makes the message queue a preferred architecture for building a scalable and reliable application. With the message queue, the producer can post a message to the queue when the consumer is unavailable to process it. The consumer can read messages from the queue even when the producer is unavailable. If the number of messages in our queue reach a certain threshold, we can increase the size of our processing cluster to quickly process the classification requests. Once the requests are no more, we can scale down our processing cluster:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.10984308131241%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsSAAALEgHS3X78AAABEElEQVQY03WPy0rDUBiE83Y+hhvfxUeoS1/ArNSNKFhKVOgFLVJKa5u0mzYnNZfmck4u/Tw5pdCNA8P8/PPDzG/NgjFTMULVDQaHw5Eald6pskZVR5725wiygO/NG1GRGNvqOFd0nEuWwYx9XjN3PfxdSJIr7vsud+9L7A+Xh4HHbyoRYaRvVlpDfQ+Pkxuuny9wXNsEWN2JTW9qI1KhGx0opNJas89ynG+Pl9GS10+P3tg1QWVZkmaZbq6QFQzdLk9ft8zFmLa/tdtlCH9Poar2X137+FaR58RxRJIkWmOiSM9azyGlxBfaCyVhnFFWJZYIfLbbDWmamqOmaQz/w8lvg9u26/WKwbDPYvFjAv4AAb94DLb+o7QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"MQ2\"\n        title=\"MQ2\"\n        src=\"/static/e08f8f7fc639119e97b4b7308384709f/1dda8/message-queue-2.png\"\n        srcset=\"/static/e08f8f7fc639119e97b4b7308384709f/27f03/message-queue-2.png 173w,\n/static/e08f8f7fc639119e97b4b7308384709f/376d0/message-queue-2.png 345w,\n/static/e08f8f7fc639119e97b4b7308384709f/1dda8/message-queue-2.png 690w,\n/static/e08f8f7fc639119e97b4b7308384709f/48606/message-queue-2.png 701w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Here's the architecture (with only a single data center shown - in reality you'll have multiple data centers):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 108.95104895104896%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAADhElEQVQ4y21VS4/bVBTur+M/8AfKDrGBHSzYwY4FEiMWRakQLHgKqa1QowpVpc2MoJkyzaSTlz2JPbav7etHnPj98V13nHiaudKRz334u9855/PxHXDUdY3uUPOKz5JPZUVVoeIRZcpX+61131HjTuuoZxiGqMoSJeeG6yHcbLHOcmzLCm4YwYsiJEWJTVHsgKKiQlZWO4wdoOu66PV6OP3vDHGaI+OLwrbwajhs9i91DfPptPG99QbZNoUebHCk53hg83z1DsMsyzAejxuWOTdTLvtktbJsbMjS9ny4MkDKkGPO1XsFz8yFhBEme4a35XCbphBBAJsAwWbTrFn0PRU2TeVxnzzl14chN4VQCVeA2y0CAm7XEc51gd8HGgIChYHEOo5vFKW+htsVZc/wJst2nEw9fPLdAI7w4AqHl6UHiuj6e4a0NM8by1lEZdtMzTME63WznjV7yorGqk507dgBRkmClWnC8QP8PX2EwewxBH1fSng0yXANx8XSEo0ZtovgOvwbOsR1HoI4QhyusbAv8NXT93H0/C5m5oyhsjjCxerKwU9Px+j1X+N+/wwPjidwWPm2QJ0ctoAxkx7h0l7i8csf8WT4C32DDEN4vg+HQh+OJnjx8jWOhyNczJeQSmJluQOsuwzDeA0p/QZAWzqYzUxcGQK2KeBYLnyyiSgdyxbUqqp2iCAKdwyr66rfAAwpFYfhWUJgRabCUUCS1fVgGQ7BHSwWFsyVaOYWL9tsM9TlXpc7QMmQTYa1dByyJLAvoNmXEErcvCgIaVGM+ZUO3VrC8wII10dKwKnu4ds/3yBJi32VDYb6xc//4o/BlE0gwJe/DfHrszeQ9FXyVX51e4F7g49w7/hjmMJsxK7GzArx4Td/USnZW0AFKcjwfv8cH3z9DDrD7vVHeO+zhzh6dIYkYb4k2VkX+H7wKX44+RxLW2MuY373FXL2gYD5R1fYNm/T9QVOR2No1FkUS/QHZ3h4MkHMAkhq0fUlVoYNy/GbtEimIu/kr+4KO0kzrFTyPQ8eD1oM0/JcFits5OFzrTWPIleCD5N9l6l3Ve6IsiT9gjem/O7yrGD7SgiWIE3zt2vUXNfqd77ng27TnpBOBG1iYEWJNDa3EAebw87R+Q3c+gtofceUOP3nHJORhvNXs8Yi/zC8+rbm0G097YZnB1guTBjaVWMrzeRXsj44d9v4H80RjwPyAdNFAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Decoupled\"\n        title=\"Decoupled\"\n        src=\"/static/1a67f0249b4bc12727b7b34cd7c507cc/1dda8/decoupled.png\"\n        srcset=\"/static/1a67f0249b4bc12727b7b34cd7c507cc/27f03/decoupled.png 173w,\n/static/1a67f0249b4bc12727b7b34cd7c507cc/376d0/decoupled.png 345w,\n/static/1a67f0249b4bc12727b7b34cd7c507cc/1dda8/decoupled.png 690w,\n/static/1a67f0249b4bc12727b7b34cd7c507cc/c79eb/decoupled.png 715w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Having said that, here's a summary of techniques we've talked about:</p>\n<ul>\n<li>Keep web tier stateless</li>\n<li>Build redundancy at every tier</li>\n<li>Cache data as much as you can</li>\n<li>Support multiple data centers</li>\n<li>Host static assets in CDN</li>\n<li>Scale your data tier by sharding</li>\n<li>Split tiers into individual services</li>\n<li>Monitor your system and use automation tools</li>\n</ul>\n<h3 id=\"generating-unique-ids-in-a-distributed-env\"><a href=\"#generating-unique-ids-in-a-distributed-env\" aria-label=\"generating unique ids in a distributed env permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Generating Unique IDs in a distributed Env</h3>\n<p>Say you're given a distributed system and are asked to come up with a function to generate a globally unique ID for this system. On a single machine, this is simple, you just auto-increment an ID in your DB and you have a unique ID on each call. However, this isn't possible if you have a distributed system with multiple machines and multiple partitions.</p>\n<ul>\n<li><strong>Requirements</strong></li>\n<li>The ID should be unique across EVERY call and EVERY machine.</li>\n<li>It should consist of numerical values only</li>\n<li>It should fit into 64-bit</li>\n<li>Should be able to generate over 10,000 unique IDs/sec</li>\n</ul>\n<p>First thing that comes to mind is to use UUID that can be generated independently without coordination between servers. However, UUIDs are 128 bits long and are non-numeric: Example: 09c93e62-50b4-468d-bf8a-c07e1040bfb2. </p>\n<p>Another thing that can be done is to have a centralized generator. Every time you need to generate a new ID, this centralized generator is called. The issue here is that this is a single point of failure and is not scalable. It definitely won't be able to handle 10,000 unique IDs/sec. </p>\n<p>How about we just use time as the id? Hmm, ok so if I have distributed environment, it is possible that two different nodes are called at the same time to generate the id. Even if they're not, different nodes might have different clocks that might result in collisions. </p>\n<p>But the idea of using time does look promising ie using epoch time. Now to make it unique, we can add in the IP address of the server. So, we might be able to concatenate the IP address of the server with the epoch time and get a unique id right? Well, what if we invoke this function in the same microsecond on the same server? That would cause a collision!  Maybe we can use a counter that gets incremented every time this function is called. So something like: <code class=\"language-cpptext\">epochTime_serverID_counter</code>. Hmm, this would work!</p>\n<p>But wait a second, what if the machine reboots? What if it crashes, has to re-boot and then start generating unique ids again. Since the machine crashed, our counter would reset to 0. Maybe we can store this counter somewhere and have the server read it from there on restart. And every time it is incremented, we can push the counter value to this store! This sounds like a job for Redis! Yup, that would work. So, our unique ID would be: <code class=\"language-cpptext\">epochTime_serverID_counter</code></p>\n<ul>\n<li><strong>Approach</strong>\nOk, so we've deiced to have the unique ID like so: <code class=\"language-cpptext\">epochTime_serverID_counter</code>. Now, we can have up to 64 bits in the id. Epoch time takes 41 bits. How do I know that? Convert an epoch time value to binary and count the number of bits. For example,  epoch time 1288834974657 converted to binary is:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cppcpp\"><code class=\"language-cppcpp\"><span class=\"token number\">0</span>       epoch time                      <span class=\"token number\">40</span>\n<span class=\"token number\">10010110000010100100011010000001111000001</span></code></pre></div>\n<p>We're still left with 23 bits. For the sake of having a more robust id, we can add the datacenter id to the unique ID as well! So our unique ID would be:</p>\n<p><code class=\"language-cpptext\">epochTime_dataCenterID_serverID_counter</code></p>\n<p>Alright, so we've got 41 bits for epoch time. Next up, we can use 5 bits for our dataCenterID. This would result in a total of 32 data centers because <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>5</mn></msup><mo>=</mo><mn>32</mn></mrow><annotation encoding=\"application/x-tex\">2^5 = 32</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">5</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">3</span><span class=\"mord\">2</span></span></span></span>. Our ID now is:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cppcpp\"><code class=\"language-cppcpp\"><span class=\"token number\">0</span>       epoch time                     <span class=\"token number\">40</span>   <span class=\"token number\">44</span> \n<span class=\"token number\">1001011000001010010001101000000111100000100001</span>\n                                        dcID</code></pre></div>\n<p>Next, we add serverId which we can have a bit longer, say 6 bits meaning we can have 64 servers in a datacenter:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cppcpp\"><code class=\"language-cppcpp\"><span class=\"token number\">0</span>       epoch time                     <span class=\"token number\">40</span>   <span class=\"token number\">44</span>    <span class=\"token number\">45</span> \n<span class=\"token number\">1001011000001010010001101000000111100000100001000001</span>\n                                        dcID serverID</code></pre></div>\n<p>and finally the remaining bits can be the counter value meaning <span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>1</mn></msup><mn>9</mn></mrow><annotation encoding=\"application/x-tex\">2^19</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8141079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span><span class=\"mord\">9</span></span></span></span> giving us a total of 524288 per machine:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cppcpp\"><code class=\"language-cppcpp\"><span class=\"token number\">0</span>       epoch time                     <span class=\"token number\">40</span>   <span class=\"token number\">44</span>    <span class=\"token number\">45</span>   counter       <span class=\"token number\">64</span>\n<span class=\"token number\">10010110000010100100011010000001111000001000010000010000000000000000001</span>\n                                        dcID serverID</code></pre></div>\n<p>Check Twitter blog <a href=\"https://blog.twitter.com/engineering/en_us/a/2010/announcing-snowflake.html\">here</a></p>\n<h3 id=\"back-of-the-envelope-estimation\"><a href=\"#back-of-the-envelope-estimation\" aria-label=\"back of the envelope estimation permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Back of the envelope Estimation</h3>\n<p>Below is a table explaining the data volume unit </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.88431876606684%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABR0lEQVQoz2XSh47DMAwD0Pz/R7bonuneS8UToOAODWDYoUWKYtKMRqOYz+dxuVzier3mPplMYjwe5z6dTmO1WuUO22w2cbvd4ng8Bi58sVgk93A4RLNer/Py9XrF+/2Ox+MRsP1+nwW73a47q0P8fD4put1uuzvY+XyORof7/d4tBI6Gw2E6QrTU9Xq9dPh8PpPsniAzuOmQXWPWyKfTKQXbtk13cM4KI1Ajw4gUV30jPx2Nazkvl8t0ZHyj2JErb45gzhqowc2RZ7PZj0OFljOs3KiVbznUmKCaziEnXior5/q6mshGZ9HIlQh31diHqfy7DEsMSETwnCCVYGFcFMZ11fwT1FF2FmEkTriVTWEcEYa5c2YAT67EG0H/HVkBol+i3+9nEUwEg8EgykD9Nj8jC9XjS3l0UlxBwzmod009RGuC4nr/Ap1CS9xeuDqYAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Power of Two\"\n        title=\"Power of Two\"\n        src=\"/static/fc08d92bfc92d5aecf388f5ebaef136b/1dda8/power-of-two.png\"\n        srcset=\"/static/fc08d92bfc92d5aecf388f5ebaef136b/27f03/power-of-two.png 173w,\n/static/fc08d92bfc92d5aecf388f5ebaef136b/376d0/power-of-two.png 345w,\n/static/fc08d92bfc92d5aecf388f5ebaef136b/1dda8/power-of-two.png 690w,\n/static/fc08d92bfc92d5aecf388f5ebaef136b/4fa3d/power-of-two.png 778w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<p>Some common facts: </p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-cpptext\"><code class=\"language-cpptext\">               • Memory is fast but the disk is slow.\n               • Avoid disk seeks if possible.\n               • Simple compression algorithms are fast.\n               • Compress data before sending it over the internet if possible.\n               • Data centers are usually in different regionsundefined and it takes time to send data between them.\n               </code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 550px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.272727272727273%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAGABQDASIAAhEBAxEB/8QAFQABAQAAAAAAAAAAAAAAAAAAAAX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAGwAD//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAEFAn//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAQ/9oACAEBAAY/An//xAAWEAEBAQAAAAAAAAAAAAAAAAAAIRH/2gAIAQEAAT8hiNf/2gAMAwEAAgADAAAAEAAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGhAAAgIDAAAAAAAAAAAAAAAAAAERQSFhof/aAAgBAQABPxCbK8myGirh/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Power of Ten\"\n        title=\"Power of Ten\"\n        src=\"/static/a68ec88b918976a97c85a9df1a08b912/c603d/powers_of_10.jpg\"\n        srcset=\"/static/a68ec88b918976a97c85a9df1a08b912/6bc31/powers_of_10.jpg 173w,\n/static/a68ec88b918976a97c85a9df1a08b912/89707/powers_of_10.jpg 345w,\n/static/a68ec88b918976a97c85a9df1a08b912/c603d/powers_of_10.jpg 550w\"\n        sizes=\"(max-width: 550px) 100vw, 550px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://www.amazon.com/System-Design-Interview-insiders-Second/dp/B08CMF2CQF\">Image Credit</a></p>\n<ul>\n<li>Single Character requires 1 byte</li>\n<li>Integer requires 4 bytes </li>\n<li>Media requires 1 MB </li>\n</ul>\n<p>For variable length strings, we need this calculation to determine the number of bytes needed:</p>\n<span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mtext>Total size (in Bytes)</mtext><mo>=</mo><mo stretchy=\"false\">(</mo><mo stretchy=\"false\">(</mo><mtext>Number of bits used to encode a single character</mtext><mo stretchy=\"false\">)</mo><mo>∗</mo><mo stretchy=\"false\">(</mo><mtext>Number of characters</mtext><mo stretchy=\"false\">)</mo><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mn>8</mn></mrow><annotation encoding=\"application/x-tex\">\\textrm{Total size (in Bytes)} = ((\\textrm{Number of bits used to encode a single character}) * (\\textrm{Number of characters}))/8</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord text\"><span class=\"mord textrm\">Total size (in Bytes)</span></span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord textrm\">Number of bits used to encode a single character</span></span><span class=\"mclose\">)</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord text\"><span class=\"mord textrm\">Number of characters</span></span><span class=\"mclose\">)</span><span class=\"mclose\">)</span><span class=\"mord\">/</span><span class=\"mord\">8</span></span></span></span></span>\n<p>If we are using ASCII encoding, we need 8 bits to encode each character, so Number of bits used to encode a single character = 8\nIf we are using UNICODE encoding, we need 16 bits to encode each character, so Number of bits used to encode a single character = 16.</p>\n<h3 id=\"storing-images\"><a href=\"#storing-images\" aria-label=\"storing images permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Storing Images</h3>\n<p>Say, for example, that you're creating an image sharing system (instagram like service) and need to store images for your service. How/where would you store them? You have 2 options: use a DB and store images as blob (binary large object) or use a distributed file system and have a DB store location of images for each user. Let's have a look at the pros and cons for each:</p>\n<p><strong>Why DB</strong></p>\n<ul>\n<li>DB is ACID (Atomicity, Consistency, Isolation, Durability) compliant</li>\n<li>DB provides data integrity between the file and its metadata (Files can be deleted from FS causing database integrity to be compromised.)</li>\n<li>Much easier to perform backups as the entire process is built-in</li>\n<li>Database indexes perform better than file system trees when more number of items are to be stored</li>\n<li>File deletion and updates becomes simpler as opposed to a File System.( In the case of FS, we first delete the mapping from DB and then delete the image from FS as well. There’s this extra overhead to make sure that the file in FS is deleted. In DB this operation is atomic)</li>\n</ul>\n<p><strong>Why DFS</strong></p>\n<ul>\n<li>If your application uploads a large number of high-quality images, your DB backups become huge, which can have a significant impact on the makes replication speed</li>\n<li>FS can be accessed via a CDN without allowing the user’s request to go through your Application and Database layers</li>\n<li>Needless to say, this will be cost-effective as compared to DB</li>\n<li>Easier in cases where files has to be shared with third-party providers</li>\n<li>Storing/retrieving BLOB in DB is a heavy process</li>\n<li>For the application in which the images will be used requires streaming performance, such as real-time video playback</li>\n</ul>\n<p>The case against DB is that for images, we aren't ever going to use ACID properties (those are for financial transactions etc). DFS is cheaper as compared to a DB, it is faster and a DFS can make use of a CDN to render our images for us. </p>\n<h3 id=\"allowing-users-to-chat\"><a href=\"#allowing-users-to-chat\" aria-label=\"allowing users to chat permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Allowing users to Chat</h3>\n<p>XMPP, an Extensible Messaging and Presence Protocol, helps to build a real time chat application. XMPP provides an open and decentralized instant messaging services. As the name indicates, it is a highly extendable protocol formerly known as Jabber protocol. To exchange the information, XMPP uses Extensible Markup language (XML) as the base format. XMPP uses the TCP protocol to maintain connections between 2 clients.</p>\n<p>A simple XMPP architecture consists of a server and two clients. Every client acts as the part of a common domain where the servers can also communicate for the purpose of routing between domains.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 690px;\"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 21.828103683492497%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsSAAALEgHS3X78AAABHElEQVQY0z2OvS8DcQCG7/+RGOzCYGDqYjR169SFpaE0iEGEsmAqA5KLNNEw2NQgEQYf1Wuid9dWEySuX7nf/e7z0Tbh2d43eZ+8ShRFNJtN3soahmlSq9eAiD9a7TbVqk690SAMg//eEYKyVkHXDXTDGOYBys2HT7zQIZn/IXlmEd9vod55Q6lqBaRNwbLWZqnUYeFFUukGuH5EqihIDDaqRSJnkTqx6dgRytGzx8ieIHboML0lGE3arBw7fWHAoukSK0nmXl1mHyVj1w7FT4+u8BnPCaYOHGaygsmMzcS84MsKUR76D9NXkvULyca5JJ1zuL73hvcvv302qy477y7bmsvak8TohfhBxO6tJFPo7/KS1VOHrCrpiYhfp1cQ9pmr6UAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"XMPP\"\n        title=\"XMPP\"\n        src=\"/static/d527af46a6735b6995513f73acaafa7a/1dda8/xmpp.png\"\n        srcset=\"/static/d527af46a6735b6995513f73acaafa7a/27f03/xmpp.png 173w,\n/static/d527af46a6735b6995513f73acaafa7a/376d0/xmpp.png 345w,\n/static/d527af46a6735b6995513f73acaafa7a/1dda8/xmpp.png 690w,\n/static/d527af46a6735b6995513f73acaafa7a/e558e/xmpp.png 733w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span> <a href=\"https://blog.mirrorfly.com/xmpp-use-cases-for-scalable-chat-platform/\">Image Credit</a></p>\n<p>XMPP protocol is a great fit for Real-Time Web applications like Live News, Interactive web page, web games and web chat. It provides an inbuilt security with multiple layers. Moreover, here the users need to authenticate both host servers as well as messages to prevent the risk of spoofing. Eventually, it eradicates the fear of spamming. Now, when you use XMPP in a chat service, you need to able to keep track of the user ids and connection ids that are being used by each user. To do so, you can have a <strong>connection service</strong> that maintains this information for you:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 664px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e23888c3ea53e52a0b07e60826e00e85/32c46/chat.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.50602409638555%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABBUlEQVQoz42S2wqDQAxE+///55MPoogi3u93U05KZFta6MIQdzeZmcR9HMch53kK0WB74nVdN2zv3n/Gx7cLsO+79H0vXde9oW1bGcfxqwGghNu2KQGRPWueZ4XrkGVCRmC1t8N1XSXPcwmCQNI0laqqlKiua3XEGoZBz6ZpUmIIqUuSRBHHsWRZ9iKEnRZIonBZFlUMw1B839cWEWmaRkUo4qwsSyUhDxRF8WqZBFvuwEnAsY3AzcEA7hGKokhd2hjUobWDOwhxShue5+k43J+DO/bMjjwT4U4JOaQIN0QKIEfI4P5RF9SaEDU6Q9wxH8AFyu4z+Hyjv56Lfd/v0MUvgn/wBCdhCsChC885AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Chat\"\n        title=\"Chat\"\n        src=\"/static/e23888c3ea53e52a0b07e60826e00e85/32c46/chat.png\"\n        srcset=\"/static/e23888c3ea53e52a0b07e60826e00e85/27f03/chat.png 173w,\n/static/e23888c3ea53e52a0b07e60826e00e85/376d0/chat.png 345w,\n/static/e23888c3ea53e52a0b07e60826e00e85/32c46/chat.png 664w\"\n        sizes=\"(max-width: 664px) 100vw, 664px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3 id=\"useful-architectures\"><a href=\"#useful-architectures\" aria-label=\"useful architectures permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Useful architectures</h3>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/whitepapers/latest/best-practices-wordpress/reference-architecture.html\">WordPress on AWS</a></li>\n<li><a href=\"https://netflixtechblog.com/active-active-for-multi-regional-resiliency-c47719f6685b\">Netflix active-active</a></li>\n</ul>","timeToRead":86,"excerpt":"Microservice Architecture Service Challenges IPC Message Formats Communication Using RPI REST: Pros vs Cons gRPC Services: Service discovery…","frontmatter":{"title":"Data System Design","date":"2020-05-14T00:00:00.000Z","categories":["System Design"],"extract":"Data system design","thumbnail":"/post-images/system-design.png","tags":["Data system design"]},"fields":{"slug":"/data-system-design","date":"May 14, 2020"}}},"pageContext":{"slug":"/data-system-design","nexttitle":"Quick Sort","nextslug":"/quick-sort","prevtitle":"TODO Problems","prevslug":"/todo-problems"}}}