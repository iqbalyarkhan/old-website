{"componentChunkName":"component---src-templates-post-js","path":"/aws-sqs","result":{"data":{"markdownRemark":{"html":"<h3 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h3>\n<ul>\n<li><a href=\"#what-is-sqs\">What is SQS?</a></li>\n<li><a href=\"#what-is-poll-based-messaging\">What is poll-based messaging?</a></li>\n<li><a href=\"#queue-types\">Queue Types</a>\n<ul>\n<li><a href=\"#standard-queue\">Standard queue</a></li>\n<li><a href=\"#fifo-queue\">FIFO Queue</a></li>\n</ul>\n</li>\n<li><a href=\"#settings\">Settings</a>\n<ul>\n<li><a href=\"#access-policy\">Access Policy</a></li>\n<li><a href=\"#visibility-timeouts\">Visibility Timeouts</a></li>\n<li><a href=\"#delay-queues\">Delay Queues</a></li>\n<li><a href=\"#message-size\">Message Size</a></li>\n<li><a href=\"#encryption\">Encryption</a></li>\n<li><a href=\"#message-retention\">Message Retention</a></li>\n<li><a href=\"#polling\">Polling</a></li>\n<li><a href=\"#queue-depth\">Queue Depth</a></li>\n<li><a href=\"#receive-message-wait-time\">Receive Message Wait Time</a></li>\n<li><a href=\"#redrive-allow-policy\">Redrive allow policy</a></li>\n<li><a href=\"#dead-letter-queue\">Dead Letter Queue</a></li>\n<li><a href=\"#maximum-receives\">Maximum Receives</a></li>\n</ul>\n</li>\n<li><a href=\"#dlq-and-sqs-demo\">DLQ and SQS Demo</a></li>\n<li><a href=\"#conclusion\">Conclusion</a></li>\n</ul>\n<h2 id=\"what-is-sqs\" style=\"position:relative;\"><a href=\"#what-is-sqs\" aria-label=\"what is sqs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is <a href=\"https://docs.aws.amazon.com/AWSSimpleQueueService/latest/SQSDeveloperGuide/welcome.html\">SQS?</a></h2>\n<p>Amazon Simple Queue Service (Amazon SQS) offers a secure, durable, and available hosted queue that lets you integrate and decouple distributed software systems and components.SQS is a messaging queue that allows asynchronous processing of work. One resource will write a message to an SQS queue and another resrouce will retrieve that message from SQS.</p>\n<p>The word asynchronous in the definition above allows us to decouple our frontend servers and backend servers with SQS queue serving as an intermediary. This means that if our backends are not ready to respond to that message, they don't have to and the message from the frontend won't be lost. It'll stay in SQS until processed.</p>\n<p>Amazon SQS offers common constructs such as dead-letter queues and cost allocation tags. It provides a generic web services API that you can access using any programming language that the AWS SDK supports. Amazon SQS supports both standard and FIFO queues.</p>\n<h2 id=\"what-is-poll-based-messaging\" style=\"position:relative;\"><a href=\"#what-is-poll-based-messaging\" aria-label=\"what is poll based messaging permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is poll-based messaging?</h2>\n<p>Poll based messaging is when the consumer (person/service receiving our messages) regularly polls our consumer (by checking the message queue or a mailbox!) to determine if there're any messages from the producer that need to be processed.</p>\n<h2 id=\"queue-types\" style=\"position:relative;\"><a href=\"#queue-types\" aria-label=\"queue types permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Queue Types</h2>\n<p>Let's look at the queue types provided by AWS SQS: standard and FIFO.</p>\n<h3 id=\"standard-queue\" style=\"position:relative;\"><a href=\"#standard-queue\" aria-label=\"standard queue permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Standard queue</h3>\n<p><strong>Unlimited Throughput</strong> – Standard queues support a nearly unlimited number of API calls per second, per API action (SendMessage, ReceiveMessage, or DeleteMessage).</p>\n<p><strong>At-Least-Once Delivery</strong> – A message is delivered at least once, but occasionally more than one copy of a message is delivered.</p>\n<p><strong>Best-Effort Ordering</strong> – Occasionally, messages are delivered in an order different from which they were sent.</p>\n<p>For example, if your incoming messages are labelled as <code class=\"language-cpptext\">1,2,3,4,5</code> , they might be delivered in the order <code class=\"language-cpptext\">1,2,5,3,3,4</code>. Notice the duplicate in there</p>\n<p>Send data between applications when the throughput is important, for example:</p>\n<ul>\n<li>\n<p>Decouple live user requests from intensive background work: let users upload media while resizing or encoding it.</p>\n</li>\n<li>\n<p>Allocate tasks to multiple worker nodes: process a high number of credit card validation requests.</p>\n</li>\n<li>\n<p>Batch messages for future processing: schedule multiple entries to be added to a database.</p>\n</li>\n</ul>\n<h3 id=\"fifo-queue\" style=\"position:relative;\"><a href=\"#fifo-queue\" aria-label=\"fifo queue permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FIFO Queue</h3>\n<p><strong>High Throughput</strong> – If you use batching, FIFO queues support up to 3,000 messages per second, per API method (SendMessageBatch, ReceiveMessage, or DeleteMessageBatch). The 3000 messages per second represent 300 API calls, each with a batch of 10 messages. To request a quota increase, submit a support request. Without batching, FIFO queues support up to 300 API calls per second, per API method (SendMessage, ReceiveMessage, or DeleteMessage).</p>\n<p><strong>Exactly-Once Processing</strong> – A message is delivered once and remains available until a consumer processes and deletes it. Duplicates aren't introduced into the queue.</p>\n<p><strong>First-In-First-Out Delivery</strong> – The order in which messages are sent and received is strictly preserved.</p>\n<p>For example, if your incoming messages are labelled as <code class=\"language-cpptext\">1,2,3,4,5</code> , they'll definitely be delivered in the order <code class=\"language-cpptext\">1,2,3,4,5</code>. Notice the perfect ordering and exactly once processing.</p>\n<p>Send data between applications when the order of events is important, for example:</p>\n<ul>\n<li>\n<p>Make sure that user-entered commands are run in the right order.</p>\n</li>\n<li>\n<p>Display the correct product price by sending price modifications in the right order.</p>\n</li>\n<li>\n<p>Prevent a student from enrolling in a course before registering for an account.</p>\n</li>\n</ul>\n<p>For your fifo Q, you have 2 important fields:</p>\n<ul>\n<li>Message group ID</li>\n</ul>\n<p>This is the group within which deduplication will occurr</p>\n<ul>\n<li>Message deduplication ID</li>\n</ul>\n<p>This is the token that'll be used for deduplication of messages within the deduplication interval. The interval is set to 5 minutes.</p>\n<h2 id=\"settings\" style=\"position:relative;\"><a href=\"#settings\" aria-label=\"settings permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Settings</h2>\n<p>There're a few important settings that we need to be aware of while using SQS:</p>\n<h3 id=\"access-policy\" style=\"position:relative;\"><a href=\"#access-policy\" aria-label=\"access policy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Access Policy</h3>\n<p>The access policy defines the accounts, users and roles that can access this queue, and the actions that are allowed. You can configure basic and advanced settings.</p>\n<p>In the basic settings, you configure who can send messages to the queue, and who can receive messages from the queue. The read-only JSON panel displays the resulting access policy for the queue. By default, only the queue owner can send and receive messages.</p>\n<p>In the advanced settings, you modify the JSON access policy directly. This allows you to specify a custom set of actions that each principal (account, user or role) can perform.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-cppjson\"><code class=\"language-cppjson\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2008-10-17\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"__default_policy_ID\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"Sid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"__owner_statement\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Principal\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"AWS\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"123456789\"</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token string\">\"SQS:*\"</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"arn:aws:sqs:us-east-1:123456789:\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"visibility-timeouts\" style=\"position:relative;\"><a href=\"#visibility-timeouts\" aria-label=\"visibility timeouts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Visibility Timeouts</h3>\n<p>When a consumer receives and processes a message from a queue, the message remains in the queue. Amazon SQS doesn't automatically delete the message. Because Amazon SQS is a distributed system, there's no guarantee that the consumer actually receives the message (for example, due to a connectivity issue, or due to an issue in the consumer application). Thus, the consumer must delete the message from the queue after receiving and processing it.</p>\n<p>Immediately after a message is received by the consumer, it remains in the queue. To prevent other consumers from processing the message again, Amazon SQS sets a visibility timeout, a period of time during which Amazon SQS prevents other consumers from receiving and processing the message. The default visibility timeout for a message is 30 seconds. The minimum is 0 seconds. The maximum is 12 hours.</p>\n<p>As soon as the consumer takes the message from SQS queue, SQS adds a lock to the message. Lock remains in place for the duration of visibility timeout. During this period, message stays in the queue but isn't visible to other consumers. Before that timeout expires, the consumer needs to finish processing the message and send an OK response back to SQS saying that it was successfully processed. If message is processed before timeout expires, message is purged from the queue. If message is NOT processed before timeout expires, message re-appears in the queue and is available for other consumers to process.</p>\n<h3 id=\"delay-queues\" style=\"position:relative;\"><a href=\"#delay-queues\" aria-label=\"delay queues permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Delay Queues</h3>\n<p>Delay queues let you postpone the delivery of new messages to a queue for a number of seconds, for example, when your consumer application needs additional time to process messages. If you create a delay queue, any messages that you send to the queue remain invisible to consumers for the duration of the delay period. The default (minimum) delay for a queue is 0 seconds. The maximum is 15 minutes.</p>\n<p>Delay queues are similar to visibility timeouts because both features make messages unavailable to consumers for a specific period of time. The difference between the two is that, for delay queues, a message is hidden when it is first added to queue, whereas for visibility timeouts a message is hidden only after it is consumed from the queue.</p>\n<p>To set delay seconds on individual messages, rather than on an entire queue, use message timers to allow Amazon SQS to use the message timer's DelaySeconds value instead of the delay queue's DelaySeconds value.</p>\n<h3 id=\"message-size\" style=\"position:relative;\"><a href=\"#message-size\" aria-label=\"message size permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Message Size</h3>\n<p>Messages can be up to 256KB of text in any format.</p>\n<h3 id=\"encryption\" style=\"position:relative;\"><a href=\"#encryption\" aria-label=\"encryption permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Encryption</h3>\n<p>Messages are encrypted in transit by default but are not encrypted at rest by default. You can enable encryption at rest easily!</p>\n<p>When you enable server-side encrpytion (SSE), Amazon SQS encrypts all messages that are sent to this queue. The messages are stored in encrypted form and Amazon SQS decrypts a message only when it is sent to an authorized consumer. SSE encrypts the body of the message, but doesn't encrypt the following fields:</p>\n<p>Queue metadata (queue name and attributes)\nMessage metadata (message ID, timestamp, and attributes)\nPer-queue metrics\nA message is encrypted only if it is sent after the encryption of a queue is enabled. Amazon SQS doesn't encrypt backlogged messages. Any encrypted message remains encrypted even if the queue encryption is disabled.</p>\n<p>When Amazon SQS moves a message from an encrypted source queue to an unencrypted dead-letter queue, the message remains encrypted.</p>\n<h3 id=\"message-retention\" style=\"position:relative;\"><a href=\"#message-retention\" aria-label=\"message retention permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Message Retention</h3>\n<p>Messages will not live in SQS forever. Default is 4 days but can be set between 1 minute and 14 days. After the window expires, messages are purged from that queue.</p>\n<h3 id=\"polling\" style=\"position:relative;\"><a href=\"#polling\" aria-label=\"polling permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Polling</h3>\n<p>By default, SQS has short polling enabled: consumers connect, check for messages and disconnect. Long polling is when the conenction between SQS queue and consumers stay alive for a longer period. Since API calls to SQS are not free, short polling can become expensive. However, you can specify the connection to use long-polling.</p>\n<h3 id=\"queue-depth\" style=\"position:relative;\"><a href=\"#queue-depth\" aria-label=\"queue depth permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Queue Depth</h3>\n<p>SQS queue can keep track of the number of messages in the queue that'll trigger an alarm that'd autoscale our queue.</p>\n<h3 id=\"receive-message-wait-time\" style=\"position:relative;\"><a href=\"#receive-message-wait-time\" aria-label=\"receive message wait time permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Receive Message Wait Time</h3>\n<p>The receive message wait time is the maximum amount of time that polling will wait for messages to become available to receive. The minimum value is zero seconds and the maximum value is 20 seconds.</p>\n<p>Long polling helps reduce the cost of using Amazon SQS by eliminating the number of empty responses (when there are no messages available for a ReceiveMessage request) and false empty responses (when messages are available but aren't included in a response). If a receive request collects the maximum number of messages, it returns immediately. It does not wait for the polling to time out.</p>\n<p>If you set the receive message wait time to zero, the receive requests use short polling.</p>\n<h3 id=\"redrive-allow-policy\" style=\"position:relative;\"><a href=\"#redrive-allow-policy\" aria-label=\"redrive allow policy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Redrive allow policy</h3>\n<p>The redrive allow policy defines which source queues can use this queue as the dead-letter queue.</p>\n<p>By default, the redrive allow policy is disabled, which results in the same behavior as allowing all source queues to use this queue as the dead-letter queue.</p>\n<p>When enabling the redrive allow policy, you can choose to allow or deny all source queues or specify a list of up to 10 source queues by ARN.</p>\n<p>The source queues must be owned by the same AWS account and must reside in the same region as the dead-letter queue.</p>\n<h3 id=\"dead-letter-queue\" style=\"position:relative;\"><a href=\"#dead-letter-queue\" aria-label=\"dead letter queue permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Dead Letter Queue</h3>\n<p>If a message can't be consumed successfully, you can send it to a dead-letter queue (DLQ). Dead-letter queues let you isolate problematic messages to determine why they are failing.</p>\n<p>When you designate a queue to be a source queue, a DLQ is not created automatically. You must first create a queue to designate as the DLQ. The DLQ queue type (standard or FIFO) must match the source queues. You can associate the same DLQ with more than one source queue.</p>\n<p>The Maximum receives value determines when a message will be sent to the DLQ. If the ReceiveCount for a message exceeds the maximum receive count for the queue, Amazon SQS moves the message to the associated DLQ (with its original message ID).</p>\n<p>You must use the same AWS account to create the DLQ and the source queues that send messages to the DLQ. Also, the DLQ must reside in the same region as the source queues that use the DLQ.</p>\n<p>The main task of a dead-letter queue is to handle the lifecycle of unconsumed messages. Setting up a dead-letter queue allows you to do the following:</p>\n<ul>\n<li>\n<p>Configure an alarm for any messages moved to a dead-letter queue.</p>\n</li>\n<li>\n<p>Examine logs for exceptions that might have caused messages to be moved to a dead-letter queue.</p>\n</li>\n<li>\n<p>Analyze the contents of messages moved to a dead-letter queue to diagnose software or the producer's or consumer's hardware issues.</p>\n</li>\n<li>\n<p>Determine whether you have given your consumer sufficient time to process messages.</p>\n</li>\n</ul>\n<h3 id=\"maximum-receives\" style=\"position:relative;\"><a href=\"#maximum-receives\" aria-label=\"maximum receives permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Maximum Receives</h3>\n<p>Whenever you're trying to process a defective message, it'll eventually end up back in the original queue. Maximum recives setting, when creating your DLQ, allows you to specify the number of times a message is attempted to be processed by your consumers, before you send it to your DLQ.</p>\n<h2 id=\"dlq-and-sqs-demo\" style=\"position:relative;\"><a href=\"#dlq-and-sqs-demo\" aria-label=\"dlq and sqs demo permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DLQ and SQS Demo</h2>\n<ul>\n<li>Create a DLQ first, call it DLQ!</li>\n<li>Change retention period to 14 days</li>\n<li>Go ahead and create the DLQ</li>\n<li>Create a new Queue, call it testQueue</li>\n<li>Leave everything as is and go to Dead-Letter-Queue section</li>\n<li>Click on enabled and provide your DLQ ARN</li>\n</ul>\n<p>This means that for your testQueue, you're providing a DLQ ARN where messages should be forwarded. <code class=\"language-cpptext\">Set this queue to receive undeliverable messages.</code></p>\n<ul>\n<li>Set Maximum receives to 1. In reality this should be > 1 but for the demo, we'll leave it at 1.</li>\n<li>Go to your original Q and send a message to it</li>\n<li>Poll for that message!</li>\n<li>Click on stop polling. The message will disappear and appear in your DLQ</li>\n</ul>\n<!-- copy and paste. Modify height and width if desired. -->\n<div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 52.998605299860536%; position: relative; height: 0; overflow: hidden; \" > <iframe class=\"embeddedObject shadow resizable\" name=\"embedded_content\" scrolling=\"no\" frameborder=\"0\" type=\"text/html\" style=\"overflow:hidden; position: absolute; top: 0; left: 0; width: 100%; height: 100%; \" src=\"https://www.screencast.com/users/IqbalKhan8502/folders/Capture/media/c1b26449-a8eb-4c60-b03f-95e22f376011/embed\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\"></iframe> </div>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<ul>\n<li>Make sure you monitor your DLQ for messages by setting up alarms</li>\n<li>DLQs are not only used in conjunction with other queues. You can use DLQs to store messages that are being processed by say, a lambda function, and those that couldn't be processed should be sent to a DLQ.</li>\n</ul>","timeToRead":10,"excerpt":"Table of Contents What is SQS? What is poll-based messaging? Queue Types Standard queue FIFO Queue Settings Access Policy Visibility…","frontmatter":{"title":"AWS - SQS","date":"2022-01-01T00:00:00.000Z","categories":["AWS"],"extract":"Notes for SQS","thumbnail":"/post-images/sqs.png","tags":["blog","AWS"]},"fields":{"slug":"/aws-sqs","date":"January 01, 2022"}}},"pageContext":{"slug":"/aws-sqs","nexttitle":"AWS - Decoupled Workflows","nextslug":"/aws-decoupled-workflows","prevtitle":"AWS - SNS","prevslug":"/aws-sns"}},"staticQueryHashes":["3969716136"]}