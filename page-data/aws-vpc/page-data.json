{"componentChunkName":"component---src-templates-post-js","path":"/aws-vpc","result":{"data":{"markdownRemark":{"html":"<h3 id=\"table-of-contents\" style=\"position:relative;\"><a href=\"#table-of-contents\" aria-label=\"table of contents permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Table of Contents</h3>\n<ul>\n<li><a href=\"#what-is-vpc\">What is VPC?</a>\n<ul>\n<li><a href=\"#intro\">Intro</a></li>\n<li><a href=\"#key-concepts\">Key Concepts</a></li>\n<li><a href=\"#3-tier-architecture\">3 tier architecture</a></li>\n</ul>\n</li>\n<li><a href=\"#network-diagram-for-vpc\">Network diagram for VPC</a>\n<ul>\n<li><a href=\"#ip-address-ranges\">IP address ranges</a></li>\n<li><a href=\"#default-options\">Default Options</a></li>\n<li><a href=\"#public-subnet-creation\">Public Subnet Creation</a></li>\n<li><a href=\"#private-subnet-creation\">Private Subnet Creation</a></li>\n<li><a href=\"#public-subnet-config\">Public Subnet Config</a></li>\n<li><a href=\"#route-table-for-public-subnet\">Route Table for Public Subnet</a></li>\n<li><a href=\"#add-public-subnet-to-new-route-table\">Add Public Subnet to New Route Table</a></li>\n<li><a href=\"#summary-for-public-subnet-creation\">Summary for public subnet creation</a></li>\n<li><a href=\"#create-ec2s\">Create EC2s</a></li>\n<li><a href=\"#private-ec2-security-groups\">Private EC2 Security Groups</a></li>\n</ul>\n</li>\n<li><a href=\"#nat-gateways\">NAT Gateways</a></li>\n<li><a href=\"#security-groups\">Security Groups</a></li>\n<li><a href=\"#nacls\">NACLs</a></li>\n<li><a href=\"#vpc-endpoints\">VPC Endpoints</a>\n<ul>\n<li><a href=\"#interface-endpoints\">Interface endpoints</a></li>\n<li><a href=\"#gateway-endpoints\">Gateway endpoints</a></li>\n</ul>\n</li>\n<li><a href=\"#vpc-peering\">VPC Peering</a></li>\n<li><a href=\"#sharing-applications-across-vpcs\">Sharing Applications across VPCs</a></li>\n<li><a href=\"#connect-data-center-to-aws\">Connect Data Center to AWS</a></li>\n</ul>\n<h2 id=\"what-is-vpc\" style=\"position:relative;\"><a href=\"#what-is-vpc\" aria-label=\"what is vpc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is <a href=\"https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html\">VPC</a>?</h2>\n<p>Amazon Virtual Private Cloud (Amazon VPC) enables you to launch AWS resources into a virtual network that you've defined. This virtual network closely resembles a traditional network that you'd operate in your own data center, with the benefits of using the scalable infrastructure of AWS.</p>\n<h3 id=\"intro\" style=\"position:relative;\"><a href=\"#intro\" aria-label=\"intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Intro</h3>\n<p>Amazon VPC is the networking layer for Amazon EC2. You can think of a VPC as a virtual data center in the cloud. We've already been using VPCs as seen in the EC2 section where we were provisioning our EC2s into the <code class=\"language-cpptext\">default</code> VPC. Every AWS account has a default VPC that's set up automatically.</p>\n<p>VPC is logically isolated part of AWS cloud where you can define your own network. You have complete control of the virtual network including your own IP address range, subnets, route tables and network gateways. VPC is basically a fully customizable network.</p>\n<h3 id=\"key-concepts\" style=\"position:relative;\"><a href=\"#key-concepts\" aria-label=\"key concepts permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Key Concepts</h3>\n<p>The following are the key concepts for VPCs:</p>\n<ul>\n<li>\n<p><strong>Virtual private cloud (VPC)</strong> — A virtual network dedicated to your AWS account.</p>\n</li>\n<li>\n<p><strong>Subnet</strong> — A range of IP addresses in your VPC. When you create a subnet, you'll choose a range of IP addresses that you want associated with that subnet. 1 subnet is always in 1 availability zone.</p>\n</li>\n<li>\n<p><strong>Route table</strong> — A set of rules, called routes, that are used to determine where network traffic is directed. This allows us to communicate between subnets.</p>\n</li>\n<li>\n<p><strong>Internet gateway</strong> — A gateway that you attach to your VPC to enable communication between resources in your VPC and the internet.</p>\n</li>\n<li>\n<p><strong>VPC endpoint</strong> — Enables you to privately connect your VPC to supported AWS services and VPC endpoint services powered by PrivateLink without requiring an internet gateway, NAT device, VPN connection, or AWS Direct Connect connection. Instances in your VPC do not require public IP addresses to communicate with resources in the service. Traffic between your VPC and the other service does not leave the Amazon network.</p>\n</li>\n<li>\n<p><strong>CIDR block</strong> — Classless Inter-Domain Routing. An internet protocol address allocation and route aggregation methodology. For CIDR visualization, check out this website: <a href=\"https://cidr.xyz/\">cidr.xyz</a>.</p>\n</li>\n<li>\n<p><strong>NACLs</strong> - Network access control lists that allow us to block specific IP addresses.</p>\n</li>\n</ul>\n<h3 id=\"3-tier-architecture\" style=\"position:relative;\"><a href=\"#3-tier-architecture\" aria-label=\"3 tier architecture permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3 tier architecture</h3>\n<p>Usually we have a 3 tier architecture (web servers, application and DB). In such an architecture, our web servers are in a public facing subnet meaning these are accessible via port 80 or 443 (HTTP or HTTPS). The application tier is in a private subnet that handles our business logic (rendering the webpage, routing requests for backend, authN and authZ logic etc). The application tier is NOT accessible via the internet and can only speak with the web tier or the DB tier. Finally we have the database tier which is also in a private subnet and is responsible for maintaining our data. It can only speak with the application and nothing else.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.41618497109826%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABqklEQVQozz3OX2/SUACG8X4DgXJOT3t6eqB0DIwyMVumcdEZjReOwYABpdAW2OL/aPwExmj82o+RJV788ua5ex3tDonVgEhcEopLIjEg9gbUKyNcb4IrxrhygivHdy3HiMoEvzbHq17jVWd7qjpHVqY4TTVCVsesTs75/vKMvr3YdySuEE/XqLcb1JsS71WBel1S7y0wIufs8Ccvur857/7hWfsHzzu/sLLEaXhD3HtjWt6AbnBBWB8iKyOsuqJmZ7jxjJq5vqOnuGaKlhlWbGjIHU15s9+Wd4uur3ASf0wg5kg3RdRSpPvvwZRGMEVHK5KgoBmsiXVOSxf4JsV4OUYtMcGC0E/Rao7xlxixxkmCKc2o5CDe0o63HMQ7rFrQ1DOCxprjR595cvqN05OvPOi8w7cZxi952H3P46NPHPe/0O99pHf/A1aVOO1wTqRStFwSypRALkn0HKtTpM3xVY6JSiJT4HsZymZEwRYtCjw3Q9VXKHe1b6t2OEm4pRNmJDqjpZcc6IyuXhHJHKM3xNGWhimJTUliN7R0iZUFh/4tsX+D9Xf/aZnzF8b73jdk+EwMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"3-Tier\"\n        title=\"3-Tier\"\n        src=\"/static/b014df5efa2143fbf8d5406679806775/1e043/3-tier.png\"\n        srcset=\"/static/b014df5efa2143fbf8d5406679806775/991de/3-tier.png 173w,\n/static/b014df5efa2143fbf8d5406679806775/e4d6b/3-tier.png 345w,\n/static/b014df5efa2143fbf8d5406679806775/1e043/3-tier.png 690w,\n/static/b014df5efa2143fbf8d5406679806775/e3189/3-tier.png 1035w,\n/static/b014df5efa2143fbf8d5406679806775/d43b4/3-tier.png 1202w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><a href=\"https://acloudguru.com\">Image Credit - Acloudguru</a></p>\n<p>For applications that already exist in a corporate data center, we can create a hardware virtual private network (VPN) connection between the corporate data center and AWS and leverage AWS cloud as an extension of the corporate data center.</p>\n<h2 id=\"network-diagram-for-vpc\" style=\"position:relative;\"><a href=\"#network-diagram-for-vpc\" aria-label=\"network diagram for vpc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Network diagram for VPC</h2>\n<p>Here's how we'd usually go about creating a VPC network for a typical use-case (we'll complete these steps in a demo!):</p>\n<p>(1) We first need to choose the region we want to deploy to</p>\n<h3 id=\"ip-address-ranges\" style=\"position:relative;\"><a href=\"#ip-address-ranges\" aria-label=\"ip address ranges permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IP address ranges</h3>\n<p>(2) Next we need to choose the IP address range which could be one of three:</p>\n<ul>\n<li>10.0.0.0 (we'll use this with /16 option. Only two valid options are /16 and /28)</li>\n<li>172.16.0.0</li>\n<li>192.168.0.0</li>\n</ul>\n<h3 id=\"default-options\" style=\"position:relative;\"><a href=\"#default-options\" aria-label=\"default options permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Default Options</h3>\n<p>(3) You'll be asked about tenancy: You can run instances in your VPC on single-tenant, dedicated hardware. Select Dedicated to ensure that instances launched in this VPC are dedicated tenancy instances, regardless of the tenancy attribute specified at launch. Select Default to ensure that instances launched in this VPC use the tenancy attribute specified at launch. <code class=\"language-cpptext\">Dedicated</code> are more expensive! We'll use <code class=\"language-cpptext\">Default</code></p>\n<p>(4) As soon as we create our VPC, a main route table is created automatically for us, along with main network acl. In addition, a default security group is also created for our VPC.  Initial settings for the security group:</p>\n<ul>\n<li>deny all inbound traffic</li>\n<li>allow all outbound traffic</li>\n<li>allow all traffic between instances assigned to the security group.</li>\n</ul>\n<p>If you don’t specify a security group when you launch an instance, the instance is automatically assigned to this default security group.</p>\n<p>(5) If you exmaine the route table associated with our VPC, you'll notice that there're routes associated with it but no subnets as shown under <code class=\"language-cpptext\">Subnet associations</code> section.</p>\n<p>(6) However, going to the subnets section, you'll find subnets present. These are associated with our default VPC and not with the new VPC that you created.</p>\n<h3 id=\"public-subnet-creation\" style=\"position:relative;\"><a href=\"#public-subnet-creation\" aria-label=\"public subnet creation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Public Subnet Creation</h3>\n<p>(7) Next, we'll create a public subnet (10.0.1.0/24 IP address range), add an instance to it and configure security group. To do so, click on <code class=\"language-cpptext\">Create Subnet</code>. You'll be asked to choose a VPC. We'll obviously choose the VPC we created earlier. Provide a region, <code class=\"language-cpptext\">us-east-1a</code> and name for your subnet. We'll name it using the convention: <code class=\"language-cpptext\">&lt;IP ADDRESS RANGE&gt; - &lt;REGION&gt;</code> which would translate to: <code class=\"language-cpptext\">10.0.1.0 - us-east-1a</code>. Next, we'll specify the IPv4 CIDR block: 10.0.1.0/24. We'll then click on <code class=\"language-cpptext\">Create Subnet</code>. You can see that this subnet is associated with the VPC you created in the steps above.</p>\n<p>Notice under the Available IPv4 addresses, you'll see 251. If you go to <a href=\"https://cidr.xyz/\">cidr.xyz</a> and type in the CIDR block address you provided, it'll return 256. Why does AWS give us 5 fewer addresses? The first four IP addresses and the last IP address in each subnet CIDR block are not available for you to use, and cannot be assigned to an instance. For example, in a subnet with CIDR block 10.0.0.0/24, the following five IP addresses are reserved:</p>\n<ul>\n<li>\n<p>10.0.0.0: Network address.</p>\n</li>\n<li>\n<p>10.0.0.1: Reserved by AWS for the VPC router.</p>\n</li>\n<li>\n<p>10.0.0.2: Reserved by AWS. The IP address of the DNS server is the base of the VPC network range plus two. For VPCs with multiple CIDR blocks, the IP address of the DNS server is located in the primary CIDR. We also reserve the base of each subnet range plus two for all CIDR blocks in the VPC. For more information, see Amazon DNS server.</p>\n</li>\n<li>\n<p>10.0.0.3: Reserved by AWS for future use.</p>\n</li>\n<li>\n<p>10.0.0.255: Network broadcast address. We do not support broadcast in a VPC, therefore we reserve this address.</p>\n</li>\n</ul>\n<h3 id=\"private-subnet-creation\" style=\"position:relative;\"><a href=\"#private-subnet-creation\" aria-label=\"private subnet creation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Private Subnet Creation</h3>\n<p>(8) Similar to our public subnet, we'll create a private subnet. We'll place this private subnet in us-east-1b region. Therefore, we'll name this subnet as: <code class=\"language-cpptext\">10.0.2.0 - us-east-1b</code>. Now go to subnets tab to make sure both new subnets are available.</p>\n<p><strong>Side Note</strong>: Just by creating the two subnets and giving them IP addresses, we have NOT made them public or private yet! We'll do that in the steps below. Here's what we've created so far (note the labelled subnets are not actually private or public as stated):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.71098265895954%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACXElEQVQoz43MyU5TARjF8bsT6MSdp5ZLpVBaAYEWMCKKKYUW2tJKy6W3AygBNCAsjEaMEl251MRXkJj4BLpwpw/gwjdAExc+w98wbNy5+OV8ycn5BF/HHL5LFzrmCHTOn/FfOL27OuZR/Bm+7Vzlz8txTp6N8etogp8v0mdOnqf4/TTJ94cjCIZaIdrj0RN2sY0qilhEEUvoUhFDPqdJJSLqIm+Lk3xsTHC8NsGxN8X7+hTH9dOc5NhN8a6YRhgIL5OO5s6MO3mSZpZhO4uj5LDEHPYFLZRHDeaQAzlCvjx6aAEtuIAjZdmduYmlVujsyJ8+rDISecCos0+f3kTvLqMGl+j2FQj5igR8y1hiAS+VYXZggWw8w2HmOkZoiZCvhBgokbCL9BpVuv0lhHjExZLraGKNzq4a928s8PXxbb48yvJp9xYJq8BY3OPDvsthxeVVtcyP10vMjDYJBFcJ+cuElTKO6SIFKwiDEY+w0sCU6+hSi8noCrV0gTupEpWxAra8QiJS4427yPZsif1Mns97M0yPbnBt0MPRXfosl6jlIYeqCEmnRURbx1LbhLV1FLGFv6tOwFcn4PfQuutYkkvCWqFPrxHTawxbZRyjyc5MiemRTRK96/RZTXRxDSEZ3cDWmmiii6k0Cevr2KqHrTbOmEoDQ2mgSk00+ZwitTBkj35rFUNaI2rUiUU20CQPYejyPWKxJ8TiRzg9B5jKBoZ8Omj/w1RamPIF5bzX5Taa1KbfbhJ3NjGVNsJo/w5TV/aYHDpgIrlHKr5NamDr/8TPMz24RSyyRVi9y1+i406dghwP2QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"VPC-Part-1\"\n        title=\"VPC-Part-1\"\n        src=\"/static/2340cac4d78b64628686ca5af0fe7d06/1e043/vpc-creation-part-1.png\"\n        srcset=\"/static/2340cac4d78b64628686ca5af0fe7d06/991de/vpc-creation-part-1.png 173w,\n/static/2340cac4d78b64628686ca5af0fe7d06/e4d6b/vpc-creation-part-1.png 345w,\n/static/2340cac4d78b64628686ca5af0fe7d06/1e043/vpc-creation-part-1.png 690w,\n/static/2340cac4d78b64628686ca5af0fe7d06/e3189/vpc-creation-part-1.png 1035w,\n/static/2340cac4d78b64628686ca5af0fe7d06/b1001/vpc-creation-part-1.png 1380w,\n/static/2340cac4d78b64628686ca5af0fe7d06/b0de5/vpc-creation-part-1.png 1517w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><a href=\"https://acloudguru.com\">Image Credit - Acloudguru</a></p>\n<h3 id=\"public-subnet-config\" style=\"position:relative;\"><a href=\"#public-subnet-config\" aria-label=\"public subnet config permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Public Subnet Config</h3>\n<p>(9) Alright, let's make our public subnet public:</p>\n<ul>\n<li>We'll first enable <code class=\"language-cpptext\">Auto-assign public IPv4 address</code> for the subnet 10.0.1.0-us-east-1a. That's because we want EC2s in that subnet to be public. To do so, choose the public subnet and click on Actions and then click on <code class=\"language-cpptext\">Edit subnet settings</code>. Then all we need to do is click <code class=\"language-cpptext\">Enable auto-assign public IPv4 addressInfo</code>. This will make our subnet public.</li>\n<li>Next, we'll create an internet gateway. Simply go to Internet Gateway and create one. Next, we need to attach it to your VPC by choosing your VPC name. <strong>You can only have 1 IGW attached to a VPC</strong>.</li>\n<li>Attaching an IGW is not enough. We need to add entries to our Route Table. So go to Route Tables and choose the VPC that you created. Go to routes tab and you'll see that a route already exists: 10.0.0.0/16. This route will ONLY allow our subnets to communicate with each other. Go ahead and click on Subnet Associations and you'll see this message:</li>\n</ul>\n<p><strong>\"The following subnets have not been explicitly associated with any route tables and are therefore associated with the main route table:\"</strong></p>\n<p>In that table you'll see our public and private subnets. Any new subnets created are <strong>automatically associated with the main route table</strong>. This is why you wouldn't want your main route table to have a route out to the internet, otherwise, any new subnets created and any EC2s in that subnet will always be internet accessible. <strong>Best practice is to create a new route table that's accessible via the internet. That's exactly what we'll do in the next section</strong>:</p>\n<h3 id=\"route-table-for-public-subnet\" style=\"position:relative;\"><a href=\"#route-table-for-public-subnet\" aria-label=\"route table for public subnet permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Route Table for Public Subnet</h3>\n<p>So let's create the route table for our public subnet. Go ahead and click on create route table and call it <code class=\"language-cpptext\">InternetRT</code> and choose our VPC. With the newly created route table selected, go back to routes and click on edit. We'll add a route to the internet. To do so, clik on add route and provide the following as destination:\n<code class=\"language-cpptext\">0.0.0.0/0</code></p>\n<p>and for Target, choose the internet gateway that you created. This will create a route out to the internet! What this does is that for destination <code class=\"language-cpptext\">0.0.0.0/0</code> (ie destination internet), forward requests to internet gateway that's attached to this VPC.</p>\n<h3 id=\"add-public-subnet-to-new-route-table\" style=\"position:relative;\"><a href=\"#add-public-subnet-to-new-route-table\" aria-label=\"add public subnet to new route table permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Add Public Subnet to New Route Table</h3>\n<p>Next, go back to your public subnet, click on Route table and then on edit route table association. Next, you can choose the internet route table that you created to be associated with your public subnet. Now if you go back to Route Tables and look under Subnet Associations, you'll now only see your private subnet under the message saying subnet not associated with any route table. You'll see your public subnet associated with the new route table.</p>\n<h3 id=\"summary-for-public-subnet-creation\" style=\"position:relative;\"><a href=\"#summary-for-public-subnet-creation\" aria-label=\"summary for public subnet creation permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary for public subnet creation</h3>\n<p>To summarize all the steps above, here's what we did to make our subnet public:</p>\n<ul>\n<li>Create a subnet with CIDR block (we chose 10.0.1.0/24)</li>\n<li>Enable auto assign public IPv4 address</li>\n<li>Create internet gateway called <code class=\"language-cpptext\">PublicIGW</code></li>\n<li>Create a new internet route table, called <code class=\"language-cpptext\">InternetRT</code> and attach to VPC</li>\n<li>Add route out to internet in <code class=\"language-cpptext\">InternetRT</code> where destination is <code class=\"language-cpptext\">0.0.0.0/0</code> and destination is <code class=\"language-cpptext\">PublicIGW</code></li>\n<li>Edit public subnet route table association to point to <code class=\"language-cpptext\">InternetRT</code></li>\n</ul>\n<h3 id=\"create-ec2s\" style=\"position:relative;\"><a href=\"#create-ec2s\" aria-label=\"create ec2s permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create EC2s</h3>\n<p>(10) We'll create 2 EC2 instances. One will be placed in our public subnet while the other will be placed in our private subnet. We'll create a standard EC2 instance and in configuration details provide our custom VPC for network instead of our default VPC. Additionally, we'll also provide the subnet where we want our EC2 instance launched. Remember, one will go into public subnet and the other in our private subnet. Add a tag to each EC2 for easy identification (WebServer for public and DBServer for private).</p>\n<p>Notice that when public web server is created, it'll automatically be assigned a public IPv4 address. To test whether your WebServer is actually public, try to SSH into it and perform a <code class=\"language-cpptext\">yum update</code>.</p>\n<h3 id=\"private-ec2-security-groups\" style=\"position:relative;\"><a href=\"#private-ec2-security-groups\" aria-label=\"private ec2 security groups permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Private EC2 Security Groups</h3>\n<p><strong>IMPORTANT</strong>: For your private DBServer, you don't want internet access for now. You only want access from to DBServer from WebServer:</p>\n<ul>\n<li>\n<p>We'll allow MySQL traffic into DBServer. To do so, we'll set Inbound Rules. Since our DBServer is <code class=\"language-cpptext\">MySQL/Aurora</code>, we'll set the type as MySQL/Aurora and the source as <code class=\"language-cpptext\">10.0.1.0/24</code>. Remember, this is the CIDR block we chose for our WebServer. Therefore, we're saying that allow inbound traffic from that IP address range.</p>\n</li>\n<li>\n<p>We also want to be able to ping our DBServer. To make that possible, we'll add another inbound rule with type <code class=\"language-cpptext\">All ICMP - IPv4</code>. Again, the source CIDR block would be the WebServer CIDR block: <code class=\"language-cpptext\">10.0.1.0/24</code>.</p>\n</li>\n<li>\n<p>We also want HTTP access to our DBServer. To make that possible, we'll add another inbound rule with type <code class=\"language-cpptext\">HTTP</code>. Again, the source CIDR block would be the WebServer CIDR block: <code class=\"language-cpptext\">10.0.1.0/24</code>.</p>\n</li>\n<li>\n<p>We also want SSH access to our DBServer. To make that possible, we'll add another inbound rule with type <code class=\"language-cpptext\">SSH</code>. Again, the source CIDR block would be the WebServer CIDR block: <code class=\"language-cpptext\">10.0.1.0/24</code>.</p>\n</li>\n</ul>\n<p>NOTICE: we're adding SSH Inbound Rule ONLY from WebServer for demo purposes.</p>\n<p>Now, let's grab the private IPv4 address for our DBServer and from our connected WebServer terminal, see if we're able to ping our DBServer. To do so, we'll run:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-cppbash\"><code class=\"language-cppbash\"><span class=\"token function\">ping</span> <span class=\"token operator\">&lt;</span>DB_SERVER_IP_ADDRESS<span class=\"token operator\">></span></code></pre></div>\n<p>Now, try to connect to the DBServer in another terminal where you're not SSHed into your WebServer. That won't be possible since our security groups do not allow that!</p>\n<p>Now SSH into your DBServer via the WebServer using:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-cppbash\"><code class=\"language-cppbash\"><span class=\"token function\">ssh</span> -i <span class=\"token string\">\"kvPair.pem\"</span> ec2-user@<span class=\"token operator\">&lt;</span>DBServerPrivateIP<span class=\"token operator\">></span></code></pre></div>\n<p>Once in, elevate yourself to <code class=\"language-cpptext\">su</code> and try running <code class=\"language-cpptext\">yum update -y</code>. You'll get a timeout! This is obviously not what we want! We want no internet traffic coming in but at the same time we want our DBServers to be up to date with latest security patches. We'll look at how to enable this outflow in the next section.</p>\n<p>Here's a demo showing what we've done so far:</p>\n<ul>\n<li>Create a VPC in a region</li>\n<li>Create 2 subnets in that region. Use CIDR block <code class=\"language-cpptext\">10.0.1.0/24</code> for public subnet and <code class=\"language-cpptext\">10.0.2.0/24</code> for private subnet</li>\n<li>For public subnet:\n<ul>\n<li>Create Internet Gateway</li>\n<li>Enable auto-assign public IPv4 address</li>\n<li>Add route out to the internet using <code class=\"language-cpptext\">0.0.0.0/0</code></li>\n</ul>\n</li>\n<li>For private subnet:\n<ul>\n<li>Do nothing for now!</li>\n</ul>\n</li>\n<li>Create 2 EC2 instances, one for public subnet and one for private subnet</li>\n<li>For public subnet EC2, add SSH, HTTP and HTTPS security group rules</li>\n<li>For private subnet EC2, add HTTP, PING and MySQL/Aurora Inbound Rules from our public subnet CIDR block</li>\n<li>Ping private subnet EC2 from public subnet EC2</li>\n<li>SSH into DBServer from WebServer</li>\n<li>Try yum update for DBServer (which will timeout)</li>\n</ul>\n<!-- copy and paste. Modify height and width if desired. -->\n<div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 52.859135285913524%; position: relative; height: 0; overflow: hidden; \" > <iframe class=\"embeddedObject shadow resizable\" name=\"embedded_content\" scrolling=\"no\" frameborder=\"0\" type=\"text/html\" style=\"overflow:hidden; position: absolute; top: 0; left: 0; width: 100%; height: 100%; \" src=\"https://www.screencast.com/users/IqbalKhan8502/folders/Capture/media/f12d64a9-219c-4e09-ade9-1b5fe11f7c21/embed\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\"></iframe> </div>\n<br/>\n<p><strong>SIDE NOTE</strong>:  SSH should be disabled by default but for demo purposes, I've added SSH access to DBServer security group.</p>\n<p>(7) Optional: We can attach a virtual private gateway to our VPC that'll allow us to connect our corporate data center to our private subnet</p>\n<p>Here's a network diagram of what we've created so far:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.28901734104046%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACoUlEQVQoz0XP7U9SCwDH8bO2rAQiIA96OIAcOAQoAs5KChVR5HAMEBQ0QB7iQbfccj1pZa31sLX6J6p7e3nvdh9e3PsHtNaa9h/cf+V7Z2v14rPvu9/2E4xn0pgGM99pnDX8ZDJomI0aA6d0YnKSL7vTHD1c4nAvxdGBztFBlsOHGp/vzvPf/hQ78TiCJBYJKNfxuyuMSiWGrTojVh3J9tP5c9eYci/wdv0SvzSTvK8leLeZ5G0jxYfmLL+2F/mwOcvq+AyCXy4w6UwzIWeIOTOMjWQYlzJIlmVE8zKSRcdu1rAYdUyDWU4PZDl9KovFkGHgpMa0O0kxpiGcyGEcXD4eLOO1b3LV28Yjtgk4WgSlCh6xgEdcwWIqE5bz3JpLMq3o7C0kuJ2cwWhYwWYuYD+XZ8xdZMhSxGbOI1xwVlHsJd6s6pw1rXF3fo6vByk+PVjk9+5Vhi0l8vEmfz2osTm3zr97ef6+V2R0tI1hsIjNVEAW1zCbVjEb8gghVw2XWEOW+0hDddThClHXGhHnGmG5jGipc9FT4kVBIxXI8zK3yNN8lliww0KohNfVpJrYYCrYIuDrIoQ8TZSRJiuRCg6xzaRSJxPeYCl8nflQlRHxBtNqhRfLKdKhIq9zszzTUySifaoXc3hdNyhf3iA+0ePS5C5CSOmgynWerJSxWRvcW1ji8NESH/ez/NZN4hiqU0j0+XO/RWO+wT/3V/njdpnx0A6XozdxSw3SkSqR0DY+TxchqnYJqLv4xx5zQb2D33sL1b2NR2qhONo4hnvE/TWe5XKkx9Z5VUjzPKcxZG0S9G4T9PbZSVcopPeZubJ3fLlPVO0T8fWIHFfdYkLdJvLDFlG1R8zX+daor0vU1yGi9ggrHSa8HRTnFnZrG8nW4n/BaWAXcQhtpQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Network-Diagram\"\n        title=\"Network-Diagram\"\n        src=\"/static/a4ea53019f641f925a374b228c23f3a4/1e043/network-diagram.png\"\n        srcset=\"/static/a4ea53019f641f925a374b228c23f3a4/991de/network-diagram.png 173w,\n/static/a4ea53019f641f925a374b228c23f3a4/e4d6b/network-diagram.png 345w,\n/static/a4ea53019f641f925a374b228c23f3a4/1e043/network-diagram.png 690w,\n/static/a4ea53019f641f925a374b228c23f3a4/e3189/network-diagram.png 1035w,\n/static/a4ea53019f641f925a374b228c23f3a4/b1001/network-diagram.png 1380w,\n/static/a4ea53019f641f925a374b228c23f3a4/387f2/network-diagram.png 1518w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><a href=\"https://acloudguru.com\">Image Credit: acloudguru</a></p>\n<h2 id=\"nat-gateways\" style=\"position:relative;\"><a href=\"#nat-gateways\" aria-label=\"nat gateways permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NAT Gateways</h2>\n<p>From the previous demo, you can see that DBServer was not able to perfrom a yum update. To prevent outside traffic from reaching our DBServer BUT at the same time, enabling DBServer to reach out to the internet would require something called a NAT gateway. A NAT gateway is a Network Address Translation (NAT) service. You can use a NAT gateway so that instances in a private subnet can connect to services outside your VPC but external services cannot initiate a connection with those instances.</p>\n<p>When you create a NAT gateway, you specify one of the following connectivity types:</p>\n<ul>\n<li>\n<p><strong>Public – (Default)</strong> Instances in private subnets can connect to the internet through a public NAT gateway, but cannot receive unsolicited inbound connections from the internet. You create a public NAT gateway in a public subnet and must associate an elastic IP address with the NAT gateway at creation. You route traffic from the NAT gateway to the internet gateway for the VPC. Alternatively, you can use a public NAT gateway to connect to other VPCs or your on-premises network. In this case, you route traffic from the NAT gateway through a transit gateway or a virtual private gateway.</p>\n</li>\n<li>\n<p><strong>Private</strong> – Instances in private subnets can connect to other VPCs or your on-premises network through a private NAT gateway. You can route traffic from the NAT gateway through a transit gateway or a virtual private gateway. You cannot associate an elastic IP address with a private NAT gateway. You can attach an internet gateway to a VPC with a private NAT gateway, but if you route traffic from the private NAT gateway to the internet gateway, the internet gateway drops the traffic.</p>\n</li>\n</ul>\n<p>When our DBServer tries to reach out to the internet, it is unable to do so. That's because there's no route in the route table that allows traffic out to the internet. Similarly, no traffic from the internet can acccess our private subnet.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.35260115606936%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACTklEQVQoz0XJy04TARjF8Uk0QaTQDh06nemFaenQAi0tpYEELIiGttP7jUlb6IW7hRJ1wUJJUEyMLl35GK5cmvgW7PQdTNz/jYBx8cv5zvkE/2QLzdNA8zZR5SqSWMBhL+K0F5Hv0in9p/y7734uRwm7Lc/IgxSjw2mEuJYjoWVZ8mWJuAzm1RS6I41qM3CLBi4xg2y9pVgzSKMGii1zszutaU6Tj4lOFhkeyiFacgi6s0XEtUvY1WNa6RJ07qCIdSTrFhNWE4d1i0oshbmYZsVv8D67StybxfKwgs1SYspZZtpVxTpSwj5WRrDbmpys52klDL4/T/L7s8G7TJJ7Q3VksYZib3Cxuc5VZo3mksGPTzXy0Rz3h0zEsRqyfQuXw8QyXEYcrSL45W1m9WPC/l36jwq8ytXJzFWxjXVwS23c9iaX1SofmiaVmMG3wQoboQIhtUZIrRJQTIqJBjP6IQFvB8Gr9Ej4Gsx5thmz7qFKbfxKm7C3hU/t4hzf5rJc4WOjTm4uy5fOMquBCvlIkfXpMiF3k0GqxdLiS+ZDxwjyRI9nayU250yWtRLXFytcv3nKz6skveUsk9oZV9kMb3Npzp6Y/DI1KuEi0vgObqmFV26jKW1ESwNZbCGEfH0i86+ZnT1H106Ih/pEfF0iWpsptYvfc8iLjQLnm0Xq8RpfawukZmtIYg/3RBvd1SHi30WVungcXYTFmT4LoVPif80MmA8OiOj9G7Fgn2jgkAV9n7h+QDRwQDR4SEw/IBa47fHpI4KTR7gn9vDK+/wBFcowMVYusV8AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Private-Subnet-Internet-Connection\"\n        title=\"Private-Subnet-Internet-Connection\"\n        src=\"/static/2f563e51320eea0889b401d02b499b4a/1e043/private-subnet.png\"\n        srcset=\"/static/2f563e51320eea0889b401d02b499b4a/991de/private-subnet.png 173w,\n/static/2f563e51320eea0889b401d02b499b4a/e4d6b/private-subnet.png 345w,\n/static/2f563e51320eea0889b401d02b499b4a/1e043/private-subnet.png 690w,\n/static/2f563e51320eea0889b401d02b499b4a/e3189/private-subnet.png 1035w,\n/static/2f563e51320eea0889b401d02b499b4a/b1001/private-subnet.png 1380w,\n/static/2f563e51320eea0889b401d02b499b4a/c0566/private-subnet.png 1544w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><a href=\"https://acloudguru.com\">Image Credit: acloudguru</a></p>\n<p><strong>The solution to this issue is to provision a NAT Gateway in the public subnet.</strong> You can use a public NAT gateway to enable instances in a private subnet to send outbound traffic to the internet, but the internet cannot establish connections to the private instances. Once the NAT gateway is created in the public subnet, our private DBServer instance can reach out to the NAT Gateway (remember, our private DBServer can speak with other subnets in our VPC). Once DBServer connects to NAT Gateway, the request is sent to network ACL, to route table, the router and then the internet gateway!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.50867052023121%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACVklEQVQoz03Qz0+SAQDGcY6pMOB9QUBe4BXhRcEXBaTXavNn+r4YvxXBF4EETMXcsk6tttpcrXlo1dba2ry1tS6dOrb1R3Tq2j/ybbq2Ojz7HJ7T81j83i3CcpOQ1CDorzMqlnALRTxiEa/4V1cRn+ufl/m/dwslbMMG1iEdSzxQJCvrzMk6qaBBYmwd1b9GQMjhc+SQnAY+h4HLZuC1G4i2HC5bjoCgI1pzLEeWaM3rDA+XcYxsYJmSaiieFqq0R8Rzl4i7hSTUcI5U8AubOK014r48bW2NpHSHnrZAJ7vE0LUyTlsZn6NAaryMaK8i2EpYJsaapEJVnhgFTpdW+f1qnR8PliloJmd5naDXpKrt8HFLo66V+f64wpejHHanicO2hdNWQRqtIdhrOKyVy8kmitRGjR1SnC7wpmXyormPpg6YnxkQDuxjzNS46Fcopatc7K7wrr6GOnVAOlRhzL2DPtsgEW4xHuhgicttxr0tMnKDYOiYaPQEn9hCdteRR01ER4fbiU0+nZgUUpu8Li5wtrHC9XiX/s08SuSQ0w2T9fkDbmiPsChyj5S8zctiHo+nx/vNBX49X+LnszW+9hZwCR10dZsPW4vkp4t8e1jl81EFh7VBzF/H42xweZvX1cLj3MGSnOgTjZwyM/sUSTohPXnErekemrJLJtzEJfZYjpuclwz0RI231UXOS6vY7Xt4xQ4+sU0y3CHo6+J3t7GkYwdk4wPSkwOyiWNSU/dRowPUyCFJ5YjM5AFzSg8t1r1y7souaaV/lYzSYzZ6j6C3T2C0yx/d7DP0v1xBgwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"NAT-Gateway\"\n        title=\"NAT-Gateway\"\n        src=\"/static/c66566e17fdae9a9d138a2eacedcc89f/1e043/nat-gateway.png\"\n        srcset=\"/static/c66566e17fdae9a9d138a2eacedcc89f/991de/nat-gateway.png 173w,\n/static/c66566e17fdae9a9d138a2eacedcc89f/e4d6b/nat-gateway.png 345w,\n/static/c66566e17fdae9a9d138a2eacedcc89f/1e043/nat-gateway.png 690w,\n/static/c66566e17fdae9a9d138a2eacedcc89f/e3189/nat-gateway.png 1035w,\n/static/c66566e17fdae9a9d138a2eacedcc89f/b1001/nat-gateway.png 1380w,\n/static/c66566e17fdae9a9d138a2eacedcc89f/fb4e7/nat-gateway.png 1519w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><a href=\"https://acloudguru.com\">Image Credit: acloudguru</a></p>\n<p>As you might remember from the previous section, we're not able to SSH into our DBServer apart from our WebServer. We enabled SSH from <code class=\"language-cpptext\">10.0.1.0/24</code> to our Inbound Rule for security group that's attached to our DBServer. Next, we SSHed into our WebServer, imported the .pem file into that EC2 instance, and SSHed into our DBServer. We saw that we aren't able to perform a <code class=\"language-cpptext\">yum update -y</code> from the DBServer.</p>\n<p>To enable internet access from private subnet, we'll now create a NAT Gateway. To do so, we'll follow these steps:</p>\n<ul>\n<li>Go to NAT Gateways and create NAT gateway</li>\n<li>Call it DBServerNatGateway</li>\n<li>It'll ask you to choose a subnet, choose your public subnet</li>\n<li>Connectivity type: Public</li>\n<li>Choose to Allocate Elastic IP address</li>\n<li>We also need to create a route out to the internet for requests originating from our private subnet. To do so, follow these steps:\n<ul>\n<li>Go to your route tables and look for the main route table associated with our VPC. Why main route table? Because remember that the main route table is used for unassociated subnets. We never associated our private subnet with any specific route table.</li>\n<li>Once chosen, go ahead and add the following route: <code class=\"language-cpptext\">0.0.0.0/0</code> and target as the NAT gateway you created.</li>\n</ul>\n</li>\n<li>Run <code class=\"language-cpptext\">yum update -y</code> in your DBServer to make sure that the DBServer is able to perform the update!</li>\n</ul>\n<!-- copy and paste. Modify height and width if desired. -->\n<div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 52.64623955431755%; position: relative; height: 0; overflow: hidden; \" > <iframe class=\"embeddedObject shadow resizable\" name=\"embedded_content\" scrolling=\"no\" frameborder=\"0\" type=\"text/html\" style=\"overflow:hidden; position: absolute; top: 0; left: 0; width: 100%; height: 100%; \" src=\"https://www.screencast.com/users/IqbalKhan8502/folders/Capture/media/e56e526c-03b6-4c78-9f22-5d83234f3569/embed\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\"></iframe> </div>\n<h2 id=\"security-groups\" style=\"position:relative;\"><a href=\"#security-groups\" aria-label=\"security groups permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Security Groups</h2>\n<p>Here's what our VPC setup looks like right now (minus the VP Gateway):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.24277456647399%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAACcklEQVQozyWOzUuTAQDGB0llUMvPudd9uHcfus1tpfv0Yx9MpnPf2+vcllPfpU4neggs0oNopJQUdOyDCCrpEp0i6FjXbhFFB7tE9A94/oV2+PEcnh8Pj6K7dZKYM4tLzNNvkHCIBVxGiSumKby2MnZ9DpVyEpUyzsclH9+243y5GeXH7iTfT9iJ83VrjKNNP49SPhS6y+MsjYzSJ0qYeyS0QgFVZ54WZYpzZ8dpuZTA0hWj4BzhfsLNq9kh3skedpJh7maj3ElHeCCNcZCPMOMOoehpT2PQSdRCudNHt5MJ3q5neFZL8qQcZNiSQB5JwHMnm/EYT8tBfm55USqnaGpKcqYpRXdrmgvnUzQ3Z1CYVHlETYGyP4fYlWN7LMCn9SE+NMJ8XgsQdySQg1l4GWQvN8FhPcmv/RhOaw1Np0SbMotDV0Boy9F6MYNC7JzCaigy7qly1VLBZSjgN2fxGDMEzBk0qiIpa5S/twwseEPsx7y8n7FiNdeoj6awiDKL0SKlSA2v5waKPqGESVtmIzKBXSjwoujn+OEQf+5FOD7wMuNLIoen4XWY/Xyaw+UMR3sxBmx1xgeqaDoq+EQJpziDzVxHYVFXcPXOMeTfYMC1dipNj1TI+UrE+9OYdbM0Ill43Mt+Js4beYzfu3606nnsfQ1MplXq0RLXYg1Cwc2TwSrefplUeIV0ZIVRT4NQYJVB5zJCl4xemMfVU2ZqMI3bWGK0VyLuyKFXV+lRV9ELc7iNFfr0MhaxjsLWLRMyzjIsVk+xaeawauawaeex62rYdDV6tdfRqZcwaxYwdS9gEBax6f93J2nX1tB0yAjt8/wDTkVPM/Wio7AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Security-1\"\n        title=\"Security-1\"\n        src=\"/static/28f258107b7493dc44a5c58d947caa19/1e043/security-1.png\"\n        srcset=\"/static/28f258107b7493dc44a5c58d947caa19/991de/security-1.png 173w,\n/static/28f258107b7493dc44a5c58d947caa19/e4d6b/security-1.png 345w,\n/static/28f258107b7493dc44a5c58d947caa19/1e043/security-1.png 690w,\n/static/28f258107b7493dc44a5c58d947caa19/e3189/security-1.png 1035w,\n/static/28f258107b7493dc44a5c58d947caa19/b1001/security-1.png 1380w,\n/static/28f258107b7493dc44a5c58d947caa19/8b84a/security-1.png 1531w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><a href=\"https://acloudguru.com\">Image Credit: acloudguru</a></p>\n<p>When a request comes in from the internet, it hits our router that defers to our route table. The request then goes through NACL and then finally to our security group. The security group is our last line of defense. If you have internet connectivity issues in your VPC, check to see if the route table has correct entry, check if NACL rules are correct (we'll discuss this later) and finally check your security groups.</p>\n<p>Security groups are stateful: if you send a request from your instance, the response traffic for that request is allowed to flow in both directions. If port 80 is open, requests can come in via that port and can go out through that port as well. <strong>Responses to allowed inbound traffic are allowed to flow out, regardless of outbound rules</strong>. So if you open port 80 to the world for inbound and try to block outbound at port 80, it won't work.</p>\n<h2 id=\"nacls\" style=\"position:relative;\"><a href=\"#nacls\" aria-label=\"nacls permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NACLs</h2>\n<p>A NACL is a layer of security for your VPC that acts as a firewall for controlling traffic in and out of one or more subnets.</p>\n<ul>\n<li>Default NACLs ALLOW all inbound and outbound traffic.</li>\n<li>If you create a custom NACL, it'll DENY all inbound and outbound traffic until you add rules.</li>\n<li>Each subnet in your VPC must be associated with a NACL. A single NACL can be tied to multiple subnets but each subnet must only have 1 NACL associated</li>\n<li>If you don't explicitly associate a subnet with a NACL, the subnet is automatically associated with default NACL.</li>\n<li>Best practice is to block IP addresses using NACLs and not security groups</li>\n<li>NACLs contain a numbered list of rules that are evaluated in order, starting with the lowest numbered rule.</li>\n<li>NACLs have separate inbound and outbound rules and each rule can be either allow or deny</li>\n<li>NACLs are stateless: responses to allowed inbound traffic are subject to the rules for outbound traffic and vice versa</li>\n</ul>\n<p>Let's look at a demo:</p>\n<ul>\n<li>ssh into the WebServer and install apache: <code class=\"language-cpptext\">sudo yum install httpd</code></li>\n<li>run <code class=\"language-cpptext\">sudo service httpd start</code></li>\n<li><code class=\"language-cpptext\">cd /var/www/html</code></li>\n<li>create a index.html file:</li>\n</ul>\n<p><code class=\"language-cpptext\">echo &quot;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hello!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&quot; &gt; index.html</code></p>\n<ul>\n<li>Now visit the public address of your WebServer and you should see hello! Close this tab</li>\n<li>Now go to Network ACLs in AWS console and check Inbound Rules for your test VPC: You'll see it allows all traffic with rule number 100 and a deny rule after that.</li>\n<li>Let's create a new NACL and choose our VPC.</li>\n<li>Looking at the rules of the newly created NACL, you'll see it denies both inboud and outbound traffic</li>\n<li>Try associating our public subnet with this NACL and hit save. Re-open the public EC2's URl page and you'll see there's an error now!</li>\n<li>Edit NACLs inbound rule. Start with a rule number of 100 and increment by 100 for each new rule. Rule number 100 will be checked first, then 200 and so on. Items below show what I've added (Rule number -> Type -> Source -> Allow/Deny)\n<ul>\n<li>100 -> HTTP -> 0.0.0.0/0 -> ALLOW</li>\n<li>200 -> SSH -> 0.0.0.0/0 -> ALLOW</li>\n<li>Since NACLs are stateless, we need to add similar rules to outbound rules as well</li>\n<li>100 -> HTTP -> 0.0.0.0/0 -> ALLOW</li>\n<li>200 -> SSH -> 0.0.0.0/0 -> ALLOW</li>\n<li>We also need to add ephemeral ports:\n<ul>\n<li>300 -> Custom TCP -> 1024-65535 (This is the port range) -> 0.0.0.0/0 -> ALLOW</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>Refresh the webpage and you should see the same Hello page again!</li>\n</ul>\n<!-- copy and paste. Modify height and width if desired. -->\n<div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 53.546592489568845%; position: relative; height: 0; overflow: hidden; \" > <iframe class=\"embeddedObject shadow resizable\" name=\"embedded_content\" scrolling=\"no\" frameborder=\"0\" type=\"text/html\" style=\"overflow:hidden; position: absolute; top: 0; left: 0; width: 100%; height: 100%; \" src=\"https://www.screencast.com/users/IqbalKhan8502/folders/Capture/media/ec8549ff-76cb-465c-ba83-c986ba0f611a/embed\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\"></iframe> </div>\n<p>A few caveats:</p>\n<ul>\n<li>If there're two conflicting rules, the rule that shows first in sorted order is one that's applied. Example:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-cppbash\"><code class=\"language-cppbash\"><span class=\"token number\">50</span> HTTP<span class=\"token punctuation\">(</span><span class=\"token number\">80</span><span class=\"token punctuation\">)</span> Deny\n<span class=\"token number\">100</span> HTTP<span class=\"token punctuation\">(</span><span class=\"token number\">80</span><span class=\"token punctuation\">)</span> Allow</code></pre></div>\n<p>Deny will remain in effect even though there's an allow!</p>\n<ul>\n<li>To deny an IP address, say you have the following rules:</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-cppbash\"><code class=\"language-cppbash\"><span class=\"token number\">100</span> HTTP<span class=\"token punctuation\">(</span><span class=\"token number\">80</span><span class=\"token punctuation\">)</span> Allow</code></pre></div>\n<p>You'll have to add the deny with a lower rule number than that of HTTP(80) Allow:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-cppbash\"><code class=\"language-cppbash\"><span class=\"token number\">99</span> HTTP<span class=\"token punctuation\">(</span><span class=\"token number\">80</span><span class=\"token punctuation\">)</span> Deny\n<span class=\"token number\">100</span> HTTP<span class=\"token punctuation\">(</span><span class=\"token number\">80</span><span class=\"token punctuation\">)</span> Allow</code></pre></div>\n<h2 id=\"vpc-endpoints\" style=\"position:relative;\"><a href=\"#vpc-endpoints\" aria-label=\"vpc endpoints permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>VPC Endpoints</h2>\n<p>A VPC endpoint enables connections between a virtual private cloud (VPC) and supported services, without requiring that you use an internet gateway, NAT device, VPN connection, or AWS Direct Connect connection. Therefore, your VPC is not exposed to the public internet. Traffic between your VPC and the other service does not leave the Amazon network.</p>\n<p>VPC endpoints are virtual devices. They are horizontally scaled, redundant, and highly available VPC components. The following are the different types of VPC endpoints. You create the type of VPC endpoint that's required by the supported service.</p>\n<h3 id=\"interface-endpoints\" style=\"position:relative;\"><a href=\"#interface-endpoints\" aria-label=\"interface endpoints permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Interface endpoints</h3>\n<p>An interface endpoint is an elastic network interface with a private IP address from the IP address range of your subnet. It serves as an entry point for traffic destined to a service that is owned by AWS or owned by an AWS customer or partner.</p>\n<h3 id=\"gateway-endpoints\" style=\"position:relative;\"><a href=\"#gateway-endpoints\" aria-label=\"gateway endpoints permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gateway endpoints</h3>\n<p>A gateway endpoint is a gateway that is a target for a route in your route table used for traffic destined to either Amazon S3 or DynamoDB.</p>\n<p>For the next demo, we'll have our DBServer EC2 instance communicate with S3 via a VPC endpoint of type gateway endpoint:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50.28901734104046%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAACi0lEQVQoz0XKb08SAQCA8XtXKiiHwIGHB3gcHP/BVWptFMJh2hHggQJygJniKLU/a7VeVGur3tZcvewr1Ddo62P0BfoYT6u1evF78+wRROcGerRDUuuSTfZJxnqk4ntkkjYpfY98Zkgw0GD6QhnntPGPY+qvaYOZi+V/hHlXjZQ+IhkfkYgNCMktFLlFZLFFJNhCVdrIUgP3nIlHNPn9u+dq+NwmktvE+7uJt3FMbeCYqiKE/E3SCwb5YIWcXEb3lUn7y4TEKpJzA8lZRXYZZBYMNF+VhFSmIK+z4NrAO7vJFWUde3UTx3QN18wWgiZbqL4uicA+Mf+IiGeI4u4wP2sRcFm4nW2SQYt3ZpHdZYNXtSpfx9fxidvMzjTwu26zEm3gmWsgOuoIcaWLJHZ5XKnTv7TF90cVfrw2aOYMTkq3uJFoUtCGnLdL3Lm2xYeRxbdnJvn0IfOuHRxTTcKBXXyihThrIehKj7C3R04fs6J1eWHWedvewUjvkNEnJNQxiYDF55MBdyu7nF69yqf6MgV9n0mpQTRyh+NKh+3iXYrFpwjJsM2iNKAQ6rAkj/B4DlClHkFvn9Voh1jQJr+0x/tWheGayZtWky+TLa6kD6mkLIJSn7V4j4TSJyyPENJLI/zeAQ9KJqXsgPXlAx5Xtzm7ZfPzY5uXtRq52CHn7QrjYoNze5vvT26S1I7wiDZeV4+4MmTB08cn9hCy6j7x8DGFwnMS8Yfo2imF3BNS0SNWsve4lD3lsrpPN9/kstrhutakka0he/ZQfDZBr01OHRH2D5G9QwQ9fMSyPiEfv0dBv/9HTpuQjR6TUcdkUmecFce8WO0TUY5ILY2JhY7JRQ//08Yo/gMWpQN+ATYdUng3H1x3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"VPC-Gateway-Endpoint\"\n        title=\"VPC-Gateway-Endpoint\"\n        src=\"/static/af16e40525140832e1fd8dd93f54af8f/1e043/vpc-endpoint-s3.png\"\n        srcset=\"/static/af16e40525140832e1fd8dd93f54af8f/991de/vpc-endpoint-s3.png 173w,\n/static/af16e40525140832e1fd8dd93f54af8f/e4d6b/vpc-endpoint-s3.png 345w,\n/static/af16e40525140832e1fd8dd93f54af8f/1e043/vpc-endpoint-s3.png 690w,\n/static/af16e40525140832e1fd8dd93f54af8f/e3189/vpc-endpoint-s3.png 1035w,\n/static/af16e40525140832e1fd8dd93f54af8f/b1001/vpc-endpoint-s3.png 1380w,\n/static/af16e40525140832e1fd8dd93f54af8f/8b84a/vpc-endpoint-s3.png 1531w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><a href=\"https://acloudguru.com\">Image Credit: acloudguru</a></p>\n<p>Here's what we'll go through:</p>\n<ul>\n<li>For DBServer EC2 instance to communicate with S3, it needs to have the relevant permissions. To do so, we'll add the S3 role</li>\n<li>We'll first go to IAM and create an S3_FULL_ACCESS role for EC2 service</li>\n<li>We'll then go to EC2 console and add the role to our DBServer</li>\n<li>Next, we'll go back to VPC console and Click on Endpoints -> Choose service as s3</li>\n<li>We'll get back the option of choosing a Gateway or Interface. We'll choose gateway</li>\n<li>Choose our VPC</li>\n<li>Choose route table where you want this gateway to be placed. Look at the diagram above again: route table should be our private instance's route table</li>\n<li>Create endpoint!</li>\n<li>SSH into our DBServer via WebServer and run S3 comands to confirm</li>\n<li>Commands could be: <code class=\"language-cpptext\">aws s3 ls</code></li>\n</ul>\n<!-- copy and paste. Modify height and width if desired. -->\n<div class=\"gatsby-resp-iframe-wrapper\" style=\"padding-bottom: 52.932960893854755%; position: relative; height: 0; overflow: hidden; \" > <iframe class=\"embeddedObject shadow resizable\" name=\"embedded_content\" scrolling=\"no\" frameborder=\"0\" type=\"text/html\" style=\"overflow:hidden; position: absolute; top: 0; left: 0; width: 100%; height: 100%; \" src=\"https://www.screencast.com/users/IqbalKhan8502/folders/Capture/media/d9e2cfe1-28e0-461f-af5c-5f05e463c9cf/embed\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\"></iframe> </div>\n<h2 id=\"vpc-peering\" style=\"position:relative;\"><a href=\"#vpc-peering\" aria-label=\"vpc peering permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>VPC Peering</h2>\n<p>You may need to connect multiple VPCs together for various reasons.</p>\n<ul>\n<li>VPC peering allows you to connect one VPC with another using private IP addresses.</li>\n<li>VPC can be peered in the same account or a different account.</li>\n<li>Peering is in a star config: 1 central VPC with 4 others.</li>\n<li>Peering can't be transitive. If A -> B and B -> C, then A is NOT connected to C.</li>\n<li>Peering can be done between regions</li>\n<li>Can't have overlapping CIDR address ranges between Accepter and Requester VPCs</li>\n</ul>\n<h2 id=\"sharing-applications-across-vpcs\" style=\"position:relative;\"><a href=\"#sharing-applications-across-vpcs\" aria-label=\"sharing applications across vpcs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sharing Applications across VPCs</h2>\n<p>To share data between 2 VPCs one could create a VPC Peering or make the resources publicly available. Best approach is to use PrivateLink! To use this, you need:</p>\n<ul>\n<li>Network Load Balancer on service VPC</li>\n<li>Elastic Network Interface or ENI on customer VPC</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 690px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 28.323699421965316%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABuElEQVQY0x3OTWvTAADG8XwKQexb0iZNk6a1Sbd2ymbGLrqiTkXqTsPSl7Vp0ia+sCHzsE13mEp1ogPFKr6cFMXDRFR220BhKDg8DPwAHjwInv9iD8/p/zs8wqhWQRNrZBM15GgLMdwmEXWQIm00sYmdPs+YXqGYqqLEWsQj/5szcGqsSSZeRRdrDCsVJjIVhIvHyoybLhPmLMOpOjm5jiY1UcUmQ8kaWXkWU2lwSKuSkhw0qYWlNMjJDUb0GqVCE9vqMDN6joXSFEKvt8GHnT3ebe4yOX6VaLjL+pVV+strmOlLJEUXVfIw1ICH80vc8pcGRgy1mDp6jffbe3z6+pN7vbdI+6sIdx9t8eDLH7Z+/B6AcOwyn5/eZ/f1Y/LWAmnZI5Pskk3P8e35HT6ur3EgdIFY2GX61Covtn/x8vtfnj3ZJLSvjnCytMLK9TcEXp9cqktKDjh7+iYnjt/A0v3BO0X0sItzlMu3mS73GMrNI0VcrHRA1+2zvPiKM5OLJGNtBD3uYGkdDNklrzoUtDZ2PsC2fIqaQ0bpDHbYcBkzfY5YPiOGR0FzMJMORqLNQdXDSDiocsA/A2z0o7Pb4p4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Private-Link\"\n        title=\"Private-Link\"\n        src=\"/static/bd1e9dd31be6bc342f2b120428584dfb/1e043/private-link.png\"\n        srcset=\"/static/bd1e9dd31be6bc342f2b120428584dfb/991de/private-link.png 173w,\n/static/bd1e9dd31be6bc342f2b120428584dfb/e4d6b/private-link.png 345w,\n/static/bd1e9dd31be6bc342f2b120428584dfb/1e043/private-link.png 690w,\n/static/bd1e9dd31be6bc342f2b120428584dfb/e3189/private-link.png 1035w,\n/static/bd1e9dd31be6bc342f2b120428584dfb/b1001/private-link.png 1380w,\n/static/bd1e9dd31be6bc342f2b120428584dfb/2dab4/private-link.png 1461w\"\n        sizes=\"(max-width: 690px) 100vw, 690px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n    </span><a href=\"https://acloudguru.com\">Image Credit: acloudguru</a></p>\n<h2 id=\"connect-data-center-to-aws\" style=\"position:relative;\"><a href=\"#connect-data-center-to-aws\" aria-label=\"connect data center to aws permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Connect Data Center to AWS</h2>\n<p>We can use AWS DirectConnect to establish a connection from your premises to AWS. There are 2 types of connections: dedicated vs hosted.</p>\n<p>Talking about all the ways to connect VPCs to VPCs, our network topology can become quite complicated! To simplify it, we can use <strong>AWS Transit Gateway</strong>.</p>","timeToRead":21,"excerpt":"Table of Contents What is VPC? Intro Key Concepts 3 tier architecture Network diagram for VPC IP address ranges Default Options Public…","frontmatter":{"title":"AWS - VPC","date":"2021-12-26T00:00:00.000Z","categories":["AWS"],"extract":"Notes for VPC","thumbnail":"/post-images/aws-vpc.png","tags":["blog","AWS"]},"fields":{"slug":"/aws-vpc","date":"December 26, 2021"}}},"pageContext":{"slug":"/aws-vpc","nexttitle":"AWS - DynamoDB","nextslug":"/aws-dynamo-db","prevtitle":"AWS - Route 53","prevslug":"/aws-route-53"}},"staticQueryHashes":["3969716136"]}