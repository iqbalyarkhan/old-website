---
date: 2021-06-09
draft: false
thumbnail: /post-images/graphql.png
title: GraphQL Notes
extract: My notes as I learn GraphQL
categories:
  - React
tags:
  - blog
  - React
---

- [Introduction](#introduction)
- [GraphQL and Github](#graphql-and-github)
- [Query](#query)
- [Fragments](#fragments)
- [Variables](#variables)
- [Default Variables](#default-variables)
- [Named Queries](#named-queries)
- [Nested Objects](#nested-objects)
- [Directives](#directives)

### Introduction

GraphQL is a query language and server-side runtime for application programming interfaces (APIs) that prioritizes giving clients exactly the data they request and no more. GraphQL is designed to make APIs fast, flexible, and developer-friendly. It can even be deployed within an integrated development environment (IDE) known as GraphiQL. As an alternative to REST, GraphQL lets developers construct requests that pull data from multiple data sources in a single API call.

### GraphQL and Github

To get started, let's use Github's GraphQL API. To use GitHub’s GraphQL API, you need to generate a personal access token. The access token authorizes users to interact with data. It allows you to read and write data with your username.

There are two common ways to interact with the GitHub GraphQL API:

- First, you can use [GitHub’s GraphQL Explorer](https://docs.github.com/en/graphql/overview/explorer). You only need to sign up with your GitHub account to run GraphQL queries.
- Second, you can use a generic client called `GraphiQL`. It allows you to run GraphQL queries against your github account using the token you generated.

### Query

```graphql
query {
  viewer {
    login
    url
  }
}
```

output:

```json
{
  "data": {
    "viewer": {
      "login": "iqbalyarkhan",
      "url": "https://github.com/iqbalyarkhan",
      "avatarUrl": "https://xyz.com/u/123"
    }
  }
}
```

Example above starts with keyword `query`. Inside the query, we provider the `viewer` object that can be used to request data about the currently authorized user. Since you are authorized by your personal access token, it should show data about your account.

The viewer is an `object` in GraphQL terms. Objects hold data about an entity.

This data is accessed using a so-called `field` in GraphQL. Fields are used to ask for specific `properties` in objects. For instance, the viewer object exposes a wide range of fields. Two fields for the object–name and url–were used in the query.

To specify a GitHub organization, you can pass an `argument` to fields. In the example below, I've provided `login` as an argument:

```graphql
query {
  organization(login: "SMUCSEG2Consulting") {
    name
    descriptionHTML
    url
  }
}
```

output:

```json
{
  "data": {
    "organization": {
      "name": "SMUCSEG2Consulting",
      "descriptionHTML": "<div></div>",
      "url": "https://github.com/SMUCSEG2Consulting"
    }
  }
}
```

What if you're part of 2 organizations? Simply add 2 queries right?

```graphql
query {
  organization(login: "SMUCSEG2Consulting") {
    name
    descriptionHTML
    url
  }
  organization(login: "SMUCSE2341") {
    name
    descriptionHTML
    url
  }
}
```

output: You’d see an error such as `Field 'organization' has an argument conflict`.

That's because you're requesting 2 objects with the same structure. If you ever wanted to request data about two identical objects, you would have to use `aliases` because GraphQL wouldn’t know how to resolve the two organization objects in a result. Here's how you'd do it. (Note the use of `consulting` and `teaching` as aliases):

```graphql
query {
  consulting: organization(login: "SMUCSEG2Consulting") {
    name
    descriptionHTML
    url
  }
  teaching: organization(login: "SMUCSE2341") {
    name
    descriptionHTML
    url
  }
}
```

output:

```json
{
  "data": {
    "consulting": {
      "name": "SMUCSEG2Consulting",
      "descriptionHTML": "<div></div>",
      "url": "https://github.com/SMUCSEG2Consulting"
    },
    "teaching": {
      "name": "CS 2341 - Data Structures",
      "descriptionHTML": "<div>Github Org for SMU's Data Structures Class</div>",
      "url": "https://github.com/SMUCSE2341"
    }
  }
}
```

### Fragments

Note how we repeated the same fields(name, descriptionHTML and url) over and over in the query above:

```graphql
query {
  consulting: organization(login: "SMUCSEG2Consulting") {
    name
    descriptionHTML
    url
  }
  teaching: organization(login: "SMUCSE2341") {
    name
    descriptionHTML
    url
  }
}
```

We can extract commonly used fields into something called a `fragment`. Fragment specifies 2 pieces of information:

- What fields should form the query
- What type of object can the fragment be used on

Here's how you define a fragment

```graphql
fragment nameOfFragment on nameOfObject {
  field1
  field2
}
```

Now converting our 3 fields into a fragment we get:

```graphql
fragment sharedOrgFields on Organization {
  name
  descriptionHTML
  url
}
```

We can now change our query to:

```graphql
query {
  consulting: organization(login: "SMUCSEG2Consulting") {
    ...sharedOrgFields
  }
  teaching: organization(login: "SMUCSE2341") {
    ...sharedOrgFields
  }
}

fragment sharedOrgFields on Organization {
  name
  descriptionHTML
  url
}
```

### Variables

In the previous queries, you provided arguments that identified an organization to your fields; but you **inlined** these arguments in your query. Think about a query like a function, where it’s important to provide dynamic arguments to it. That’s where the `variable` in GraphQL comes in: it allows arguments to be extracted as variables from queries. Here’s how an organization’s login argument can be extracted to a dynamic variable (let's use a single organization for now):

```graphql
query ($organization: String!) {...}
```

We've provided name of the variable, `organization`, to our query via the `$` sign. We're also providing the **type** of variable which is `String`. Exclamation point `!` means that the argument is required.

Here's the previous example in its entirety using variables (I removed the alias since there's only 1 org now):

```graphql
query ($organization: String!) {
  organization(login: $organization) {
    ...sharedOrgFields
  }
}

fragment sharedOrgFields on Organization {
  name
  descriptionHTML
  url
}
```

To pass in the variables, you'd do so in the query variables section:

```json
{ "organization": "SMUCSE2341" }
```

### Default Variables

What if you have a field that can be provided in some cases and omitted in others? You can use a default variable. To do so, simply make the variable non-required (by removing exclamation) and provide a default value:

```graphql
query ($organization: String = "SMUCSE2341") {
  organization(login: $organization) {
    ...sharedOrgFields
  }
}

fragment sharedOrgFields on Organization {
  name
  descriptionHTML
  url
}
```

### Named Queries

What if you had multiple queries? To keep things clean, we can also name our queries:

```graphql
query getOrgInfo($organization: String = "SMUSCE2341") {
  organization(login: $organization) {
    ...sharedOrgFields
  }
}

fragment sharedOrgFields on Organization {
  name
  descriptionHTML
  url
}
```

### Nested Objects

So far we've only looked at organization info. Let's find out the repos owned by an org. An org has another field called `repository` that can disply info of the repo name passed in.

Let's pass in the repo's name dynamically. Let's remove the default args and make org name and repo name required:

```graphql
query getOrgInfo($organization: String!, $repository: String!) {
  organization(login: $organization) {
    ...sharedOrgFields
    repository(name: $repository) {
      name
    }
  }
}
fragment sharedOrgFields on Organization {
  name
  descriptionHTML
  url
}
```

with the following query variables:

```json
{ "organization": "SMUCSE2341", "repository": "Sprint4Headers" }
```

will return this:

```json
{
  "data": {
    "organization": {
      "name": "CS 2341 - Data Structures",
      "descriptionHTML": "<div>Github Org for SMU's Data Structures Class</div>",
      "url": "https://github.com/SMUCSE2341",
      "repository": {
        "name": "Sprint4Headers"
      }
    }
  }
}
```

### Directives
